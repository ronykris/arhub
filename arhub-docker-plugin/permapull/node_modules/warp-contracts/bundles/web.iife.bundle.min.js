var warp=(()=>{var Th=Object.create;var Rn=Object.defineProperty;var xh=Object.getOwnPropertyDescriptor;var Ch=Object.getOwnPropertyNames;var Ih=Object.getPrototypeOf,Ah=Object.prototype.hasOwnProperty;var kh=(n,t,e)=>t in n?Rn(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var Lh=(n,t)=>()=>(n&&(t=n(n=0)),t);var ft=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports),Oh=(n,t)=>{for(var e in t)Rn(n,e,{get:t[e],enumerable:!0})},qc=(n,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Ch(t))!Ah.call(n,i)&&i!==e&&Rn(n,i,{get:()=>t[i],enumerable:!(r=xh(t,i))||r.enumerable});return n};var zt=(n,t,e)=>(e=n!=null?Th(Ih(n)):{},qc(t||!n||!n.__esModule?Rn(e,"default",{value:n,enumerable:!0}):e,n)),Bh=n=>qc(Rn({},"__esModule",{value:!0}),n);var sr=(n,t,e)=>(kh(n,typeof t!="symbol"?t+"":t,e),e);var wa=ft(qi=>{"use strict";R();qi.byteLength=Ph;qi.toByteArray=Uh;qi.fromByteArray=Mh;var ke=[],ye=[],Rh=typeof Uint8Array<"u"?Uint8Array:Array,ya="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(Ir=0,jc=ya.length;Ir<jc;++Ir)ke[Ir]=ya[Ir],ye[ya.charCodeAt(Ir)]=Ir;var Ir,jc;ye["-".charCodeAt(0)]=62;ye["_".charCodeAt(0)]=63;function Hc(n){var t=n.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var e=n.indexOf("=");e===-1&&(e=t);var r=e===t?0:4-e%4;return[e,r]}function Ph(n){var t=Hc(n),e=t[0],r=t[1];return(e+r)*3/4-r}function Nh(n,t,e){return(t+e)*3/4-e}function Uh(n){var t,e=Hc(n),r=e[0],i=e[1],o=new Rh(Nh(n,r,i)),a=0,s=i>0?r-4:r,l;for(l=0;l<s;l+=4)t=ye[n.charCodeAt(l)]<<18|ye[n.charCodeAt(l+1)]<<12|ye[n.charCodeAt(l+2)]<<6|ye[n.charCodeAt(l+3)],o[a++]=t>>16&255,o[a++]=t>>8&255,o[a++]=t&255;return i===2&&(t=ye[n.charCodeAt(l)]<<2|ye[n.charCodeAt(l+1)]>>4,o[a++]=t&255),i===1&&(t=ye[n.charCodeAt(l)]<<10|ye[n.charCodeAt(l+1)]<<4|ye[n.charCodeAt(l+2)]>>2,o[a++]=t>>8&255,o[a++]=t&255),o}function Wh(n){return ke[n>>18&63]+ke[n>>12&63]+ke[n>>6&63]+ke[n&63]}function Dh(n,t,e){for(var r,i=[],o=t;o<e;o+=3)r=(n[o]<<16&16711680)+(n[o+1]<<8&65280)+(n[o+2]&255),i.push(Wh(r));return i.join("")}function Mh(n){for(var t,e=n.length,r=e%3,i=[],o=16383,a=0,s=e-r;a<s;a+=o)i.push(Dh(n,a,a+o>s?s:a+o));return r===1?(t=n[e-1],i.push(ke[t>>2]+ke[t<<4&63]+"==")):r===2&&(t=(n[e-2]<<8)+n[e-1],i.push(ke[t>>10]+ke[t>>4&63]+ke[t<<2&63]+"=")),i.join("")}});var Qc=ft(ma=>{R();ma.read=function(n,t,e,r,i){var o,a,s=i*8-r-1,l=(1<<s)-1,g=l>>1,v=-7,A=e?i-1:0,B=e?-1:1,m=n[t+A];for(A+=B,o=m&(1<<-v)-1,m>>=-v,v+=s;v>0;o=o*256+n[t+A],A+=B,v-=8);for(a=o&(1<<-v)-1,o>>=-v,v+=r;v>0;a=a*256+n[t+A],A+=B,v-=8);if(o===0)o=1-g;else{if(o===l)return a?NaN:(m?-1:1)*(1/0);a=a+Math.pow(2,r),o=o-g}return(m?-1:1)*a*Math.pow(2,o-r)};ma.write=function(n,t,e,r,i,o){var a,s,l,g=o*8-i-1,v=(1<<g)-1,A=v>>1,B=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,m=r?0:o-1,E=r?1:-1,N=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=v):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+A>=1?t+=B/l:t+=B*Math.pow(2,1-A),t*l>=2&&(a++,l/=2),a+A>=v?(s=0,a=v):a+A>=1?(s=(t*l-1)*Math.pow(2,i),a=a+A):(s=t*Math.pow(2,A-1)*Math.pow(2,i),a=0));i>=8;n[e+m]=s&255,m+=E,s/=256,i-=8);for(a=a<<i|s,g+=i;g>0;n[e+m]=a&255,m+=E,a/=256,g-=8);n[e+m-E]|=N*128}});var nn=ft(rn=>{"use strict";R();var va=wa(),en=Qc(),zc=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;rn.Buffer=Y;rn.SlowBuffer=qh;rn.INSPECT_MAX_BYTES=50;var ji=2147483647;rn.kMaxLength=ji;Y.TYPED_ARRAY_SUPPORT=$h();!Y.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function $h(){try{var n=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(n,t),n.foo()===42}catch{return!1}}Object.defineProperty(Y.prototype,"parent",{enumerable:!0,get:function(){if(Y.isBuffer(this))return this.buffer}});Object.defineProperty(Y.prototype,"offset",{enumerable:!0,get:function(){if(Y.isBuffer(this))return this.byteOffset}});function Ge(n){if(n>ji)throw new RangeError('The value "'+n+'" is invalid for option "size"');var t=new Uint8Array(n);return Object.setPrototypeOf(t,Y.prototype),t}function Y(n,t,e){if(typeof n=="number"){if(typeof t=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return Sa(n)}return Xc(n,t,e)}Y.poolSize=8192;function Xc(n,t,e){if(typeof n=="string")return Kh(n,t);if(ArrayBuffer.isView(n))return Vh(n);if(n==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof n);if(Le(n,ArrayBuffer)||n&&Le(n.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(Le(n,SharedArrayBuffer)||n&&Le(n.buffer,SharedArrayBuffer)))return _a(n,t,e);if(typeof n=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var r=n.valueOf&&n.valueOf();if(r!=null&&r!==n)return Y.from(r,t,e);var i=Gh(n);if(i)return i;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof n[Symbol.toPrimitive]=="function")return Y.from(n[Symbol.toPrimitive]("string"),t,e);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof n)}Y.from=function(n,t,e){return Xc(n,t,e)};Object.setPrototypeOf(Y.prototype,Uint8Array.prototype);Object.setPrototypeOf(Y,Uint8Array);function Zc(n){if(typeof n!="number")throw new TypeError('"size" argument must be of type number');if(n<0)throw new RangeError('The value "'+n+'" is invalid for option "size"')}function Fh(n,t,e){return Zc(n),n<=0?Ge(n):t!==void 0?typeof e=="string"?Ge(n).fill(t,e):Ge(n).fill(t):Ge(n)}Y.alloc=function(n,t,e){return Fh(n,t,e)};function Sa(n){return Zc(n),Ge(n<0?0:Ta(n)|0)}Y.allocUnsafe=function(n){return Sa(n)};Y.allocUnsafeSlow=function(n){return Sa(n)};function Kh(n,t){if((typeof t!="string"||t==="")&&(t="utf8"),!Y.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var e=tu(n,t)|0,r=Ge(e),i=r.write(n,t);return i!==e&&(r=r.slice(0,i)),r}function ba(n){for(var t=n.length<0?0:Ta(n.length)|0,e=Ge(t),r=0;r<t;r+=1)e[r]=n[r]&255;return e}function Vh(n){if(Le(n,Uint8Array)){var t=new Uint8Array(n);return _a(t.buffer,t.byteOffset,t.byteLength)}return ba(n)}function _a(n,t,e){if(t<0||n.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(n.byteLength<t+(e||0))throw new RangeError('"length" is outside of buffer bounds');var r;return t===void 0&&e===void 0?r=new Uint8Array(n):e===void 0?r=new Uint8Array(n,t):r=new Uint8Array(n,t,e),Object.setPrototypeOf(r,Y.prototype),r}function Gh(n){if(Y.isBuffer(n)){var t=Ta(n.length)|0,e=Ge(t);return e.length===0||n.copy(e,0,0,t),e}if(n.length!==void 0)return typeof n.length!="number"||xa(n.length)?Ge(0):ba(n);if(n.type==="Buffer"&&Array.isArray(n.data))return ba(n.data)}function Ta(n){if(n>=ji)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+ji.toString(16)+" bytes");return n|0}function qh(n){return+n!=n&&(n=0),Y.alloc(+n)}Y.isBuffer=function(t){return t!=null&&t._isBuffer===!0&&t!==Y.prototype};Y.compare=function(t,e){if(Le(t,Uint8Array)&&(t=Y.from(t,t.offset,t.byteLength)),Le(e,Uint8Array)&&(e=Y.from(e,e.offset,e.byteLength)),!Y.isBuffer(t)||!Y.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;for(var r=t.length,i=e.length,o=0,a=Math.min(r,i);o<a;++o)if(t[o]!==e[o]){r=t[o],i=e[o];break}return r<i?-1:i<r?1:0};Y.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};Y.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(t.length===0)return Y.alloc(0);var r;if(e===void 0)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var i=Y.allocUnsafe(e),o=0;for(r=0;r<t.length;++r){var a=t[r];if(Le(a,Uint8Array))o+a.length>i.length?Y.from(a).copy(i,o):Uint8Array.prototype.set.call(i,a,o);else if(Y.isBuffer(a))a.copy(i,o);else throw new TypeError('"list" argument must be an Array of Buffers');o+=a.length}return i};function tu(n,t){if(Y.isBuffer(n))return n.length;if(ArrayBuffer.isView(n)||Le(n,ArrayBuffer))return n.byteLength;if(typeof n!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof n);var e=n.length,r=arguments.length>2&&arguments[2]===!0;if(!r&&e===0)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return e;case"utf8":case"utf-8":return Ea(n).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return e*2;case"hex":return e>>>1;case"base64":return au(n).length;default:if(i)return r?-1:Ea(n).length;t=(""+t).toLowerCase(),i=!0}}Y.byteLength=tu;function jh(n,t,e){var r=!1;if((t===void 0||t<0)&&(t=0),t>this.length||((e===void 0||e>this.length)&&(e=this.length),e<=0)||(e>>>=0,t>>>=0,e<=t))return"";for(n||(n="utf8");;)switch(n){case"hex":return rg(this,t,e);case"utf8":case"utf-8":return ru(this,t,e);case"ascii":return tg(this,t,e);case"latin1":case"binary":return eg(this,t,e);case"base64":return Xh(this,t,e);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ng(this,t,e);default:if(r)throw new TypeError("Unknown encoding: "+n);n=(n+"").toLowerCase(),r=!0}}Y.prototype._isBuffer=!0;function Ar(n,t,e){var r=n[t];n[t]=n[e],n[e]=r}Y.prototype.swap16=function(){var t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)Ar(this,e,e+1);return this};Y.prototype.swap32=function(){var t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)Ar(this,e,e+3),Ar(this,e+1,e+2);return this};Y.prototype.swap64=function(){var t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)Ar(this,e,e+7),Ar(this,e+1,e+6),Ar(this,e+2,e+5),Ar(this,e+3,e+4);return this};Y.prototype.toString=function(){var t=this.length;return t===0?"":arguments.length===0?ru(this,0,t):jh.apply(this,arguments)};Y.prototype.toLocaleString=Y.prototype.toString;Y.prototype.equals=function(t){if(!Y.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t?!0:Y.compare(this,t)===0};Y.prototype.inspect=function(){var t="",e=rn.INSPECT_MAX_BYTES;return t=this.toString("hex",0,e).replace(/(.{2})/g,"$1 ").trim(),this.length>e&&(t+=" ... "),"<Buffer "+t+">"};zc&&(Y.prototype[zc]=Y.prototype.inspect);Y.prototype.compare=function(t,e,r,i,o){if(Le(t,Uint8Array)&&(t=Y.from(t,t.offset,t.byteLength)),!Y.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(e===void 0&&(e=0),r===void 0&&(r=t?t.length:0),i===void 0&&(i=0),o===void 0&&(o=this.length),e<0||r>t.length||i<0||o>this.length)throw new RangeError("out of range index");if(i>=o&&e>=r)return 0;if(i>=o)return-1;if(e>=r)return 1;if(e>>>=0,r>>>=0,i>>>=0,o>>>=0,this===t)return 0;for(var a=o-i,s=r-e,l=Math.min(a,s),g=this.slice(i,o),v=t.slice(e,r),A=0;A<l;++A)if(g[A]!==v[A]){a=g[A],s=v[A];break}return a<s?-1:s<a?1:0};function eu(n,t,e,r,i){if(n.length===0)return-1;if(typeof e=="string"?(r=e,e=0):e>2147483647?e=2147483647:e<-2147483648&&(e=-2147483648),e=+e,xa(e)&&(e=i?0:n.length-1),e<0&&(e=n.length+e),e>=n.length){if(i)return-1;e=n.length-1}else if(e<0)if(i)e=0;else return-1;if(typeof t=="string"&&(t=Y.from(t,r)),Y.isBuffer(t))return t.length===0?-1:Jc(n,t,e,r,i);if(typeof t=="number")return t=t&255,typeof Uint8Array.prototype.indexOf=="function"?i?Uint8Array.prototype.indexOf.call(n,t,e):Uint8Array.prototype.lastIndexOf.call(n,t,e):Jc(n,[t],e,r,i);throw new TypeError("val must be string, number or Buffer")}function Jc(n,t,e,r,i){var o=1,a=n.length,s=t.length;if(r!==void 0&&(r=String(r).toLowerCase(),r==="ucs2"||r==="ucs-2"||r==="utf16le"||r==="utf-16le")){if(n.length<2||t.length<2)return-1;o=2,a/=2,s/=2,e/=2}function l(m,E){return o===1?m[E]:m.readUInt16BE(E*o)}var g;if(i){var v=-1;for(g=e;g<a;g++)if(l(n,g)===l(t,v===-1?0:g-v)){if(v===-1&&(v=g),g-v+1===s)return v*o}else v!==-1&&(g-=g-v),v=-1}else for(e+s>a&&(e=a-s),g=e;g>=0;g--){for(var A=!0,B=0;B<s;B++)if(l(n,g+B)!==l(t,B)){A=!1;break}if(A)return g}return-1}Y.prototype.includes=function(t,e,r){return this.indexOf(t,e,r)!==-1};Y.prototype.indexOf=function(t,e,r){return eu(this,t,e,r,!0)};Y.prototype.lastIndexOf=function(t,e,r){return eu(this,t,e,r,!1)};function Hh(n,t,e,r){e=Number(e)||0;var i=n.length-e;r?(r=Number(r),r>i&&(r=i)):r=i;var o=t.length;r>o/2&&(r=o/2);for(var a=0;a<r;++a){var s=parseInt(t.substr(a*2,2),16);if(xa(s))return a;n[e+a]=s}return a}function Qh(n,t,e,r){return Hi(Ea(t,n.length-e),n,e,r)}function zh(n,t,e,r){return Hi(ag(t),n,e,r)}function Jh(n,t,e,r){return Hi(au(t),n,e,r)}function Yh(n,t,e,r){return Hi(sg(t,n.length-e),n,e,r)}Y.prototype.write=function(t,e,r,i){if(e===void 0)i="utf8",r=this.length,e=0;else if(r===void 0&&typeof e=="string")i=e,r=this.length,e=0;else if(isFinite(e))e=e>>>0,isFinite(r)?(r=r>>>0,i===void 0&&(i="utf8")):(i=r,r=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var o=this.length-e;if((r===void 0||r>o)&&(r=o),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var a=!1;;)switch(i){case"hex":return Hh(this,t,e,r);case"utf8":case"utf-8":return Qh(this,t,e,r);case"ascii":case"latin1":case"binary":return zh(this,t,e,r);case"base64":return Jh(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Yh(this,t,e,r);default:if(a)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),a=!0}};Y.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Xh(n,t,e){return t===0&&e===n.length?va.fromByteArray(n):va.fromByteArray(n.slice(t,e))}function ru(n,t,e){e=Math.min(n.length,e);for(var r=[],i=t;i<e;){var o=n[i],a=null,s=o>239?4:o>223?3:o>191?2:1;if(i+s<=e){var l,g,v,A;switch(s){case 1:o<128&&(a=o);break;case 2:l=n[i+1],(l&192)===128&&(A=(o&31)<<6|l&63,A>127&&(a=A));break;case 3:l=n[i+1],g=n[i+2],(l&192)===128&&(g&192)===128&&(A=(o&15)<<12|(l&63)<<6|g&63,A>2047&&(A<55296||A>57343)&&(a=A));break;case 4:l=n[i+1],g=n[i+2],v=n[i+3],(l&192)===128&&(g&192)===128&&(v&192)===128&&(A=(o&15)<<18|(l&63)<<12|(g&63)<<6|v&63,A>65535&&A<1114112&&(a=A))}}a===null?(a=65533,s=1):a>65535&&(a-=65536,r.push(a>>>10&1023|55296),a=56320|a&1023),r.push(a),i+=s}return Zh(r)}var Yc=4096;function Zh(n){var t=n.length;if(t<=Yc)return String.fromCharCode.apply(String,n);for(var e="",r=0;r<t;)e+=String.fromCharCode.apply(String,n.slice(r,r+=Yc));return e}function tg(n,t,e){var r="";e=Math.min(n.length,e);for(var i=t;i<e;++i)r+=String.fromCharCode(n[i]&127);return r}function eg(n,t,e){var r="";e=Math.min(n.length,e);for(var i=t;i<e;++i)r+=String.fromCharCode(n[i]);return r}function rg(n,t,e){var r=n.length;(!t||t<0)&&(t=0),(!e||e<0||e>r)&&(e=r);for(var i="",o=t;o<e;++o)i+=cg[n[o]];return i}function ng(n,t,e){for(var r=n.slice(t,e),i="",o=0;o<r.length-1;o+=2)i+=String.fromCharCode(r[o]+r[o+1]*256);return i}Y.prototype.slice=function(t,e){var r=this.length;t=~~t,e=e===void 0?r:~~e,t<0?(t+=r,t<0&&(t=0)):t>r&&(t=r),e<0?(e+=r,e<0&&(e=0)):e>r&&(e=r),e<t&&(e=t);var i=this.subarray(t,e);return Object.setPrototypeOf(i,Y.prototype),i};function Kt(n,t,e){if(n%1!==0||n<0)throw new RangeError("offset is not uint");if(n+t>e)throw new RangeError("Trying to access beyond buffer length")}Y.prototype.readUintLE=Y.prototype.readUIntLE=function(t,e,r){t=t>>>0,e=e>>>0,r||Kt(t,e,this.length);for(var i=this[t],o=1,a=0;++a<e&&(o*=256);)i+=this[t+a]*o;return i};Y.prototype.readUintBE=Y.prototype.readUIntBE=function(t,e,r){t=t>>>0,e=e>>>0,r||Kt(t,e,this.length);for(var i=this[t+--e],o=1;e>0&&(o*=256);)i+=this[t+--e]*o;return i};Y.prototype.readUint8=Y.prototype.readUInt8=function(t,e){return t=t>>>0,e||Kt(t,1,this.length),this[t]};Y.prototype.readUint16LE=Y.prototype.readUInt16LE=function(t,e){return t=t>>>0,e||Kt(t,2,this.length),this[t]|this[t+1]<<8};Y.prototype.readUint16BE=Y.prototype.readUInt16BE=function(t,e){return t=t>>>0,e||Kt(t,2,this.length),this[t]<<8|this[t+1]};Y.prototype.readUint32LE=Y.prototype.readUInt32LE=function(t,e){return t=t>>>0,e||Kt(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+this[t+3]*16777216};Y.prototype.readUint32BE=Y.prototype.readUInt32BE=function(t,e){return t=t>>>0,e||Kt(t,4,this.length),this[t]*16777216+(this[t+1]<<16|this[t+2]<<8|this[t+3])};Y.prototype.readIntLE=function(t,e,r){t=t>>>0,e=e>>>0,r||Kt(t,e,this.length);for(var i=this[t],o=1,a=0;++a<e&&(o*=256);)i+=this[t+a]*o;return o*=128,i>=o&&(i-=Math.pow(2,8*e)),i};Y.prototype.readIntBE=function(t,e,r){t=t>>>0,e=e>>>0,r||Kt(t,e,this.length);for(var i=e,o=1,a=this[t+--i];i>0&&(o*=256);)a+=this[t+--i]*o;return o*=128,a>=o&&(a-=Math.pow(2,8*e)),a};Y.prototype.readInt8=function(t,e){return t=t>>>0,e||Kt(t,1,this.length),this[t]&128?(255-this[t]+1)*-1:this[t]};Y.prototype.readInt16LE=function(t,e){t=t>>>0,e||Kt(t,2,this.length);var r=this[t]|this[t+1]<<8;return r&32768?r|4294901760:r};Y.prototype.readInt16BE=function(t,e){t=t>>>0,e||Kt(t,2,this.length);var r=this[t+1]|this[t]<<8;return r&32768?r|4294901760:r};Y.prototype.readInt32LE=function(t,e){return t=t>>>0,e||Kt(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24};Y.prototype.readInt32BE=function(t,e){return t=t>>>0,e||Kt(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]};Y.prototype.readFloatLE=function(t,e){return t=t>>>0,e||Kt(t,4,this.length),en.read(this,t,!0,23,4)};Y.prototype.readFloatBE=function(t,e){return t=t>>>0,e||Kt(t,4,this.length),en.read(this,t,!1,23,4)};Y.prototype.readDoubleLE=function(t,e){return t=t>>>0,e||Kt(t,8,this.length),en.read(this,t,!0,52,8)};Y.prototype.readDoubleBE=function(t,e){return t=t>>>0,e||Kt(t,8,this.length),en.read(this,t,!1,52,8)};function re(n,t,e,r,i,o){if(!Y.isBuffer(n))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(e+r>n.length)throw new RangeError("Index out of range")}Y.prototype.writeUintLE=Y.prototype.writeUIntLE=function(t,e,r,i){if(t=+t,e=e>>>0,r=r>>>0,!i){var o=Math.pow(2,8*r)-1;re(this,t,e,r,o,0)}var a=1,s=0;for(this[e]=t&255;++s<r&&(a*=256);)this[e+s]=t/a&255;return e+r};Y.prototype.writeUintBE=Y.prototype.writeUIntBE=function(t,e,r,i){if(t=+t,e=e>>>0,r=r>>>0,!i){var o=Math.pow(2,8*r)-1;re(this,t,e,r,o,0)}var a=r-1,s=1;for(this[e+a]=t&255;--a>=0&&(s*=256);)this[e+a]=t/s&255;return e+r};Y.prototype.writeUint8=Y.prototype.writeUInt8=function(t,e,r){return t=+t,e=e>>>0,r||re(this,t,e,1,255,0),this[e]=t&255,e+1};Y.prototype.writeUint16LE=Y.prototype.writeUInt16LE=function(t,e,r){return t=+t,e=e>>>0,r||re(this,t,e,2,65535,0),this[e]=t&255,this[e+1]=t>>>8,e+2};Y.prototype.writeUint16BE=Y.prototype.writeUInt16BE=function(t,e,r){return t=+t,e=e>>>0,r||re(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=t&255,e+2};Y.prototype.writeUint32LE=Y.prototype.writeUInt32LE=function(t,e,r){return t=+t,e=e>>>0,r||re(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=t&255,e+4};Y.prototype.writeUint32BE=Y.prototype.writeUInt32BE=function(t,e,r){return t=+t,e=e>>>0,r||re(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=t&255,e+4};Y.prototype.writeIntLE=function(t,e,r,i){if(t=+t,e=e>>>0,!i){var o=Math.pow(2,8*r-1);re(this,t,e,r,o-1,-o)}var a=0,s=1,l=0;for(this[e]=t&255;++a<r&&(s*=256);)t<0&&l===0&&this[e+a-1]!==0&&(l=1),this[e+a]=(t/s>>0)-l&255;return e+r};Y.prototype.writeIntBE=function(t,e,r,i){if(t=+t,e=e>>>0,!i){var o=Math.pow(2,8*r-1);re(this,t,e,r,o-1,-o)}var a=r-1,s=1,l=0;for(this[e+a]=t&255;--a>=0&&(s*=256);)t<0&&l===0&&this[e+a+1]!==0&&(l=1),this[e+a]=(t/s>>0)-l&255;return e+r};Y.prototype.writeInt8=function(t,e,r){return t=+t,e=e>>>0,r||re(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=t&255,e+1};Y.prototype.writeInt16LE=function(t,e,r){return t=+t,e=e>>>0,r||re(this,t,e,2,32767,-32768),this[e]=t&255,this[e+1]=t>>>8,e+2};Y.prototype.writeInt16BE=function(t,e,r){return t=+t,e=e>>>0,r||re(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=t&255,e+2};Y.prototype.writeInt32LE=function(t,e,r){return t=+t,e=e>>>0,r||re(this,t,e,4,2147483647,-2147483648),this[e]=t&255,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4};Y.prototype.writeInt32BE=function(t,e,r){return t=+t,e=e>>>0,r||re(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=t&255,e+4};function nu(n,t,e,r,i,o){if(e+r>n.length)throw new RangeError("Index out of range");if(e<0)throw new RangeError("Index out of range")}function iu(n,t,e,r,i){return t=+t,e=e>>>0,i||nu(n,t,e,4,34028234663852886e22,-34028234663852886e22),en.write(n,t,e,r,23,4),e+4}Y.prototype.writeFloatLE=function(t,e,r){return iu(this,t,e,!0,r)};Y.prototype.writeFloatBE=function(t,e,r){return iu(this,t,e,!1,r)};function ou(n,t,e,r,i){return t=+t,e=e>>>0,i||nu(n,t,e,8,17976931348623157e292,-17976931348623157e292),en.write(n,t,e,r,52,8),e+8}Y.prototype.writeDoubleLE=function(t,e,r){return ou(this,t,e,!0,r)};Y.prototype.writeDoubleBE=function(t,e,r){return ou(this,t,e,!1,r)};Y.prototype.copy=function(t,e,r,i){if(!Y.isBuffer(t))throw new TypeError("argument should be a Buffer");if(r||(r=0),!i&&i!==0&&(i=this.length),e>=t.length&&(e=t.length),e||(e=0),i>0&&i<r&&(i=r),i===r||t.length===0||this.length===0)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-e<i-r&&(i=t.length-e+r);var o=i-r;return this===t&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(e,r,i):Uint8Array.prototype.set.call(t,this.subarray(r,i),e),o};Y.prototype.fill=function(t,e,r,i){if(typeof t=="string"){if(typeof e=="string"?(i=e,e=0,r=this.length):typeof r=="string"&&(i=r,r=this.length),i!==void 0&&typeof i!="string")throw new TypeError("encoding must be a string");if(typeof i=="string"&&!Y.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(t.length===1){var o=t.charCodeAt(0);(i==="utf8"&&o<128||i==="latin1")&&(t=o)}}else typeof t=="number"?t=t&255:typeof t=="boolean"&&(t=Number(t));if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;e=e>>>0,r=r===void 0?this.length:r>>>0,t||(t=0);var a;if(typeof t=="number")for(a=e;a<r;++a)this[a]=t;else{var s=Y.isBuffer(t)?t:Y.from(t,i),l=s.length;if(l===0)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(a=0;a<r-e;++a)this[a+e]=s[a%l]}return this};var ig=/[^+/0-9A-Za-z-_]/g;function og(n){if(n=n.split("=")[0],n=n.trim().replace(ig,""),n.length<2)return"";for(;n.length%4!==0;)n=n+"=";return n}function Ea(n,t){t=t||1/0;for(var e,r=n.length,i=null,o=[],a=0;a<r;++a){if(e=n.charCodeAt(a),e>55295&&e<57344){if(!i){if(e>56319){(t-=3)>-1&&o.push(239,191,189);continue}else if(a+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=e;continue}if(e<56320){(t-=3)>-1&&o.push(239,191,189),i=e;continue}e=(i-55296<<10|e-56320)+65536}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,e<128){if((t-=1)<0)break;o.push(e)}else if(e<2048){if((t-=2)<0)break;o.push(e>>6|192,e&63|128)}else if(e<65536){if((t-=3)<0)break;o.push(e>>12|224,e>>6&63|128,e&63|128)}else if(e<1114112){if((t-=4)<0)break;o.push(e>>18|240,e>>12&63|128,e>>6&63|128,e&63|128)}else throw new Error("Invalid code point")}return o}function ag(n){for(var t=[],e=0;e<n.length;++e)t.push(n.charCodeAt(e)&255);return t}function sg(n,t){for(var e,r,i,o=[],a=0;a<n.length&&!((t-=2)<0);++a)e=n.charCodeAt(a),r=e>>8,i=e%256,o.push(i),o.push(r);return o}function au(n){return va.toByteArray(og(n))}function Hi(n,t,e,r){for(var i=0;i<r&&!(i+e>=t.length||i>=n.length);++i)t[i+e]=n[i];return i}function Le(n,t){return n instanceof t||n!=null&&n.constructor!=null&&n.constructor.name!=null&&n.constructor.name===t.name}function xa(n){return n!==n}var cg=function(){for(var n="0123456789abcdef",t=new Array(256),e=0;e<16;++e)for(var r=e*16,i=0;i<16;++i)t[r+i]=n[e]+n[i];return t}()});var fu=ft((Ww,lu)=>{R();var Wt=lu.exports={},Oe,Be;function Ca(){throw new Error("setTimeout has not been defined")}function Ia(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Oe=setTimeout:Oe=Ca}catch{Oe=Ca}try{typeof clearTimeout=="function"?Be=clearTimeout:Be=Ia}catch{Be=Ia}})();function su(n){if(Oe===setTimeout)return setTimeout(n,0);if((Oe===Ca||!Oe)&&setTimeout)return Oe=setTimeout,setTimeout(n,0);try{return Oe(n,0)}catch{try{return Oe.call(null,n,0)}catch{return Oe.call(this,n,0)}}}function ug(n){if(Be===clearTimeout)return clearTimeout(n);if((Be===Ia||!Be)&&clearTimeout)return Be=clearTimeout,clearTimeout(n);try{return Be(n)}catch{try{return Be.call(null,n)}catch{return Be.call(this,n)}}}var qe=[],on=!1,kr,Qi=-1;function lg(){!on||!kr||(on=!1,kr.length?qe=kr.concat(qe):Qi=-1,qe.length&&cu())}function cu(){if(!on){var n=su(lg);on=!0;for(var t=qe.length;t;){for(kr=qe,qe=[];++Qi<t;)kr&&kr[Qi].run();Qi=-1,t=qe.length}kr=null,on=!1,ug(n)}}Wt.nextTick=function(n){var t=new Array(arguments.length-1);if(arguments.length>1)for(var e=1;e<arguments.length;e++)t[e-1]=arguments[e];qe.push(new uu(n,t)),qe.length===1&&!on&&su(cu)};function uu(n,t){this.fun=n,this.array=t}uu.prototype.run=function(){this.fun.apply(null,this.array)};Wt.title="browser";Wt.browser=!0;Wt.env={};Wt.argv=[];Wt.version="";Wt.versions={};function je(){}Wt.on=je;Wt.addListener=je;Wt.once=je;Wt.off=je;Wt.removeListener=je;Wt.removeAllListeners=je;Wt.emit=je;Wt.prependListener=je;Wt.prependOnceListener=je;Wt.listeners=function(n){return[]};Wt.binding=function(n){throw new Error("process.binding is not supported")};Wt.cwd=function(){return"/"};Wt.chdir=function(n){throw new Error("process.chdir is not supported")};Wt.umask=function(){return 0}});var Q,z,fg,J,R=Lh(()=>{Q=zt(nn()),z=zt(fu()),fg=function(n){function t(){var r=this||self;return delete n.prototype.__magic__,r}if(typeof globalThis=="object")return globalThis;if(this)return t();n.defineProperty(n.prototype,"__magic__",{configurable:!0,get:t});var e=__magic__;return e}(Object),J=fg});var du=ft(gu=>{"use strict";R();gu.supports=function(...t){let e=t.reduce((r,i)=>Object.assign(r,i),{});return Object.assign(e,{snapshots:e.snapshots||!1,permanence:e.permanence||!1,seek:e.seek||!1,clear:e.clear||!1,getMany:e.getMany||!1,keyIterator:e.keyIterator||!1,valueIterator:e.valueIterator||!1,iteratorNextv:e.iteratorNextv||!1,iteratorAll:e.iteratorAll||!1,status:e.status||!1,createIfMissing:e.createIfMissing||!1,errorIfExists:e.errorIfExists||!1,deferredOpen:e.deferredOpen||!1,promises:e.promises||!1,streams:e.streams||!1,encodings:Object.assign({},e.encodings),events:Object.assign({},e.events),additionalMethods:Object.assign({},e.additionalMethods)})}});var we=ft((sm,pu)=>{"use strict";R();pu.exports=class extends Error{constructor(t,e){super(t||""),typeof e=="object"&&e!==null&&(e.code&&(this.code=String(e.code)),e.expected&&(this.expected=!0),e.transient&&(this.transient=!0),e.cause&&(this.cause=e.cause)),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}});var ka=ft((um,yu)=>{"use strict";R();var Aa=null;yu.exports=function(){return Aa===null&&(Aa={textEncoder:new TextEncoder,textDecoder:new TextDecoder}),Aa}});var Ba=ft(wu=>{"use strict";R();var La=we(),hg=new Set(["buffer","view","utf8"]),Oa=class{constructor(t){if(this.encode=t.encode||this.encode,this.decode=t.decode||this.decode,this.name=t.name||this.name,this.format=t.format||this.format,typeof this.encode!="function")throw new TypeError("The 'encode' property must be a function");if(typeof this.decode!="function")throw new TypeError("The 'decode' property must be a function");if(this.encode=this.encode.bind(this),this.decode=this.decode.bind(this),typeof this.name!="string"||this.name==="")throw new TypeError("The 'name' property must be a string");if(typeof this.format!="string"||!hg.has(this.format))throw new TypeError("The 'format' property must be one of 'buffer', 'view', 'utf8'");t.createViewTranscoder&&(this.createViewTranscoder=t.createViewTranscoder),t.createBufferTranscoder&&(this.createBufferTranscoder=t.createBufferTranscoder),t.createUTF8Transcoder&&(this.createUTF8Transcoder=t.createUTF8Transcoder)}get commonName(){return this.name.split("+")[0]}createBufferTranscoder(){throw new La(`Encoding '${this.name}' cannot be transcoded to 'buffer'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createViewTranscoder(){throw new La(`Encoding '${this.name}' cannot be transcoded to 'view'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createUTF8Transcoder(){throw new La(`Encoding '${this.name}' cannot be transcoded to 'utf8'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}};wu.Encoding=Oa});var Ua=ft(Ji=>{"use strict";R();var{Buffer:Pa}=nn()||{},{Encoding:Na}=Ba(),gg=ka(),Un=class extends Na{constructor(t){super({...t,format:"buffer"})}createViewTranscoder(){return new Wn({encode:this.encode,decode:t=>this.decode(Pa.from(t.buffer,t.byteOffset,t.byteLength)),name:`${this.name}+view`})}createBufferTranscoder(){return this}},Wn=class extends Na{constructor(t){super({...t,format:"view"})}createBufferTranscoder(){return new Un({encode:t=>{let e=this.encode(t);return Pa.from(e.buffer,e.byteOffset,e.byteLength)},decode:this.decode,name:`${this.name}+buffer`})}createViewTranscoder(){return this}},Ra=class extends Na{constructor(t){super({...t,format:"utf8"})}createBufferTranscoder(){return new Un({encode:t=>Pa.from(this.encode(t),"utf8"),decode:t=>this.decode(t.toString("utf8")),name:`${this.name}+buffer`})}createViewTranscoder(){let{textEncoder:t,textDecoder:e}=gg();return new Wn({encode:r=>t.encode(this.encode(r)),decode:r=>this.decode(e.decode(r)),name:`${this.name}+view`})}createUTF8Transcoder(){return this}};Ji.BufferFormat=Un;Ji.ViewFormat=Wn;Ji.UTF8Format=Ra});var _u=ft(Or=>{"use strict";R();var{Buffer:Yt}=nn()||{Buffer:{isBuffer:()=>!1}},{textEncoder:vu,textDecoder:mu}=ka()(),{BufferFormat:Dn,ViewFormat:Wa,UTF8Format:bu}=Ua(),Yi=n=>n;Or.utf8=new bu({encode:function(n){return Yt.isBuffer(n)?n.toString("utf8"):ArrayBuffer.isView(n)?mu.decode(n):String(n)},decode:Yi,name:"utf8",createViewTranscoder(){return new Wa({encode:function(n){return ArrayBuffer.isView(n)?n:vu.encode(n)},decode:function(n){return mu.decode(n)},name:`${this.name}+view`})},createBufferTranscoder(){return new Dn({encode:function(n){return Yt.isBuffer(n)?n:ArrayBuffer.isView(n)?Yt.from(n.buffer,n.byteOffset,n.byteLength):Yt.from(String(n),"utf8")},decode:function(n){return n.toString("utf8")},name:`${this.name}+buffer`})}});Or.json=new bu({encode:JSON.stringify,decode:JSON.parse,name:"json"});Or.buffer=new Dn({encode:function(n){return Yt.isBuffer(n)?n:ArrayBuffer.isView(n)?Yt.from(n.buffer,n.byteOffset,n.byteLength):Yt.from(String(n),"utf8")},decode:Yi,name:"buffer",createViewTranscoder(){return new Wa({encode:function(n){return ArrayBuffer.isView(n)?n:Yt.from(String(n),"utf8")},decode:function(n){return Yt.from(n.buffer,n.byteOffset,n.byteLength)},name:`${this.name}+view`})}});Or.view=new Wa({encode:function(n){return ArrayBuffer.isView(n)?n:vu.encode(n)},decode:Yi,name:"view",createBufferTranscoder(){return new Dn({encode:function(n){return Yt.isBuffer(n)?n:ArrayBuffer.isView(n)?Yt.from(n.buffer,n.byteOffset,n.byteLength):Yt.from(String(n),"utf8")},decode:Yi,name:`${this.name}+buffer`})}});Or.hex=new Dn({encode:function(n){return Yt.isBuffer(n)?n:Yt.from(String(n),"hex")},decode:function(n){return n.toString("hex")},name:"hex"});Or.base64=new Dn({encode:function(n){return Yt.isBuffer(n)?n:Yt.from(String(n),"base64")},decode:function(n){return n.toString("base64")},name:"base64"})});var Tu=ft(Su=>{"use strict";R();var Eu=we(),Zi=_u(),{Encoding:dg}=Ba(),{BufferFormat:pg,ViewFormat:yg,UTF8Format:wg}=Ua(),Mn=Symbol("formats"),Xi=Symbol("encodings"),mg=new Set(["buffer","view","utf8"]),Da=class{constructor(t){if(Array.isArray(t)){if(!t.every(e=>mg.has(e)))throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}else throw new TypeError("The first argument 'formats' must be an array");this[Xi]=new Map,this[Mn]=new Set(t);for(let e in Zi)try{this.encoding(e)}catch(r){if(r.code!=="LEVEL_ENCODING_NOT_SUPPORTED")throw r}}encodings(){return Array.from(new Set(this[Xi].values()))}encoding(t){let e=this[Xi].get(t);if(e===void 0){if(typeof t=="string"&&t!==""){if(e=Eg[t],!e)throw new Eu(`Encoding '${t}' is not found`,{code:"LEVEL_ENCODING_NOT_FOUND"})}else{if(typeof t!="object"||t===null)throw new TypeError("First argument 'encoding' must be a string or object");e=vg(t)}let{name:r,format:i}=e;if(!this[Mn].has(i))if(this[Mn].has("view"))e=e.createViewTranscoder();else if(this[Mn].has("buffer"))e=e.createBufferTranscoder();else if(this[Mn].has("utf8"))e=e.createUTF8Transcoder();else throw new Eu(`Encoding '${r}' cannot be transcoded`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"});for(let o of[t,r,e.name,e.commonName])this[Xi].set(o,e)}return e}};Su.Transcoder=Da;function vg(n){if(n instanceof dg)return n;let t="type"in n&&typeof n.type=="string"?n.type:void 0,e=n.name||t||`anonymous-${Sg++}`;switch(bg(n)){case"view":return new yg({...n,name:e});case"utf8":return new wg({...n,name:e});case"buffer":return new pg({...n,name:e});default:throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}}function bg(n){return"format"in n&&n.format!==void 0?n.format:"buffer"in n&&typeof n.buffer=="boolean"?n.buffer?"buffer":"utf8":"code"in n&&Number.isInteger(n.code)?"view":"buffer"}var _g={binary:Zi.buffer,"utf-8":Zi.utf8},Eg={...Zi,..._g},Sg=0});var Nu=ft((vm,Ma)=>{"use strict";R();var an=typeof Reflect=="object"?Reflect:null,xu=an&&typeof an.apply=="function"?an.apply:function(t,e,r){return Function.prototype.apply.call(t,e,r)},to;an&&typeof an.ownKeys=="function"?to=an.ownKeys:Object.getOwnPropertySymbols?to=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:to=function(t){return Object.getOwnPropertyNames(t)};function Tg(n){console&&console.warn&&console.warn(n)}var Iu=Number.isNaN||function(t){return t!==t};function At(){At.init.call(this)}Ma.exports=At;Ma.exports.once=Ag;At.EventEmitter=At;At.prototype._events=void 0;At.prototype._eventsCount=0;At.prototype._maxListeners=void 0;var Cu=10;function eo(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(At,"defaultMaxListeners",{enumerable:!0,get:function(){return Cu},set:function(n){if(typeof n!="number"||n<0||Iu(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");Cu=n}});At.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};At.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||Iu(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function Au(n){return n._maxListeners===void 0?At.defaultMaxListeners:n._maxListeners}At.prototype.getMaxListeners=function(){return Au(this)};At.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e.push(arguments[r]);var i=t==="error",o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var l=o[t];if(l===void 0)return!1;if(typeof l=="function")xu(l,this,e);else for(var g=l.length,v=Ru(l,g),r=0;r<g;++r)xu(v[r],this,e);return!0};function ku(n,t,e,r){var i,o,a;if(eo(e),o=n._events,o===void 0?(o=n._events=Object.create(null),n._eventsCount=0):(o.newListener!==void 0&&(n.emit("newListener",t,e.listener?e.listener:e),o=n._events),a=o[t]),a===void 0)a=o[t]=e,++n._eventsCount;else if(typeof a=="function"?a=o[t]=r?[e,a]:[a,e]:r?a.unshift(e):a.push(e),i=Au(n),i>0&&a.length>i&&!a.warned){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=n,s.type=t,s.count=a.length,Tg(s)}return n}At.prototype.addListener=function(t,e){return ku(this,t,e,!1)};At.prototype.on=At.prototype.addListener;At.prototype.prependListener=function(t,e){return ku(this,t,e,!0)};function xg(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Lu(n,t,e){var r={fired:!1,wrapFn:void 0,target:n,type:t,listener:e},i=xg.bind(r);return i.listener=e,r.wrapFn=i,i}At.prototype.once=function(t,e){return eo(e),this.on(t,Lu(this,t,e)),this};At.prototype.prependOnceListener=function(t,e){return eo(e),this.prependListener(t,Lu(this,t,e)),this};At.prototype.removeListener=function(t,e){var r,i,o,a,s;if(eo(e),i=this._events,i===void 0)return this;if(r=i[t],r===void 0)return this;if(r===e||r.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,r.listener||e));else if(typeof r!="function"){for(o=-1,a=r.length-1;a>=0;a--)if(r[a]===e||r[a].listener===e){s=r[a].listener,o=a;break}if(o<0)return this;o===0?r.shift():Cg(r,o),r.length===1&&(i[t]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",t,s||e)}return this};At.prototype.off=At.prototype.removeListener;At.prototype.removeAllListeners=function(t){var e,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[t]),this;if(arguments.length===0){var o=Object.keys(r),a;for(i=0;i<o.length;++i)a=o[i],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=r[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(i=e.length-1;i>=0;i--)this.removeListener(t,e[i]);return this};function Ou(n,t,e){var r=n._events;if(r===void 0)return[];var i=r[t];return i===void 0?[]:typeof i=="function"?e?[i.listener||i]:[i]:e?Ig(i):Ru(i,i.length)}At.prototype.listeners=function(t){return Ou(this,t,!0)};At.prototype.rawListeners=function(t){return Ou(this,t,!1)};At.listenerCount=function(n,t){return typeof n.listenerCount=="function"?n.listenerCount(t):Bu.call(n,t)};At.prototype.listenerCount=Bu;function Bu(n){var t=this._events;if(t!==void 0){var e=t[n];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}At.prototype.eventNames=function(){return this._eventsCount>0?to(this._events):[]};function Ru(n,t){for(var e=new Array(t),r=0;r<t;++r)e[r]=n[r];return e}function Cg(n,t){for(;t+1<n.length;t++)n[t]=n[t+1];n.pop()}function Ig(n){for(var t=new Array(n.length),e=0;e<t.length;++e)t[e]=n[e].listener||n[e];return t}function Ag(n,t){return new Promise(function(e,r){function i(a){n.removeListener(t,o),r(a)}function o(){typeof n.removeListener=="function"&&n.removeListener("error",i),e([].slice.call(arguments))}Pu(n,t,o,{once:!0}),t!=="error"&&kg(n,i,{once:!0})})}function kg(n,t,e){typeof n.on=="function"&&Pu(n,"error",t,e)}function Pu(n,t,e,r){if(typeof n.on=="function")r.once?n.once(t,e):n.on(t,e);else if(typeof n.addEventListener=="function")n.addEventListener(t,function i(o){r.once&&n.removeEventListener(t,i),e(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}});var Wu=ft((_m,Uu)=>{R();Uu.exports=typeof queueMicrotask=="function"?queueMicrotask:n=>Promise.resolve().then(n)});var $n=ft($a=>{"use strict";R();var Du=Wu();$a.fromCallback=function(n,t){if(n===void 0){var e=new Promise(function(r,i){n=function(o,a){o?i(o):r(a)}});n[t!==void 0?t:"promise"]=e}else if(typeof n!="function")throw new TypeError("Callback must be a function");return n};$a.fromPromise=function(n,t){if(t===void 0)return n;n.then(function(e){Du(()=>t(null,e))}).catch(function(e){Du(()=>t(e))})}});var ro=ft(Fa=>{"use strict";R();Fa.getCallback=function(n,t){return typeof n=="function"?n:t};Fa.getOptions=function(n,t){return typeof n=="object"&&n!==null?n:t!==void 0?t:{}}});var gr=ft(ao=>{"use strict";R();var{fromCallback:Ka}=$n(),ae=we(),{getOptions:Va,getCallback:Mu}=ro(),Br=Symbol("promise"),sn=Symbol("callback"),Re=Symbol("working"),Rr=Symbol("handleOne"),He=Symbol("handleMany"),Ga=Symbol("autoClose"),fr=Symbol("finishWork"),Pe=Symbol("returnMany"),cr=Symbol("closing"),Fn=Symbol("handleClose"),no=Symbol("closed"),Kn=Symbol("closeCallbacks"),lr=Symbol("keyEncoding"),Pr=Symbol("valueEncoding"),qa=Symbol("abortOnClose"),io=Symbol("legacy"),ja=Symbol("keys"),Ha=Symbol("values"),ur=Symbol("limit"),me=Symbol("count"),oo=Object.freeze({}),Lg=()=>{},$u=!1,Vn=class{constructor(t,e,r){if(typeof t!="object"||t===null){let i=t===null?"null":typeof t;throw new TypeError(`The first argument must be an abstract-level database, received ${i}`)}if(typeof e!="object"||e===null)throw new TypeError("The second argument must be an options object");this[no]=!1,this[Kn]=[],this[Re]=!1,this[cr]=!1,this[Ga]=!1,this[sn]=null,this[Rr]=this[Rr].bind(this),this[He]=this[He].bind(this),this[Fn]=this[Fn].bind(this),this[lr]=e[lr],this[Pr]=e[Pr],this[io]=r,this[ur]=Number.isInteger(e.limit)&&e.limit>=0?e.limit:1/0,this[me]=0,this[qa]=!!e.abortOnClose,this.db=t,this.db.attachResource(this),this.nextTick=t.nextTick}get count(){return this[me]}get limit(){return this[ur]}next(t){let e;if(t===void 0)e=new Promise((r,i)=>{t=(o,a,s)=>{o?i(o):this[io]?a===void 0&&s===void 0?r():r([a,s]):r(a)}});else if(typeof t!="function")throw new TypeError("Callback must be a function");return this[cr]?this.nextTick(t,new ae("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[Re]?this.nextTick(t,new ae("Iterator is busy: cannot call next() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[Re]=!0,this[sn]=t,this[me]>=this[ur]?this.nextTick(this[Rr],null):this._next(this[Rr])),e}_next(t){this.nextTick(t)}nextv(t,e,r){return r=Mu(e,r),r=Ka(r,Br),e=Va(e,oo),Number.isInteger(t)?(this[cr]?this.nextTick(r,new ae("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[Re]?this.nextTick(r,new ae("Iterator is busy: cannot call nextv() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(t<1&&(t=1),this[ur]<1/0&&(t=Math.min(t,this[ur]-this[me])),this[Re]=!0,this[sn]=r,t<=0?this.nextTick(this[He],null,[]):this._nextv(t,e,this[He])),r[Br]):(this.nextTick(r,new TypeError("The first argument 'size' must be an integer")),r[Br])}_nextv(t,e,r){let i=[],o=(a,s,l)=>{if(a)return r(a);if(this[io]?s===void 0&&l===void 0:s===void 0)return r(null,i);i.push(this[io]?[s,l]:s),i.length===t?r(null,i):this._next(o)};this._next(o)}all(t,e){return e=Mu(t,e),e=Ka(e,Br),t=Va(t,oo),this[cr]?this.nextTick(e,new ae("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[Re]?this.nextTick(e,new ae("Iterator is busy: cannot call all() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[Re]=!0,this[sn]=e,this[Ga]=!0,this[me]>=this[ur]?this.nextTick(this[He],null,[]):this._all(t,this[He])),e[Br]}_all(t,e){let r=this[me],i=[],o=()=>{let s=this[ur]<1/0?Math.min(1e3,this[ur]-r):1e3;s<=0?this.nextTick(e,null,i):this._nextv(s,oo,a)},a=(s,l)=>{s?e(s):l.length===0?e(null,i):(i.push.apply(i,l),r+=l.length,o())};o()}[fr](){let t=this[sn];return this[qa]&&t===null?Lg:(this[Re]=!1,this[sn]=null,this[cr]&&this._close(this[Fn]),t)}[Pe](t,e,r){this[Ga]?this.close(t.bind(null,e,r)):t(e,r)}seek(t,e){if(e=Va(e,oo),!this[cr]){if(this[Re])throw new ae("Iterator is busy: cannot call seek() until next() has completed",{code:"LEVEL_ITERATOR_BUSY"});{let r=this.db.keyEncoding(e.keyEncoding||this[lr]),i=r.format;e.keyEncoding!==i&&(e={...e,keyEncoding:i});let o=this.db.prefixKey(r.encode(t),i);this._seek(o,e)}}}_seek(t,e){throw new ae("Iterator does not support seek()",{code:"LEVEL_NOT_SUPPORTED"})}close(t){return t=Ka(t,Br),this[no]?this.nextTick(t):this[cr]?this[Kn].push(t):(this[cr]=!0,this[Kn].push(t),this[Re]?this[qa]&&this[fr]()(new ae("Aborted on iterator close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this._close(this[Fn])),t[Br]}_close(t){this.nextTick(t)}[Fn](){this[no]=!0,this.db.detachResource(this);let t=this[Kn];this[Kn]=[];for(let e of t)e()}async*[Symbol.asyncIterator](){try{let t;for(;(t=await this.next())!==void 0;)yield t}finally{this[no]||await this.close()}}},cn=class extends Vn{constructor(t,e){super(t,e,!0),this[ja]=e.keys!==!1,this[Ha]=e.values!==!1}[Rr](t,e,r){let i=this[fr]();if(t)return i(t);try{e=this[ja]&&e!==void 0?this[lr].decode(e):void 0,r=this[Ha]&&r!==void 0?this[Pr].decode(r):void 0}catch(o){return i(new hr("entry",o))}e===void 0&&r===void 0||this[me]++,i(null,e,r)}[He](t,e){let r=this[fr]();if(t)return this[Pe](r,t);try{for(let i of e){let o=i[0],a=i[1];i[0]=this[ja]&&o!==void 0?this[lr].decode(o):void 0,i[1]=this[Ha]&&a!==void 0?this[Pr].decode(a):void 0}}catch(i){return this[Pe](r,new hr("entries",i))}this[me]+=e.length,this[Pe](r,null,e)}end(t){return!$u&&typeof console<"u"&&($u=!0,console.warn(new ae("The iterator.end() method was renamed to close() and end() is an alias that will be removed in a future version",{code:"LEVEL_LEGACY"}))),this.close(t)}},Qa=class extends Vn{constructor(t,e){super(t,e,!1)}[Rr](t,e){let r=this[fr]();if(t)return r(t);try{e=e!==void 0?this[lr].decode(e):void 0}catch(i){return r(new hr("key",i))}e!==void 0&&this[me]++,r(null,e)}[He](t,e){let r=this[fr]();if(t)return this[Pe](r,t);try{for(let i=0;i<e.length;i++){let o=e[i];e[i]=o!==void 0?this[lr].decode(o):void 0}}catch(i){return this[Pe](r,new hr("keys",i))}this[me]+=e.length,this[Pe](r,null,e)}},za=class extends Vn{constructor(t,e){super(t,e,!1)}[Rr](t,e){let r=this[fr]();if(t)return r(t);try{e=e!==void 0?this[Pr].decode(e):void 0}catch(i){return r(new hr("value",i))}e!==void 0&&this[me]++,r(null,e)}[He](t,e){let r=this[fr]();if(t)return this[Pe](r,t);try{for(let i=0;i<e.length;i++){let o=e[i];e[i]=o!==void 0?this[Pr].decode(o):void 0}}catch(i){return this[Pe](r,new hr("values",i))}this[me]+=e.length,this[Pe](r,null,e)}},hr=class extends ae{constructor(t,e){super(`Iterator could not decode ${t}`,{code:"LEVEL_DECODE_ERROR",cause:e})}};for(let n of["_ended property","_nexting property","_end method"])Object.defineProperty(cn.prototype,n.split(" ")[0],{get(){throw new ae(`The ${n} has been removed`,{code:"LEVEL_LEGACY"})},set(){throw new ae(`The ${n} has been removed`,{code:"LEVEL_LEGACY"})}});cn.keyEncoding=lr;cn.valueEncoding=Pr;ao.AbstractIterator=cn;ao.AbstractKeyIterator=Qa;ao.AbstractValueIterator=za});var Fu=ft(Ja=>{"use strict";R();var{AbstractKeyIterator:Og,AbstractValueIterator:Bg}=gr(),Nr=Symbol("iterator"),Gn=Symbol("callback"),un=Symbol("handleOne"),Ur=Symbol("handleMany"),qn=class extends Og{constructor(t,e){super(t,e),this[Nr]=t.iterator({...e,keys:!0,values:!1}),this[un]=this[un].bind(this),this[Ur]=this[Ur].bind(this)}},so=class extends Bg{constructor(t,e){super(t,e),this[Nr]=t.iterator({...e,keys:!1,values:!0}),this[un]=this[un].bind(this),this[Ur]=this[Ur].bind(this)}};for(let n of[qn,so]){let t=n===qn,e=t?r=>r[0]:r=>r[1];n.prototype._next=function(r){this[Gn]=r,this[Nr].next(this[un])},n.prototype[un]=function(r,i,o){let a=this[Gn];r?a(r):a(null,t?i:o)},n.prototype._nextv=function(r,i,o){this[Gn]=o,this[Nr].nextv(r,i,this[Ur])},n.prototype._all=function(r,i){this[Gn]=i,this[Nr].all(r,this[Ur])},n.prototype[Ur]=function(r,i){let o=this[Gn];r?o(r):o(null,i.map(e))},n.prototype._seek=function(r,i){this[Nr].seek(r,i)},n.prototype._close=function(r){this[Nr].close(r)}}Ja.DefaultKeyIterator=qn;Ja.DefaultValueIterator=so});var Ku=ft(go=>{"use strict";R();var{AbstractIterator:Rg,AbstractKeyIterator:Pg,AbstractValueIterator:Ng}=gr(),Ya=we(),ne=Symbol("nut"),fo=Symbol("undefer"),ho=Symbol("factory"),co=class extends Rg{constructor(t,e){super(t,e),this[ne]=null,this[ho]=()=>t.iterator(e),this.db.defer(()=>this[fo]())}},uo=class extends Pg{constructor(t,e){super(t,e),this[ne]=null,this[ho]=()=>t.keys(e),this.db.defer(()=>this[fo]())}},lo=class extends Ng{constructor(t,e){super(t,e),this[ne]=null,this[ho]=()=>t.values(e),this.db.defer(()=>this[fo]())}};for(let n of[co,uo,lo])n.prototype[fo]=function(){this.db.status==="open"&&(this[ne]=this[ho]())},n.prototype._next=function(t){this[ne]!==null?this[ne].next(t):this.db.status==="opening"?this.db.defer(()=>this._next(t)):this.nextTick(t,new Ya("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},n.prototype._nextv=function(t,e,r){this[ne]!==null?this[ne].nextv(t,e,r):this.db.status==="opening"?this.db.defer(()=>this._nextv(t,e,r)):this.nextTick(r,new Ya("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},n.prototype._all=function(t,e){this[ne]!==null?this[ne].all(e):this.db.status==="opening"?this.db.defer(()=>this._all(t,e)):this.nextTick(e,new Ya("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},n.prototype._seek=function(t,e){this[ne]!==null?this[ne]._seek(t,e):this.db.status==="opening"&&this.db.defer(()=>this._seek(t,e))},n.prototype._close=function(t){this[ne]!==null?this[ne].close(t):this.db.status==="opening"?this.db.defer(()=>this._close(t)):this.nextTick(t)};go.DeferredIterator=co;go.DeferredKeyIterator=uo;go.DeferredValueIterator=lo});var Za=ft(Gu=>{"use strict";R();var{fromCallback:Vu}=$n(),po=we(),{getCallback:Ug,getOptions:Wg}=ro(),yo=Symbol("promise"),ve=Symbol("status"),ln=Symbol("operations"),jn=Symbol("finishClose"),fn=Symbol("closeCallbacks"),Xa=class{constructor(t){if(typeof t!="object"||t===null){let e=t===null?"null":typeof t;throw new TypeError(`The first argument must be an abstract-level database, received ${e}`)}this[ln]=[],this[fn]=[],this[ve]="open",this[jn]=this[jn].bind(this),this.db=t,this.db.attachResource(this),this.nextTick=t.nextTick}get length(){return this[ln].length}put(t,e,r){if(this[ve]!=="open")throw new po("Batch is not open: cannot call put() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});let i=this.db._checkKey(t)||this.db._checkValue(e);if(i)throw i;let o=r&&r.sublevel!=null?r.sublevel:this.db,a=r,s=o.keyEncoding(r&&r.keyEncoding),l=o.valueEncoding(r&&r.valueEncoding),g=s.format;r={...r,keyEncoding:g,valueEncoding:l.format},o!==this.db&&(r.sublevel=null);let v=o.prefixKey(s.encode(t),g),A=l.encode(e);return this._put(v,A,r),this[ln].push({...a,type:"put",key:t,value:e}),this}_put(t,e,r){}del(t,e){if(this[ve]!=="open")throw new po("Batch is not open: cannot call del() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});let r=this.db._checkKey(t);if(r)throw r;let i=e&&e.sublevel!=null?e.sublevel:this.db,o=e,a=i.keyEncoding(e&&e.keyEncoding),s=a.format;return e={...e,keyEncoding:s},i!==this.db&&(e.sublevel=null),this._del(i.prefixKey(a.encode(t),s),e),this[ln].push({...o,type:"del",key:t}),this}_del(t,e){}clear(){if(this[ve]!=="open")throw new po("Batch is not open: cannot call clear() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});return this._clear(),this[ln]=[],this}_clear(){}write(t,e){return e=Ug(t,e),e=Vu(e,yo),t=Wg(t),this[ve]!=="open"?this.nextTick(e,new po("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"})):this.length===0?this.close(e):(this[ve]="writing",this._write(t,r=>{this[ve]="closing",this[fn].push(()=>e(r)),r||this.db.emit("batch",this[ln]),this._close(this[jn])})),e[yo]}_write(t,e){}close(t){return t=Vu(t,yo),this[ve]==="closing"?this[fn].push(t):this[ve]==="closed"?this.nextTick(t):(this[fn].push(t),this[ve]!=="writing"&&(this[ve]="closing",this._close(this[jn]))),t[yo]}_close(t){this.nextTick(t)}[jn](){this[ve]="closed",this.db.detachResource(this);let t=this[fn];this[fn]=[];for(let e of t)e()}};Gu.AbstractChainedBatch=Xa});var ju=ft(qu=>{"use strict";R();var{AbstractChainedBatch:Dg}=Za(),Mg=we(),hn=Symbol("encoded"),ts=class extends Dg{constructor(t){super(t),this[hn]=[]}_put(t,e,r){this[hn].push({...r,type:"put",key:t,value:e})}_del(t,e){this[hn].push({...e,type:"del",key:t})}_clear(){this[hn]=[]}_write(t,e){this.db.status==="opening"?this.db.defer(()=>this._write(t,e)):this.db.status==="open"?this[hn].length===0?this.nextTick(e):this.db._batch(this[hn],t,e):this.nextTick(e,new Mg("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"}))}};qu.DefaultChainedBatch=ts});var zu=ft((Wm,Qu)=>{"use strict";R();var Hu=we(),$g=Object.prototype.hasOwnProperty,Fg=new Set(["lt","lte","gt","gte"]);Qu.exports=function(n,t){let e={};for(let r in n)if($g.call(n,r)&&!(r==="keyEncoding"||r==="valueEncoding")){if(r==="start"||r==="end")throw new Hu(`The legacy range option '${r}' has been removed`,{code:"LEVEL_LEGACY"});if(r==="encoding")throw new Hu("The levelup-style 'encoding' alias has been removed, use 'valueEncoding' instead",{code:"LEVEL_LEGACY"});Fg.has(r)?e[r]=t.encode(n[r]):e[r]=n[r]}return e.reverse=!!e.reverse,e.limit=Number.isInteger(e.limit)&&e.limit>=0?e.limit:-1,e}});var es=ft((Mm,Yu)=>{R();var Ju;Yu.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:J):n=>(Ju||(Ju=Promise.resolve())).then(n).catch(t=>setTimeout(()=>{throw t},0))});var tl=ft((Fm,Zu)=>{"use strict";R();var Xu=es();Zu.exports=function(n,...t){t.length===0?Xu(n):Xu(()=>n(...t))}});var el=ft(wo=>{"use strict";R();var{AbstractIterator:Kg,AbstractKeyIterator:Vg,AbstractValueIterator:Gg}=gr(),gn=Symbol("unfix"),Te=Symbol("iterator"),Wr=Symbol("handleOne"),dr=Symbol("handleMany"),Qe=Symbol("callback"),Hn=class extends Kg{constructor(t,e,r,i){super(t,e),this[Te]=r,this[gn]=i,this[Wr]=this[Wr].bind(this),this[dr]=this[dr].bind(this),this[Qe]=null}[Wr](t,e,r){let i=this[Qe];if(t)return i(t);e!==void 0&&(e=this[gn](e)),i(t,e,r)}[dr](t,e){let r=this[Qe];if(t)return r(t);for(let i of e){let o=i[0];o!==void 0&&(i[0]=this[gn](o))}r(t,e)}},Qn=class extends Vg{constructor(t,e,r,i){super(t,e),this[Te]=r,this[gn]=i,this[Wr]=this[Wr].bind(this),this[dr]=this[dr].bind(this),this[Qe]=null}[Wr](t,e){let r=this[Qe];if(t)return r(t);e!==void 0&&(e=this[gn](e)),r(t,e)}[dr](t,e){let r=this[Qe];if(t)return r(t);for(let i=0;i<e.length;i++){let o=e[i];o!==void 0&&(e[i]=this[gn](o))}r(t,e)}},zn=class extends Gg{constructor(t,e,r){super(t,e),this[Te]=r}};for(let n of[Hn,Qn])n.prototype._next=function(t){this[Qe]=t,this[Te].next(this[Wr])},n.prototype._nextv=function(t,e,r){this[Qe]=r,this[Te].nextv(t,e,this[dr])},n.prototype._all=function(t,e){this[Qe]=e,this[Te].all(t,this[dr])};for(let n of[zn])n.prototype._next=function(t){this[Te].next(t)},n.prototype._nextv=function(t,e,r){this[Te].nextv(t,e,r)},n.prototype._all=function(t,e){this[Te].all(t,e)};for(let n of[Hn,Qn,zn])n.prototype._seek=function(t,e){this[Te].seek(t,e)},n.prototype._close=function(t){this[Te].close(t)};wo.AbstractSublevelIterator=Hn;wo.AbstractSublevelKeyIterator=Qn;wo.AbstractSublevelValueIterator=zn});var ol=ft((qm,il)=>{"use strict";R();var rs=we(),{Buffer:os}=nn()||{},{AbstractSublevelIterator:qg,AbstractSublevelKeyIterator:jg,AbstractSublevelValueIterator:Hg}=el(),ze=Symbol("prefix"),rl=Symbol("upperBound"),Jn=Symbol("prefixRange"),se=Symbol("parent"),ns=Symbol("unfix"),nl=new TextEncoder,Qg={separator:"!"};il.exports=function({AbstractLevel:n}){class t extends n{static defaults(r){if(typeof r=="string")throw new rs("The subleveldown string shorthand for { separator } has been removed",{code:"LEVEL_LEGACY"});if(r&&r.open)throw new rs("The subleveldown open option has been removed",{code:"LEVEL_LEGACY"});return r==null?Qg:r.separator?r:{...r,separator:"!"}}constructor(r,i,o){let{separator:a,manifest:s,...l}=t.defaults(o);i=Jg(i,a);let g=a.charCodeAt(0)+1,v=r[se]||r;if(!nl.encode(i).every(m=>m>g&&m<127))throw new rs(`Prefix must use bytes > ${g} < 127`,{code:"LEVEL_INVALID_PREFIX"});super(zg(v,s),l);let A=(r.prefix||"")+a+i+a,B=A.slice(0,-1)+String.fromCharCode(g);this[se]=v,this[ze]=new mo(A),this[rl]=new mo(B),this[ns]=new as,this.nextTick=v.nextTick}prefixKey(r,i){if(i==="utf8")return this[ze].utf8+r;if(r.byteLength===0)return this[ze][i];if(i==="view"){let o=this[ze].view,a=new Uint8Array(o.byteLength+r.byteLength);return a.set(o,0),a.set(r,o.byteLength),a}else{let o=this[ze].buffer;return os.concat([o,r],o.byteLength+r.byteLength)}}[Jn](r,i){r.gte!==void 0?r.gte=this.prefixKey(r.gte,i):r.gt!==void 0?r.gt=this.prefixKey(r.gt,i):r.gte=this[ze][i],r.lte!==void 0?r.lte=this.prefixKey(r.lte,i):r.lt!==void 0?r.lt=this.prefixKey(r.lt,i):r.lte=this[rl][i]}get prefix(){return this[ze].utf8}get db(){return this[se]}_open(r,i){this[se].open({passive:!0},i)}_put(r,i,o,a){this[se].put(r,i,o,a)}_get(r,i,o){this[se].get(r,i,o)}_getMany(r,i,o){this[se].getMany(r,i,o)}_del(r,i,o){this[se].del(r,i,o)}_batch(r,i,o){this[se].batch(r,i,o)}_clear(r,i){this[Jn](r,r.keyEncoding),this[se].clear(r,i)}_iterator(r){this[Jn](r,r.keyEncoding);let i=this[se].iterator(r),o=this[ns].get(this[ze].utf8.length,r.keyEncoding);return new qg(this,r,i,o)}_keys(r){this[Jn](r,r.keyEncoding);let i=this[se].keys(r),o=this[ns].get(this[ze].utf8.length,r.keyEncoding);return new jg(this,r,i,o)}_values(r){this[Jn](r,r.keyEncoding);let i=this[se].values(r);return new Hg(this,r,i)}}return{AbstractSublevel:t}};var zg=function(n,t){return{...n.supports,createIfMissing:!1,errorIfExists:!1,events:{},additionalMethods:{},...t,encodings:{utf8:is(n,"utf8"),buffer:is(n,"buffer"),view:is(n,"view")}}},is=function(n,t){return n.supports.encodings[t]?n.keyEncoding(t).name===t:!1},mo=class{constructor(t){this.utf8=t,this.view=nl.encode(t),this.buffer=os?os.from(this.view.buffer,0,this.view.byteLength):{}}},as=class{constructor(){this.cache=new Map}get(t,e){let r=this.cache.get(e);return r===void 0&&(e==="view"?r=function(i,o){return o.subarray(i)}.bind(null,t):r=function(i,o){return o.slice(i)}.bind(null,t),this.cache.set(e,r)),r}},Jg=function(n,t){let e=0,r=n.length;for(;e<r&&n[e]===t;)e++;for(;r>e&&n[r-1]===t;)r--;return n.slice(e,r)}});var fs=ft(ls=>{"use strict";R();var{supports:Yg}=du(),{Transcoder:Xg}=Tu(),{EventEmitter:Zg}=Nu(),{fromCallback:pr}=$n(),xe=we(),{AbstractIterator:Dr}=gr(),{DefaultKeyIterator:td,DefaultValueIterator:ed}=Fu(),{DeferredIterator:rd,DeferredKeyIterator:nd,DeferredValueIterator:id}=Ku(),{DefaultChainedBatch:al}=ju(),{getCallback:Mr,getOptions:yr}=ro(),vo=zu(),_t=Symbol("promise"),Je=Symbol("landed"),$r=Symbol("resources"),ss=Symbol("closeResources"),Yn=Symbol("operations"),Xn=Symbol("undefer"),bo=Symbol("deferOpen"),sl=Symbol("options"),Tt=Symbol("status"),Fr=Symbol("defaultOptions"),dn=Symbol("transcoder"),_o=Symbol("keyEncoding"),cs=Symbol("valueEncoding"),od=()=>{},Zn=class extends Zg{constructor(t,e){if(super(),typeof t!="object"||t===null)throw new TypeError("The first argument 'manifest' must be an object");e=yr(e);let{keyEncoding:r,valueEncoding:i,passive:o,...a}=e;this[$r]=new Set,this[Yn]=[],this[bo]=!0,this[sl]=a,this[Tt]="opening",this.supports=Yg(t,{status:!0,promises:!0,clear:!0,getMany:!0,deferredOpen:!0,snapshots:t.snapshots!==!1,permanence:t.permanence!==!1,keyIterator:!0,valueIterator:!0,iteratorNextv:!0,iteratorAll:!0,encodings:t.encodings||{},events:Object.assign({},t.events,{opening:!0,open:!0,closing:!0,closed:!0,put:!0,del:!0,batch:!0,clear:!0})}),this[dn]=new Xg(ad(this)),this[_o]=this[dn].encoding(r||"utf8"),this[cs]=this[dn].encoding(i||"utf8");for(let s of this[dn].encodings())this.supports.encodings[s.commonName]||(this.supports.encodings[s.commonName]=!0);this[Fr]={empty:Object.freeze({}),entry:Object.freeze({keyEncoding:this[_o].commonName,valueEncoding:this[cs].commonName}),key:Object.freeze({keyEncoding:this[_o].commonName})},this.nextTick(()=>{this[bo]&&this.open({passive:!1},od)})}get status(){return this[Tt]}keyEncoding(t){return this[dn].encoding(t??this[_o])}valueEncoding(t){return this[dn].encoding(t??this[cs])}open(t,e){e=Mr(t,e),e=pr(e,_t),t={...this[sl],...yr(t)},t.createIfMissing=t.createIfMissing!==!1,t.errorIfExists=!!t.errorIfExists;let r=i=>{this[Tt]==="closing"||this[Tt]==="opening"?this.once(Je,i?()=>r(i):r):this[Tt]!=="open"?e(new xe("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN",cause:i})):e()};return t.passive?this[Tt]==="opening"?this.once(Je,r):this.nextTick(r):this[Tt]==="closed"||this[bo]?(this[bo]=!1,this[Tt]="opening",this.emit("opening"),this._open(t,i=>{if(i){this[Tt]="closed",this[ss](()=>{this.emit(Je),r(i)}),this[Xn]();return}this[Tt]="open",this[Xn](),this.emit(Je),this[Tt]==="open"&&this.emit("open"),this[Tt]==="open"&&this.emit("ready"),r()})):this[Tt]==="open"?this.nextTick(r):this.once(Je,()=>this.open(t,e)),e[_t]}_open(t,e){this.nextTick(e)}close(t){t=pr(t,_t);let e=r=>{this[Tt]==="opening"||this[Tt]==="closing"?this.once(Je,r?e(r):e):this[Tt]!=="closed"?t(new xe("Database is not closed",{code:"LEVEL_DATABASE_NOT_CLOSED",cause:r})):t()};if(this[Tt]==="open"){this[Tt]="closing",this.emit("closing");let r=i=>{this[Tt]="open",this[Xn](),this.emit(Je),e(i)};this[ss](()=>{this._close(i=>{if(i)return r(i);this[Tt]="closed",this[Xn](),this.emit(Je),this[Tt]==="closed"&&this.emit("closed"),e()})})}else this[Tt]==="closed"?this.nextTick(e):this.once(Je,()=>this.close(t));return t[_t]}[ss](t){if(this[$r].size===0)return this.nextTick(t);let e=this[$r].size,r=!0,i=()=>{--e===0&&(r?this.nextTick(t):t())};for(let o of this[$r])o.close(i);r=!1,this[$r].clear()}_close(t){this.nextTick(t)}get(t,e,r){if(r=Mr(e,r),r=pr(r,_t),e=yr(e,this[Fr].entry),this[Tt]==="opening")return this.defer(()=>this.get(t,e,r)),r[_t];if(pn(this,r))return r[_t];let i=this._checkKey(t);if(i)return this.nextTick(r,i),r[_t];let o=this.keyEncoding(e.keyEncoding),a=this.valueEncoding(e.valueEncoding),s=o.format,l=a.format;return(e.keyEncoding!==s||e.valueEncoding!==l)&&(e=Object.assign({},e,{keyEncoding:s,valueEncoding:l})),this._get(this.prefixKey(o.encode(t),s),e,(g,v)=>{if(g)return(g.code==="LEVEL_NOT_FOUND"||g.notFound||/NotFound/i.test(g))&&(g.code||(g.code="LEVEL_NOT_FOUND"),g.notFound||(g.notFound=!0),g.status||(g.status=404)),r(g);try{v=a.decode(v)}catch(A){return r(new xe("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:A}))}r(null,v)}),r[_t]}_get(t,e,r){this.nextTick(r,new Error("NotFound"))}getMany(t,e,r){if(r=Mr(e,r),r=pr(r,_t),e=yr(e,this[Fr].entry),this[Tt]==="opening")return this.defer(()=>this.getMany(t,e,r)),r[_t];if(pn(this,r))return r[_t];if(!Array.isArray(t))return this.nextTick(r,new TypeError("The first argument 'keys' must be an array")),r[_t];if(t.length===0)return this.nextTick(r,null,[]),r[_t];let i=this.keyEncoding(e.keyEncoding),o=this.valueEncoding(e.valueEncoding),a=i.format,s=o.format;(e.keyEncoding!==a||e.valueEncoding!==s)&&(e=Object.assign({},e,{keyEncoding:a,valueEncoding:s}));let l=new Array(t.length);for(let g=0;g<t.length;g++){let v=t[g],A=this._checkKey(v);if(A)return this.nextTick(r,A),r[_t];l[g]=this.prefixKey(i.encode(v),a)}return this._getMany(l,e,(g,v)=>{if(g)return r(g);try{for(let A=0;A<v.length;A++)v[A]!==void 0&&(v[A]=o.decode(v[A]))}catch(A){return r(new xe(`Could not decode one or more of ${v.length} value(s)`,{code:"LEVEL_DECODE_ERROR",cause:A}))}r(null,v)}),r[_t]}_getMany(t,e,r){this.nextTick(r,null,new Array(t.length).fill(void 0))}put(t,e,r,i){if(i=Mr(r,i),i=pr(i,_t),r=yr(r,this[Fr].entry),this[Tt]==="opening")return this.defer(()=>this.put(t,e,r,i)),i[_t];if(pn(this,i))return i[_t];let o=this._checkKey(t)||this._checkValue(e);if(o)return this.nextTick(i,o),i[_t];let a=this.keyEncoding(r.keyEncoding),s=this.valueEncoding(r.valueEncoding),l=a.format,g=s.format;(r.keyEncoding!==l||r.valueEncoding!==g)&&(r=Object.assign({},r,{keyEncoding:l,valueEncoding:g}));let v=this.prefixKey(a.encode(t),l),A=s.encode(e);return this._put(v,A,r,B=>{if(B)return i(B);this.emit("put",t,e),i()}),i[_t]}_put(t,e,r,i){this.nextTick(i)}del(t,e,r){if(r=Mr(e,r),r=pr(r,_t),e=yr(e,this[Fr].key),this[Tt]==="opening")return this.defer(()=>this.del(t,e,r)),r[_t];if(pn(this,r))return r[_t];let i=this._checkKey(t);if(i)return this.nextTick(r,i),r[_t];let o=this.keyEncoding(e.keyEncoding),a=o.format;return e.keyEncoding!==a&&(e=Object.assign({},e,{keyEncoding:a})),this._del(this.prefixKey(o.encode(t),a),e,s=>{if(s)return r(s);this.emit("del",t),r()}),r[_t]}_del(t,e,r){this.nextTick(r)}batch(t,e,r){if(!arguments.length){if(this[Tt]==="opening")return new al(this);if(this[Tt]!=="open")throw new xe("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._chainedBatch()}if(typeof t=="function"?r=t:r=Mr(e,r),r=pr(r,_t),e=yr(e,this[Fr].empty),this[Tt]==="opening")return this.defer(()=>this.batch(t,e,r)),r[_t];if(pn(this,r))return r[_t];if(!Array.isArray(t))return this.nextTick(r,new TypeError("The first argument 'operations' must be an array")),r[_t];if(t.length===0)return this.nextTick(r),r[_t];let i=new Array(t.length),{keyEncoding:o,valueEncoding:a,...s}=e;for(let l=0;l<t.length;l++){if(typeof t[l]!="object"||t[l]===null)return this.nextTick(r,new TypeError("A batch operation must be an object")),r[_t];let g=Object.assign({},t[l]);if(g.type!=="put"&&g.type!=="del")return this.nextTick(r,new TypeError("A batch operation must have a type property that is 'put' or 'del'")),r[_t];let v=this._checkKey(g.key);if(v)return this.nextTick(r,v),r[_t];let A=g.sublevel!=null?g.sublevel:this,B=A.keyEncoding(g.keyEncoding||o),m=B.format;if(g.key=A.prefixKey(B.encode(g.key),m),g.keyEncoding=m,g.type==="put"){let E=this._checkValue(g.value);if(E)return this.nextTick(r,E),r[_t];let N=A.valueEncoding(g.valueEncoding||a);g.value=N.encode(g.value),g.valueEncoding=N.format}A!==this&&(g.sublevel=null),i[l]=g}return this._batch(i,s,l=>{if(l)return r(l);this.emit("batch",t),r()}),r[_t]}_batch(t,e,r){this.nextTick(r)}sublevel(t,e){return this._sublevel(t,us.defaults(e))}_sublevel(t,e){return new us(this,t,e)}prefixKey(t,e){return t}clear(t,e){if(e=Mr(t,e),e=pr(e,_t),t=yr(t,this[Fr].empty),this[Tt]==="opening")return this.defer(()=>this.clear(t,e)),e[_t];if(pn(this,e))return e[_t];let r=t,i=this.keyEncoding(t.keyEncoding);return t=vo(t,i),t.keyEncoding=i.format,t.limit===0?this.nextTick(e):this._clear(t,o=>{if(o)return e(o);this.emit("clear",r),e()}),e[_t]}_clear(t,e){this.nextTick(e)}iterator(t){let e=this.keyEncoding(t&&t.keyEncoding),r=this.valueEncoding(t&&t.valueEncoding);if(t=vo(t,e),t.keys=t.keys!==!1,t.values=t.values!==!1,t[Dr.keyEncoding]=e,t[Dr.valueEncoding]=r,t.keyEncoding=e.format,t.valueEncoding=r.format,this[Tt]==="opening")return new rd(this,t);if(this[Tt]!=="open")throw new xe("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._iterator(t)}_iterator(t){return new Dr(this,t)}keys(t){let e=this.keyEncoding(t&&t.keyEncoding),r=this.valueEncoding(t&&t.valueEncoding);if(t=vo(t,e),t[Dr.keyEncoding]=e,t[Dr.valueEncoding]=r,t.keyEncoding=e.format,t.valueEncoding=r.format,this[Tt]==="opening")return new nd(this,t);if(this[Tt]!=="open")throw new xe("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._keys(t)}_keys(t){return new td(this,t)}values(t){let e=this.keyEncoding(t&&t.keyEncoding),r=this.valueEncoding(t&&t.valueEncoding);if(t=vo(t,e),t[Dr.keyEncoding]=e,t[Dr.valueEncoding]=r,t.keyEncoding=e.format,t.valueEncoding=r.format,this[Tt]==="opening")return new id(this,t);if(this[Tt]!=="open")throw new xe("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._values(t)}_values(t){return new ed(this,t)}defer(t){if(typeof t!="function")throw new TypeError("The first argument must be a function");this[Yn].push(t)}[Xn](){if(this[Yn].length===0)return;let t=this[Yn];this[Yn]=[];for(let e of t)e()}attachResource(t){if(typeof t!="object"||t===null||typeof t.close!="function")throw new TypeError("The first argument must be a resource object");this[$r].add(t)}detachResource(t){this[$r].delete(t)}_chainedBatch(){return new al(this)}_checkKey(t){if(t==null)return new xe("Key cannot be null or undefined",{code:"LEVEL_INVALID_KEY"})}_checkValue(t){if(t==null)return new xe("Value cannot be null or undefined",{code:"LEVEL_INVALID_VALUE"})}};Zn.prototype.nextTick=tl();var{AbstractSublevel:us}=ol()({AbstractLevel:Zn});ls.AbstractLevel=Zn;ls.AbstractSublevel=us;var pn=function(n,t){return n[Tt]!=="open"?(n.nextTick(t,new xe("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"})),!0):!1},ad=function(n){return Object.keys(n.supports.encodings).filter(t=>!!n.supports.encodings[t])}});var Eo=ft(Kr=>{"use strict";R();Kr.AbstractLevel=fs().AbstractLevel;Kr.AbstractSublevel=fs().AbstractSublevel;Kr.AbstractIterator=gr().AbstractIterator;Kr.AbstractKeyIterator=gr().AbstractKeyIterator;Kr.AbstractValueIterator=gr().AbstractValueIterator;Kr.AbstractChainedBatch=Za().AbstractChainedBatch});var ul=ft((Ym,cl)=>{R();cl.exports=cd;var sd=es();function cd(n,t,e){if(typeof t!="number")throw new Error("second argument must be a Number");let r,i,o,a,s,l=!0,g;Array.isArray(n)?(r=[],o=i=n.length):(a=Object.keys(n),r={},o=i=a.length);function v(B){function m(){e&&e(B,r),e=null}l?sd(m):m()}function A(B,m,E){if(r[B]=E,m&&(s=!0),--o===0||m)v(m);else if(!s&&g<i){let N;a?(N=a[g],g+=1,n[N](function(D,K){A(N,D,K)})):(N=g,g+=1,n[N](function(D,K){A(N,D,K)}))}}g=t,o?a?a.some(function(B,m){return n[B](function(E,N){A(B,E,N)}),m===t-1}):n.some(function(B,m){return B(function(E,N){A(m,E,N)}),m===t-1}):v(null),l=!1}});var hs=ft((Zm,ll)=>{"use strict";R();ll.exports=function(t){let e=t.gte!==void 0?t.gte:t.gt!==void 0?t.gt:void 0,r=t.lte!==void 0?t.lte:t.lt!==void 0?t.lt:void 0,i=t.gte===void 0,o=t.lte===void 0;return e!==void 0&&r!==void 0?IDBKeyRange.bound(e,r,i,o):e!==void 0?IDBKeyRange.lowerBound(e,i):r!==void 0?IDBKeyRange.upperBound(r,o):null}});var gs=ft((e0,fl)=>{"use strict";R();var ud=new TextEncoder;fl.exports=function(n){return n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):ud.encode(n)}});var yl=ft(pl=>{"use strict";R();var{AbstractIterator:ld}=Eo(),hl=hs(),So=gs(),Ne=Symbol("cache"),Ye=Symbol("finished"),ce=Symbol("options"),Xe=Symbol("currentOptions"),Vr=Symbol("position"),ds=Symbol("location"),yn=Symbol("first"),gl={},ps=class extends ld{constructor(t,e,r){super(t,r),this[Ne]=[],this[Ye]=this.limit===0,this[ce]=r,this[Xe]={...r},this[Vr]=void 0,this[ds]=e,this[yn]=!0}_nextv(t,e,r){if(this[yn]=!1,this[Ye])return this.nextTick(r,null,[]);if(this[Ne].length>0)return t=Math.min(t,this[Ne].length),this.nextTick(r,null,this[Ne].splice(0,t));this[Vr]!==void 0&&(this[ce].reverse?(this[Xe].lt=this[Vr],this[Xe].lte=void 0):(this[Xe].gt=this[Vr],this[Xe].gte=void 0));let i;try{i=hl(this[Xe])}catch{return this[Ye]=!0,this.nextTick(r,null,[])}let o=this.db.db.transaction([this[ds]],"readonly"),a=o.objectStore(this[ds]),s=[];if(this[ce].reverse){let l=!this[ce].values&&a.openKeyCursor?"openKeyCursor":"openCursor";a[l](i,"prev").onsuccess=g=>{let v=g.target.result;if(v){let{key:A,value:B}=v;this[Vr]=A,s.push([this[ce].keys&&A!==void 0?So(A):void 0,this[ce].values&&B!==void 0?So(B):void 0]),s.length<t?v.continue():dl(o)}else this[Ye]=!0}}else{let l,g,v=()=>{if(l===void 0||g===void 0)return;let A=Math.max(l.length,g.length);A===0||t===1/0?this[Ye]=!0:this[Vr]=l[A-1],s.length=A;for(let B=0;B<A;B++){let m=l[B],E=g[B];s[B]=[this[ce].keys&&m!==void 0?So(m):void 0,this[ce].values&&E!==void 0?So(E):void 0]}dl(o)};this[ce].keys||t<1/0?a.getAllKeys(i,t<1/0?t:void 0).onsuccess=A=>{l=A.target.result,v()}:(l=[],this.nextTick(v)),this[ce].values?a.getAll(i,t<1/0?t:void 0).onsuccess=A=>{g=A.target.result,v()}:(g=[],this.nextTick(v))}o.onabort=()=>{r(o.error||new Error("aborted by user")),r=null},o.oncomplete=()=>{r(null,s),r=null}}_next(t){if(this[Ne].length>0){let[e,r]=this[Ne].shift();this.nextTick(t,null,e,r)}else if(this[Ye])this.nextTick(t);else{let e=Math.min(100,this.limit-this.count);this[yn]&&(this[yn]=!1,e=1),this._nextv(e,gl,(r,i)=>{if(r)return t(r);this[Ne]=i,this._next(t)})}}_all(t,e){this[yn]=!1;let r=this[Ne].splice(0,this[Ne].length),i=this.limit-this.count-r.length;if(i<=0)return this.nextTick(e,null,r);this._nextv(i,gl,(o,a)=>{if(o)return e(o);r.length>0&&(a=r.concat(a)),e(null,a)})}_seek(t,e){this[yn]=!0,this[Ne]=[],this[Ye]=!1,this[Vr]=void 0,this[Xe]={...this[ce]};let r;try{r=hl(this[ce])}catch{this[Ye]=!0;return}r!==null&&!r.includes(t)?this[Ye]=!0:this[ce].reverse?this[Xe].lte=t:this[Xe].gte=t}};pl.Iterator=ps;function dl(n){typeof n.commit=="function"&&n.commit()}});var ml=ft((o0,wl)=>{"use strict";R();wl.exports=function(t,e,r,i,o){if(i.limit===0)return t.nextTick(o);let a=t.db.transaction([e],"readwrite"),s=a.objectStore(e),l=0;a.oncomplete=function(){o()},a.onabort=function(){o(a.error||new Error("aborted by user"))};let g=s.openKeyCursor?"openKeyCursor":"openCursor",v=i.reverse?"prev":"next";s[g](r,v).onsuccess=function(A){let B=A.target.result;B&&(s.delete(B.key).onsuccess=function(){(i.limit<=0||++l<i.limit)&&B.continue()})}}});var Tl=ft(Sl=>{"use strict";R();var{AbstractLevel:fd}=Eo(),vl=we(),hd=ul(),{fromCallback:gd}=$n(),{Iterator:dd}=yl(),bl=gs(),pd=ml(),yd=hs(),El="level-js-",ti=Symbol("idb"),ys=Symbol("namePrefix"),Ze=Symbol("location"),ws=Symbol("version"),Gr=Symbol("store"),ei=Symbol("onComplete"),_l=Symbol("promise"),To=class extends fd{constructor(t,e,r){if(typeof e=="function"||typeof r=="function")throw new vl("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});let{prefix:i,version:o,...a}=e||{};if(super({encodings:{view:!0},snapshots:!1,createIfMissing:!1,errorIfExists:!1,seek:!0},a),typeof t!="string")throw new Error("constructor requires a location string argument");this[Ze]=t,this[ys]=i??El,this[ws]=parseInt(o||1,10),this[ti]=null}get location(){return this[Ze]}get namePrefix(){return this[ys]}get version(){return this[ws]}get db(){return this[ti]}get type(){return"browser-level"}_open(t,e){let r=indexedDB.open(this[ys]+this[Ze],this[ws]);r.onerror=function(){e(r.error||new Error("unknown error"))},r.onsuccess=()=>{this[ti]=r.result,e()},r.onupgradeneeded=i=>{let o=i.target.result;o.objectStoreNames.contains(this[Ze])||o.createObjectStore(this[Ze])}}[Gr](t){return this[ti].transaction([this[Ze]],t).objectStore(this[Ze])}[ei](t,e){let r=t.transaction;r.onabort=function(){e(r.error||new Error("aborted by user"))},r.oncomplete=function(){e(null,t.result)}}_get(t,e,r){let i=this[Gr]("readonly"),o;try{o=i.get(t)}catch(a){return this.nextTick(r,a)}this[ei](o,function(a,s){if(a)return r(a);if(s===void 0)return r(new vl("Entry not found",{code:"LEVEL_NOT_FOUND"}));r(null,bl(s))})}_getMany(t,e,r){let i=this[Gr]("readonly"),o=t.map(a=>s=>{let l;try{l=i.get(a)}catch(g){return s(g)}l.onsuccess=()=>{let g=l.result;s(null,g===void 0?g:bl(g))},l.onerror=g=>{g.stopPropagation(),s(l.error)}});hd(o,16,r)}_del(t,e,r){let i=this[Gr]("readwrite"),o;try{o=i.delete(t)}catch(a){return this.nextTick(r,a)}this[ei](o,r)}_put(t,e,r,i){let o=this[Gr]("readwrite"),a;try{a=o.put(e,t)}catch(s){return this.nextTick(i,s)}this[ei](a,i)}_iterator(t){return new dd(this,this[Ze],t)}_batch(t,e,r){let i=this[Gr]("readwrite"),o=i.transaction,a=0,s;o.onabort=function(){r(s||o.error||new Error("aborted by user"))},o.oncomplete=function(){r()};function l(){let g=t[a++],v=g.key,A;try{A=g.type==="del"?i.delete(v):i.put(g.value,v)}catch(B){s=B,o.abort();return}a<t.length?A.onsuccess=l:typeof o.commit=="function"&&o.commit()}l()}_clear(t,e){let r,i;try{r=yd(t)}catch{return this.nextTick(e)}if(t.limit>=0)return pd(this,this[Ze],r,t,e);try{let o=this[Gr]("readwrite");i=r?o.delete(r):o.clear()}catch(o){return this.nextTick(e,o)}this[ei](i,e)}_close(t){this[ti].close(),this.nextTick(t)}};To.destroy=function(n,t,e){typeof t=="function"&&(e=t,t=El),e=gd(e,_l);let r=indexedDB.deleteDatabase(t+n);return r.onsuccess=function(){e()},r.onerror=function(i){e(i)},e[_l]};Sl.BrowserLevel=To});var Cl=ft(xl=>{R();xl.Level=Tl().BrowserLevel});var kl=ft((f0,Al)=>{"use strict";R();Al.exports=vd;var Rt=0,It=1;function ue(n,t,e,r,i,o){this._color=n,this.key=t,this.value=e,this.left=r,this.right=i,this._count=o}function Ue(n){return new ue(n._color,n.key,n.value,n.left,n.right,n._count)}function wr(n,t){return new ue(n,t.key,t.value,t.left,t.right,t._count)}function Pt(n){n._count=1+(n.left?n.left._count:0)+(n.right?n.right._count:0)}function mr(n,t){this._compare=n,this.root=t}var Xt=mr.prototype;Object.defineProperty(Xt,"keys",{get:function(){var n=[];return this.forEach(function(t,e){n.push(t)}),n}});Object.defineProperty(Xt,"values",{get:function(){var n=[];return this.forEach(function(t,e){n.push(e)}),n}});Object.defineProperty(Xt,"length",{get:function(){return this.root?this.root._count:0}});Xt.insert=function(n,t){for(var e=this._compare,r=this.root,i=[],o=[];r;){var a=e(n,r.key);i.push(r),o.push(a),a<=0?r=r.left:r=r.right}i.push(new ue(Rt,n,t,null,null,1));for(var s=i.length-2;s>=0;--s){var r=i[s];o[s]<=0?i[s]=new ue(r._color,r.key,r.value,i[s+1],r.right,r._count+1):i[s]=new ue(r._color,r.key,r.value,r.left,i[s+1],r._count+1)}for(var s=i.length-1;s>1;--s){var l=i[s-1],r=i[s];if(l._color===It||r._color===It)break;var g=i[s-2];if(g.left===l)if(l.left===r){var v=g.right;if(v&&v._color===Rt)l._color=It,g.right=wr(It,v),g._color=Rt,s-=1;else{if(g._color=Rt,g.left=l.right,l._color=It,l.right=g,i[s-2]=l,i[s-1]=r,Pt(g),Pt(l),s>=3){var A=i[s-3];A.left===g?A.left=l:A.right=l}break}}else{var v=g.right;if(v&&v._color===Rt)l._color=It,g.right=wr(It,v),g._color=Rt,s-=1;else{if(l.right=r.left,g._color=Rt,g.left=r.right,r._color=It,r.left=l,r.right=g,i[s-2]=r,i[s-1]=l,Pt(g),Pt(l),Pt(r),s>=3){var A=i[s-3];A.left===g?A.left=r:A.right=r}break}}else if(l.right===r){var v=g.left;if(v&&v._color===Rt)l._color=It,g.left=wr(It,v),g._color=Rt,s-=1;else{if(g._color=Rt,g.right=l.left,l._color=It,l.left=g,i[s-2]=l,i[s-1]=r,Pt(g),Pt(l),s>=3){var A=i[s-3];A.right===g?A.right=l:A.left=l}break}}else{var v=g.left;if(v&&v._color===Rt)l._color=It,g.left=wr(It,v),g._color=Rt,s-=1;else{if(l.left=r.right,g._color=Rt,g.right=r.left,r._color=It,r.right=l,r.left=g,i[s-2]=r,i[s-1]=l,Pt(g),Pt(l),Pt(r),s>=3){var A=i[s-3];A.right===g?A.right=r:A.left=r}break}}}return i[0]._color=It,new mr(e,i[0])};function ms(n,t){if(t.left){var e=ms(n,t.left);if(e)return e}var e=n(t.key,t.value);if(e)return e;if(t.right)return ms(n,t.right)}function vs(n,t,e,r){var i=t(n,r.key);if(i<=0){if(r.left){var o=vs(n,t,e,r.left);if(o)return o}var o=e(r.key,r.value);if(o)return o}if(r.right)return vs(n,t,e,r.right)}function bs(n,t,e,r,i){var o=e(n,i.key),a=e(t,i.key),s;if(o<=0&&(i.left&&(s=bs(n,t,e,r,i.left),s)||a>0&&(s=r(i.key,i.value),s)))return s;if(a>0&&i.right)return bs(n,t,e,r,i.right)}Xt.forEach=function(t,e,r){if(this.root)switch(arguments.length){case 1:return ms(t,this.root);case 2:return vs(e,this._compare,t,this.root);case 3:return this._compare(e,r)>=0?void 0:bs(e,r,this._compare,t,this.root)}};Object.defineProperty(Xt,"begin",{get:function(){for(var n=[],t=this.root;t;)n.push(t),t=t.left;return new le(this,n)}});Object.defineProperty(Xt,"end",{get:function(){for(var n=[],t=this.root;t;)n.push(t),t=t.right;return new le(this,n)}});Xt.at=function(n){if(n<0)return new le(this,[]);for(var t=this.root,e=[];;){if(e.push(t),t.left){if(n<t.left._count){t=t.left;continue}n-=t.left._count}if(!n)return new le(this,e);if(n-=1,t.right){if(n>=t.right._count)break;t=t.right}else break}return new le(this,[])};Xt.ge=function(n){for(var t=this._compare,e=this.root,r=[],i=0;e;){var o=t(n,e.key);r.push(e),o<=0&&(i=r.length),o<=0?e=e.left:e=e.right}return r.length=i,new le(this,r)};Xt.gt=function(n){for(var t=this._compare,e=this.root,r=[],i=0;e;){var o=t(n,e.key);r.push(e),o<0&&(i=r.length),o<0?e=e.left:e=e.right}return r.length=i,new le(this,r)};Xt.lt=function(n){for(var t=this._compare,e=this.root,r=[],i=0;e;){var o=t(n,e.key);r.push(e),o>0&&(i=r.length),o<=0?e=e.left:e=e.right}return r.length=i,new le(this,r)};Xt.le=function(n){for(var t=this._compare,e=this.root,r=[],i=0;e;){var o=t(n,e.key);r.push(e),o>=0&&(i=r.length),o<0?e=e.left:e=e.right}return r.length=i,new le(this,r)};Xt.find=function(n){for(var t=this._compare,e=this.root,r=[];e;){var i=t(n,e.key);if(r.push(e),i===0)return new le(this,r);i<=0?e=e.left:e=e.right}return new le(this,[])};Xt.remove=function(n){var t=this.find(n);return t?t.remove():this};Xt.get=function(n){for(var t=this._compare,e=this.root;e;){var r=t(n,e.key);if(r===0)return e.value;r<=0?e=e.left:e=e.right}};function le(n,t){this.tree=n,this._stack=t}var be=le.prototype;Object.defineProperty(be,"valid",{get:function(){return this._stack.length>0}});Object.defineProperty(be,"node",{get:function(){return this._stack.length>0?this._stack[this._stack.length-1]:null},enumerable:!0});be.clone=function(){return new le(this.tree,this._stack.slice())};function Il(n,t){n.key=t.key,n.value=t.value,n.left=t.left,n.right=t.right,n._color=t._color,n._count=t._count}function wd(n){for(var t,e,r,i,o=n.length-1;o>=0;--o){if(t=n[o],o===0){t._color=It;return}if(e=n[o-1],e.left===t){if(r=e.right,r.right&&r.right._color===Rt){if(r=e.right=Ue(r),i=r.right=Ue(r.right),e.right=r.left,r.left=e,r.right=i,r._color=e._color,t._color=It,e._color=It,i._color=It,Pt(e),Pt(r),o>1){var a=n[o-2];a.left===e?a.left=r:a.right=r}n[o-1]=r;return}else if(r.left&&r.left._color===Rt){if(r=e.right=Ue(r),i=r.left=Ue(r.left),e.right=i.left,r.left=i.right,i.left=e,i.right=r,i._color=e._color,e._color=It,r._color=It,t._color=It,Pt(e),Pt(r),Pt(i),o>1){var a=n[o-2];a.left===e?a.left=i:a.right=i}n[o-1]=i;return}if(r._color===It)if(e._color===Rt){e._color=It,e.right=wr(Rt,r);return}else{e.right=wr(Rt,r);continue}else{if(r=Ue(r),e.right=r.left,r.left=e,r._color=e._color,e._color=Rt,Pt(e),Pt(r),o>1){var a=n[o-2];a.left===e?a.left=r:a.right=r}n[o-1]=r,n[o]=e,o+1<n.length?n[o+1]=t:n.push(t),o=o+2}}else{if(r=e.left,r.left&&r.left._color===Rt){if(r=e.left=Ue(r),i=r.left=Ue(r.left),e.left=r.right,r.right=e,r.left=i,r._color=e._color,t._color=It,e._color=It,i._color=It,Pt(e),Pt(r),o>1){var a=n[o-2];a.right===e?a.right=r:a.left=r}n[o-1]=r;return}else if(r.right&&r.right._color===Rt){if(r=e.left=Ue(r),i=r.right=Ue(r.right),e.left=i.right,r.right=i.left,i.right=e,i.left=r,i._color=e._color,e._color=It,r._color=It,t._color=It,Pt(e),Pt(r),Pt(i),o>1){var a=n[o-2];a.right===e?a.right=i:a.left=i}n[o-1]=i;return}if(r._color===It)if(e._color===Rt){e._color=It,e.left=wr(Rt,r);return}else{e.left=wr(Rt,r);continue}else{if(r=Ue(r),e.left=r.right,r.right=e,r._color=e._color,e._color=Rt,Pt(e),Pt(r),o>1){var a=n[o-2];a.right===e?a.right=r:a.left=r}n[o-1]=r,n[o]=e,o+1<n.length?n[o+1]=t:n.push(t),o=o+2}}}}be.remove=function(){var n=this._stack;if(n.length===0)return this.tree;var t=new Array(n.length),e=n[n.length-1];t[t.length-1]=new ue(e._color,e.key,e.value,e.left,e.right,e._count);for(var r=n.length-2;r>=0;--r){var e=n[r];e.left===n[r+1]?t[r]=new ue(e._color,e.key,e.value,t[r+1],e.right,e._count):t[r]=new ue(e._color,e.key,e.value,e.left,t[r+1],e._count)}if(e=t[t.length-1],e.left&&e.right){var i=t.length;for(e=e.left;e.right;)t.push(e),e=e.right;var o=t[i-1];t.push(new ue(e._color,o.key,o.value,e.left,e.right,e._count)),t[i-1].key=e.key,t[i-1].value=e.value;for(var r=t.length-2;r>=i;--r)e=t[r],t[r]=new ue(e._color,e.key,e.value,e.left,t[r+1],e._count);t[i-1].left=t[i]}if(e=t[t.length-1],e._color===Rt){var a=t[t.length-2];a.left===e?a.left=null:a.right===e&&(a.right=null),t.pop();for(var r=0;r<t.length;++r)t[r]._count--;return new mr(this.tree._compare,t[0])}else if(e.left||e.right){e.left?Il(e,e.left):e.right&&Il(e,e.right),e._color=It;for(var r=0;r<t.length-1;++r)t[r]._count--;return new mr(this.tree._compare,t[0])}else{if(t.length===1)return new mr(this.tree._compare,null);for(var r=0;r<t.length;++r)t[r]._count--;var s=t[t.length-2];wd(t),s.left===e?s.left=null:s.right=null}return new mr(this.tree._compare,t[0])};Object.defineProperty(be,"key",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].key},enumerable:!0});Object.defineProperty(be,"value",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].value},enumerable:!0});Object.defineProperty(be,"index",{get:function(){var n=0,t=this._stack;if(t.length===0){var e=this.tree.root;return e?e._count:0}else t[t.length-1].left&&(n=t[t.length-1].left._count);for(var r=t.length-2;r>=0;--r)t[r+1]===t[r].right&&(++n,t[r].left&&(n+=t[r].left._count));return n},enumerable:!0});be.next=function(){var n=this._stack;if(n.length!==0){var t=n[n.length-1];if(t.right)for(t=t.right;t;)n.push(t),t=t.left;else for(n.pop();n.length>0&&n[n.length-1].right===t;)t=n[n.length-1],n.pop()}};Object.defineProperty(be,"hasNext",{get:function(){var n=this._stack;if(n.length===0)return!1;if(n[n.length-1].right)return!0;for(var t=n.length-1;t>0;--t)if(n[t-1].left===n[t])return!0;return!1}});be.update=function(n){var t=this._stack;if(t.length===0)throw new Error("Can't update empty node!");var e=new Array(t.length),r=t[t.length-1];e[e.length-1]=new ue(r._color,r.key,n,r.left,r.right,r._count);for(var i=t.length-2;i>=0;--i)r=t[i],r.left===t[i+1]?e[i]=new ue(r._color,r.key,r.value,e[i+1],r.right,r._count):e[i]=new ue(r._color,r.key,r.value,r.left,e[i+1],r._count);return new mr(this.tree._compare,e[0])};be.prev=function(){var n=this._stack;if(n.length!==0){var t=n[n.length-1];if(t.left)for(t=t.left;t;)n.push(t),t=t.right;else for(n.pop();n.length>0&&n[n.length-1].left===t;)t=n[n.length-1],n.pop()}};Object.defineProperty(be,"hasPrev",{get:function(){var n=this._stack;if(n.length===0)return!1;if(n[n.length-1].left)return!0;for(var t=n.length-1;t>0;--t)if(n[t-1].right===n[t])return!0;return!1}});function md(n,t){return n<t?-1:n>t?1:0}function vd(n){return new mr(n||md,null)}});var Pl=ft(Rl=>{"use strict";R();var{AbstractLevel:bd,AbstractIterator:_d,AbstractKeyIterator:Ed,AbstractValueIterator:Sd}=Eo(),Ll=we(),Ol=kl(),Td=new Set(["gt","gte","lt","lte"]),tr=Symbol("none"),qt=Symbol("tree"),xt=Symbol("iterator"),fe=Symbol("lowerBound"),vr=Symbol("upperBound"),Bl=Symbol("outOfRange"),xo=Symbol("reverse"),_s=Symbol("options"),ie=Symbol("test"),_e=Symbol("advance"),Lo=Symbol("init");function We(n,t){if(typeof n=="string")return n<t?-1:n>t?1:0;let e=Math.min(n.byteLength,t.byteLength);for(let r=0;r<e;r++){let i=n[r]-t[r];if(i!==0)return i}return n.byteLength-t.byteLength}function xd(n){return We(n,this[vr])>0}function Cd(n){return We(n,this[vr])>=0}function Id(n){return We(n,this[vr])<0}function Ad(n){return We(n,this[vr])<=0}var Co=class extends _d{constructor(t,e){super(t,e),this[Lo](t[qt],e)}_next(t){if(!this[xt].valid)return this.nextTick(t);let e=this[xt].key,r=this[xt].value;if(!this[ie](e))return this.nextTick(t);this[xt][this[_e]](),this.nextTick(t,null,e,r)}_nextv(t,e,r){let i=this[xt],o=[];for(;i.valid&&o.length<t&&this[ie](i.key);)o.push([i.key,i.value]),i[this[_e]]();this.nextTick(r,null,o)}_all(t,e){let r=this.limit-this.count,i=this[xt],o=[];for(;i.valid&&o.length<r&&this[ie](i.key);)o.push([i.key,i.value]),i[this[_e]]();this.nextTick(e,null,o)}},Io=class extends Ed{constructor(t,e){super(t,e),this[Lo](t[qt],e)}_next(t){if(!this[xt].valid)return this.nextTick(t);let e=this[xt].key;if(!this[ie](e))return this.nextTick(t);this[xt][this[_e]](),this.nextTick(t,null,e)}_nextv(t,e,r){let i=this[xt],o=[];for(;i.valid&&o.length<t&&this[ie](i.key);)o.push(i.key),i[this[_e]]();this.nextTick(r,null,o)}_all(t,e){let r=this.limit-this.count,i=this[xt],o=[];for(;i.valid&&o.length<r&&this[ie](i.key);)o.push(i.key),i[this[_e]]();this.nextTick(e,null,o)}},Ao=class extends Sd{constructor(t,e){super(t,e),this[Lo](t[qt],e)}_next(t){if(!this[xt].valid)return this.nextTick(t);let e=this[xt].key,r=this[xt].value;if(!this[ie](e))return this.nextTick(t);this[xt][this[_e]](),this.nextTick(t,null,r)}_nextv(t,e,r){let i=this[xt],o=[];for(;i.valid&&o.length<t&&this[ie](i.key);)o.push(i.value),i[this[_e]]();this.nextTick(r,null,o)}_all(t,e){let r=this.limit-this.count,i=this[xt],o=[];for(;i.valid&&o.length<r&&this[ie](i.key);)o.push(i.value),i[this[_e]]();this.nextTick(e,null,o)}};for(let n of[Co,Io,Ao])n.prototype[Lo]=function(t,e){this[xo]=e.reverse,this[_s]=e,this[xo]?(this[_e]="prev",this[fe]="lte"in e?e.lte:"lt"in e?e.lt:tr,this[vr]="gte"in e?e.gte:"gt"in e?e.gt:tr,this[fe]===tr?this[xt]=t.end:"lte"in e?this[xt]=t.le(this[fe]):this[xt]=t.lt(this[fe]),this[vr]!==tr&&(this[ie]="gte"in e?Cd:xd)):(this[_e]="next",this[fe]="gte"in e?e.gte:"gt"in e?e.gt:tr,this[vr]="lte"in e?e.lte:"lt"in e?e.lt:tr,this[fe]===tr?this[xt]=t.begin:"gte"in e?this[xt]=t.ge(this[fe]):this[xt]=t.gt(this[fe]),this[vr]!==tr&&(this[ie]="lte"in e?Ad:Id))},n.prototype[ie]=function(){return!0},n.prototype[Bl]=function(t){return this[ie](t)?this[fe]===tr?!1:this[xo]?"lte"in this[_s]?We(t,this[fe])>0:We(t,this[fe])>=0:"gte"in this[_s]?We(t,this[fe])<0:We(t,this[fe])<=0:!0},n.prototype._seek=function(t,e){this[Bl](t)?(this[xt]=this[xt].tree.end,this[xt].next()):this[xo]?this[xt]=this[xt].tree.le(t):this[xt]=this[xt].tree.ge(t)};var ko=class extends bd{constructor(t,e,r){if(typeof t=="object"&&t!==null&&(e=t),typeof t=="function"||typeof e=="function"||typeof r=="function")throw new Ll("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});let{storeEncoding:i,...o}=e||{};if(i=i||"buffer",!["buffer","view","utf8"].includes(i))throw new Ll("The storeEncoding option must be 'buffer', 'view' or 'utf8'",{code:"LEVEL_ENCODING_NOT_SUPPORTED"});super({seek:!0,permanence:!1,createIfMissing:!1,errorIfExists:!1,encodings:{[i]:!0}},o),this[qt]=Ol(We)}_put(t,e,r,i){let o=this[qt].find(t);o.valid?this[qt]=o.update(e):this[qt]=this[qt].insert(t,e),this.nextTick(i)}_get(t,e,r){let i=this[qt].get(t);if(typeof i>"u")return this.nextTick(r,new Error("NotFound"));this.nextTick(r,null,i)}_getMany(t,e,r){this.nextTick(r,null,t.map(i=>this[qt].get(i)))}_del(t,e,r){this[qt]=this[qt].remove(t),this.nextTick(r)}_batch(t,e,r){let i=this[qt];for(let o of t){let a=o.key,s=i.find(a);o.type==="put"?i=s.valid?s.update(o.value):i.insert(a,o.value):i=s.remove()}this[qt]=i,this.nextTick(r)}_clear(t,e){if(t.limit===-1&&!Object.keys(t).some(kd))return this[qt]=Ol(We),this.nextTick(e);let r=this._keys({...t}),i=r.limit,o=0,a=()=>{for(let s=0;s<500;s++){if(++o>i||!r[xt].valid||!r[ie](r[xt].key))return e();this[qt]=this[qt].remove(r[xt].key),r[xt][r[_e]]()}this.nextTick(a)};this.nextTick(a)}_iterator(t){return new Co(this,t)}_keys(t){return new Io(this,t)}_values(t){return new Ao(this,t)}};Rl.MemoryLevel=ko;if(typeof z.default<"u"&&!z.default.browser&&typeof J<"u"&&typeof J.setImmediate=="function"){let n=J.setImmediate;ko.prototype.nextTick=function(t,...e){e.length===0?n(t):n(()=>t(...e))}}function kd(n){return Td.has(n)}});var br=ft((T0,Wl)=>{R();window.global=window;J.fetch=window.fetch;Wl.exports={Buffer:nn().Buffer,Crypto:window.crypto}});var Ls=ft((Jl,Po)=>{R();(function(n){"use strict";var t,e=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,r=Math.ceil,i=Math.floor,o="[BigNumber Error] ",a=o+"Number primitive has more than 15 significant digits: ",s=1e14,l=14,g=9007199254740991,v=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],A=1e7,B=1e9;function m(U){var M,q,G,W=tt.prototype={constructor:tt,toString:null,valueOf:null},at=new tt(1),V=20,ot=4,ct=-7,ut=21,vt=-1e7,yt=1e7,it=!1,Ot=1,Dt=0,oe={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xA0",suffix:""},bt="0123456789abcdefghijklmnopqrstuvwxyz",Bt=!0;function tt(T,k){var h,w,p,C,x,b,I,_,S=this;if(!(S instanceof tt))return new tt(T,k);if(k==null){if(T&&T._isBigNumber===!0){S.s=T.s,!T.c||T.e>yt?S.c=S.e=null:T.e<vt?S.c=[S.e=0]:(S.e=T.e,S.c=T.c.slice());return}if((b=typeof T=="number")&&T*0==0){if(S.s=1/T<0?(T=-T,-1):1,T===~~T){for(C=0,x=T;x>=10;x/=10,C++);C>yt?S.c=S.e=null:(S.e=C,S.c=[T]);return}_=String(T)}else{if(!e.test(_=String(T)))return G(S,_,b);S.s=_.charCodeAt(0)==45?(_=_.slice(1),-1):1}(C=_.indexOf("."))>-1&&(_=_.replace(".","")),(x=_.search(/e/i))>0?(C<0&&(C=x),C+=+_.slice(x+1),_=_.substring(0,x)):C<0&&(C=_.length)}else{if(K(k,2,bt.length,"Base"),k==10&&Bt)return S=new tt(T),Mt(S,V+S.e+1,ot);if(_=String(T),b=typeof T=="number"){if(T*0!=0)return G(S,_,b,k);if(S.s=1/T<0?(_=_.slice(1),-1):1,tt.DEBUG&&_.replace(/^0\.0*|\./,"").length>15)throw Error(a+T)}else S.s=_.charCodeAt(0)===45?(_=_.slice(1),-1):1;for(h=bt.slice(0,k),C=x=0,I=_.length;x<I;x++)if(h.indexOf(w=_.charAt(x))<0){if(w=="."){if(x>C){C=I;continue}}else if(!p&&(_==_.toUpperCase()&&(_=_.toLowerCase())||_==_.toLowerCase()&&(_=_.toUpperCase()))){p=!0,x=-1,C=0;continue}return G(S,String(T),b,k)}b=!1,_=q(_,k,10,S.s),(C=_.indexOf("."))>-1?_=_.replace(".",""):C=_.length}for(x=0;_.charCodeAt(x)===48;x++);for(I=_.length;_.charCodeAt(--I)===48;);if(_=_.slice(x,++I)){if(I-=x,b&&tt.DEBUG&&I>15&&(T>g||T!==i(T)))throw Error(a+S.s*T);if((C=C-x-1)>yt)S.c=S.e=null;else if(C<vt)S.c=[S.e=0];else{if(S.e=C,S.c=[],x=(C+1)%l,C<0&&(x+=l),x<I){for(x&&S.c.push(+_.slice(0,x)),I-=l;x<I;)S.c.push(+_.slice(x,x+=l));x=l-(_=_.slice(x)).length}else x-=I;for(;x--;_+="0");S.c.push(+_)}}else S.c=[S.e=0]}tt.clone=m,tt.ROUND_UP=0,tt.ROUND_DOWN=1,tt.ROUND_CEIL=2,tt.ROUND_FLOOR=3,tt.ROUND_HALF_UP=4,tt.ROUND_HALF_DOWN=5,tt.ROUND_HALF_EVEN=6,tt.ROUND_HALF_CEIL=7,tt.ROUND_HALF_FLOOR=8,tt.EUCLID=9,tt.config=tt.set=function(T){var k,h;if(T!=null)if(typeof T=="object"){if(T.hasOwnProperty(k="DECIMAL_PLACES")&&(h=T[k],K(h,0,B,k),V=h),T.hasOwnProperty(k="ROUNDING_MODE")&&(h=T[k],K(h,0,8,k),ot=h),T.hasOwnProperty(k="EXPONENTIAL_AT")&&(h=T[k],h&&h.pop?(K(h[0],-B,0,k),K(h[1],0,B,k),ct=h[0],ut=h[1]):(K(h,-B,B,k),ct=-(ut=h<0?-h:h))),T.hasOwnProperty(k="RANGE"))if(h=T[k],h&&h.pop)K(h[0],-B,-1,k),K(h[1],1,B,k),vt=h[0],yt=h[1];else if(K(h,-B,B,k),h)vt=-(yt=h<0?-h:h);else throw Error(o+k+" cannot be zero: "+h);if(T.hasOwnProperty(k="CRYPTO"))if(h=T[k],h===!!h)if(h)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))it=h;else throw it=!h,Error(o+"crypto unavailable");else it=h;else throw Error(o+k+" not true or false: "+h);if(T.hasOwnProperty(k="MODULO_MODE")&&(h=T[k],K(h,0,9,k),Ot=h),T.hasOwnProperty(k="POW_PRECISION")&&(h=T[k],K(h,0,B,k),Dt=h),T.hasOwnProperty(k="FORMAT"))if(h=T[k],typeof h=="object")oe=h;else throw Error(o+k+" not an object: "+h);if(T.hasOwnProperty(k="ALPHABET"))if(h=T[k],typeof h=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(h))Bt=h.slice(0,10)=="0123456789",bt=h;else throw Error(o+k+" invalid: "+h)}else throw Error(o+"Object expected: "+T);return{DECIMAL_PLACES:V,ROUNDING_MODE:ot,EXPONENTIAL_AT:[ct,ut],RANGE:[vt,yt],CRYPTO:it,MODULO_MODE:Ot,POW_PRECISION:Dt,FORMAT:oe,ALPHABET:bt}},tt.isBigNumber=function(T){if(!T||T._isBigNumber!==!0)return!1;if(!tt.DEBUG)return!0;var k,h,w=T.c,p=T.e,C=T.s;t:if({}.toString.call(w)=="[object Array]"){if((C===1||C===-1)&&p>=-B&&p<=B&&p===i(p)){if(w[0]===0){if(p===0&&w.length===1)return!0;break t}if(k=(p+1)%l,k<1&&(k+=l),String(w[0]).length==k){for(k=0;k<w.length;k++)if(h=w[k],h<0||h>=s||h!==i(h))break t;if(h!==0)return!0}}}else if(w===null&&p===null&&(C===null||C===1||C===-1))return!0;throw Error(o+"Invalid BigNumber: "+T)},tt.maximum=tt.max=function(){return rt(arguments,W.lt)},tt.minimum=tt.min=function(){return rt(arguments,W.gt)},tt.random=function(){var T=9007199254740992,k=Math.random()*T&2097151?function(){return i(Math.random()*T)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(h){var w,p,C,x,b,I=0,_=[],S=new tt(at);if(h==null?h=V:K(h,0,B),x=r(h/l),it)if(crypto.getRandomValues){for(w=crypto.getRandomValues(new Uint32Array(x*=2));I<x;)b=w[I]*131072+(w[I+1]>>>11),b>=9e15?(p=crypto.getRandomValues(new Uint32Array(2)),w[I]=p[0],w[I+1]=p[1]):(_.push(b%1e14),I+=2);I=x/2}else if(crypto.randomBytes){for(w=crypto.randomBytes(x*=7);I<x;)b=(w[I]&31)*281474976710656+w[I+1]*1099511627776+w[I+2]*4294967296+w[I+3]*16777216+(w[I+4]<<16)+(w[I+5]<<8)+w[I+6],b>=9e15?crypto.randomBytes(7).copy(w,I):(_.push(b%1e14),I+=7);I=x/7}else throw it=!1,Error(o+"crypto unavailable");if(!it)for(;I<x;)b=k(),b<9e15&&(_[I++]=b%1e14);for(x=_[--I],h%=l,x&&h&&(b=v[l-h],_[I]=i(x/b)*b);_[I]===0;_.pop(),I--);if(I<0)_=[C=0];else{for(C=-1;_[0]===0;_.splice(0,1),C-=l);for(I=1,b=_[0];b>=10;b/=10,I++);I<l&&(C-=l-I)}return S.e=C,S.c=_,S}}(),tt.sum=function(){for(var T=1,k=arguments,h=new tt(k[0]);T<k.length;)h=h.plus(k[T++]);return h},q=function(){var T="0123456789";function k(h,w,p,C){for(var x,b=[0],I,_=0,S=h.length;_<S;){for(I=b.length;I--;b[I]*=w);for(b[0]+=C.indexOf(h.charAt(_++)),x=0;x<b.length;x++)b[x]>p-1&&(b[x+1]==null&&(b[x+1]=0),b[x+1]+=b[x]/p|0,b[x]%=p)}return b.reverse()}return function(h,w,p,C,x){var b,I,_,S,L,f,y,O,F=h.indexOf("."),Z=V,st=ot;for(F>=0&&(S=Dt,Dt=0,h=h.replace(".",""),O=new tt(w),f=O.pow(h.length-F),Dt=S,O.c=k(nt(N(f.c),f.e,"0"),10,p,T),O.e=O.c.length),y=k(h,w,p,x?(b=bt,T):(b=T,bt)),_=S=y.length;y[--S]==0;y.pop());if(!y[0])return b.charAt(0);if(F<0?--_:(f.c=y,f.e=_,f.s=C,f=M(f,O,Z,st,p),y=f.c,L=f.r,_=f.e),I=_+Z+1,F=y[I],S=p/2,L=L||I<0||y[I+1]!=null,L=st<4?(F!=null||L)&&(st==0||st==(f.s<0?3:2)):F>S||F==S&&(st==4||L||st==6&&y[I-1]&1||st==(f.s<0?8:7)),I<1||!y[0])h=L?nt(b.charAt(1),-Z,b.charAt(0)):b.charAt(0);else{if(y.length=I,L)for(--p;++y[--I]>p;)y[I]=0,I||(++_,y=[1].concat(y));for(S=y.length;!y[--S];);for(F=0,h="";F<=S;h+=b.charAt(y[F++]));h=nt(h,_,b.charAt(0))}return h}}(),M=function(){function T(w,p,C){var x,b,I,_,S=0,L=w.length,f=p%A,y=p/A|0;for(w=w.slice();L--;)I=w[L]%A,_=w[L]/A|0,x=y*I+_*f,b=f*I+x%A*A+S,S=(b/C|0)+(x/A|0)+y*_,w[L]=b%C;return S&&(w=[S].concat(w)),w}function k(w,p,C,x){var b,I;if(C!=x)I=C>x?1:-1;else for(b=I=0;b<C;b++)if(w[b]!=p[b]){I=w[b]>p[b]?1:-1;break}return I}function h(w,p,C,x){for(var b=0;C--;)w[C]-=b,b=w[C]<p[C]?1:0,w[C]=b*x+w[C]-p[C];for(;!w[0]&&w.length>1;w.splice(0,1));}return function(w,p,C,x,b){var I,_,S,L,f,y,O,F,Z,st,c,u,d,P,$,H,et,gt=w.s==p.s?1:-1,Et=w.c,lt=p.c;if(!Et||!Et[0]||!lt||!lt[0])return new tt(!w.s||!p.s||(Et?lt&&Et[0]==lt[0]:!lt)?NaN:Et&&Et[0]==0||!lt?gt*0:gt/0);for(F=new tt(gt),Z=F.c=[],_=w.e-p.e,gt=C+_+1,b||(b=s,_=E(w.e/l)-E(p.e/l),gt=gt/l|0),S=0;lt[S]==(Et[S]||0);S++);if(lt[S]>(Et[S]||0)&&_--,gt<0)Z.push(1),L=!0;else{for(P=Et.length,H=lt.length,S=0,gt+=2,f=i(b/(lt[0]+1)),f>1&&(lt=T(lt,f,b),Et=T(Et,f,b),H=lt.length,P=Et.length),d=H,st=Et.slice(0,H),c=st.length;c<H;st[c++]=0);et=lt.slice(),et=[0].concat(et),$=lt[0],lt[1]>=b/2&&$++;do{if(f=0,I=k(lt,st,H,c),I<0){if(u=st[0],H!=c&&(u=u*b+(st[1]||0)),f=i(u/$),f>1)for(f>=b&&(f=b-1),y=T(lt,f,b),O=y.length,c=st.length;k(y,st,O,c)==1;)f--,h(y,H<O?et:lt,O,b),O=y.length,I=1;else f==0&&(I=f=1),y=lt.slice(),O=y.length;if(O<c&&(y=[0].concat(y)),h(st,y,c,b),c=st.length,I==-1)for(;k(lt,st,H,c)<1;)f++,h(st,H<c?et:lt,c,b),c=st.length}else I===0&&(f++,st=[0]);Z[S++]=f,st[0]?st[c++]=Et[d]||0:(st=[Et[d]],c=1)}while((d++<P||st[0]!=null)&&gt--);L=st[0]!=null,Z[0]||Z.splice(0,1)}if(b==s){for(S=1,gt=Z[0];gt>=10;gt/=10,S++);Mt(F,C+(F.e=S+_*l-1)+1,x,L)}else F.e=_,F.r=+L;return F}}();function de(T,k,h,w){var p,C,x,b,I;if(h==null?h=ot:K(h,0,8),!T.c)return T.toString();if(p=T.c[0],x=T.e,k==null)I=N(T.c),I=w==1||w==2&&(x<=ct||x>=ut)?j(I,x):nt(I,x,"0");else if(T=Mt(new tt(T),k,h),C=T.e,I=N(T.c),b=I.length,w==1||w==2&&(k<=C||C<=ct)){for(;b<k;I+="0",b++);I=j(I,C)}else if(k-=x,I=nt(I,C,"0"),C+1>b){if(--k>0)for(I+=".";k--;I+="0");}else if(k+=C-b,k>0)for(C+1==b&&(I+=".");k--;I+="0");return T.s<0&&p?"-"+I:I}function rt(T,k){for(var h,w=1,p=new tt(T[0]);w<T.length;w++)if(h=new tt(T[w]),h.s)k.call(p,h)&&(p=h);else{p=h;break}return p}function pe(T,k,h){for(var w=1,p=k.length;!k[--p];k.pop());for(p=k[0];p>=10;p/=10,w++);return(h=w+h*l-1)>yt?T.c=T.e=null:h<vt?T.c=[T.e=0]:(T.e=h,T.c=k),T}G=function(){var T=/^(-?)0([xbo])(?=\w[\w.]*$)/i,k=/^([^.]+)\.$/,h=/^\.([^.]+)$/,w=/^-?(Infinity|NaN)$/,p=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(C,x,b,I){var _,S=b?x:x.replace(p,"");if(w.test(S))C.s=isNaN(S)?null:S<0?-1:1;else{if(!b&&(S=S.replace(T,function(L,f,y){return _=(y=y.toLowerCase())=="x"?16:y=="b"?2:8,!I||I==_?f:L}),I&&(_=I,S=S.replace(k,"$1").replace(h,"0.$1")),x!=S))return new tt(S,_);if(tt.DEBUG)throw Error(o+"Not a"+(I?" base "+I:"")+" number: "+x);C.s=null}C.c=C.e=null}}();function Mt(T,k,h,w){var p,C,x,b,I,_,S,L=T.c,f=v;if(L){t:{for(p=1,b=L[0];b>=10;b/=10,p++);if(C=k-p,C<0)C+=l,x=k,I=L[_=0],S=I/f[p-x-1]%10|0;else if(_=r((C+1)/l),_>=L.length)if(w){for(;L.length<=_;L.push(0));I=S=0,p=1,C%=l,x=C-l+1}else break t;else{for(I=b=L[_],p=1;b>=10;b/=10,p++);C%=l,x=C-l+p,S=x<0?0:I/f[p-x-1]%10|0}if(w=w||k<0||L[_+1]!=null||(x<0?I:I%f[p-x-1]),w=h<4?(S||w)&&(h==0||h==(T.s<0?3:2)):S>5||S==5&&(h==4||w||h==6&&(C>0?x>0?I/f[p-x]:0:L[_-1])%10&1||h==(T.s<0?8:7)),k<1||!L[0])return L.length=0,w?(k-=T.e+1,L[0]=f[(l-k%l)%l],T.e=-k||0):L[0]=T.e=0,T;if(C==0?(L.length=_,b=1,_--):(L.length=_+1,b=f[l-C],L[_]=x>0?i(I/f[p-x]%f[x])*b:0),w)for(;;)if(_==0){for(C=1,x=L[0];x>=10;x/=10,C++);for(x=L[0]+=b,b=1;x>=10;x/=10,b++);C!=b&&(T.e++,L[0]==s&&(L[0]=1));break}else{if(L[_]+=b,L[_]!=s)break;L[_--]=0,b=1}for(C=L.length;L[--C]===0;L.pop());}T.e>yt?T.c=T.e=null:T.e<vt&&(T.c=[T.e=0])}return T}function Nt(T){var k,h=T.e;return h===null?T.toString():(k=N(T.c),k=h<=ct||h>=ut?j(k,h):nt(k,h,"0"),T.s<0?"-"+k:k)}return W.absoluteValue=W.abs=function(){var T=new tt(this);return T.s<0&&(T.s=1),T},W.comparedTo=function(T,k){return D(this,new tt(T,k))},W.decimalPlaces=W.dp=function(T,k){var h,w,p,C=this;if(T!=null)return K(T,0,B),k==null?k=ot:K(k,0,8),Mt(new tt(C),T+C.e+1,k);if(!(h=C.c))return null;if(w=((p=h.length-1)-E(this.e/l))*l,p=h[p])for(;p%10==0;p/=10,w--);return w<0&&(w=0),w},W.dividedBy=W.div=function(T,k){return M(this,new tt(T,k),V,ot)},W.dividedToIntegerBy=W.idiv=function(T,k){return M(this,new tt(T,k),0,1)},W.exponentiatedBy=W.pow=function(T,k){var h,w,p,C,x,b,I,_,S,L=this;if(T=new tt(T),T.c&&!T.isInteger())throw Error(o+"Exponent not an integer: "+Nt(T));if(k!=null&&(k=new tt(k)),b=T.e>14,!L.c||!L.c[0]||L.c[0]==1&&!L.e&&L.c.length==1||!T.c||!T.c[0])return S=new tt(Math.pow(+Nt(L),b?T.s*(2-X(T)):+Nt(T))),k?S.mod(k):S;if(I=T.s<0,k){if(k.c?!k.c[0]:!k.s)return new tt(NaN);w=!I&&L.isInteger()&&k.isInteger(),w&&(L=L.mod(k))}else{if(T.e>9&&(L.e>0||L.e<-1||(L.e==0?L.c[0]>1||b&&L.c[1]>=24e7:L.c[0]<8e13||b&&L.c[0]<=9999975e7)))return C=L.s<0&&X(T)?-0:0,L.e>-1&&(C=1/C),new tt(I?1/C:C);Dt&&(C=r(Dt/l+2))}for(b?(h=new tt(.5),I&&(T.s=1),_=X(T)):(p=Math.abs(+Nt(T)),_=p%2),S=new tt(at);;){if(_){if(S=S.times(L),!S.c)break;C?S.c.length>C&&(S.c.length=C):w&&(S=S.mod(k))}if(p){if(p=i(p/2),p===0)break;_=p%2}else if(T=T.times(h),Mt(T,T.e+1,1),T.e>14)_=X(T);else{if(p=+Nt(T),p===0)break;_=p%2}L=L.times(L),C?L.c&&L.c.length>C&&(L.c.length=C):w&&(L=L.mod(k))}return w?S:(I&&(S=at.div(S)),k?S.mod(k):C?Mt(S,Dt,ot,x):S)},W.integerValue=function(T){var k=new tt(this);return T==null?T=ot:K(T,0,8),Mt(k,k.e+1,T)},W.isEqualTo=W.eq=function(T,k){return D(this,new tt(T,k))===0},W.isFinite=function(){return!!this.c},W.isGreaterThan=W.gt=function(T,k){return D(this,new tt(T,k))>0},W.isGreaterThanOrEqualTo=W.gte=function(T,k){return(k=D(this,new tt(T,k)))===1||k===0},W.isInteger=function(){return!!this.c&&E(this.e/l)>this.c.length-2},W.isLessThan=W.lt=function(T,k){return D(this,new tt(T,k))<0},W.isLessThanOrEqualTo=W.lte=function(T,k){return(k=D(this,new tt(T,k)))===-1||k===0},W.isNaN=function(){return!this.s},W.isNegative=function(){return this.s<0},W.isPositive=function(){return this.s>0},W.isZero=function(){return!!this.c&&this.c[0]==0},W.minus=function(T,k){var h,w,p,C,x=this,b=x.s;if(T=new tt(T,k),k=T.s,!b||!k)return new tt(NaN);if(b!=k)return T.s=-k,x.plus(T);var I=x.e/l,_=T.e/l,S=x.c,L=T.c;if(!I||!_){if(!S||!L)return S?(T.s=-k,T):new tt(L?x:NaN);if(!S[0]||!L[0])return L[0]?(T.s=-k,T):new tt(S[0]?x:ot==3?-0:0)}if(I=E(I),_=E(_),S=S.slice(),b=I-_){for((C=b<0)?(b=-b,p=S):(_=I,p=L),p.reverse(),k=b;k--;p.push(0));p.reverse()}else for(w=(C=(b=S.length)<(k=L.length))?b:k,b=k=0;k<w;k++)if(S[k]!=L[k]){C=S[k]<L[k];break}if(C&&(p=S,S=L,L=p,T.s=-T.s),k=(w=L.length)-(h=S.length),k>0)for(;k--;S[h++]=0);for(k=s-1;w>b;){if(S[--w]<L[w]){for(h=w;h&&!S[--h];S[h]=k);--S[h],S[w]+=s}S[w]-=L[w]}for(;S[0]==0;S.splice(0,1),--_);return S[0]?pe(T,S,_):(T.s=ot==3?-1:1,T.c=[T.e=0],T)},W.modulo=W.mod=function(T,k){var h,w,p=this;return T=new tt(T,k),!p.c||!T.s||T.c&&!T.c[0]?new tt(NaN):!T.c||p.c&&!p.c[0]?new tt(p):(Ot==9?(w=T.s,T.s=1,h=M(p,T,0,3),T.s=w,h.s*=w):h=M(p,T,0,Ot),T=p.minus(h.times(T)),!T.c[0]&&Ot==1&&(T.s=p.s),T)},W.multipliedBy=W.times=function(T,k){var h,w,p,C,x,b,I,_,S,L,f,y,O,F,Z,st=this,c=st.c,u=(T=new tt(T,k)).c;if(!c||!u||!c[0]||!u[0])return!st.s||!T.s||c&&!c[0]&&!u||u&&!u[0]&&!c?T.c=T.e=T.s=null:(T.s*=st.s,!c||!u?T.c=T.e=null:(T.c=[0],T.e=0)),T;for(w=E(st.e/l)+E(T.e/l),T.s*=st.s,I=c.length,L=u.length,I<L&&(O=c,c=u,u=O,p=I,I=L,L=p),p=I+L,O=[];p--;O.push(0));for(F=s,Z=A,p=L;--p>=0;){for(h=0,f=u[p]%Z,y=u[p]/Z|0,x=I,C=p+x;C>p;)_=c[--x]%Z,S=c[x]/Z|0,b=y*_+S*f,_=f*_+b%Z*Z+O[C]+h,h=(_/F|0)+(b/Z|0)+y*S,O[C--]=_%F;O[C]=h}return h?++w:O.splice(0,1),pe(T,O,w)},W.negated=function(){var T=new tt(this);return T.s=-T.s||null,T},W.plus=function(T,k){var h,w=this,p=w.s;if(T=new tt(T,k),k=T.s,!p||!k)return new tt(NaN);if(p!=k)return T.s=-k,w.minus(T);var C=w.e/l,x=T.e/l,b=w.c,I=T.c;if(!C||!x){if(!b||!I)return new tt(p/0);if(!b[0]||!I[0])return I[0]?T:new tt(b[0]?w:p*0)}if(C=E(C),x=E(x),b=b.slice(),p=C-x){for(p>0?(x=C,h=I):(p=-p,h=b),h.reverse();p--;h.push(0));h.reverse()}for(p=b.length,k=I.length,p-k<0&&(h=I,I=b,b=h,k=p),p=0;k;)p=(b[--k]=b[k]+I[k]+p)/s|0,b[k]=s===b[k]?0:b[k]%s;return p&&(b=[p].concat(b),++x),pe(T,b,x)},W.precision=W.sd=function(T,k){var h,w,p,C=this;if(T!=null&&T!==!!T)return K(T,1,B),k==null?k=ot:K(k,0,8),Mt(new tt(C),T,k);if(!(h=C.c))return null;if(p=h.length-1,w=p*l+1,p=h[p]){for(;p%10==0;p/=10,w--);for(p=h[0];p>=10;p/=10,w++);}return T&&C.e+1>w&&(w=C.e+1),w},W.shiftedBy=function(T){return K(T,-g,g),this.times("1e"+T)},W.squareRoot=W.sqrt=function(){var T,k,h,w,p,C=this,x=C.c,b=C.s,I=C.e,_=V+4,S=new tt("0.5");if(b!==1||!x||!x[0])return new tt(!b||b<0&&(!x||x[0])?NaN:x?C:1/0);if(b=Math.sqrt(+Nt(C)),b==0||b==1/0?(k=N(x),(k.length+I)%2==0&&(k+="0"),b=Math.sqrt(+k),I=E((I+1)/2)-(I<0||I%2),b==1/0?k="5e"+I:(k=b.toExponential(),k=k.slice(0,k.indexOf("e")+1)+I),h=new tt(k)):h=new tt(b+""),h.c[0]){for(I=h.e,b=I+_,b<3&&(b=0);;)if(p=h,h=S.times(p.plus(M(C,p,_,1))),N(p.c).slice(0,b)===(k=N(h.c)).slice(0,b))if(h.e<I&&--b,k=k.slice(b-3,b+1),k=="9999"||!w&&k=="4999"){if(!w&&(Mt(p,p.e+V+2,0),p.times(p).eq(C))){h=p;break}_+=4,b+=4,w=1}else{(!+k||!+k.slice(1)&&k.charAt(0)=="5")&&(Mt(h,h.e+V+2,1),T=!h.times(h).eq(C));break}}return Mt(h,h.e+V+1,ot,T)},W.toExponential=function(T,k){return T!=null&&(K(T,0,B),T++),de(this,T,k,1)},W.toFixed=function(T,k){return T!=null&&(K(T,0,B),T=T+this.e+1),de(this,T,k)},W.toFormat=function(T,k,h){var w,p=this;if(h==null)T!=null&&k&&typeof k=="object"?(h=k,k=null):T&&typeof T=="object"?(h=T,T=k=null):h=oe;else if(typeof h!="object")throw Error(o+"Argument not an object: "+h);if(w=p.toFixed(T,k),p.c){var C,x=w.split("."),b=+h.groupSize,I=+h.secondaryGroupSize,_=h.groupSeparator||"",S=x[0],L=x[1],f=p.s<0,y=f?S.slice(1):S,O=y.length;if(I&&(C=b,b=I,I=C,O-=C),b>0&&O>0){for(C=O%b||b,S=y.substr(0,C);C<O;C+=b)S+=_+y.substr(C,b);I>0&&(S+=_+y.slice(C)),f&&(S="-"+S)}w=L?S+(h.decimalSeparator||"")+((I=+h.fractionGroupSize)?L.replace(new RegExp("\\d{"+I+"}\\B","g"),"$&"+(h.fractionGroupSeparator||"")):L):S}return(h.prefix||"")+w+(h.suffix||"")},W.toFraction=function(T){var k,h,w,p,C,x,b,I,_,S,L,f,y=this,O=y.c;if(T!=null&&(b=new tt(T),!b.isInteger()&&(b.c||b.s!==1)||b.lt(at)))throw Error(o+"Argument "+(b.isInteger()?"out of range: ":"not an integer: ")+Nt(b));if(!O)return new tt(y);for(k=new tt(at),_=h=new tt(at),w=I=new tt(at),f=N(O),C=k.e=f.length-y.e-1,k.c[0]=v[(x=C%l)<0?l+x:x],T=!T||b.comparedTo(k)>0?C>0?k:_:b,x=yt,yt=1/0,b=new tt(f),I.c[0]=0;S=M(b,k,0,1),p=h.plus(S.times(w)),p.comparedTo(T)!=1;)h=w,w=p,_=I.plus(S.times(p=_)),I=p,k=b.minus(S.times(p=k)),b=p;return p=M(T.minus(h),w,0,1),I=I.plus(p.times(_)),h=h.plus(p.times(w)),I.s=_.s=y.s,C=C*2,L=M(_,w,C,ot).minus(y).abs().comparedTo(M(I,h,C,ot).minus(y).abs())<1?[_,w]:[I,h],yt=x,L},W.toNumber=function(){return+Nt(this)},W.toPrecision=function(T,k){return T!=null&&K(T,1,B),de(this,T,k,2)},W.toString=function(T){var k,h=this,w=h.s,p=h.e;return p===null?w?(k="Infinity",w<0&&(k="-"+k)):k="NaN":(T==null?k=p<=ct||p>=ut?j(N(h.c),p):nt(N(h.c),p,"0"):T===10&&Bt?(h=Mt(new tt(h),V+p+1,ot),k=nt(N(h.c),h.e,"0")):(K(T,2,bt.length,"Base"),k=q(nt(N(h.c),p,"0"),10,T,w,!0)),w<0&&h.c[0]&&(k="-"+k)),k},W.valueOf=W.toJSON=function(){return Nt(this)},W._isBigNumber=!0,U!=null&&tt.set(U),tt}function E(U){var M=U|0;return U>0||U===M?M:M-1}function N(U){for(var M,q,G=1,W=U.length,at=U[0]+"";G<W;){for(M=U[G++]+"",q=l-M.length;q--;M="0"+M);at+=M}for(W=at.length;at.charCodeAt(--W)===48;);return at.slice(0,W+1||1)}function D(U,M){var q,G,W=U.c,at=M.c,V=U.s,ot=M.s,ct=U.e,ut=M.e;if(!V||!ot)return null;if(q=W&&!W[0],G=at&&!at[0],q||G)return q?G?0:-ot:V;if(V!=ot)return V;if(q=V<0,G=ct==ut,!W||!at)return G?0:!W^q?1:-1;if(!G)return ct>ut^q?1:-1;for(ot=(ct=W.length)<(ut=at.length)?ct:ut,V=0;V<ot;V++)if(W[V]!=at[V])return W[V]>at[V]^q?1:-1;return ct==ut?0:ct>ut^q?1:-1}function K(U,M,q,G){if(U<M||U>q||U!==i(U))throw Error(o+(G||"Argument")+(typeof U=="number"?U<M||U>q?" out of range: ":" not an integer: ":" not a primitive number: ")+String(U))}function X(U){var M=U.c.length-1;return E(U.e/l)==M&&U.c[M]%2!=0}function j(U,M){return(U.length>1?U.charAt(0)+"."+U.slice(1):U)+(M<0?"e":"e+")+M}function nt(U,M,q){var G,W;if(M<0){for(W=q+".";++M;W+=q);U=W+U}else if(G=U.length,++M>G){for(W=q,M-=G;--M;W+=q);U+=W}else M<G&&(U=U.slice(0,M)+"."+U.slice(M));return U}t=m(),t.default=t.BigNumber=t,typeof define=="function"&&define.amd?define(function(){return t}):typeof Po<"u"&&Po.exports?Po.exports=t:(n||(n=typeof self<"u"&&self?self:window),n.BigNumber=t)})(Jl)});var Yl=ft(Bs=>{"use strict";R();Object.defineProperty(Bs,"__esModule",{value:!0});var yp=Ls(),Os=class{BigNum;constructor(){this.BigNum=(t,e)=>{let r=yp.BigNumber.clone({DECIMAL_PLACES:e});return new r(t)}}winstonToAr(t,{formatted:e=!1,decimals:r=12,trim:i=!0}={}){let o=this.stringToBigNum(t,r).shiftedBy(-12);return e?o.toFormat(r):o.toFixed(r)}arToWinston(t,{formatted:e=!1}={}){let r=this.stringToBigNum(t).shiftedBy(12);return e?r.toFormat():r.toFixed(0)}compare(t,e){let r=this.stringToBigNum(t),i=this.stringToBigNum(e);return r.comparedTo(i)}isEqual(t,e){return this.compare(t,e)===0}isLessThan(t,e){let r=this.stringToBigNum(t),i=this.stringToBigNum(e);return r.isLessThan(i)}isGreaterThan(t,e){let r=this.stringToBigNum(t),i=this.stringToBigNum(e);return r.isGreaterThan(i)}add(t,e){let r=this.stringToBigNum(t),i=this.stringToBigNum(e);return r.plus(e).toFixed(0)}sub(t,e){let r=this.stringToBigNum(t),i=this.stringToBigNum(e);return r.minus(e).toFixed(0)}stringToBigNum(t,e=12){return this.BigNum(t,e)}};Bs.default=Os});var Xl=ft(Ps=>{"use strict";R();Object.defineProperty(Ps,"__esModule",{value:!0});var Rs=class{METHOD_GET="GET";METHOD_POST="POST";config;constructor(t){this.applyConfig(t)}applyConfig(t){this.config=this.mergeDefaults(t)}getConfig(){return this.config}mergeDefaults(t){let e=t.protocol||"http",r=t.port||(e==="https"?443:80);return{host:t.host||"127.0.0.1",protocol:e,port:r,timeout:t.timeout||2e4,logging:t.logging||!1,logger:t.logger||console.log,network:t.network}}async get(t,e){return await this.request(t,{...e,method:this.METHOD_GET})}async post(t,e,r){let i=new Headers(r?.headers||{});return i.get("content-type")?.includes("application/json")||i.append("content-type","application/json"),i.append("accept","application/json, text/plain, */*"),await this.request(t,{...r,method:this.METHOD_POST,body:typeof e!="string"?JSON.stringify(e):e,headers:i})}async request(t,e){let r=new Headers(e?.headers||{}),i=`${this.config.protocol}://${this.config.host}:${this.config.port}`,o=e?.responseType;delete e?.responseType,t.startsWith("/")&&(t=t.slice(1)),this.config.network&&r.append("x-network",this.config.network),this.config.logging&&this.config.logger(`Requesting: ${i}/${t}`);let a=await fetch(`${i}/${t}`,{...e||{},headers:r});this.config.logging&&this.config.logger(`Response:   ${a.url} - ${a.status}`);let l=a.headers.get("content-type")?.match(/charset=([^()<>@,;:\"/[\]?.=\s]*)/i)?.[1],g=a,v=async()=>{if(l)try{g.data=new TextDecoder(l).decode(await a.arrayBuffer())}catch{g.data=await a.text()}else g.data=await a.text()};if(o==="arraybuffer")g.data=await a.arrayBuffer();else if(o==="text")await v();else if(o==="webstream")g.data=wp(a.body);else try{let A=await a.clone().json();typeof A!="object"?await v():g.data=await a.json(),A=null}catch{await v()}return g}};Ps.default=Rs;var wp=n=>{let t=n;return typeof t[Symbol.asyncIterator]>"u"?(t[Symbol.asyncIterator]=mp(n),t):n},mp=function(n){return async function*(){let e=n.getReader();try{for(;;){let{done:r,value:i}=await e.read();if(r)return;yield i}}finally{e.releaseLock()}}}});var Ie=ft(Ut=>{"use strict";R();Object.defineProperty(Ut,"__esModule",{value:!0});Ut.b64UrlDecode=Ut.b64UrlEncode=Ut.bufferTob64Url=Ut.bufferTob64=Ut.b64UrlToBuffer=Ut.stringToB64Url=Ut.stringToBuffer=Ut.bufferToString=Ut.b64UrlToString=Ut.concatBuffers=void 0;var Zl=wa();function vp(n){let t=0;for(let i=0;i<n.length;i++)t+=n[i].byteLength;let e=new Uint8Array(t),r=0;e.set(new Uint8Array(n[0]),r),r+=n[0].byteLength;for(let i=1;i<n.length;i++)e.set(new Uint8Array(n[i]),r),r+=n[i].byteLength;return e}Ut.concatBuffers=vp;function bp(n){let t=rf(n);return tf(t)}Ut.b64UrlToString=bp;function tf(n){return new TextDecoder("utf-8",{fatal:!0}).decode(n)}Ut.bufferToString=tf;function ef(n){return new TextEncoder().encode(n)}Ut.stringToBuffer=ef;function _p(n){return of(ef(n))}Ut.stringToB64Url=_p;function rf(n){return new Uint8Array(Zl.toByteArray(sf(n)))}Ut.b64UrlToBuffer=rf;function nf(n){return Zl.fromByteArray(new Uint8Array(n))}Ut.bufferTob64=nf;function of(n){return af(nf(n))}Ut.bufferTob64Url=of;function af(n){return n.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}Ut.b64UrlEncode=af;function sf(n){n=n.replace(/\-/g,"+").replace(/\_/g,"/");let t;return n.length%4==0?t=0:t=4-n.length%4,n.concat("=".repeat(t))}Ut.b64UrlDecode=sf});var cf=ft(Us=>{"use strict";R();Object.defineProperty(Us,"__esModule",{value:!0});var Er=Ie(),Ns=class{keyLength=4096;publicExponent=65537;hashAlgorithm="sha256";driver;constructor(){if(!this.detectWebCrypto())throw new Error("SubtleCrypto not available!");this.driver=crypto.subtle}async generateJWK(){let t=await this.driver.generateKey({name:"RSA-PSS",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign"]),e=await this.driver.exportKey("jwk",t.privateKey);return{kty:e.kty,e:e.e,n:e.n,d:e.d,p:e.p,q:e.q,dp:e.dp,dq:e.dq,qi:e.qi}}async sign(t,e,{saltLength:r}={}){let i=await this.driver.sign({name:"RSA-PSS",saltLength:32},await this.jwkToCryptoKey(t),e);return new Uint8Array(i)}async hash(t,e="SHA-256"){let r=await this.driver.digest(e,t);return new Uint8Array(r)}async verify(t,e,r){let i={kty:"RSA",e:"AQAB",n:t},o=await this.jwkToPublicCryptoKey(i),a=await this.driver.digest("SHA-256",e),s=await this.driver.verify({name:"RSA-PSS",saltLength:0},o,r,e),l=await this.driver.verify({name:"RSA-PSS",saltLength:32},o,r,e),g=await this.driver.verify({name:"RSA-PSS",saltLength:Math.ceil((o.algorithm.modulusLength-1)/8)-a.byteLength-2},o,r,e);return s||l||g}async jwkToCryptoKey(t){return this.driver.importKey("jwk",t,{name:"RSA-PSS",hash:{name:"SHA-256"}},!1,["sign"])}async jwkToPublicCryptoKey(t){return this.driver.importKey("jwk",t,{name:"RSA-PSS",hash:{name:"SHA-256"}},!1,["verify"])}detectWebCrypto(){if(typeof crypto>"u")return!1;let t=crypto?.subtle;return t===void 0?!1:["generateKey","importKey","exportKey","digest","sign"].every(r=>typeof t[r]=="function")}async encrypt(t,e,r){let i=await this.driver.importKey("raw",typeof e=="string"?Er.stringToBuffer(e):e,{name:"PBKDF2",length:32},!1,["deriveKey"]),o=await this.driver.deriveKey({name:"PBKDF2",salt:r?Er.stringToBuffer(r):Er.stringToBuffer("salt"),iterations:1e5,hash:"SHA-256"},i,{name:"AES-CBC",length:256},!1,["encrypt","decrypt"]),a=new Uint8Array(16);crypto.getRandomValues(a);let s=await this.driver.encrypt({name:"AES-CBC",iv:a},o,t);return Er.concatBuffers([a,s])}async decrypt(t,e,r){let i=await this.driver.importKey("raw",typeof e=="string"?Er.stringToBuffer(e):e,{name:"PBKDF2",length:32},!1,["deriveKey"]),o=await this.driver.deriveKey({name:"PBKDF2",salt:r?Er.stringToBuffer(r):Er.stringToBuffer("salt"),iterations:1e5,hash:"SHA-256"},i,{name:"AES-CBC",length:256},!1,["encrypt","decrypt"]),a=t.slice(0,16),s=await this.driver.decrypt({name:"AES-CBC",iv:a},o,t.slice(16));return Er.concatBuffers([s])}};Us.default=Ns});var uf=ft(Ds=>{"use strict";R();Object.defineProperty(Ds,"__esModule",{value:!0});var Ws=class{api;constructor(t){this.api=t}getInfo(){return this.api.get("info").then(t=>t.data)}getPeers(){return this.api.get("peers").then(t=>t.data)}};Ds.default=Ws});var li=ft(ui=>{"use strict";R();Object.defineProperty(ui,"__esModule",{value:!0});ui.getError=void 0;var Ms=class extends Error{type;response;constructor(t,e={}){e.message?super(e.message):super(),this.type=t,this.response=e.response}getType(){return this.type}};ui.default=Ms;function Ep(n){let t=n.data;if(typeof n.data=="string")try{t=JSON.parse(n.data)}catch{}if(n.data instanceof ArrayBuffer||n.data instanceof Uint8Array)try{t=JSON.parse(t.toString())}catch{}return t?t.error||t:n.statusText||"unknown"}ui.getError=Ep});var hf=ft($s=>{"use strict";R();Object.defineProperty($s,"__esModule",{value:!0});var he=fi();async function lf(n){if(Array.isArray(n)){let r=he.default.utils.concatBuffers([he.default.utils.stringToBuffer("list"),he.default.utils.stringToBuffer(n.length.toString())]);return await ff(n,await he.default.crypto.hash(r,"SHA-384"))}let t=he.default.utils.concatBuffers([he.default.utils.stringToBuffer("blob"),he.default.utils.stringToBuffer(n.byteLength.toString())]),e=he.default.utils.concatBuffers([await he.default.crypto.hash(t,"SHA-384"),await he.default.crypto.hash(n,"SHA-384")]);return await he.default.crypto.hash(e,"SHA-384")}$s.default=lf;async function ff(n,t){if(n.length<1)return t;let e=he.default.utils.concatBuffers([t,await lf(n[0])]),r=await he.default.crypto.hash(e,"SHA-384");return await ff(n.slice(1),r)}});var js=ft(St=>{"use strict";R();Object.defineProperty(St,"__esModule",{value:!0});St.debug=St.validatePath=St.arrayCompare=St.bufferToInt=St.intToBuffer=St.arrayFlatten=St.generateProofs=St.buildLayers=St.generateTransactionChunks=St.generateTree=St.computeRootHash=St.generateLeaves=St.chunkData=St.MIN_CHUNK_SIZE=St.MAX_CHUNK_SIZE=void 0;var No=fi(),gf=Ie();St.MAX_CHUNK_SIZE=256*1024;St.MIN_CHUNK_SIZE=32*1024;var gi=32,wn=32;async function Ks(n){let t=[],e=n,r=0;for(;e.byteLength>=St.MAX_CHUNK_SIZE;){let i=St.MAX_CHUNK_SIZE,o=e.byteLength-St.MAX_CHUNK_SIZE;o>0&&o<St.MIN_CHUNK_SIZE&&(i=Math.ceil(e.byteLength/2));let a=e.slice(0,i),s=await No.default.crypto.hash(a);r+=a.byteLength,t.push({dataHash:s,minByteRange:r-a.byteLength,maxByteRange:r}),e=e.slice(i)}return t.push({dataHash:await No.default.crypto.hash(e),minByteRange:r,maxByteRange:r+e.byteLength}),t}St.chunkData=Ks;async function Vs(n){return Promise.all(n.map(async({dataHash:t,minByteRange:e,maxByteRange:r})=>({type:"leaf",id:await Gt(await Promise.all([Gt(t),Gt(di(r))])),dataHash:t,minByteRange:e,maxByteRange:r})))}St.generateLeaves=Vs;async function Sp(n){return(await df(n)).id}St.computeRootHash=Sp;async function df(n){return await Uo(await Vs(await Ks(n)))}St.generateTree=df;async function Tp(n){let t=await Ks(n),e=await Vs(t),r=await Uo(e),i=await pf(r),o=t.slice(-1)[0];return o.maxByteRange-o.minByteRange===0&&(t.splice(t.length-1,1),i.splice(i.length-1,1)),{data_root:r.id,chunks:t,proofs:i}}St.generateTransactionChunks=Tp;async function Uo(n,t=0){if(n.length<2)return n[0];let e=[];for(let r=0;r<n.length;r+=2)e.push(await xp(n[r],n[r+1]));return Uo(e,t+1)}St.buildLayers=Uo;function pf(n){let t=Fs(n);return Array.isArray(t)?Gs(t):[t]}St.generateProofs=pf;function Fs(n,t=new Uint8Array,e=0){if(n.type=="leaf")return{offset:n.maxByteRange-1,proof:(0,gf.concatBuffers)([t,n.dataHash,di(n.maxByteRange)])};if(n.type=="branch"){let r=(0,gf.concatBuffers)([t,n.leftChild.id,n.rightChild.id,di(n.byteRange)]);return[Fs(n.leftChild,r,e+1),Fs(n.rightChild,r,e+1)]}throw new Error("Unexpected node type")}function Gs(n){let t=[];return n.forEach(e=>{Array.isArray(e)?t.push(...Gs(e)):t.push(e)}),t}St.arrayFlatten=Gs;async function xp(n,t){return t?{type:"branch",id:await Gt([await Gt(n.id),await Gt(t.id),await Gt(di(n.maxByteRange))]),byteRange:n.maxByteRange,maxByteRange:t.maxByteRange,leftChild:n,rightChild:t}:n}async function Gt(n){return Array.isArray(n)&&(n=No.default.utils.concatBuffers(n)),new Uint8Array(await No.default.crypto.hash(n))}function di(n){let t=new Uint8Array(gi);for(var e=t.length-1;e>=0;e--){var r=n%256;t[e]=r,n=(n-r)/256}return t}St.intToBuffer=di;function qs(n){let t=0;for(var e=0;e<n.length;e++)t*=256,t+=n[e];return t}St.bufferToInt=qs;var Cp=(n,t)=>n.every((e,r)=>t[r]===e);St.arrayCompare=Cp;async function hi(n,t,e,r,i){if(r<=0)return!1;if(t>=r)return hi(n,0,r-1,r,i);if(t<0)return hi(n,0,0,r,i);if(i.length==wn+gi){let A=i.slice(0,wn),B=i.slice(A.length,A.length+gi),m=await Gt([await Gt(A),await Gt(B)]);return(0,St.arrayCompare)(n,m)?{offset:r-1,leftBound:e,rightBound:r,chunkSize:r-e}:!1}let o=i.slice(0,wn),a=i.slice(o.length,o.length+wn),s=i.slice(o.length+a.length,o.length+a.length+gi),l=qs(s),g=i.slice(o.length+a.length+s.length),v=await Gt([await Gt(o),await Gt(a),await Gt(s)]);return(0,St.arrayCompare)(n,v)?t<l?await hi(o,t,e,Math.min(r,l),g):await hi(a,t,Math.max(e,l),r,g):!1}St.validatePath=hi;async function yf(n,t=""){if(n.byteLength<1)return t;let e=n.slice(0,wn),r=n.slice(e.length,e.length+wn),i=n.slice(e.length+r.length,e.length+r.length+gi),o=qs(i),a=n.slice(e.length+r.length+i.length),s=await Gt([await Gt(e),await Gt(r),await Gt(i)]),l=`${t}
${JSON.stringify(Q.Buffer.from(e))},${JSON.stringify(Q.Buffer.from(r))},${o} => ${JSON.stringify(s)}`;return yf(a,l)}St.debug=yf});var Do=ft(yi=>{"use strict";R();Object.defineProperty(yi,"__esModule",{value:!0});yi.Tag=void 0;var Ft=Ie(),Ip=hf(),Ap=js(),Wo=class{get(t,e){if(!Object.getOwnPropertyNames(this).includes(t))throw new Error(`Field "${t}" is not a property of the Arweave Transaction class.`);if(this[t]instanceof Uint8Array)return e&&e.decode&&e.string?Ft.bufferToString(this[t]):e&&e.decode&&!e.string?this[t]:Ft.bufferTob64Url(this[t]);if(this[t]instanceof Array){if(e?.decode!==void 0||e?.string!==void 0)throw t==="tags"&&console.warn(`Did you mean to use 'transaction["tags"]' ?`),new Error("Cannot decode or stringify an array.");return this[t]}return e&&e.decode==!0?e&&e.string?Ft.b64UrlToString(this[t]):Ft.b64UrlToBuffer(this[t]):this[t]}},pi=class extends Wo{name;value;constructor(t,e,r=!1){super(),this.name=t,this.value=e}};yi.Tag=pi;var Hs=class extends Wo{format=2;id="";last_tx="";owner="";tags=[];target="";quantity="0";data_size="0";data=new Uint8Array;data_root="";reward="0";signature="";chunks;constructor(t={}){super(),Object.assign(this,t),typeof this.data=="string"&&(this.data=Ft.b64UrlToBuffer(this.data)),t.tags&&(this.tags=t.tags.map(e=>new pi(e.name,e.value)))}addTag(t,e){this.tags.push(new pi(Ft.stringToB64Url(t),Ft.stringToB64Url(e)))}toJSON(){return{format:this.format,id:this.id,last_tx:this.last_tx,owner:this.owner,tags:this.tags,target:this.target,quantity:this.quantity,data:Ft.bufferTob64Url(this.data),data_size:this.data_size,data_root:this.data_root,data_tree:this.data_tree,reward:this.reward,signature:this.signature}}setOwner(t){this.owner=t}setSignature({id:t,owner:e,reward:r,tags:i,signature:o}){this.id=t,this.owner=e,r&&(this.reward=r),i&&(this.tags=i),this.signature=o}async prepareChunks(t){!this.chunks&&t.byteLength>0&&(this.chunks=await(0,Ap.generateTransactionChunks)(t),this.data_root=Ft.bufferTob64Url(this.chunks.data_root)),!this.chunks&&t.byteLength===0&&(this.chunks={chunks:[],data_root:new Uint8Array,proofs:[]},this.data_root="")}getChunk(t,e){if(!this.chunks)throw new Error("Chunks have not been prepared");let r=this.chunks.proofs[t],i=this.chunks.chunks[t];return{data_root:this.data_root,data_size:this.data_size,data_path:Ft.bufferTob64Url(r.proof),offset:r.offset.toString(),chunk:Ft.bufferTob64Url(e.slice(i.minByteRange,i.maxByteRange))}}async getSignatureData(){switch(this.format){case 1:let t=this.tags.reduce((r,i)=>Ft.concatBuffers([r,i.get("name",{decode:!0,string:!1}),i.get("value",{decode:!0,string:!1})]),new Uint8Array);return Ft.concatBuffers([this.get("owner",{decode:!0,string:!1}),this.get("target",{decode:!0,string:!1}),this.get("data",{decode:!0,string:!1}),Ft.stringToBuffer(this.quantity),Ft.stringToBuffer(this.reward),this.get("last_tx",{decode:!0,string:!1}),t]);case 2:this.data_root||await this.prepareChunks(this.data);let e=this.tags.map(r=>[r.get("name",{decode:!0,string:!1}),r.get("value",{decode:!0,string:!1})]);return await(0,Ip.default)([Ft.stringToBuffer(this.format.toString()),this.get("owner",{decode:!0,string:!1}),this.get("target",{decode:!0,string:!1}),Ft.stringToBuffer(this.quantity),Ft.stringToBuffer(this.reward),this.get("last_tx",{decode:!0,string:!1}),e,Ft.stringToBuffer(this.data_size),this.get("data_root",{decode:!0,string:!1})]);default:throw new Error(`Unexpected transaction format: ${this.format}`)}}};yi.default=Hs});var bf=ft(Mo=>{"use strict";R();Object.defineProperty(Mo,"__esModule",{value:!0});Mo.TransactionUploader=void 0;var wf=Do(),kp=Ie(),Qs=li(),Lp=js(),mf=1,Op=["invalid_json","chunk_too_big","data_path_too_big","offset_too_big","data_size_too_big","chunk_proof_ratio_not_attractive","invalid_proof"],vf=1e3*40,wi=class{api;chunkIndex=0;txPosted=!1;transaction;lastRequestTimeEnd=0;totalErrors=0;data;lastResponseStatus=0;lastResponseError="";get isComplete(){return this.txPosted&&this.chunkIndex===this.transaction.chunks.chunks.length}get totalChunks(){return this.transaction.chunks.chunks.length}get uploadedChunks(){return this.chunkIndex}get pctComplete(){return Math.trunc(this.uploadedChunks/this.totalChunks*100)}constructor(t,e){if(this.api=t,!e.id)throw new Error("Transaction is not signed");if(!e.chunks)throw new Error("Transaction chunks not prepared");this.data=e.data,this.transaction=new wf.default(Object.assign({},e,{data:new Uint8Array(0)}))}async uploadChunk(t){if(this.isComplete)throw new Error("Upload is already complete");if(this.lastResponseError!==""?this.totalErrors++:this.totalErrors=0,this.totalErrors===100)throw new Error(`Unable to complete upload: ${this.lastResponseStatus}: ${this.lastResponseError}`);let e=this.lastResponseError===""?0:Math.max(this.lastRequestTimeEnd+vf-Date.now(),vf);if(e>0&&(e=e-e*Math.random()*.3,await new Promise(a=>setTimeout(a,e))),this.lastResponseError="",!this.txPosted){await this.postTransaction();return}t&&(this.chunkIndex=t);let r=this.transaction.getChunk(t||this.chunkIndex,this.data);if(!await(0,Lp.validatePath)(this.transaction.chunks.data_root,parseInt(r.offset),0,parseInt(r.data_size),kp.b64UrlToBuffer(r.data_path)))throw new Error(`Unable to validate chunk ${this.chunkIndex}`);let o=await this.api.post("chunk",this.transaction.getChunk(this.chunkIndex,this.data)).catch(a=>(console.error(a.message),{status:-1,data:{error:a.message}}));if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=o.status,this.lastResponseStatus==200)this.chunkIndex++;else if(this.lastResponseError=(0,Qs.getError)(o),Op.includes(this.lastResponseError))throw new Error(`Fatal error uploading chunk ${this.chunkIndex}: ${this.lastResponseError}`)}static async fromSerialized(t,e,r){if(!e||typeof e.chunkIndex!="number"||typeof e.transaction!="object")throw new Error("Serialized object does not match expected format.");var i=new wf.default(e.transaction);i.chunks||await i.prepareChunks(r);let o=new wi(t,i);if(o.chunkIndex=e.chunkIndex,o.lastRequestTimeEnd=e.lastRequestTimeEnd,o.lastResponseError=e.lastResponseError,o.lastResponseStatus=e.lastResponseStatus,o.txPosted=e.txPosted,o.data=r,o.transaction.data_root!==e.transaction.data_root)throw new Error("Data mismatch: Uploader doesn't match provided data.");return o}static async fromTransactionId(t,e){let r=await t.get(`tx/${e}`);if(r.status!==200)throw new Error(`Tx ${e} not found: ${r.status}`);let i=r.data;return i.data=new Uint8Array(0),{txPosted:!0,chunkIndex:0,lastResponseError:"",lastRequestTimeEnd:0,lastResponseStatus:0,transaction:i}}toJSON(){return{chunkIndex:this.chunkIndex,transaction:this.transaction,lastRequestTimeEnd:this.lastRequestTimeEnd,lastResponseStatus:this.lastResponseStatus,lastResponseError:this.lastResponseError,txPosted:this.txPosted}}async postTransaction(){if(this.totalChunks<=mf){this.transaction.data=this.data;let r=await this.api.post("tx",this.transaction).catch(i=>(console.error(i),{status:-1,data:{error:i.message}}));if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=r.status,this.transaction.data=new Uint8Array(0),r.status>=200&&r.status<300){this.txPosted=!0,this.chunkIndex=mf;return}throw this.lastResponseError=(0,Qs.getError)(r),new Error(`Unable to upload transaction: ${r.status}, ${this.lastResponseError}`)}let e=await this.api.post("tx",this.transaction);if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=e.status,!(e.status>=200&&e.status<300))throw this.lastResponseError=(0,Qs.getError)(e),new Error(`Unable to upload transaction: ${e.status}, ${this.lastResponseError}`);this.txPosted=!0}};Mo.TransactionUploader=wi});var $o=ft((fv,_f)=>{R();_f.exports={}});var Ef=ft(Xs=>{"use strict";R();Object.defineProperty(Xs,"__esModule",{value:!0});var zs=li(),er=Do(),mi=Ie(),Js=bf();$o();var Ys=class{api;crypto;chunks;constructor(t,e,r){this.api=t,this.crypto=e,this.chunks=r}async getTransactionAnchor(){let t=await this.api.get("tx_anchor");if(!t.data.match(/^[a-z0-9_-]{43,}/i)||!t.ok)throw new Error(`Could not getTransactionAnchor. Received: ${t.data}. Status: ${t.status}, ${t.statusText}`);return t.data}async getPrice(t,e){let r=e?`price/${t}/${e}`:`price/${t}`,i=await this.api.get(r);if(!/^\d+$/.test(i.data)||!i.ok)throw new Error(`Could not getPrice. Received: ${i.data}. Status: ${i.status}, ${i.statusText}`);return i.data}async get(t){let e=await this.api.get(`tx/${t}`);if(e.status==200){let r=parseInt(e.data.data_size);if(e.data.format>=2&&r>0&&r<=1024*1024*12){let i=await this.getData(t);return new er.default({...e.data,data:i})}return new er.default({...e.data,format:e.data.format||1})}throw e.status==404?new zs.default("TX_NOT_FOUND"):e.status==410?new zs.default("TX_FAILED"):new zs.default("TX_INVALID")}fromRaw(t){return new er.default(t)}async search(t,e){return this.api.post("arql",{op:"equals",expr1:t,expr2:e}).then(r=>r.data?r.data:[])}getStatus(t){return this.api.get(`tx/${t}/status`).then(e=>e.status==200?{status:200,confirmed:e.data}:{status:e.status,confirmed:null})}async getData(t,e){let r;try{r=await this.chunks.downloadChunkedData(t)}catch(i){console.error(`Error while trying to download chunked data for ${t}`),console.error(i)}if(!r){console.warn(`Falling back to gateway cache for ${t}`);try{let{data:i,ok:o,status:a,statusText:s}=await this.api.get(`/${t}`,{responseType:"arraybuffer"});if(!o)throw new Error("Bad http status code",{cause:{status:a,statusText:s}});r=i}catch(i){console.error(`Error while trying to download contiguous data from gateway cache for ${t}`),console.error(i)}}if(!r)throw new Error(`${t} data was not found!`);return e&&e.decode&&!e.string?r:e&&e.decode&&e.string?mi.bufferToString(r):mi.bufferTob64Url(r)}async sign(t,e,r){let o=typeof e=="object"&&(s=>{let l=!0;return["n","e","d","p","q","dp","dq","qi"].map(g=>!(g in s)&&(l=!1)),l})(e),a=typeof arweaveWallet=="object";if(!o&&!a)throw new Error("No valid JWK or external wallet found to sign transaction.");if(a){try{(await arweaveWallet.getPermissions()).includes("SIGN_TRANSACTION")||await arweaveWallet.connect(["SIGN_TRANSACTION"])}catch{}let s=await arweaveWallet.sign(t,r);t.setSignature({id:s.id,owner:s.owner,reward:s.reward,tags:s.tags,signature:s.signature})}else if(o){t.setOwner(e.n);let s=await t.getSignatureData(),l=await this.crypto.sign(e,s,r),g=await this.crypto.hash(l);t.setSignature({id:mi.bufferTob64Url(g),owner:e.n,signature:mi.bufferTob64Url(l)})}else throw new Error("An error occurred while signing. Check wallet is valid")}async verify(t){let e=await t.getSignatureData(),r=t.get("signature",{decode:!0,string:!1}),i=mi.bufferTob64Url(await this.crypto.hash(r));if(t.id!==i)throw new Error("Invalid transaction signature or ID! The transaction ID doesn't match the expected SHA-256 hash of the signature.");return this.crypto.verify(t.owner,e,r)}async post(t){if(typeof t=="string"?t=new er.default(JSON.parse(t)):typeof t.readInt32BE=="function"?t=new er.default(JSON.parse(t.toString())):typeof t=="object"&&!(t instanceof er.default)&&(t=new er.default(t)),!(t instanceof er.default))throw new Error("Must be Transaction object");t.chunks||await t.prepareChunks(t.data);let e=await this.getUploader(t,t.data);try{for(;!e.isComplete;)await e.uploadChunk()}catch(r){if(e.lastResponseStatus>0)return{status:e.lastResponseStatus,statusText:e.lastResponseError,data:{error:e.lastResponseError}};throw r}return{status:200,statusText:"OK",data:{}}}async getUploader(t,e){let r;if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),t instanceof er.default){if(e||(e=t.data),!(e instanceof Uint8Array))throw new Error("Data format is invalid");t.chunks||await t.prepareChunks(e),r=new Js.TransactionUploader(this.api,t),(!r.data||r.data.length===0)&&(r.data=e)}else{if(typeof t=="string"&&(t=await Js.TransactionUploader.fromTransactionId(this.api,t)),!e||!(e instanceof Uint8Array))throw new Error("Must provide data when resuming upload");r=await Js.TransactionUploader.fromSerialized(this.api,t,e)}return r}async*upload(t,e){let r=await this.getUploader(t,e);for(;!r.isComplete;)await r.uploadChunk(),yield r;return r}};Xs.default=Ys});var Tf=ft(tc=>{"use strict";R();Object.defineProperty(tc,"__esModule",{value:!0});var Sf=Ie();$o();var Zs=class{api;crypto;constructor(t,e){this.api=t,this.crypto=e}getBalance(t){return this.api.get(`wallet/${t}/balance`).then(e=>e.data)}getLastTransactionID(t){return this.api.get(`wallet/${t}/last_tx`).then(e=>e.data)}generate(){return this.crypto.generateJWK()}async jwkToAddress(t){return!t||t==="use_wallet"?this.getAddress():this.getAddress(t)}async getAddress(t){if(!t||t==="use_wallet"){try{await arweaveWallet.connect(["ACCESS_ADDRESS"])}catch{}return arweaveWallet.getActiveAddress()}else return this.ownerToAddress(t.n)}async ownerToAddress(t){return Sf.bufferTob64Url(await this.crypto.hash(Sf.b64UrlToBuffer(t)))}};tc.default=Zs});var Cf=ft(vi=>{"use strict";R();Object.defineProperty(vi,"__esModule",{value:!0});vi.SiloResource=void 0;var xf=Ie(),ec=class{api;crypto;transactions;constructor(t,e,r){this.api=t,this.crypto=e,this.transactions=r}async get(t){if(!t)throw new Error("No Silo URI specified");let e=await this.parseUri(t),r=await this.transactions.search("Silo-Name",e.getAccessKey());if(r.length==0)throw new Error(`No data could be found for the Silo URI: ${t}`);let i=await this.transactions.get(r[0]);if(!i)throw new Error(`No data could be found for the Silo URI: ${t}`);let o=i.get("data",{decode:!0,string:!1});return this.crypto.decrypt(o,e.getEncryptionKey())}async readTransactionData(t,e){if(!e)throw new Error("No Silo URI specified");let r=await this.parseUri(e),i=t.get("data",{decode:!0,string:!1});return this.crypto.decrypt(i,r.getEncryptionKey())}async parseUri(t){let e=t.match(/^([a-z0-9-_]+)\.([0-9]+)/i);if(!e)throw new Error("Invalid Silo name, must be a name in the format of [a-z0-9]+.[0-9]+, e.g. 'bubble.7'");let r=e[1],i=Math.pow(2,parseInt(e[2])),o=await this.hash(xf.stringToBuffer(r),i),a=xf.bufferTob64(o.slice(0,15)),s=await this.hash(o.slice(16,31),1);return new Fo(t,a,s)}async hash(t,e){let r=await this.crypto.hash(t);for(let i=0;i<e-1;i++)r=await this.crypto.hash(r);return r}};vi.default=ec;var Fo=class{uri;accessKey;encryptionKey;constructor(t,e,r){this.uri=t,this.accessKey=e,this.encryptionKey=r}getUri(){return this.uri}getAccessKey(){return this.accessKey}getEncryptionKey(){return this.encryptionKey}};vi.SiloResource=Fo});var Af=ft(nc=>{"use strict";R();Object.defineProperty(nc,"__esModule",{value:!0});var If=li(),Bp=Ie(),rc=class{api;constructor(t){this.api=t}async getTransactionOffset(t){let e=await this.api.get(`tx/${t}/offset`);if(e.status===200)return e.data;throw new Error(`Unable to get transaction offset: ${(0,If.getError)(e)}`)}async getChunk(t){let e=await this.api.get(`chunk/${t}`);if(e.status===200)return e.data;throw new Error(`Unable to get chunk: ${(0,If.getError)(e)}`)}async getChunkData(t){let e=await this.getChunk(t);return Bp.b64UrlToBuffer(e.chunk)}firstChunkOffset(t){return parseInt(t.offset)-parseInt(t.size)+1}async downloadChunkedData(t){let e=await this.getTransactionOffset(t),r=parseInt(e.size),o=parseInt(e.offset)-r+1,a=new Uint8Array(r),s=0;for(;s<r;){this.api.config.logging&&console.log(`[chunk] ${s}/${r}`);let l;try{l=await this.getChunkData(o+s)}catch{console.error(`[chunk] Failed to fetch chunk at offset ${o+s}`),console.error("[chunk] This could indicate that the chunk wasn't uploaded or hasn't yet seeded properly to a particular gateway/node")}if(l)a.set(l,s),s+=l.length;else throw new Error(`Couldn't complete data download at ${s}/${r}`)}return a}};nc.default=rc});var kf=ft(ic=>{"use strict";R();Object.defineProperty(ic,"__esModule",{value:!0});var Rp=li();$o();var oc=class{api;network;constructor(t,e){this.api=t,this.network=e}async get(t){let e=await this.api.get(`${oc.ENDPOINT}${t}`);if(e.status===200)return e.data;throw e.status===404?new Rp.default("BLOCK_NOT_FOUND"):new Error(`Error while loading block data: ${e}`)}async getCurrent(){let{current:t}=await this.network.getInfo();return await this.get(t)}},Ko=oc;sr(Ko,"ENDPOINT","block/hash/");ic.default=Ko});var fi=ft(ac=>{"use strict";R();Object.defineProperty(ac,"__esModule",{value:!0});var Pp=Yl(),Np=Xl(),Up=cf(),Wp=uf(),Dp=Ef(),Mp=Tf(),Lf=Do(),bi=Ie(),$p=Cf(),Fp=Af(),Kp=kf(),vn=class{api;wallets;transactions;network;blocks;ar;silo;chunks;constructor(t){this.api=new Np.default(t),this.wallets=new Mp.default(this.api,vn.crypto),this.chunks=new Fp.default(this.api),this.transactions=new Dp.default(this.api,vn.crypto,this.chunks),this.silo=new $p.default(this.api,this.crypto,this.transactions),this.network=new Wp.default(this.api),this.blocks=new Kp.default(this.api,this.network),this.ar=new Pp.default}get crypto(){return vn.crypto}get utils(){return vn.utils}getConfig(){return{api:this.api.getConfig(),crypto:null}}async createTransaction(t,e){let r={};if(Object.assign(r,t),!t.data&&!(t.target&&t.quantity))throw new Error("A new Arweave transaction must have a 'data' value, or 'target' and 'quantity' values.");if(t.owner==null&&e&&e!=="use_wallet"&&(r.owner=e.n),t.last_tx==null&&(r.last_tx=await this.transactions.getTransactionAnchor()),typeof t.data=="string"&&(t.data=bi.stringToBuffer(t.data)),t.data instanceof ArrayBuffer&&(t.data=new Uint8Array(t.data)),t.data&&!(t.data instanceof Uint8Array))throw new Error("Expected data to be a string, Uint8Array or ArrayBuffer");if(t.reward==null){let o=t.data?t.data.byteLength:0;r.reward=await this.transactions.getPrice(o,r.target)}r.data_root="",r.data_size=t.data?t.data.byteLength.toString():"0",r.data=t.data||new Uint8Array(0);let i=new Lf.default(r);return await i.getSignatureData(),i}async createSiloTransaction(t,e,r){let i={};if(Object.assign(i,t),!t.data)throw new Error("Silo transactions must have a 'data' value");if(!r)throw new Error("No Silo URI specified.");if(t.target||t.quantity)throw new Error("Silo transactions can only be used for storing data, sending AR to other wallets isn't supported.");if(t.owner==null){if(!e||!e.n)throw new Error("A new Arweave transaction must either have an 'owner' attribute, or you must provide the jwk parameter.");i.owner=e.n}t.last_tx==null&&(i.last_tx=await this.transactions.getTransactionAnchor());let o=await this.silo.parseUri(r);if(typeof t.data=="string"){let s=await this.crypto.encrypt(bi.stringToBuffer(t.data),o.getEncryptionKey());i.reward=await this.transactions.getPrice(s.byteLength),i.data=bi.bufferTob64Url(s)}if(t.data instanceof Uint8Array){let s=await this.crypto.encrypt(t.data,o.getEncryptionKey());i.reward=await this.transactions.getPrice(s.byteLength),i.data=bi.bufferTob64Url(s)}let a=new Lf.default(i);return a.addTag("Silo-Name",o.getAccessKey()),a.addTag("Silo-Version","0.1.0"),a}arql(t){return this.api.post("/arql",t).then(e=>e.data||[])}},mn=vn;sr(mn,"init"),sr(mn,"crypto",new Up.default),sr(mn,"utils",bi);ac.default=mn});var Of=ft(Vo=>{"use strict";R();Object.defineProperty(Vo,"__esModule",{value:!0});Vo.getDefaultConfig=void 0;var Vp=(n,t)=>{let e=/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,r=t.split("."),i=r[r.length-1],o=["localhost","[::1]"];return o.includes(t)||n=="file"||o.includes(i)||!!t.match(e)||!!i.match(e)},Gp=n=>{let t=n.charAt(0)==="[",e=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/;return!!n.match(e)||t},qp=(n,t)=>{if(Vp(n,t))return{protocol:"https",host:"arweave.net",port:443};if(!Gp(t)){let e=t.split(".");if(e.length>=3){e.shift();let r=e.join(".");return{protocol:n,host:r}}}return{protocol:n,host:t}};Vo.getDefaultConfig=qp});var Go=ft(Sr=>{"use strict";R();var jp=Sr&&Sr.__createBinding||(Object.create?function(n,t,e,r){r===void 0&&(r=e);var i=Object.getOwnPropertyDescriptor(t,e);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[e]}}),Object.defineProperty(n,r,i)}:function(n,t,e,r){r===void 0&&(r=e),n[r]=t[e]}),Hp=Sr&&Sr.__exportStar||function(n,t){for(var e in n)e!=="default"&&!Object.prototype.hasOwnProperty.call(t,e)&&jp(t,n,e)};Object.defineProperty(Sr,"__esModule",{value:!0});var bn=fi(),Qp=Of();bn.default.init=function(n={}){let t={host:"arweave.net",port:443,protocol:"https"};if(typeof location!="object"||!location.protocol||!location.hostname)return new bn.default({...n,...t});let e=location.protocol.replace(":",""),r=location.hostname,i=location.port?parseInt(location.port):e=="https"?443:80,o=(0,Qp.getDefaultConfig)(e,r),a=n.protocol||o.protocol,s=n.host||o.host,l=n.port||o.port||i;return new bn.default({...n,host:s,protocol:a,port:l})};typeof globalThis=="object"?globalThis.Arweave=bn.default:typeof self=="object"&&(self.Arweave=bn.default);Hp(fi(),Sr);Sr.default=bn.default});var sh=ft((kc,ah)=>{"use strict";R();var{hasOwnProperty:ta}=Object.prototype,Xr=Ac();Xr.configure=Ac;Xr.stringify=Xr;Xr.default=Xr;kc.stringify=Xr;kc.configure=Ac;ah.exports=Xr;var oh=/[\u0000-\u001f\u0022\u005c\ud800-\udfff]|[\ud800-\udbff](?![\udc00-\udfff])|(?:[^\ud800-\udbff]|^)[\udc00-\udfff]/,Oy=new RegExp(oh,"g"),Ic=["\\u0000","\\u0001","\\u0002","\\u0003","\\u0004","\\u0005","\\u0006","\\u0007","\\b","\\t","\\n","\\u000b","\\f","\\r","\\u000e","\\u000f","\\u0010","\\u0011","\\u0012","\\u0013","\\u0014","\\u0015","\\u0016","\\u0017","\\u0018","\\u0019","\\u001a","\\u001b","\\u001c","\\u001d","\\u001e","\\u001f","","",'\\"',"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","\\\\"];function By(n){if(n.length===2){let e=n.charCodeAt(1);return`${n[0]}\\u${e.toString(16)}`}let t=n.charCodeAt(0);return Ic.length>t?Ic[t]:`\\u${t.toString(16)}`}function Tr(n){if(n.length<5e3&&!oh.test(n))return n;if(n.length>100)return n.replace(Oy,By);let t="",e=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);if(i===34||i===92||i<32)t+=`${n.slice(e,r)}${Ic[i]}`,e=r+1;else if(i>=55296&&i<=57343){if(i<=56319&&r+1<n.length){let o=n.charCodeAt(r+1);if(o>=56320&&o<=57343){r++;continue}}t+=`${n.slice(e,r)}\\u${i.toString(16)}`,e=r+1}}return t+=n.slice(e),t}function Tc(n){if(n.length>200)return n.sort();for(let t=1;t<n.length;t++){let e=n[t],r=t;for(;r!==0&&n[r-1]>e;)n[r]=n[r-1],r--;n[r]=e}return n}var Ry=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(Object.getPrototypeOf(new Int8Array)),Symbol.toStringTag).get;function xc(n){return Ry.call(n)!==void 0&&n.length!==0}function Cc(n,t,e){n.length<e&&(e=n.length);let r=t===","?"":" ",i=`"0":${r}${n[0]}`;for(let o=1;o<e;o++)i+=`${t}"${o}":${r}${n[o]}`;return i}function Py(n){if(ta.call(n,"circularValue")){let t=n.circularValue;if(typeof t=="string")return`"${t}"`;if(t==null)return t;if(t===Error||t===TypeError)return{toString(){throw new TypeError("Converting circular structure to JSON")}};throw new TypeError('The "circularValue" argument must be of type string or the value null or undefined')}return'"[Circular]"'}function nh(n,t){let e;if(ta.call(n,t)&&(e=n[t],typeof e!="boolean"))throw new TypeError(`The "${t}" argument must be of type boolean`);return e===void 0?!0:e}function ih(n,t){let e;if(ta.call(n,t)){if(e=n[t],typeof e!="number")throw new TypeError(`The "${t}" argument must be of type number`);if(!Number.isInteger(e))throw new TypeError(`The "${t}" argument must be an integer`);if(e<1)throw new RangeError(`The "${t}" argument must be >= 1`)}return e===void 0?1/0:e}function Yr(n){return n===1?"1 item":`${n} items`}function Ny(n){let t=new Set;for(let e of n)(typeof e=="string"||typeof e=="number")&&t.add(String(e));return t}function Uy(n){if(ta.call(n,"strict")){let t=n.strict;if(typeof t!="boolean")throw new TypeError('The "strict" argument must be of type boolean');if(t)return e=>{let r=`Object can not safely be stringified. Received type ${typeof e}`;throw typeof e!="function"&&(r+=` (${e.toString()})`),new Error(r)}}}function Ac(n){n={...n};let t=Uy(n);t&&(n.bigint===void 0&&(n.bigint=!1),"circularValue"in n||(n.circularValue=Error));let e=Py(n),r=nh(n,"bigint"),i=nh(n,"deterministic"),o=ih(n,"maximumDepth"),a=ih(n,"maximumBreadth");function s(B,m,E,N,D,K){let X=m[B];switch(typeof X=="object"&&X!==null&&typeof X.toJSON=="function"&&(X=X.toJSON(B)),X=N.call(m,B,X),typeof X){case"string":return`"${Tr(X)}"`;case"object":{if(X===null)return"null";if(E.indexOf(X)!==-1)return e;let j="",nt=",",U=K;if(Array.isArray(X)){if(X.length===0)return"[]";if(o<E.length+1)return'"[Array]"';E.push(X),D!==""&&(K+=D,j+=`
${K}`,nt=`,
${K}`);let V=Math.min(X.length,a),ot=0;for(;ot<V-1;ot++){let ut=s(ot,X,E,N,D,K);j+=ut!==void 0?ut:"null",j+=nt}let ct=s(ot,X,E,N,D,K);if(j+=ct!==void 0?ct:"null",X.length-1>a){let ut=X.length-a-1;j+=`${nt}"... ${Yr(ut)} not stringified"`}return D!==""&&(j+=`
${U}`),E.pop(),`[${j}]`}let M=Object.keys(X),q=M.length;if(q===0)return"{}";if(o<E.length+1)return'"[Object]"';let G="",W="";D!==""&&(K+=D,nt=`,
${K}`,G=" ");let at=Math.min(q,a);xc(X)&&(j+=Cc(X,nt,a),M=M.slice(X.length),at-=X.length,W=nt),i&&(M=Tc(M)),E.push(X);for(let V=0;V<at;V++){let ot=M[V],ct=s(ot,X,E,N,D,K);ct!==void 0&&(j+=`${W}"${Tr(ot)}":${G}${ct}`,W=nt)}if(q>a){let V=q-a;j+=`${W}"...":${G}"${Yr(V)} not stringified"`,W=nt}return D!==""&&W.length>1&&(j=`
${K}${j}
${U}`),E.pop(),`{${j}}`}case"number":return isFinite(X)?String(X):t?t(X):"null";case"boolean":return X===!0?"true":"false";case"undefined":return;case"bigint":if(r)return String(X);default:return t?t(X):void 0}}function l(B,m,E,N,D,K){switch(typeof m=="object"&&m!==null&&typeof m.toJSON=="function"&&(m=m.toJSON(B)),typeof m){case"string":return`"${Tr(m)}"`;case"object":{if(m===null)return"null";if(E.indexOf(m)!==-1)return e;let X=K,j="",nt=",";if(Array.isArray(m)){if(m.length===0)return"[]";if(o<E.length+1)return'"[Array]"';E.push(m),D!==""&&(K+=D,j+=`
${K}`,nt=`,
${K}`);let q=Math.min(m.length,a),G=0;for(;G<q-1;G++){let at=l(G,m[G],E,N,D,K);j+=at!==void 0?at:"null",j+=nt}let W=l(G,m[G],E,N,D,K);if(j+=W!==void 0?W:"null",m.length-1>a){let at=m.length-a-1;j+=`${nt}"... ${Yr(at)} not stringified"`}return D!==""&&(j+=`
${X}`),E.pop(),`[${j}]`}if(N.size===0)return"{}";E.push(m);let U="";D!==""&&(K+=D,nt=`,
${K}`,U=" ");let M="";for(let q of N){let G=l(q,m[q],E,N,D,K);G!==void 0&&(j+=`${M}"${Tr(q)}":${U}${G}`,M=nt)}return D!==""&&M.length>1&&(j=`
${K}${j}
${X}`),E.pop(),`{${j}}`}case"number":return isFinite(m)?String(m):t?t(m):"null";case"boolean":return m===!0?"true":"false";case"undefined":return;case"bigint":if(r)return String(m);default:return t?t(m):void 0}}function g(B,m,E,N,D){switch(typeof m){case"string":return`"${Tr(m)}"`;case"object":{if(m===null)return"null";if(typeof m.toJSON=="function"){if(m=m.toJSON(B),typeof m!="object")return g(B,m,E,N,D);if(m===null)return"null"}if(E.indexOf(m)!==-1)return e;let K=D;if(Array.isArray(m)){if(m.length===0)return"[]";if(o<E.length+1)return'"[Array]"';E.push(m),D+=N;let G=`
${D}`,W=`,
${D}`,at=Math.min(m.length,a),V=0;for(;V<at-1;V++){let ct=g(V,m[V],E,N,D);G+=ct!==void 0?ct:"null",G+=W}let ot=g(V,m[V],E,N,D);if(G+=ot!==void 0?ot:"null",m.length-1>a){let ct=m.length-a-1;G+=`${W}"... ${Yr(ct)} not stringified"`}return G+=`
${K}`,E.pop(),`[${G}]`}let X=Object.keys(m),j=X.length;if(j===0)return"{}";if(o<E.length+1)return'"[Object]"';D+=N;let nt=`,
${D}`,U="",M="",q=Math.min(j,a);xc(m)&&(U+=Cc(m,nt,a),X=X.slice(m.length),q-=m.length,M=nt),i&&(X=Tc(X)),E.push(m);for(let G=0;G<q;G++){let W=X[G],at=g(W,m[W],E,N,D);at!==void 0&&(U+=`${M}"${Tr(W)}": ${at}`,M=nt)}if(j>a){let G=j-a;U+=`${M}"...": "${Yr(G)} not stringified"`,M=nt}return M!==""&&(U=`
${D}${U}
${K}`),E.pop(),`{${U}}`}case"number":return isFinite(m)?String(m):t?t(m):"null";case"boolean":return m===!0?"true":"false";case"undefined":return;case"bigint":if(r)return String(m);default:return t?t(m):void 0}}function v(B,m,E){switch(typeof m){case"string":return`"${Tr(m)}"`;case"object":{if(m===null)return"null";if(typeof m.toJSON=="function"){if(m=m.toJSON(B),typeof m!="object")return v(B,m,E);if(m===null)return"null"}if(E.indexOf(m)!==-1)return e;let N="";if(Array.isArray(m)){if(m.length===0)return"[]";if(o<E.length+1)return'"[Array]"';E.push(m);let nt=Math.min(m.length,a),U=0;for(;U<nt-1;U++){let q=v(U,m[U],E);N+=q!==void 0?q:"null",N+=","}let M=v(U,m[U],E);if(N+=M!==void 0?M:"null",m.length-1>a){let q=m.length-a-1;N+=`,"... ${Yr(q)} not stringified"`}return E.pop(),`[${N}]`}let D=Object.keys(m),K=D.length;if(K===0)return"{}";if(o<E.length+1)return'"[Object]"';let X="",j=Math.min(K,a);xc(m)&&(N+=Cc(m,",",a),D=D.slice(m.length),j-=m.length,X=","),i&&(D=Tc(D)),E.push(m);for(let nt=0;nt<j;nt++){let U=D[nt],M=v(U,m[U],E);M!==void 0&&(N+=`${X}"${Tr(U)}":${M}`,X=",")}if(K>a){let nt=K-a;N+=`${X}"...":"${Yr(nt)} not stringified"`}return E.pop(),`{${N}}`}case"number":return isFinite(m)?String(m):t?t(m):"null";case"boolean":return m===!0?"true":"false";case"undefined":return;case"bigint":if(r)return String(m);default:return t?t(m):void 0}}function A(B,m,E){if(arguments.length>1){let N="";if(typeof E=="number"?N=" ".repeat(Math.min(E,10)):typeof E=="string"&&(N=E.slice(0,10)),m!=null){if(typeof m=="function")return s("",{"":B},[],m,N,"");if(Array.isArray(m))return l("",B,[],Ny(m),N,"")}if(N.length!==0)return g("",B,[],N,"")}return v("",B,[])}return A}});var kw={};Oh(kw,{AbstractContractHandler:()=>zr,ArweaveGatewayBundledContractDefinitionLoader:()=>Gi,ArweaveGatewayBundledInteractionLoader:()=>Bn,ArweaveGatewayInteractionsLoader:()=>Ii,ArweaveWrapper:()=>te,BUNDLR_NODES:()=>Wy,Benchmark:()=>Ct,CacheKey:()=>Jt,CacheableInteractionsLoader:()=>Tn,CacheableStateEvaluator:()=>ki,ConsoleLogger:()=>Pn,ConsoleLoggerFactory:()=>Nn,ContractCache:()=>si,ContractCallRecord:()=>Jr,ContractDefinitionLoader:()=>Qr,ContractError:()=>Ee,ContractMetadata:()=>ks,DEFAULT_LEVEL_DB_LOCATION:()=>ga,DefaultEvaluationOptions:()=>oi,DefaultStateEvaluator:()=>Ai,EvalStateResult:()=>$t,EvaluationOptionsEvaluator:()=>Mi,HandlerBasedContract:()=>Zr,HandlerExecutorFactory:()=>Pi,InnerWritesEvaluator:()=>Ui,InteractionCall:()=>An,InteractionInput:()=>Zo,InteractionOutput:()=>Ec,JsHandlerApi:()=>Bi,KV:()=>Yo,LevelDbCache:()=>De,LexicographicalInteractionsSorter:()=>nr,LogLevelOrder:()=>hu,LoggerFactory:()=>dt,MemCache:()=>Es,PstContractImpl:()=>Ki,SMART_WEAVE_TAGS:()=>kt,SUPPORTED_SRC_CONTENT_TYPES:()=>ci,SWBlock:()=>Cn,SWTransaction:()=>xn,SWVrf:()=>In,Signature:()=>Di,SmartWeaveError:()=>Ni,SmartWeaveErrorType:()=>Sc,SmartWeaveGlobal:()=>Li,SortKeyCacheResult:()=>Vt,SourceType:()=>zl,SrcCache:()=>ai,Tag:()=>jt,TagsParser:()=>Ht,Transaction:()=>jr,WARP_GW_URL:()=>Vc,WARP_TAGS:()=>pt,Warp:()=>tn,WarpBuilder:()=>Vi,WarpFactory:()=>Gc,WarpFetchWrapper:()=>$i,WarpGatewayContractDefinitionLoader:()=>Ci,WarpGatewayInteractionsLoader:()=>ii,WasmHandlerApi:()=>Ri,WasmSrc:()=>rr,arrayToHex:()=>pc,asc:()=>fp,ascS:()=>hp,bufToBn:()=>pp,bundledTxsFilter:()=>mc,checkJsSrc:()=>xy,createDummyTx:()=>Oc,createInteractionTagsList:()=>ra,createInteractionTx:()=>ea,deepCopy:()=>_r,defaultArweaveMs:()=>Jo,defaultCacheOptions:()=>On,defaultWarpGwOptions:()=>pa,desc:()=>gp,descS:()=>dp,emptyTransfer:()=>xr,genesisSortKey:()=>Sn,getJsonResponse:()=>$e,indent:()=>Ce,isBrowser:()=>qr,knownWarpPlugins:()=>Kc,knownWarpPluginsPartial:()=>Fc,lastPossibleSortKey:()=>Ey,lvlToOrder:()=>zi,mapReplacer:()=>up,mapReviver:()=>lp,matchMutClosureDtor:()=>Iw,normalizeContractSource:()=>Xo,rustWasmImports:()=>bc,safeParseInt:()=>ni,sleep:()=>ri,sortingFirst:()=>zf,sortingLast:()=>wc,stripTrailingSlash:()=>Me,timeout:()=>As});R();R();R();var hu={silly:0,trace:1,debug:2,info:3,warn:4,error:5,fatal:6,none:7};function zi(n){return hu[n]}var Pn=class{constructor(t,e){this.moduleName=t;this.settings=e}trace(t,...e){this.shouldLog("trace")&&console.debug(this.message("trace",t),e)}error(t,...e){this.shouldLog("error")&&console.error(this.message("error",t),e)}info(t,...e){this.shouldLog("info")&&console.info(this.message("info",t),e)}silly(t,...e){this.shouldLog("silly")&&console.debug(this.message("silly",t),e)}debug(t,...e){this.shouldLog("debug")&&console.debug(this.message("debug",t),e)}warn(t,...e){this.shouldLog("warn")&&console.warn(this.message("warn",t),e)}log(t,...e){this.shouldLog("info")&&console.info(this.message("info",t),e)}fatal(t,...e){this.shouldLog("fatal")&&console.error(this.message("fatal",t),e)}shouldLog(t){return zi(t)>=zi(this.settings.minLevel)}setSettings(t){this.settings=t}message(t,e){return`${new Date().toISOString()} ${t.toUpperCase()} [${this.moduleName}] ${e}`}};R();var Nn=class{registeredLoggers={};registeredOptions={};defOptions={minLevel:"info"};constructor(){this.setOptions=this.setOptions.bind(this),this.getOptions=this.getOptions.bind(this),this.create=this.create.bind(this),this.logLevel=this.logLevel.bind(this)}setOptions(t,e){e?this.registeredLoggers[e]?this.registeredLoggers[e].setSettings({...this.registeredLoggers[e].settings,...t}):this.registeredOptions[e]={...this.defOptions,...t}:(this.defOptions=t,Object.keys(this.registeredLoggers).forEach(r=>{this.registeredLoggers[r].setSettings({...this.registeredLoggers[r].settings,...t})}))}getOptions(t){return t?this.registeredLoggers[t]?this.registeredLoggers[t].settings:this.registeredOptions[t]?this.registeredOptions[t]:this.defOptions:this.defOptions}logLevel(t,e){this.setOptions({minLevel:t},e)}create(t="SWC"){return Object.prototype.hasOwnProperty.call(this.registeredLoggers,t)||(this.registeredLoggers[t]=new Pn(t,this.getOptions(t))),this.registeredLoggers[t]}};R();var Lr=class{constructor(){}setOptions(t,e){Lr.INST.setOptions(t,e)}getOptions(t){return Lr.INST.getOptions(t)}logLevel(t,e){Lr.INST.logLevel(t,e)}create(t){return Lr.INST.create(t)}static use(t){Lr.INST=t}},dt=Lr;sr(dt,"INST",new Nn);R();var Ct=class{static measure(){return new Ct}constructor(){}start=Date.now();end=null;reset(){this.start=Date.now(),this.end=null}stop(){this.end=Date.now()}elapsed(t=!1){this.end===null&&(this.end=Date.now());let e=this.end-this.start;return t?e:`${(this.end-this.start).toFixed(0)}ms`}};R();var Jt=class{constructor(t,e){this.key=t;this.sortKey=e}},Vt=class{constructor(t,e){this.sortKey=t;this.cachedValue=e}};R();var Nl=zt(Cl()),Ul=zt(Pl());var Oo=class{constructor(t,e=!1){this.value=t;this.tomb=e}},De=class{constructor(t){this.cacheOptions=t;this.subLevelSeparator=t.subLevelSeparator||"!",this.subLevelOptions={valueEncoding:"json",separator:this.subLevelSeparator}}ongoingTransactionMark="$$warp-internal-transaction$$";logger=dt.INST.create("LevelDbCache");subLevelSeparator;subLevelOptions;_db;_rollbackBatch;get db(){if(!this._db)if(this.cacheOptions.inMemory)this._db=new Ul.MemoryLevel(this.subLevelOptions);else{if(!this.cacheOptions.dbLocation)throw new Error("LevelDb cache configuration error - no db location specified");let t=this.cacheOptions.dbLocation;this.logger.info(`Using location ${t}`),this._db=new Nl.Level(t,this.subLevelOptions)}return this._db}async get(t,e){this.validateKey(t.key);let r=this.db.sublevel(t.key,this.subLevelOptions);await r.open();let i=await this.getValueFromLevel(t.sortKey,r);return i?new Vt(t.sortKey,i):null}async getLast(t){let e=this.db.sublevel(t,this.subLevelOptions);await e.open();let r=await e.keys({reverse:!0,limit:1}).all();if(r.length){let i=await this.getValueFromLevel(r[0],e);if(i)return new Vt(r[0],i)}return null}async getLessOrEqual(t,e){let r=this.db.sublevel(t,this.subLevelOptions);await r.open();let i=await r.keys({reverse:!0,lte:e,limit:1}).all();if(i.length){let o=await this.getValueFromLevel(i[0],r);if(o)return new Vt(i[0],o)}return null}async getValueFromLevel(t,e){try{let r=await e.get(t);if(r&&r.tomb===void 0&&r.value===void 0)return r;if(r&&r.tomb===!1&&r.value!=null)return r.value}catch(r){if(r.code!="LEVEL_NOT_FOUND")throw r}return null}async put(t,e){await this.setClientValue(t,new Oo(e))}async del(t){await this.setClientValue(t,new Oo(null,!0))}async setClientValue(t,e){this.validateKey(t.key);let r=this.db.sublevel(t.key,this.subLevelOptions);await r.open(),await r.put(t.sortKey,e),this._rollbackBatch&&this._rollbackBatch.del(t.sortKey,{sublevel:r})}async delete(t){let e=this.db.sublevel(t,this.subLevelOptions);await e.open(),await e.clear()}async batch(t){for(let e of t)e.type==="put"?await this.put(e.key,e.value):e.type==="del"&&await this.delete(e.key)}async open(){await this.db.open()}async close(){this._db&&await this._db.close()}async begin(){await this.initRollbackBatch()}async rollback(){this._rollbackBatch&&(this._rollbackBatch.del(this.ongoingTransactionMark),await this._rollbackBatch.write(),await this._rollbackBatch.close()),this._rollbackBatch=null}async initRollbackBatch(){return this._rollbackBatch==null&&(await this.checkPreviousTransactionFinished(),await this.db.put(this.ongoingTransactionMark,"ongoing"),this._rollbackBatch=this.db.batch()),this._rollbackBatch}async checkPreviousTransactionFinished(){let t;try{t=await this.db.get(this.ongoingTransactionMark)}catch(e){if(e.code!="LEVEL_NOT_FOUND")throw e}if(t=="ongoing")throw new Error("Database seems to be in inconsistent state. The previous transaction has not finished.")}async commit(){this._rollbackBatch&&(await this._rollbackBatch.clear(),await this.db.del(this.ongoingTransactionMark),await this._rollbackBatch.close()),this._rollbackBatch=null}async dump(){return await this.db.iterator().all()}async getLastSortKey(){let t="";await this.db.open();let e=await this.db.keys().all();for(let r of e){let i=r.split(this.subLevelSeparator)[1];i.localeCompare(t)>0&&(t=i)}return t==""?null:t}async keys(t,e){return Array.from((await this.kvMap(t,e)).keys())}validateKey(t){if(t.includes(this.ongoingTransactionMark))throw new Error(`Validation error: Key ${t} for internal use only`);if(t.includes(this.subLevelSeparator))throw new Error(`Validation error: key ${t} contains db separator ${this.subLevelSeparator}`)}extractOriginalKey(t){return t.split(this.subLevelSeparator)[1]}extractSortKey(t){return t.split(this.subLevelSeparator)[2]}async kvMap(t,e){let r=new Map,i=(await this.db.keys(this.levelRangeOptions(e)).all()).filter(o=>o!=this.ongoingTransactionMark).filter(o=>!t||this.extractSortKey(o).localeCompare(t)<=0).map(o=>this.extractOriginalKey(o));for(let o of i){let a=await this.getLessOrEqual(o,t);a&&r.set(o,a.cachedValue)}if(e?.limit){let o=new Map;for(let a of Array.from(r.entries()).slice(0,e.limit))o.set(a[0],a[1]);return o}return r}levelRangeOptions(t){let e={reverse:t?.reverse};return t?.gte&&(e.gte=this.subLevelSeparator+t.gte),t?.lt&&(e.lt=this.subLevelSeparator+t.lt),e}storage(){return this.db}async getNumEntries(){return(await this.db.keys().all()).length}async prune(t=5){(!t||t<=0)&&(t=1);let e=await this.allKeys();for(let r=0;r<e.length;r++){let i=this.db.sublevel(e[r],this.subLevelOptions);await i.open();let o=await i.keys({reverse:!0,limit:t}).all();!o||o.length<t||(await i.clear({lt:o[o.length-1]}),await i.close())}return null}async allKeys(){return(await this.db.keys().all()).filter(t=>t!=this.ongoingTransactionMark).map(t=>this.extractOriginalKey(t))}};R();var Es=class{storage={};clearAll(){Object.keys(this.storage).forEach(t=>{delete this.storage[t]})}contains(t){return Object.prototype.hasOwnProperty.call(this.storage,t)}get(t){return this.storage[t]}put(t,e){this.storage[t]=e}remove(t){delete this.storage[t]}};R();R();var P0=zt(br());R();R();var Ld=Function.prototype.toString,Ss=Object.create,Od=Object.prototype.toString,Bd=function(){function n(){this._keys=[],this._values=[]}return n.prototype.has=function(t){return!!~this._keys.indexOf(t)},n.prototype.get=function(t){return this._values[this._keys.indexOf(t)]},n.prototype.set=function(t,e){this._keys.push(t),this._values.push(e)},n}();function Rd(){return new Bd}function Pd(){return new WeakMap}var Nd=typeof WeakMap<"u"?Pd:Rd;function xs(n){if(!n)return Ss(null);var t=n.constructor;if(t===Object)return n===Object.prototype?{}:Ss(n);if(~Ld.call(t).indexOf("[native code]"))try{return new t}catch{}return Ss(n)}function Ud(n){var t="";return n.global&&(t+="g"),n.ignoreCase&&(t+="i"),n.multiline&&(t+="m"),n.unicode&&(t+="u"),n.sticky&&(t+="y"),t}function Wd(n){return n.flags}var Dd=/test/g.flags==="g"?Wd:Ud;function Dl(n){var t=Od.call(n);return t.substring(8,t.length-1)}function Md(n){return n[Symbol.toStringTag]||Dl(n)}var $d=typeof Symbol<"u"?Md:Dl,Fd=Object.defineProperty,Kd=Object.getOwnPropertyDescriptor,Ml=Object.getOwnPropertyNames,Cs=Object.getOwnPropertySymbols,$l=Object.prototype,Fl=$l.hasOwnProperty,Vd=$l.propertyIsEnumerable,Kl=typeof Cs=="function";function Gd(n){return Ml(n).concat(Cs(n))}var qd=Kl?Gd:Ml;function Ro(n,t,e){for(var r=qd(n),i=0,o=r.length,a=void 0,s=void 0;i<o;++i)if(a=r[i],!(a==="callee"||a==="caller")){if(s=Kd(n,a),!s){t[a]=e.copier(n[a],e);continue}!s.get&&!s.set&&(s.value=e.copier(s.value,e));try{Fd(t,a,s)}catch{t[a]=s.value}}return t}function jd(n,t){var e=new t.Constructor;t.cache.set(n,e);for(var r=0,i=n.length;r<i;++r)e[r]=t.copier(n[r],t);return e}function Hd(n,t){var e=new t.Constructor;return t.cache.set(n,e),Ro(n,e,t)}function Vl(n,t){return n.slice(0)}function Qd(n,t){return n.slice(0,n.size,n.type)}function zd(n,t){return new t.Constructor(Vl(n.buffer))}function Jd(n,t){return new t.Constructor(n.getTime())}function Gl(n,t){var e=new t.Constructor;return t.cache.set(n,e),n.forEach(function(r,i){e.set(i,t.copier(r,t))}),e}function Yd(n,t){return Ro(n,Gl(n,t),t)}function Xd(n,t){var e=xs(t.prototype);t.cache.set(n,e);for(var r in n)Fl.call(n,r)&&(e[r]=t.copier(n[r],t));return e}function Zd(n,t){var e=xs(t.prototype);t.cache.set(n,e);for(var r in n)Fl.call(n,r)&&(e[r]=t.copier(n[r],t));for(var i=Cs(n),o=0,a=i.length,s=void 0;o<a;++o)s=i[o],Vd.call(n,s)&&(e[s]=t.copier(n[s],t));return e}var tp=Kl?Zd:Xd;function ep(n,t){var e=xs(t.prototype);return t.cache.set(n,e),Ro(n,e,t)}function Ts(n,t){return new t.Constructor(n.valueOf())}function rp(n,t){var e=new t.Constructor(n.source,Dd(n));return e.lastIndex=n.lastIndex,e}function Bo(n,t){return n}function ql(n,t){var e=new t.Constructor;return t.cache.set(n,e),n.forEach(function(r){e.add(t.copier(r,t))}),e}function np(n,t){return Ro(n,ql(n,t),t)}var ip=Array.isArray,Is=Object.assign,op=Object.getPrototypeOf||function(n){return n.__proto__},jl={array:jd,arrayBuffer:Vl,blob:Qd,dataView:zd,date:Jd,error:Bo,map:Gl,object:tp,regExp:rp,set:ql},ap=Is({},jl,{array:Hd,map:Yd,object:ep,set:np});function sp(n){return{Arguments:n.object,Array:n.array,ArrayBuffer:n.arrayBuffer,Blob:n.blob,Boolean:Ts,DataView:n.dataView,Date:n.date,Error:n.error,Float32Array:n.arrayBuffer,Float64Array:n.arrayBuffer,Int8Array:n.arrayBuffer,Int16Array:n.arrayBuffer,Int32Array:n.arrayBuffer,Map:n.map,Number:Ts,Object:n.object,Promise:Bo,RegExp:n.regExp,Set:n.set,String:Ts,WeakMap:Bo,WeakSet:Bo,Uint8Array:n.arrayBuffer,Uint8ClampedArray:n.arrayBuffer,Uint16Array:n.arrayBuffer,Uint32Array:n.arrayBuffer,Uint64Array:n.arrayBuffer}}function Hl(n){var t=Is({},jl,n),e=sp(t),r=e.Array,i=e.Object;function o(a,s){if(s.prototype=s.Constructor=void 0,!a||typeof a!="object")return a;if(s.cache.has(a))return s.cache.get(a);if(s.prototype=op(a),s.Constructor=s.prototype&&s.prototype.constructor,!s.Constructor||s.Constructor===Object)return i(a,s);if(ip(a))return r(a,s);var l=e[$d(a)];return l?l(a,s):typeof a.then=="function"?a:i(a,s)}return function(s){return o(s,{Constructor:void 0,cache:Nd(),copier:o,prototype:void 0})}}function cp(n){return Hl(Is({},ap,n))}var C0=cp({}),Ql=Hl({});var ri=n=>new Promise(t=>setTimeout(t,n)),ni=n=>{let t=Number.parseInt(n);if(Number.isNaN(t)&&!Number.isSafeInteger(t))throw Error(`Failed to cast ${n} to integer`);return t},_r=n=>Ql(n),up=(n,t)=>t instanceof Map?{dataType:"Map",value:Array.from(t.entries())}:t,lp=(n,t)=>typeof t=="object"&&t!==null&&t.dataType==="Map"?new Map(t.value):t,fp=(n,t)=>n-t,hp=(n,t)=>+n-+t,gp=(n,t)=>t-n,dp=(n,t)=>+t-+n;function As(n){let t=null,e=new Promise((r,i)=>{t=setTimeout(()=>{clearTimeout(t),i("timeout")},n*1e3)});return{timeoutId:t,timeoutPromise:e}}function Me(n){return n.endsWith("/")?n.slice(0,-1):n}function Ce(n){return`[d:${n}]`.padEnd(n*2,"-").concat("> ")}function pp(n){let t=[];return Uint8Array.from(n).forEach(function(r){let i=r.toString(16);i.length%2&&(i="0"+i),t.push(i)}),BigInt("0x"+t.join(""))}var qr=new Function("try {return this===window;}catch(e){ return false;}");async function $e(n){let t;try{t=await n}catch(r){throw new Error(`Error while communicating with gateway: ${JSON.stringify(r)}`)}if(!t?.ok){let r=await t.text();throw new Error(`${t.status}: ${r}`)}return await t.json()}var zl=(r=>(r.ARWEAVE="arweave",r.WARP_SEQUENCER="redstone-sequencer",r.BOTH="both",r))(zl||{}),ii=class{constructor(t=null,e="both"){this.confirmationStatus=t;this.source=e;Object.assign(this,t),this.source=e}_warp;logger=dt.INST.create("WarpGatewayInteractionsLoader");async load(t,e,r,i){this.logger.debug("Loading interactions: for ",{contractId:t,fromSortKey:e,toSortKey:r});let o=[],a=0,s=0,l=0,g=i?i.sourceType:this.source,v=Ct.measure(),A=Me(this._warp.gwUrl());do{let B=Ct.measure(),m=`${A}/gateway/v2/interactions-sort-key`,E=await $e(fetch(`${m}?${new URLSearchParams({contractId:t,...this._warp.whoAmI?{client:this._warp.whoAmI}:"",...e?{from:e}:"",...r?{to:r}:"",page:(++a).toString(),fromSdk:"true",...this.confirmationStatus&&this.confirmationStatus.confirmed?{confirmationStatus:"confirmed"}:"",...this.confirmationStatus&&this.confirmationStatus.notCorrupted?{confirmationStatus:"not_corrupted"}:"",...g=="both"?"":{source:g}})}`));this.logger.debug(`Loading interactions: page ${a} loaded in ${B.elapsed()}`),o.push(...E.interactions),s=E.paging.limit,l=E.paging.items,this.logger.debug(`Loaded interactions length: ${o.length}, from: ${e}, to: ${r}`)}while(l==s);return this.logger.debug("All loaded interactions:",{from:e,to:r,loaded:o.length,time:v.elapsed()}),o}type(){return"warp"}clearCache(){}set warp(t){this._warp=t}};var $t=class{constructor(t,e,r){this.state=t;this.validity=e;this.errorMessages=r}},oi=class{ignoreExceptions=!0;waitForConfirmation=!1;updateCacheForEachInteraction=!1;internalWrites=!1;maxCallDepth=7;maxInteractionEvaluationTimeSeconds=60;stackTrace={saveState:!1};sequencerUrl="https://d1o5nlqr4okus2.cloudfront.net/";gasLimit=Number.MAX_SAFE_INTEGER;sourceType="both";unsafeClient="throw";allowBigInt=!1;walletBalanceUrl="http://nyc-1.dev.arweave.net:1984/";mineArLocalBlocks=!0;throwOnInternalWriteError=!0;cacheEveryNInteractions=-1;useKVStorage=!1;remoteStateSyncEnabled=!1;remoteStateSyncSource="https://dre-1.warp.cc/contract";useConstructor=!1};R();R();var ci=["application/javascript","application/wasm"],ks=class{dtor},ai=class{src;srcBinary;srcWasmLang;constructor(t){this.src=t.src,this.srcBinary=t.srcBinary,this.srcWasmLang=t.srcWasmLang}},si=class{txId;srcTxId;initState;minFee;owner;contractType;metadata;manifest;contractTx;srcTx;testnet;constructor(t){this.txId=t.txId,this.srcTxId=t.srcTxId,this.initState=t.initState,this.manifest=t.manifest,this.minFee=t.minFee,this.owner=t.owner,this.contractType=t.contractType,this.metadata=t.metadata,this.contractTx=t.contractTx,this.srcTx=t.srcTx,this.testnet=t.testnet}};R();var kt={APP_NAME:"App-Name",APP_VERSION:"App-Version",CONTRACT_TX_ID:"Contract",INPUT:"Input",CONTENT_TYPE:"Content-Type",CONTRACT_SRC_TX_ID:"Contract-Src",SDK:"SDK",MIN_FEE:"Min-Fee"},pt={SEQUENCER:"Sequencer",SEQUENCER_OWNER:"Sequencer-Owner",SEQUENCER_MILLIS:"Sequencer-Mills",SEQUENCER_SORT_KEY:"Sequencer-Sort-Key",SEQUENCER_PREV_SORT_KEY:"Sequencer-Prev-Sort-Key",SEQUENCER_LAST_SORT_KEY:"Sequencer-Last-Sort-Key",SEQUENCER_TX_ID:"Sequencer-Tx-Id",SEQUENCER_BLOCK_HEIGHT:"Sequencer-Block-Height",SEQUENCER_BLOCK_ID:"Sequencer-Block-Id",SEQUENCER_BLOCK_TIMESTAMP:"Sequencer-Block-Timestamp",INIT_STATE:"Init-State",INIT_STATE_TX:"Init-State-TX",INTERACT_WRITE:"Interact-Write",WASM_LANG:"Wasm-Lang",WASM_LANG_VERSION:"Wasm-Lang-Version",WASM_META:"Wasm-Meta",REQUEST_VRF:"Request-Vrf",SIGNATURE_TYPE:"Signature-Type",WARP_TESTNET:"Warp-Testnet",MANIFEST:"Contract-Manifest",NONCE:"Nonce"};R();var Bf=zt(Go()),sc=zt(br());R();var Zt=zt(Ie()),qo=class{get(t,e){if(!Object.getOwnPropertyNames(this).includes(t))throw new Error(`Field "${t}" is not a property of the Arweave Transaction class.`);return this[t]instanceof Uint8Array?e&&e.decode&&e.string?Zt.bufferToString(this[t]):e&&e.decode&&!e.string?this[t]:Zt.bufferTob64Url(this[t]):e&&e.decode==!0?e&&e.string?Zt.b64UrlToString(this[t]):Zt.b64UrlToBuffer(this[t]):this[t]}},jr=class extends qo{format=2;id="";last_tx="";owner="";tags=[];target="";quantity="0";data_size="0";data=new Uint8Array;data_root="";reward="0";signature="";chunks;constructor(t={}){super(),Object.assign(this,t),typeof this.data=="string"&&(this.data=Zt.b64UrlToBuffer(this.data)),t.tags&&(this.tags=t.tags.map(e=>new jt(e.name,e.value)))}addTag(t,e){this.tags.push(new jt(Zt.stringToB64Url(t),Zt.stringToB64Url(e)))}toJSON(){return{format:this.format,id:this.id,last_tx:this.last_tx,owner:this.owner,tags:this.tags,target:this.target,quantity:this.quantity,data:Zt.bufferTob64Url(this.data),data_size:this.data_size,data_root:this.data_root,data_tree:this.data_tree,reward:this.reward,signature:this.signature}}setOwner(t){this.owner=t}setSignature({id:t,owner:e,reward:r,tags:i,signature:o}){this.id=t,this.owner=e,r&&(this.reward=r),i&&(this.tags=i),this.signature=o}async prepareChunks(t){throw new Error("Should not be called, use arweave-js version.")}getChunk(t,e){if(!this.chunks)throw new Error("Chunks have not been prepared");let r=this.chunks.proofs[t],i=this.chunks.chunks[t];return{data_root:this.data_root,data_size:this.data_size,data_path:Zt.bufferTob64Url(r.proof),offset:r.offset.toString(),chunk:Zt.bufferTob64Url(e.slice(i.minByteRange,i.maxByteRange))}}async getSignatureData(){throw new Error("Should not be called, use arweave-js version.")}},jt=class extends qo{name;value;constructor(t,e,r=!1){super(),this.name=t,this.value=e}};var te=class{constructor(t){this.warp=t;let{arweave:e}=t;this.baseUrl=`${e.api.config.protocol}://${e.api.config.host}:${e.api.config.port}`,this.logger.debug("baseurl",this.baseUrl)}logger=dt.INST.create("ArweaveWrapper");baseUrl;async warpGwInfo(){return await this.doFetchInfo(`${Me(this.warp.gwUrl())}/gateway/arweave/info`)}async warpGwBlock(){return this.logger.debug("Calling warp gw block info"),await this.doFetchInfo(`${Me(this.warp.gwUrl())}/gateway/arweave/block`)}async info(){return await this.doFetchInfo(`${this.baseUrl}/info`)}async gql(t,e){try{let r=JSON.stringify({query:t,variables:e});return{data:await $e(fetch(`${this.baseUrl}/graphql`,{method:"POST",body:r,headers:{"Accept-Encoding":"gzip, deflate, br","Content-Type":"application/json",Accept:"application/json"}})),status:200}}catch(r){throw this.logger.error("Error while loading gql",r),r}}async tx(t){let e=await fetch(`${this.baseUrl}/tx/${t}`).then(r=>r.ok?r.json():Promise.reject(r)).catch(r=>{throw r.body?.message&&this.logger.error(r.body.message),new Error(`Unable to retrieve tx ${t}. ${r.status}. ${r.body?.message}`)});return new jr({...e})}async txData(t){let e=await fetch(`${this.baseUrl}/${t}`);if(e.ok){let r=await e.arrayBuffer();return sc.Buffer.from(r)}else{this.logger.warn(`Unable to load data from arweave.net/${t} endpoint, falling back to arweave.js`);let r=await this.warp.arweave.transactions.getData(t,{decode:!0});return sc.Buffer.from(r)}}async txDataString(t){let e=await this.txData(t);return Bf.default.utils.bufferToString(e)}async doFetchInfo(t){return await $e(fetch(t))}};R();var Ht=class{logger=dt.INST.create("TagsParser");getInputTag(t,e){if(Ht.hasMultipleInteractions(t)){this.logger.debug("Interaction transaction is using multiple input tx tag format.");let r=t.tags.findIndex(o=>o.name===kt.CONTRACT_TX_ID&&o.value===e);if(t.tags.length-1===r){this.logger.warn("Wrong tags format: 'Contract' is the last tag");return}let i=t.tags[r+1];if(i.name!==kt.INPUT){this.logger.warn(`No 'Input' tag found after 'Contract' tag. Instead ${i.name} was found`);return}return i}else return t.tags.find(r=>r.name===kt.INPUT)}isInteractWrite(t,e){return t.tags.some(r=>r.name===pt.INTERACT_WRITE&&r.value===e)}getInteractWritesContracts(t){return t.tags.filter(e=>e.name===pt.INTERACT_WRITE).map(e=>e.value)}getContractTag(t){return t.tags.find(e=>e.name===kt.CONTRACT_TX_ID)?.value}getContractsWithInputs(t){let e=new Map;return t.tags.filter(i=>i.name===kt.CONTRACT_TX_ID).forEach(i=>{e.set(i.value,this.getInputTag(t,i.value))}),e}isEvmSigned(t){return t.tags.some(e=>e.name===pt.SIGNATURE_TYPE&&e.value==="ethereum")}static hasMultipleInteractions(t){return t.tags.filter(e=>e.name===kt.CONTRACT_TX_ID).length>1}decodeTags(t){let e=t.get("tags"),r=[];for(let i of e)try{let o=i.get("name",{decode:!0,string:!0}),a=i.get("value",{decode:!0,string:!0});r.push({name:o,value:a})}catch{}return r}getTag(t,e){let r=t.get("tags");for(let i of r)try{if(i.get("name",{decode:!0,string:!0})===e)return i.get("value",{decode:!0,string:!0})}catch{}return!1}hasVrfTag(t){return t.tags.some(e=>e.name==pt.REQUEST_VRF&&e.value==="true")}};R();R();function Df(n){return n.arrayBuffer?n.arrayBuffer():new Promise((t,e)=>{let r=new FileReader;r.addEventListener("loadend",()=>{t(r.result)}),r.addEventListener("error",e),r.readAsArrayBuffer(n)})}async function zp(n){let t=await Df(n);return new Uint8Array(t)}function Mf(n){return typeof Blob<"u"&&n instanceof Blob}function Ti(n){return typeof SharedArrayBuffer<"u"&&n instanceof SharedArrayBuffer}var Jp=typeof z.default<"u"&&z.default.versions&&typeof z.default.versions.node<"u"&&typeof z.default.versions.electron>"u";function Yp(n){return n.byteOffset===0&&n.byteLength===n.buffer.byteLength}var Ho=class{constructor(t){this.typedArray=t instanceof ArrayBuffer||Ti(t)?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}async getLength(){return this.typedArray.byteLength}async read(t,e){return new Uint8Array(this.typedArray.buffer,this.typedArray.byteOffset+t,e)}},Qo=class{constructor(t){this.blob=t}async getLength(){return this.blob.size}async read(t,e){let r=this.blob.slice(t,t+e),i=await Df(r);return new Uint8Array(i)}async sliceAsBlob(t,e,r=""){return this.blob.slice(t,t+e,r)}};function Xp(n,t){var e=Uint8Array;if(n[0]==3&&n[1]==0)return t||new e(0);var r=ty,i=$f,o=Zp,a=Ff,s=t==null;s&&(t=new e(n.length>>>2<<3));for(var l=0,g=0,v=0,A=0,B=0,m=0,E=0,N=0,D=0,K,X;l==0;){if(l=r(n,D,1),g=r(n,D+1,2),D+=3,g==0){D&7&&(D+=8-(D&7));var j=(D>>>3)+4,nt=n[j-4]|n[j-3]<<8;s&&(t=cc(t,N+nt)),t.set(new e(n.buffer,n.byteOffset+j,nt),N),D=j+nt<<3,N+=nt;continue}if(s&&(t=cc(t,N+(1<<17))),g==1&&(K=ht.flmap,X=ht.fdmap,m=(1<<9)-1,E=(1<<5)-1),g==2){v=i(n,D,5)+257,A=i(n,D+5,5)+1,B=i(n,D+10,4)+4,D+=14;for(var U=0;U<38;U+=2)ht.itree[U]=0,ht.itree[U+1]=0;for(var M=1,U=0;U<B;U++){var q=i(n,D+U*3,3);ht.itree[(ht.ordr[U]<<1)+1]=q,q>M&&(M=q)}D+=3*B,_i(ht.itree,M),Ei(ht.itree,M,ht.imap),K=ht.lmap,X=ht.dmap,D=o(ht.imap,(1<<M)-1,v+A,n,D,ht.ttree);var G=Rf(ht.ttree,0,v,ht.ltree);m=(1<<G)-1;var W=Rf(ht.ttree,v,A,ht.dtree);E=(1<<W)-1,_i(ht.ltree,G),Ei(ht.ltree,G,K),_i(ht.dtree,W),Ei(ht.dtree,W,X)}for(;;){var at=K[a(n,D)&m];D+=at&15;var V=at>>>4;if(!(V>>>8))t[N++]=V;else{if(V==256)break;var ot=N+V-254;if(V>264){var ct=ht.ldef[V-257];ot=N+(ct>>>3)+i(n,D,ct&7),D+=ct&7}var ut=X[a(n,D)&E];D+=ut&15;var vt=ut>>>4,yt=ht.ddef[vt],it=(yt>>>4)+r(n,D,yt&15);for(D+=yt&15,s&&(t=cc(t,N+(1<<17)));N<ot;)t[N]=t[N++-it],t[N]=t[N++-it],t[N]=t[N++-it],t[N]=t[N++-it];N=ot}}}return t.length==N?t:t.slice(0,N)}function cc(n,t){var e=n.length;if(t<=e)return n;var r=new Uint8Array(Math.max(e<<1,t));return r.set(n,0),r}function Zp(n,t,e,r,i,o){for(var a=$f,s=Ff,l=0;l<e;){var g=n[s(r,i)&t];i+=g&15;var v=g>>>4;if(v<=15)o[l]=v,l++;else{var A=0,B=0;v==16?(B=3+a(r,i,2),i+=2,A=o[l-1]):v==17?(B=3+a(r,i,3),i+=3):v==18&&(B=11+a(r,i,7),i+=7);for(var m=l+B;l<m;)o[l]=A,l++}}return i}function Rf(n,t,e,r){for(var i=0,o=0,a=r.length>>>1;o<e;){var s=n[o+t];r[o<<1]=0,r[(o<<1)+1]=s,s>i&&(i=s),o++}for(;o<a;)r[o<<1]=0,r[(o<<1)+1]=0,o++;return i}function _i(n,t){for(var e=n.length,r,i,o,a,s,l=ht.bl_count,a=0;a<=t;a++)l[a]=0;for(a=1;a<e;a+=2)l[n[a]]++;var g=ht.next_code;for(r=0,l[0]=0,i=1;i<=t;i++)r=r+l[i-1]<<1,g[i]=r;for(o=0;o<e;o+=2)s=n[o+1],s!=0&&(n[o]=g[s],g[s]++)}function Ei(n,t,e){for(var r=n.length,i=ht.rev15,o=0;o<r;o+=2)if(n[o+1]!=0)for(var a=o>>1,s=n[o+1],l=a<<4|s,g=t-s,v=n[o]<<g,A=v+(1<<g);v!=A;){var B=i[v]>>>15-t;e[B]=l,v++}}function Pf(n,t){for(var e=ht.rev15,r=15-t,i=0;i<n.length;i+=2){var o=n[i]<<t-n[i+1];n[i]=e[o]>>>r}}function $f(n,t,e){return(n[t>>>3]|n[(t>>>3)+1]<<8)>>>(t&7)&(1<<e)-1}function ty(n,t,e){return(n[t>>>3]|n[(t>>>3)+1]<<8|n[(t>>>3)+2]<<16)>>>(t&7)&(1<<e)-1}function Ff(n,t){return(n[t>>>3]|n[(t>>>3)+1]<<8|n[(t>>>3)+2]<<16)>>>(t&7)}var ht=function(){var n=Uint16Array,t=Uint32Array;return{next_code:new n(16),bl_count:new n(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new n(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new n(512),fltree:[],fdmap:new n(32),fdtree:[],lmap:new n(32768),ltree:[],ttree:[],dmap:new n(32768),dtree:[],imap:new n(512),itree:[],rev15:new n(1<<15),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new n(1<<16),prev:new n(1<<15)}}();(function(){for(var n=32768,t=0;t<n;t++){var e=t;e=(e&2863311530)>>>1|(e&1431655765)<<1,e=(e&3435973836)>>>2|(e&858993459)<<2,e=(e&4042322160)>>>4|(e&252645135)<<4,e=(e&4278255360)>>>8|(e&16711935)<<8,ht.rev15[t]=(e>>>16|e<<16)>>>17}function r(i,o,a){for(;o--!=0;)i.push(0,a)}for(var t=0;t<32;t++)ht.ldef[t]=ht.of0[t]<<3|ht.exb[t],ht.ddef[t]=ht.df0[t]<<4|ht.dxb[t];r(ht.fltree,144,8),r(ht.fltree,255-143,9),r(ht.fltree,279-255,7),r(ht.fltree,287-279,8),_i(ht.fltree,9),Ei(ht.fltree,9,ht.flmap),Pf(ht.fltree,9),r(ht.fdtree,32,5),_i(ht.fdtree,5),Ei(ht.fdtree,5,ht.fdmap),Pf(ht.fdtree,5),r(ht.itree,19,0),r(ht.ltree,286,0),r(ht.dtree,30,0),r(ht.ttree,320,0)})();var Nf={table:function(){for(var n=new Uint32Array(256),t=0;t<256;t++){for(var e=t,r=0;r<8;r++)e&1?e=3988292384^e>>>1:e=e>>>1;n[t]=e}return n}(),update:function(n,t,e,r){for(var i=0;i<r;i++)n=Nf.table[(n^t[e+i])&255]^n>>>8;return n},crc:function(n,t,e){return Nf.update(4294967295,n,t,e)^4294967295}};function ey(n,t){return Xp(n,t)}var xi={numWorkers:1,workerURL:"",useWorkers:!1},ry=0,Uf=0,fc=!0,ny=[],jo=[],_n=[],hc=new Map;function iy(n){Kf(n.target);let{id:t,error:e,data:r}=n.data,i=hc.get(t);hc.delete(t),e?i.reject(e):i.resolve(r)}function uc(n){return new Promise((t,e)=>{let r=new Worker(n);r.onmessage=i=>{i.data==="start"?(r.onerror=void 0,r.onmessage=void 0,t(r)):e(new Error(`unexpected message: ${i.data}`))},r.onerror=e})}function oy(n,t){return n.require(t)}var Wf=function(){if(Jp){let{Worker:n}=oy(module,"worker_threads");return{async createWorker(t){return new n(t)},addEventListener(t,e){t.on("message",r=>{e({target:t,data:r})})},async terminate(t){await t.terminate()}}}else return{async createWorker(n){try{return await uc(n)}catch{console.warn("could not load worker:",n)}let t;try{let e=await fetch(n,{mode:"cors"});if(!e.ok)throw new Error(`could not load: ${n}`);t=await e.text(),n=URL.createObjectURL(new Blob([t],{type:"application/javascript"}));let r=await uc(n);return xi.workerURL=n,r}catch{console.warn("could not load worker via fetch:",n)}if(t!==void 0)try{n=`data:application/javascript;base64,${btoa(t)}`;let e=await uc(n);return xi.workerURL=n,e}catch{console.warn("could not load worker via dataURI")}throw console.warn("workers will not be used"),new Error("can not start workers")},addEventListener(n,t){n.addEventListener("message",t)},async terminate(n){n.terminate()}}}();function Kf(n){jo.push(n),Vf()}async function ay(){if(jo.length===0&&Uf<xi.numWorkers){++Uf;try{let n=await Wf.createWorker(xi.workerURL);ny.push(n),jo.push(n),Wf.addEventListener(n,iy)}catch{fc=!1}}return jo.pop()}function sy(n,t,e,r){let i=new Uint8Array(t);ey(n,i),r(e?new Blob([i],{type:e}):i.buffer)}async function Vf(){if(_n.length!==0){if(xi.useWorkers&&fc){let n=await ay();if(fc){if(n){if(_n.length===0){Kf(n);return}let{id:t,src:e,uncompressedSize:r,type:i,resolve:o,reject:a}=_n.shift();hc.set(t,{id:t,resolve:o,reject:a});let s=[];n.postMessage({type:"inflate",data:{id:t,type:i,src:e,uncompressedSize:r}},s)}return}}for(;_n.length;){let{src:n,uncompressedSize:t,type:e,resolve:r}=_n.shift(),i=n;Mf(n)&&(i=await zp(n)),sy(i,t,e,r)}}}function Gf(n,t,e){return new Promise((r,i)=>{_n.push({src:n,uncompressedSize:t,type:e,resolve:r,reject:i,id:ry++}),Vf()})}function cy(n,t){let e=n&31,r=(n>>5&15)-1,i=(n>>9&127)+1980,o=0,a=(t&31)*2,s=t>>5&63,l=t>>11&31;return new Date(i,r,e,l,s,a,o)}var gc=class{constructor(t,e){this._reader=t,this._rawEntry=e,this.name=e.name,this.nameBytes=e.nameBytes,this.size=e.uncompressedSize,this.compressedSize=e.compressedSize,this.comment=e.comment,this.commentBytes=e.commentBytes,this.compressionMethod=e.compressionMethod,this.lastModDate=cy(e.lastModFileDate,e.lastModFileTime),this.isDirectory=e.uncompressedSize===0&&e.name.endsWith("/"),this.encrypted=!!(e.generalPurposeBitFlag&1),this.externalFileAttributes=e.externalFileAttributes,this.versionMadeBy=e.versionMadeBy}async blob(t="application/octet-stream"){return await vy(this._reader,this._rawEntry,t)}async arrayBuffer(){return await my(this._reader,this._rawEntry)}async text(){let t=await this.arrayBuffer();return Si(new Uint8Array(t))}async json(){let t=await this.text();return JSON.parse(t)}},lc=22,uy=65535,ly=101010256,fy=101075792;async function En(n,t,e){return await n.read(t,e)}async function dc(n,t,e,r){return n.sliceAsBlob?await n.sliceAsBlob(t,e,r):await n.read(t,e)}var hy={unsigned(){return 0}};function Qt(n,t){return n[t]+n[t+1]*256}function ee(n,t){return n[t]+n[t+1]*256+n[t+2]*65536+n[t+3]*16777216}function Hr(n,t){return ee(n,t)+ee(n,t+4)*4294967296}var gy=new TextDecoder;function Si(n,t){return Ti(n.buffer)&&(n=new Uint8Array(n)),gy.decode(n)}async function dy(n,t){let e=Math.min(lc+uy,t),r=t-e,i=await En(n,r,e);for(let o=e-lc;o>=0;--o){if(ee(i,o)!==ly)continue;let a=new Uint8Array(i.buffer,i.byteOffset+o,i.byteLength-o),s=Qt(a,4);if(s!==0)throw new Error(`multi-volume zip files are not supported. This is volume: ${s}`);let l=Qt(a,10),g=ee(a,12),v=ee(a,16),A=Qt(a,20),B=a.length-lc;if(A!==B)throw new Error(`invalid comment length. expected: ${B}, actual: ${A}`);let m=new Uint8Array(a.buffer,a.byteOffset+22,A),E=Si(m);return l===65535||v===4294967295?await yy(n,r+o,E,m):await qf(n,v,g,l,E,m)}throw new Error("could not find end of central directory. maybe not zip file")}var py=117853008;async function yy(n,t,e,r){let i=t-20,o=await En(n,i,20);if(ee(o,0)!==py)throw new Error("invalid zip64 end of central directory locator signature");let a=Hr(o,8),s=await En(n,a,56);if(ee(s,0)!==fy)throw new Error("invalid zip64 end of central directory record signature");let l=Hr(s,32),g=Hr(s,40),v=Hr(s,48);return qf(n,v,g,l,e,r)}var wy=33639248;async function qf(n,t,e,r,i,o){let a=0,s=await En(n,t,e),l=[];for(let v=0;v<r;++v){let A=s.subarray(a,a+46),B=ee(A,0);if(B!==wy)throw new Error(`invalid central directory file header signature: 0x${B.toString(16)}`);let m={versionMadeBy:Qt(A,4),versionNeededToExtract:Qt(A,6),generalPurposeBitFlag:Qt(A,8),compressionMethod:Qt(A,10),lastModFileTime:Qt(A,12),lastModFileDate:Qt(A,14),crc32:ee(A,16),compressedSize:ee(A,20),uncompressedSize:ee(A,24),fileNameLength:Qt(A,28),extraFieldLength:Qt(A,30),fileCommentLength:Qt(A,32),internalFileAttributes:Qt(A,36),externalFileAttributes:ee(A,38),relativeOffsetOfLocalHeader:ee(A,42)};if(m.generalPurposeBitFlag&64)throw new Error("strong encryption is not supported");a+=46;let E=s.subarray(a,a+m.fileNameLength+m.extraFieldLength+m.fileCommentLength);m.nameBytes=E.slice(0,m.fileNameLength),m.name=Si(m.nameBytes);let N=m.fileNameLength+m.extraFieldLength,D=E.slice(m.fileNameLength,N);m.extraFields=[];let K=0;for(;K<D.length-3;){let j=Qt(D,K+0),nt=Qt(D,K+2),U=K+4,M=U+nt;if(M>D.length)throw new Error("extra field length exceeds extra field buffer size");m.extraFields.push({id:j,data:D.slice(U,M)}),K=M}if(m.commentBytes=E.slice(N,N+m.fileCommentLength),m.comment=Si(m.commentBytes),a+=E.length,m.uncompressedSize===4294967295||m.compressedSize===4294967295||m.relativeOffsetOfLocalHeader===4294967295){let j=m.extraFields.find(M=>M.id===1);if(!j)throw new Error("expected zip64 extended information extra field");let nt=j.data,U=0;if(m.uncompressedSize===4294967295){if(U+8>nt.length)throw new Error("zip64 extended information extra field does not include uncompressed size");m.uncompressedSize=Hr(nt,U),U+=8}if(m.compressedSize===4294967295){if(U+8>nt.length)throw new Error("zip64 extended information extra field does not include compressed size");m.compressedSize=Hr(nt,U),U+=8}if(m.relativeOffsetOfLocalHeader===4294967295){if(U+8>nt.length)throw new Error("zip64 extended information extra field does not include relative header offset");m.relativeOffsetOfLocalHeader=Hr(nt,U),U+=8}}let X=m.extraFields.find(j=>j.id===28789&&j.data.length>=6&&j.data[0]===1&&ee(j.data,1),hy.unsigned(m.nameBytes));if(X&&(m.fileName=Si(X.data.slice(5))),m.compressionMethod===0){let j=m.uncompressedSize;if(m.generalPurposeBitFlag&1&&(j+=12),m.compressedSize!==j)throw new Error(`compressed size mismatch for stored file: ${m.compressedSize} != ${j}`)}l.push(m)}return{zip:{comment:i,commentBytes:o},entries:l.map(v=>new gc(n,v))}}async function jf(n,t){if(t.generalPurposeBitFlag&1)throw new Error("encrypted entries not supported");let e=await En(n,t.relativeOffsetOfLocalHeader,30),r=await n.getLength(),i=ee(e,0);if(i!==67324752)throw new Error(`invalid local file header signature: 0x${i.toString(16)}`);let o=Qt(e,26),a=Qt(e,28),s=t.relativeOffsetOfLocalHeader+e.length+o+a,l;if(t.compressionMethod===0)l=!1;else if(t.compressionMethod===8)l=!0;else throw new Error(`unsupported compression method: ${t.compressionMethod}`);let g=s,v=g+t.compressedSize;if(t.compressedSize!==0&&v>r)throw new Error(`file data overflows file bounds: ${g} +  ${t.compressedSize}  > ${r}`);return{decompress:l,fileDataStart:g}}async function my(n,t){let{decompress:e,fileDataStart:r}=await jf(n,t);if(!e){let a=await En(n,r,t.compressedSize);return Yp(a)?a.buffer:a.slice().buffer}let i=await dc(n,r,t.compressedSize);return await Gf(i,t.uncompressedSize)}async function vy(n,t,e){let{decompress:r,fileDataStart:i}=await jf(n,t);if(!r){let s=await dc(n,i,t.compressedSize,e);return Mf(s)?s:new Blob([Ti(s.buffer)?new Uint8Array(s):s],{type:e})}let o=await dc(n,i,t.compressedSize);return await Gf(o,t.uncompressedSize,e)}async function by(n){let t;if(typeof Blob<"u"&&n instanceof Blob)t=new Qo(n);else if(n instanceof ArrayBuffer||n&&n.buffer&&n.buffer instanceof ArrayBuffer)t=new Ho(n);else if(Ti(n)||Ti(n.buffer))t=new Ho(n);else if(typeof n=="string"){let r=await fetch(n);if(!r.ok)throw new Error(`failed http request ${n}, status: ${r.status}: ${r.statusText}`);let i=await r.blob();t=new Qo(i)}else if(typeof n.getLength=="function"&&typeof n.read=="function")t=n;else throw new Error("unsupported source type");let e=await t.getLength();if(e>Number.MAX_SAFE_INTEGER)throw new Error(`file too large. size: ${e}. Only file sizes up 4503599627370496 bytes are supported`);return await dy(t,e)}async function Hf(n){let{zip:t,entries:e}=await by(n);return{zip:t,entries:Object.fromEntries(e.map(r=>[r.name,r]))}}var Qf=zt(br());var rr=class{constructor(t){this.src=t;this.splitted=this.splitBuffer(t),this.logger.debug(`Buffer splitted into ${this.splitted.length} parts`)}logger=dt.INST.create("WasmSrc");splitted;wasmBinary(){return this.splitted[0]}async sourceCode(){let{entries:t}=await Hf(this.splitted[1]),e=new Map;for(let[r,i]of Object.entries(t)){if(i.isDirectory)continue;let o=await i.text();e.set(r,o)}return e}additionalCode(){return this.splitted.length==2?null:this.splitted[2].toString()}splitBuffer(t){let e="",r=parseInt(t.toString("utf8",0,1));this.logger.debug(`Number of elements: ${r}`);let i=t.length,o=0,a=0;for(let g=2;g<i;g++){let v=t.toString("utf8",g,g+1);if(v=="|"&&o++,o==r){a=g+1;break}e+=v}this.logger.debug("Parsed:",{header:e,dataStart:a});let s=e.split("|").map(g=>parseInt(g));this.logger.debug("Lengths",s);let l=[];for(let g of s){let v=Qf.Buffer.alloc(g),A=a+g;t.copy(v,0,a,A),a=A,l.push(v)}return l}};var Qr=class{constructor(t,e){this.arweave=t;this.env=e;this.tagsParser=new Ht}logger=dt.INST.create("ContractDefinitionLoader");arweaveWrapper;tagsParser;async load(t,e){let r=Ct.measure(),i=await this.doLoad(t,e);return this.logger.info(`Contract definition loaded in: ${r.elapsed()}`),i}async doLoad(t,e){let r=Ct.measure(),i=await this.arweaveWrapper.tx(t),o=await this.arweave.wallets.ownerToAddress(i.owner);this.logger.debug("Contract tx and owner",r.elapsed()),r.reset();let a=e||this.tagsParser.getTag(i,kt.CONTRACT_SRC_TX_ID),s=this.tagsParser.getTag(i,pt.WARP_TESTNET)||null;if(s&&this.env!=="testnet")throw new Error('Trying to use testnet contract in a non-testnet env. Use the "forTestnet" factory method.');if(!s&&this.env==="testnet")throw new Error("Trying to use non-testnet contract in a testnet env.");let l=this.tagsParser.getTag(i,kt.MIN_FEE),g=null,v=this.tagsParser.getTag(i,pt.MANIFEST);v&&(g=JSON.parse(v)),this.logger.debug("Tags decoding",r.elapsed()),r.reset();let A=await this.evalInitialState(i);this.logger.debug("init state",A);let B=JSON.parse(A);this.logger.debug("Parsing src and init state",r.elapsed());let{src:m,srcBinary:E,srcWasmLang:N,contractType:D,metadata:K,srcTx:X}=await this.loadContractSource(a);return{txId:t,srcTxId:a,src:m,srcBinary:E,srcWasmLang:N,initState:B,minFee:l,owner:o,contractType:D,metadata:K,manifest:g,contractTx:i.toJSON(),srcTx:X,testnet:s}}async loadContractSource(t){let e=Ct.measure(),r=await this.arweaveWrapper.tx(t),i=this.tagsParser.getTag(r,kt.CONTENT_TYPE);if(!ci.includes(i))throw new Error(`Contract source content type ${i} not supported`);let o=i=="application/javascript"?"js":"wasm",a=o=="js"?await this.arweaveWrapper.txDataString(t):await this.arweaveWrapper.txData(t),s,l,g;if(o=="wasm"){if(l=new rr(a),s=this.tagsParser.getTag(r,pt.WASM_LANG),!s)throw new Error(`Wasm lang not set for wasm contract src ${t}`);g=JSON.parse(this.tagsParser.getTag(r,pt.WASM_META))}return this.logger.debug("Contract src tx load",e.elapsed()),e.reset(),{src:o=="js"?a:null,srcBinary:o=="wasm"?l.wasmBinary():null,srcWasmLang:s,contractType:o,metadata:g,srcTx:r.toJSON()}}async evalInitialState(t){if(this.tagsParser.getTag(t,pt.INIT_STATE))return this.tagsParser.getTag(t,pt.INIT_STATE);if(this.tagsParser.getTag(t,pt.INIT_STATE_TX)){let e=this.tagsParser.getTag(t,pt.INIT_STATE_TX);return this.arweaveWrapper.txDataString(e)}else return this.arweaveWrapper.txDataString(t.id)}type(){return"arweave"}setCache(t){throw new Error("No cache implemented for this loader")}setSrcCache(t){throw new Error("No cache implemented for this loader")}getCache(){throw new Error("No cache implemented for this loader")}getSrcCache(){throw new Error("No cache implemented for this loader")}set warp(t){this.arweaveWrapper=new te(t)}};R();var zo=zt(br());var Ci=class{constructor(t,e,r,i){this.definitionCache=e;this.srcCache=r;this.env=i;this.contractDefinitionLoader=new Qr(t,i),this.tagsParser=new Ht}rLogger=dt.INST.create("WarpGatewayContractDefinitionLoader");contractDefinitionLoader;arweaveWrapper;tagsParser;_warp;async load(t,e){let r=await this.getFromCache(t,e);if(r)return this.rLogger.debug("WarpGatewayContractDefinitionLoader: Hit from cache!"),r.contractType=="wasm"&&r.srcBinary.data&&(r.srcBinary=zo.Buffer.from(r.srcBinary.data)),this.verifyEnv(r),r;let i=Ct.measure(),o=await this.doLoad(t,e);return this.rLogger.info(`Contract definition loaded in: ${i.elapsed()}`),this.verifyEnv(o),await this.putToCache(t,o,e),o}async doLoad(t,e){try{let r=Me(this._warp.gwUrl()),i=await $e(fetch(`${r}/gateway/contract?txId=${t}${e?`&srcTxId=${e}`:""}`));if(i.srcBinary!=null&&!(i.srcBinary instanceof zo.Buffer)&&(i.srcBinary=zo.Buffer.from(i.srcBinary.data)),i.srcBinary){let o=new rr(i.srcBinary);i.srcBinary=o.wasmBinary();let a;i.srcTx?a=new jr({...i.srcTx}):a=await this.arweaveWrapper.tx(i.srcTxId);let s=JSON.parse(this.tagsParser.getTag(a,pt.WASM_META));i.metadata=s}return i.contractType=i.src?"js":"wasm",i}catch(r){return this.rLogger.warn("Falling back to default contracts loader",r),await this.contractDefinitionLoader.doLoad(t,e)}}async loadContractSource(t){return await this.contractDefinitionLoader.loadContractSource(t)}type(){return"warp"}setCache(t){this.definitionCache=t}setSrcCache(t){this.srcCache=t}getCache(){return this.definitionCache}getSrcCache(){return this.srcCache}verifyEnv(t){if(t.testnet&&this.env!=="testnet")throw new Error('Trying to use testnet contract in a non-testnet env. Use the "forTestnet" factory method.');if(!t.testnet&&this.env==="testnet")throw new Error("Trying to use non-testnet contract in a testnet env.")}async getFromCache(t,e){let r=await this.definitionCache.get(new Jt(t,"cd"));if(!r)return null;let i=await this.srcCache.get(new Jt(e||r.cachedValue.srcTxId,"src"));return i?{...r.cachedValue,...i.cachedValue}:null}async putToCache(t,e,r){let i=new ai(e),o=new si(e);await this.definitionCache.put({key:t,sortKey:"cd"},o),await this.srcCache.put({key:r||o.srcTxId,sortKey:"src"},i)}set warp(t){this._warp=t,this.arweaveWrapper=new te(t),this.contractDefinitionLoader.warp=t}};R();R();R();function pc(n){let t="";for(let e of n)t+=("0"+e.toString(16)).slice(-2);return t}var _y="".padEnd(13,"0"),yc="".padEnd(13,"9"),Jo="".padEnd(13,"0"),zf="".padEnd(64,"0"),wc="".padEnd(64,"z"),Sn=`${"".padStart(12,"0")},${_y},${zf}`,Ey=`${"".padStart(12,"9")},${yc},${wc}`,nr=class{constructor(t){this.arweave=t}logger=dt.INST.create("LexicographicalInteractionsSorter");async sort(t){let e=[...t],r=e.map(i=>this.addSortKey(i));return await Promise.all(r),e.sort((i,o)=>i.node.sortKey.localeCompare(o.node.sortKey))}async createSortKey(t,e,r,i=!1){let o=this.arweave.utils.b64UrlToBuffer(t),a=this.arweave.utils.b64UrlToBuffer(e),s=this.arweave.utils.concatBuffers([o,a]),l=pc(await this.arweave.crypto.hash(s));return`${`${r}`.padStart(12,"0")},${i?yc:Jo},${l}`}extractBlockHeight(t){return t?parseInt(t.split(",")[0]):null}async addSortKey(t){let{node:e}=t,r=t.node.sortKey;r?(t.node.sortKey=r,this.logger.debug("Using sortKey from sequencer",t.node.sortKey)):t.node.sortKey=await this.createSortKey(e.block.id,e.id,e.block.height)}generateLastSortKey(t){return`${`${t}`.padStart(12,"0")},${yc},${wc}`}};R();var Jf=`query Transactions($tags: [TagFilter!]!, $blockFilter: BlockFilter!, $first: Int!, $after: String) {
    transactions(tags: $tags, block: $blockFilter, first: $first, sort: HEIGHT_ASC, after: $after) {
      pageInfo {
        hasNextPage
      }
      edges {
        node {
          id
          owner { address }
          recipient
          tags {
            name
            value
          }
          block {
            height
            id
            timestamp
          }
          fee { winston }
          quantity { winston }
          parent { id }
          bundledIn { id }
        }
        cursor
      }
    }
  }`,Sy=`query Transaction($id: ID!) {
  transaction(id: $id) {
          id
          owner { address, key }
          recipient
          tags {
            name
            value
          }
          block {
            height
            id
            timestamp
          }
          fee { winston, ar }
          quantity { winston, ar }
          bundledIn { id }
    			parent{ id }
          signature
        }
}`,Yf=30*1e3,Ty=100,Fe=class{constructor(t){this.warp=t;this.arweaveWrapper=new te(t)}arweaveWrapper;logger=dt.INST.create(Fe.name);async transaction(t){return(await this.fetch(Sy,{id:t})).transaction}async transactions(t){let e=(await this.fetch(Jf,t)).transactions,r=[...e.edges];for(;e.pageInfo.hasNextPage;){let i=e.edges[Ty-1].cursor,o={...t,after:i};e=(await this.fetch(Jf,o)).transactions,r.push(...e.edges)}return r}async fetch(t,e){let r=Ct.measure(),i=await this.arweaveWrapper.gql(t,e);for(this.logger.debug("GQL page load:",r.elapsed());i.status===403;)this.logger.warn(`GQL rate limiting, waiting ${Yf}ms before next try.`),await ri(Yf),i=await this.arweaveWrapper.gql(t,e);if(i.status!==200)throw new Error(`Unable to retrieve transactions. Arweave gateway responded with status ${i.status}.`);if(i.data.errors)throw this.logger.error(i.data.errors),new Error("Error while fetching arweave transactions");return i.data.data}};var Xf=100;function mc(n){return!n.node.parent?.id&&!n.node.bundledIn?.id}var Ii=class{constructor(t,e){this.arweave=t;this.environment=e;this.sorter=new nr(t)}logger=dt.INST.create("ArweaveGatewayInteractionsLoader");sorter;arweaveTransactionQuery;_warp;tagsParser=new Ht;async load(t,e,r,i){this.logger.debug("Loading interactions for",{contractId:t,fromSortKey:e,toSortKey:r});let o=this.sorter.extractBlockHeight(e),a=this.sorter.extractBlockHeight(r),s={tags:[{name:kt.APP_NAME,values:["SmartWeaveAction"]},{name:kt.CONTRACT_TX_ID,values:[t]}],blockFilter:{min:o,max:a},first:Xf},l=Ct.measure(),g=(await this.arweaveTransactionQuery.transactions(s)).filter(mc);if(l.stop(),i.internalWrites){let m={tags:[{name:pt.INTERACT_WRITE,values:[t]}],blockFilter:{min:o,max:a},first:Xf},E=(await this.arweaveTransactionQuery.transactions(m)).filter(mc);this.logger.debug("Inner writes interactions length:",E.length),g=g.concat(E)}g=g.filter(m=>m.node.block&&m.node.block.id&&m.node.block.height);let v=await this.sorter.sort(g);e&&r?v=v.filter(m=>m.node.sortKey.localeCompare(e)>0&&m.node.sortKey.localeCompare(r)<=0):e&&!r?v=v.filter(m=>m.node.sortKey.localeCompare(e)>0):!e&&r&&(v=v.filter(m=>m.node.sortKey.localeCompare(r)<=0)),this.logger.debug("All loaded interactions:",{from:e,to:r,loaded:v.length,time:l.elapsed()});let A=this.environment==="local"||this.environment==="testnet",B=this._warp.maybeLoadPlugin("vrf");return v.map(m=>{let E=m.node;return A&&this.tagsParser.hasVrfTag(E)&&(B?E.vrf=B.process().generateMockVrf(E.sortKey):this.logger.warn('Cannot generate mock vrf for interaction - no "warp-contracts-plugin-vrf" attached!')),E})}type(){return"arweave"}clearCache(){}set warp(t){this.arweaveTransactionQuery=new Fe(t),this._warp=t}};R();var Tn=class{constructor(t){this.delegate=t}logger=dt.INST.create("CacheableInteractionsLoader");interactionsCache=new Map;async load(t,e,r,i){if(this.logger.debug("Loading interactions for",{contractTxId:t,fromSortKey:e,toSortKey:r}),this.interactionsCache.has(t)){let o=this.interactionsCache.get(t);if(o?.length){let a=o[o.length-1].sortKey;if(a.localeCompare(r)<0){let s=await this.delegate.load(t,a,r,i),l=o.concat(s);return this.interactionsCache.set(t,l),l}}return o}else{let o=await this.delegate.load(t,e,r,i);return o.length&&this.interactionsCache.set(t,o),o}}type(){return this.delegate.type()}clearCache(){this.interactionsCache.clear()}set warp(t){this.delegate.warp=t}};R();var Ai=class{constructor(t,e=[]){this.arweave=t;this.executionContextModifiers=e}logger=dt.INST.create("DefaultStateEvaluator");tagsParser=new Ht;async eval(t){return this.doReadState(t.sortedInteractions,new $t(t.contractDefinition.initState,{},{}),t)}async doReadState(t,e,r){let{ignoreExceptions:i,stackTrace:o,internalWrites:a}=r.evaluationOptions,{contract:s,contractDefinition:l,sortedInteractions:g,warp:v}=r,A=e.state,B=null,m=e.validity,E=e.errorMessages;r?.handler.initState(A);let N=r.contract.callDepth();this.logger.debug(`${Ce(N)}Evaluating state for ${l.txId} [${t.length} non-cached of ${g.length} all]`);let D=null,K=null,X=t.length,j=v.maybeLoadPlugin("evm-signature-verification"),nt=v.maybeLoadPlugin("evaluation-progress"),U=v.maybeLoadPlugin("vrf"),M=!1;for(let G=0;G<X&&!M;G++){s.interactionState().setInitial(s.txId(),new $t(A,m,E));let W=t[G],at=Ct.measure();if(B=W.sortKey,W.vrf){if(!U)this.logger.warn('Cannot verify vrf for interaction - no "warp-contracts-plugin-vrf" attached!');else if(!U.process().verify(W.vrf,W.sortKey))throw new Error("Vrf verification failed.")}if(j&&this.tagsParser.isEvmSigned(W))try{if(!await j.process(W)){this.logger.warn(`Interaction ${W.id} was not verified, skipping.`);continue}}catch(ot){this.logger.error(ot);continue}if(this.logger.debug(`${Ce(N)}[${l.txId}][${W.id}][${W.block.height}]: ${t.indexOf(W)+1}/${t.length} [of all:${g.length}]`),this.tagsParser.isInteractWrite(W,l.txId)&&a){let ot=this.tagsParser.getContractTag(W);this.logger.debug(`${Ce(N)}Internal Write - Loading writing contract`,ot);let ct=s.getCallStack().addInteractionData({interaction:null,interactionTx:W}),ut=v.contract(ot,r.contract,{callingInteraction:W,callType:"read"});this.logger.debug(`${Ce(N)}Reading state of the calling contract at`,W.sortKey);let vt=null;try{await ut.readState(W.sortKey),vt=s.interactionState().get(s.txId())}catch(yt){if(yt.name=="ContractError"&&yt.subtype=="unsafeClientSkip"){if(this.logger.warn("Skipping unsafe contract in internal write"),E[W.id]=yt,vc(W)){let it=new $t(A,m,E);K={tx:W,state:it}}}else throw yt}if(vt!==null){A=vt.state,r?.handler.initState(A),m[W.id]=vt.validity[W.id],vt.errorMessages?.[W.id]&&(E[W.id]=vt.errorMessages[W.id]);let yt=new $t(A,m,E);vc(W)&&(K={tx:W,state:yt})}else m[W.id]=!1;ct.update({cacheHit:!1,outputState:o.saveState?A:void 0,executionTime:at.elapsed(!0),valid:m[W.id],errorMessage:D,gasUsed:0})}else{let ot=this.tagsParser.getInputTag(W,r.contractDefinition.txId);if(!ot){this.logger.error(`${Ce(N)}Skipping tx - Input tag not found for ${W.id}`);continue}let ct=this.parseInput(ot);if(!ct){this.logger.error(`${Ce(N)}Skipping tx - invalid Input tag - ${W.id}`);continue}let ut={input:ct,caller:W.owner.address,interactionType:"write"},vt={interaction:ut,interactionTx:W},yt=s.getCallStack().addInteractionData(vt),it=await r.handler.handle(r,new $t(A,m,E),vt);if(D=it.errorMessage,it.type!=="ok"&&(E[W.id]=D),this.logResult(it,W,r),this.logger.debug(`${Ce(N)}Interaction evaluation`,at.elapsed()),yt.update({cacheHit:!1,outputState:o.saveState?A:void 0,executionTime:at.elapsed(!0),valid:m[W.id],errorMessage:D,gasUsed:it.gasUsed}),it.type==="exception"&&i!==!0)throw new Error(`Exception while processing ${JSON.stringify(ut)}:
${it.errorMessage}`);m[W.id]=it.type==="ok",A=it.state;let Ot=new $t(A,m,E);vc(W)&&(K={tx:W,state:Ot})}nt&&nt.process({contractTxId:l.txId,allInteractions:X,currentInteraction:G,lastInteractionProcessingTime:at.elapsed()});try{for(let{modify:ot}of this.executionContextModifiers)r=await ot(A,r)}catch(ot){if(ot.name=="ContractError"&&ot.subtype=="unsafeClientSkip")m[W.id]=!1,E[W.id]=ot.message,M=!0;else throw ot}s.isRoot()?K&&(s.interactionState().update(s.txId(),K.state),m[W.id]?await s.interactionState().commit(W):await s.interactionState().rollback(W)):s.interactionState().update(s.txId(),new $t(A,m,E))}let q=new $t(A,m,E);return K!==null&&await this.onStateEvaluated(K.tx,r,K.state),new Vt(B,q)}logResult(t,e,r){t.type==="exception"&&this.logger.error(`Executing of interaction: [${r.contractDefinition.txId} -> ${e.id}] threw exception:`,`${t.errorMessage}`),t.type==="error"&&this.logger.warn(`Executing of interaction: [${r.contractDefinition.txId} -> ${e.id}] returned error:`,t.errorMessage)}parseInput(t){try{return JSON.parse(t.value)}catch(e){return this.logger.error(e),null}}};function vc(n){return n.confirmationStatus===void 0?!0:n.confirmationStatus==="confirmed"}R();var ki=class extends Ai{constructor(e,r,i=[]){super(e,i);this.cache=r}cLogger=dt.INST.create("CacheableStateEvaluator");async eval(e){let{cachedState:r,contract:i}=e,o=e.sortedInteractions;if(r&&r.sortKey==e.requestedSortKey&&!o?.length)return this.cLogger.info(`Exact cache hit for sortKey ${e?.contractDefinition?.txId}:${r.sortKey}`),e.handler?.initState(r.cachedValue.state),r;let a=e.contractDefinition.txId;if(!a)throw new Error("Contract tx id not set in the execution context");let s=r==null,l=s?e.contractDefinition.initState:r.cachedValue.state,g=s?{}:r.cachedValue.validity,v=s?{}:r.cachedValue.errorMessages;if(s&&(l=await e.handler.maybeCallStateConstructor(e.contractDefinition.initState,e),await i.interactionState().commitKV()),o.length==0)if(this.cLogger.info(`No missing interactions ${a}`),s){e.handler?.initState(l),this.cLogger.debug("Inserting initial state into cache");let A=new $t(l,{},{});return await this.cache.put(new Jt(a,Sn),A),new Vt(Sn,A)}else return e.handler?.initState(r.cachedValue.state),r;return await this.doReadState(o,new $t(l,g,v||{}),e)}async onStateEvaluated(e,r,i){let o=r.contractDefinition.txId;this.cLogger.debug(`${Ce(r.contract.callDepth())}onStateEvaluated: cache update for contract ${o} [${e.sortKey}]`),await this.putInCache(o,e,i)}async onStateUpdate(e,r,i,o=!1){(r.evaluationOptions.updateCacheForEachInteraction||o)&&(this.cLogger.debug(`onStateUpdate: cache update for contract ${r.contractDefinition.txId} [${e.sortKey}]`,{contract:r.contractDefinition.txId,state:i.state,sortKey:e.sortKey}),await this.putInCache(r.contractDefinition.txId,e,i))}async latestAvailableState(e,r){if(this.cLogger.debug("Searching for",{contractTxId:e,sortKey:r}),r){let i=await this.cache.getLessOrEqual(e,r);return i&&this.cLogger.debug(`Latest available state at ${e}: ${i.sortKey}`),i}else return await this.cache.getLast(e)}async onInternalWriteStateUpdate(e,r,i){this.cLogger.debug("Internal write state update:",{sortKey:e.sortKey,dry:e.dry,contractTxId:r,state:i.state}),await this.putInCache(r,e,i)}async onContractCall(e,r,i){if(r.sortedInteractions?.length==0)return;let o=r.sortedInteractions.indexOf(e);o<1||await this.putInCache(r.contractDefinition.txId,r.sortedInteractions[o-1],i)}async putInCache(e,r,i){if(r.dry||r.confirmationStatus!==void 0&&r.confirmationStatus!=="confirmed")return;let o=new $t(i.state,i.validity,i.errorMessages||{});this.cLogger.debug("Putting into cache",{contractTxId:e,transaction:r.id,sortKey:r.sortKey,dry:r.dry}),await this.cache.put(new Jt(e,r.sortKey),o)}async syncState(e,r,i,o){let a=new $t(i,o,{});return await this.cache.put(new Jt(e,r),a),new Vt(r,a)}async dumpCache(){return await this.cache.dump()}async internalWriteState(e,r){return await this.cache.get(new Jt(e,r))}async hasContractCached(e){return await this.cache.getLast(e)!=null}async lastCachedSortKey(){return await this.cache.getLastSortKey()}setCache(e){this.cache=e}getCache(){return this.cache}};R();R();var bc=(n,t,e,r,i)=>{let o=dt.INST.create("WASM:Rust"),a={metering:{usegas:n.useGas},console:{log:function(f){o.debug(`${n.contract.id}: ${f}`)}},Block:{height:function(){return n.block.height},indep_hash:function(){return n.block.indep_hash},timestamp:function(){return n.block.timestamp}},Transaction:{id:function(){return n.transaction.id},owner:function(){return n.transaction.owner},target:function(){return n.transaction.target}},Contract:{id:function(){return n.contract.id},owner:function(){return n.contract.owner}},KV:{get:async function(f){return await n.kv.get(f)},put:async function(f,y){await n.kv.put(f,y)}},SmartWeave:{caller:function(){return n.caller},readContractState:async function(f){return await n.contracts.readContractState(f)},viewContractState:async function(f,y){return await n.contracts.viewContractState(f,y)},write:async function(f,y){return await n.contracts.write(f,y,!1)}},Vrf:{value:function(){return n.vrf.value},randomInt:function(f){return n.vrf.randomInt(f)}}},s=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});s.decode();let l=null;function g(){return(l===null||l.byteLength===0)&&(l=new Uint8Array(e.exports.memory.buffer)),l}function v(f,y){return s.decode(g().subarray(f,f+y))}let A=new Array(128).fill(void 0);A.push(void 0,null,!0,!1);let B=A.length;function m(f){B===A.length&&A.push(A.length+1);let y=B;if(B=A[y],typeof B!="number")throw new Error("corrupt heap");return A[y]=f,y}function E(f){return A[f]}function N(f){if(typeof f!="boolean")throw new Error("expected a boolean argument")}function D(f){return f==null}function K(f){if(typeof f!="number")throw new Error("expected a number argument")}let X=null;function j(){return(X===null||X.byteLength===0)&&(X=new Float64Array(e.exports.memory.buffer)),X}let nt=null;function U(){return(nt===null||nt.byteLength===0)&&(nt=new Int32Array(e.exports.memory.buffer)),nt}let M=0,q=new TextEncoder("utf-8"),G=typeof q.encodeInto=="function"?function(f,y){return q.encodeInto(f,y)}:function(f,y){let O=q.encode(f);return y.set(O),{read:f.length,written:O.length}};function W(f,y,O){if(typeof f!="string")throw new Error("expected a string argument");if(O===void 0){let u=q.encode(f),d=y(u.length);return g().subarray(d,d+u.length).set(u),M=u.length,d}let F=f.length,Z=y(F),st=g(),c=0;for(;c<F;c++){let u=f.charCodeAt(c);if(u>127)break;st[Z+c]=u}if(c!==F){c!==0&&(f=f.slice(c)),Z=O(Z,F,F=c+f.length*3);let u=g().subarray(Z+c,Z+F),d=G(f,u);if(d.read!==f.length)throw new Error("failed to pass whole string");c+=d.written}return M=c,Z}function at(f){f<132||(A[f]=B,B=f)}function V(f){let y=E(f);return at(f),y}function ot(f){let y=typeof f;if(y=="number"||y=="boolean"||f==null)return`${f}`;if(y=="string")return`"${f}"`;if(y=="symbol"){let Z=f.description;return Z==null?"Symbol":`Symbol(${Z})`}if(y=="function"){let Z=f.name;return typeof Z=="string"&&Z.length>0?`Function(${Z})`:"Function"}if(Array.isArray(f)){let Z=f.length,st="[";Z>0&&(st+=ot(f[0]));for(let c=1;c<Z;c++)st+=", "+ot(f[c]);return st+="]",st}let O=/\[object ([^\]]+)\]/.exec(toString.call(f)),F;if(O.length>1)F=O[1];else return toString.call(f);if(F=="Object")try{return"Object("+JSON.stringify(f)+")"}catch{return"Object"}return f instanceof Error?`${f.name}: ${f.message}
${f.stack}`:F}function ct(f){if(typeof f!="bigint")throw new Error("expected a bigint argument")}let ut=null;function vt(){return(ut===null||ut.byteLength===0)&&(ut=new BigInt64Array(e.exports.memory.buffer)),ut}function yt(f,y,O,F){let Z={a:f,b:y,cnt:1,dtor:O},st=(...c)=>{Z.cnt++;let u=Z.a;Z.a=0;try{return F(u,Z.b,...c)}finally{--Z.cnt===0?e.exports.__wbindgen_export_2.get(Z.dtor)(u,Z.b):Z.a=u}};return st.original=Z,st}function it(f,y){try{return f.apply(this,y)}catch(O){let F=function(){try{return O instanceof Error?`${O.message}

Stack:
${O.stack}`:O.toString()}catch{return"<failed to stringify thrown value>"}}();throw console.error("wasm-bindgen: imported JS function that was not marked as `catch` threw an error:",F),O}}function Ot(f,y,O){K(f),K(y),e.modifiedExports._dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__(f,y,m(O))}function Dt(f){let y=e.exports.warpContractWrite(m(f));return V(y)}function oe(f){var y=e.exports.handle(m(f));return V(y)}let bt=128;function Bt(f){if(bt==1)throw new Error("out of js stack");return A[--bt]=f,bt}function tt(f){try{let F=e.exports.__wbindgen_add_to_stack_pointer(-16);e.exports.initState(F,Bt(f));var y=U()[F/4+0],O=U()[F/4+1];let Z;return y!==0&&(Z=v(y,O).slice(),e.exports.__wbindgen_free(y,O*1)),Z}finally{e.exports.__wbindgen_add_to_stack_pointer(16),A[bt++]=void 0}}function de(f){try{e.exports.initState(Bt(f))}finally{A[bt++]=void 0}}function rt(){let f=e.exports.currentState();return V(f)}function pe(){return e.exports.version()}function Mt(){return e.exports.lang()}function Nt(f){let y=e.exports.warpContractView(m(f));return V(y)}function T(f,y){try{return f.apply(this,y)}catch(O){e.exports.__wbindgen_exn_store(m(O))}}function k(f,y,O,F){K(f),K(y),e.modifiedExports.wasm_bindgen__convert__closures__invoke2_mut__(f,y,m(O),m(F))}function h(f){return()=>{throw new Error(`${f} is not defined`)}}let w={__wbindgen_json_parse:function(f,y){let O=JSON.parse(v(f,y));return m(O)},__wbindgen_json_serialize:function(f,y){let O=E(y),F=JSON.stringify(O===void 0?null:O),Z=W(F,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),st=M;U()[f/4+1]=st,U()[f/4+0]=Z},__wbindgen_error_new:function(f,y){let O=new Error(v(f,y));return m(O)},__wbindgen_is_undefined:function(f){let y=E(f)===void 0;return N(y),y},__wbindgen_in:function(f,y){let O=E(f)in E(y);return N(O),O},__wbindgen_number_get:function(f,y){let O=E(y),F=typeof O=="number"?O:void 0;D(F)||K(F),j()[f/8+1]=D(F)?0:F,U()[f/4+0]=!D(F)},__wbindgen_boolean_get:function(f){let y=E(f),O=typeof y=="boolean"?y?1:0:2;return K(O),O},__wbindgen_is_null:function(f){let y=E(f)===null;return N(y),y},__wbindgen_string_new:function(f,y){let O=v(f,y);return m(O)},__wbindgen_string_get:function(f,y){let O=E(y),F=typeof O=="string"?O:void 0;var Z=D(F)?0:W(F,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),st=M;U()[f/4+1]=st,U()[f/4+0]=Z},__wbindgen_is_bigint:function(f){let y=typeof E(f)=="bigint";return N(y),y},__wbindgen_is_object:function(f){let y=E(f),O=typeof y=="object"&&y!==null;return N(O),O},__wbindgen_object_clone_ref:function(f){let y=E(f);return m(y)},__wbindgen_jsval_eq:function(f,y){let O=E(f)===E(y);return N(O),O},__wbindgen_bigint_from_i64:function(f){return m(f)},__wbindgen_bigint_from_u64:function(f){let y=BigInt.asUintN(64,f);return m(y)},__wbg_readContractState:function(){return T(function(f,y){let O=a.SmartWeave.readContractState(v(f,y));return m(O)},arguments)},__wbg_viewContractState:function(){return T(function(f,y,O){let F=a.SmartWeave.viewContractState(v(f,y),V(O));return m(F)},arguments)},__wbg_write:function(){return T(function(f,y,O){let F=a.SmartWeave.write(v(f,y),V(O));return m(F)},arguments)},__wbg_refreshState:function(f,y){},__wbg_kvGet:function(){return T(function(f,y){let O=a.KV.get(v(f,y));return m(O)},arguments)},__wbg_kvPut:function(){return T(function(f,y,O){let F=a.KV.put(v(f,y),V(O));return m(F)},arguments)},__wbindgen_object_drop_ref:function(f){V(f)},__wbg_error:function(){return it(function(f,y){try{a.console.log(v(f,y))}finally{e.exports.__wbindgen_free(f,y)}},arguments)},__wbg_new_abda76e883ba8a5f:function(){return it(function(){let f=new Error;return m(f)},arguments)},__wbg_stack:function(){return it(function(f,y){let O=Error.stackTraceLimit;Error.stackTraceLimit=25;let F=E(y).stack,Z=W(F,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),st=M;U()[f/4+1]=st,U()[f/4+0]=Z,Error.stackTraceLimit=O},arguments)},__wbg_indephash:function(){return it(function(f){let y=a.Block.indep_hash(),O=W(y,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),F=M;U()[f/4+1]=F,U()[f/4+0]=O},arguments)},__wbg_height:function(){return it(function(){let f=a.Block.height();return K(f),f},arguments)},__wbg_timestamp:function(){return it(function(){let f=a.Block.timestamp();return K(f),f},arguments)},__wbg_contractId:function(){return it(function(f){let y=a.Contract.id(),O=W(y,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),F=M;U()[f/4+1]=F,U()[f/4+0]=O},arguments)},__wbg_contractOwner:function(){return it(function(f){let y=a.Contract.owner(),O=W(y,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),F=M;U()[f/4+1]=F,U()[f/4+0]=O},arguments)},__wbg_id:function(){return it(function(f){let y=a.Transaction.id(),O=W(y,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),F=M;U()[f/4+1]=F,U()[f/4+0]=O},arguments)},__wbg_owner:function(){return it(function(f){let y=a.Transaction.owner(),O=W(y,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),F=M;U()[f/4+1]=F,U()[f/4+0]=O},arguments)},__wbg_target:function(){return it(function(f){let y=a.Transaction.target(),O=W(y,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),F=M;U()[f/4+1]=F,U()[f/4+0]=O},arguments)},__wbg_caller:function(){return it(function(f){let y=a.SmartWeave.caller(),O=W(y,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),F=M;U()[f/4+1]=F,U()[f/4+0]=O},arguments)},__wbg_value_b245bf3240b21a48:function(){return it(function(f){let y=a.Vrf.value(),O=W(y,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),F=M;U()[f/4+1]=F,U()[f/4+0]=O},arguments)},__wbg_value_7d69ddc3f1ad7876:function(){return it(function(f){let y=a.Vrf.value(),O=W(y,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),F=M;U()[f/4+1]=F,U()[f/4+0]=O},arguments)},__wbg_vrfValue:function(){return it(function(f){let y=a.Vrf.value(),O=W(y,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),F=M;U()[f/4+1]=F,U()[f/4+0]=O},arguments)},__wbg_randomInt:function(){return it(function(f){let y=a.Vrf.randomInt(f);return K(y),y},arguments)},__wbg_log:function(){return it(function(f,y){a.console.log(v(f,y))},arguments)},__wbindgen_cb_drop:function(f){let y=V(f).original;if(y.cnt--==1)return y.a=0,!0;let O=!1;return N(O),O},__wbg_debug:function(){return it(function(f){console.log(E(f))},arguments)},__wbg_String:function(){return it(function(f,y){let O=String(E(y)),F=W(O,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),Z=M;U()[f/4+1]=Z,U()[f/4+0]=F},arguments)},__wbg_getwithrefkey:function(){return it(function(f,y){let O=E(f)[E(y)];return m(O)},arguments)},__wbg_set_841ac57cff3d672b:function(){return it(function(f,y,O){E(f)[V(y)]=V(O)},arguments)},__wbindgen_number_new:function(f){return m(f)},__wbindgen_jsval_loose_eq:function(f,y){let O=E(f)==E(y);return N(O),O},__wbg_get_27fe3dac1c4d0224:function(){return it(function(f,y){let O=E(f)[y>>>0];return m(O)},arguments)},__wbg_set_17224bc548dd1d7b:function(){return it(function(f,y,O){E(f)[y>>>0]=V(O)},arguments)},__wbg_isArray:function(){return it(function(f){let y=Array.isArray(E(f));return N(y),y},arguments)},__wbg_length_e498fbc24f9c1d4f:function(){return it(function(f){let y=E(f).length;return K(y),y},arguments)},__wbg_new_b525de17f44a8943:function(){return it(function(){let f=new Array;return m(f)},arguments)},__wbg_instanceof_ArrayBuffer:function(){return it(function(f){let y;try{y=E(f)instanceof ArrayBuffer}catch{y=!1}let O=y;return N(O),O},arguments)},__wbg_call_95d1ea488d03e4e8:function(){return T(function(f,y){let O=E(f).call(E(y));return m(O)},arguments)},__wbg_call_9495de66fdbe016b:function(){return T(function(f,y,O){let F=E(f).call(E(y),E(O));return m(F)},arguments)},__wbg_call_94697a95cb7e239c:function(){return T(function(f,y,O){let F=E(f).call(E(y),E(O));return m(F)},arguments)},__wbg_new_f841cc6f2098f4b5:function(){return it(function(){return m(new Map)},arguments)},__wbg_set_388c4c6422704173:function(){return it(function(f,y,O){let F=E(f).set(E(y),E(O));return m(F)},arguments)},__wbg_next_88560ec06a094dea:function(){return T(function(f){let y=E(f).next();return m(y)},arguments)},__wbg_next_b7d530c04fd8b217:function(){return it(function(f){let y=E(f).next;return m(y)},arguments)},__wbg_done:function(){return it(function(f){let y=E(f).done;return N(y),y},arguments)},__wbg_value_6ac8da5cc5b3efda:function(){return it(function(f){let y=E(f).value;return m(y)},arguments)},__wbg_isSafeInteger:function(){return it(function(f){let y=Number.isSafeInteger(E(f));return N(y),y},arguments)},__wbg_entries:function(){return it(function(f){let y=Object.entries(E(f));return m(y)},arguments)},__wbg_new_f9876326328f45ed:function(){return it(function(){let f=new Object;return m(f)},arguments)},__wbg_iterator:function(){return it(function(){return m(Symbol.iterator)},arguments)},__wbg_new_9d3a9ce4282a18a8:function(){return it(function(f,y){try{var O={a:f,b:y},F=(st,c)=>{let u=O.a;O.a=0;try{return k(u,O.b,st,c)}finally{O.a=u}};let Z=new Promise(F);return m(Z)}finally{O.a=O.b=0}},arguments)},__wbg_new_4beacc9c71572250:function(){return it(function(f,y){try{var O={a:f,b:y},F=(st,c)=>{let u=O.a;O.a=0;try{return k(u,O.b,st,c)}finally{O.a=u}};let Z=new Promise(F);return m(Z)}finally{O.a=O.b=0}},arguments)},__wbg_resolve:function(){return it(function(f){let y=Promise.resolve(E(f));return m(y)},arguments)},__wbg_then_ec5db6d509eb475f:function(){return it(function(f,y){let O=E(f).then(E(y));return m(O)},arguments)},__wbg_then_a6860c82b90816ca:function(){return it(function(f,y){let O=E(f).then(E(y));return m(O)},arguments)},__wbg_then_f753623316e2873a:function(){return it(function(f,y,O){let F=E(f).then(E(y),E(O));return m(F)},arguments)},__wbg_then_58a04e42527f52c6:function(){return it(function(f,y,O){let F=E(f).then(E(y),E(O));return m(F)},arguments)},__wbg_instanceof_Uint8Array:function(){return it(function(f){let y;try{y=E(f)instanceof Uint8Array}catch{y=!1}let O=y;return N(O),O},arguments)},__wbg_new_537b7341ce90bb31:function(){return it(function(f){let y=new Uint8Array(E(f));return m(y)},arguments)},__wbg_length_27a2afe8ab42b09f:function(){return it(function(f){let y=E(f).length;return K(y),y},arguments)},__wbg_set_17499e8aa4003ebd:function(){return it(function(f,y,O){E(f).set(E(y),O>>>0)},arguments)},__wbindgen_is_function:function(f){let y=typeof E(f)=="function";return N(y),y},__wbindgen_is_string:function(f){let y=typeof E(f)=="string";return N(y),y},__wbg_buffer:function(){return it(function(f){let y=E(f).buffer;return m(y)},arguments)},__wbg_get_baf4855f9a986186:function(){return T(function(f,y){let O=Reflect.get(E(f),E(y));return m(O)},arguments)},__wbindgen_debug_string:function(f,y){let O=ot(E(y)),F=W(O,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),Z=M;U()[f/4+1]=Z,U()[f/4+0]=F},__wbindgen_bigint_get_as_i64:function(f,y){let O=E(y),F=typeof O=="bigint"?O:void 0;D(F)||ct(F),vt()[f/8+1]=D(F)?BigInt(0):F,U()[f/4+0]=!D(F)},__wbindgen_throw:function(f,y){throw new Error(v(f,y))},__wbindgen_memory:function(){let f=e.exports.memory;return m(f)},__wbindgen_closure_wrapper:function(){return it(function(f,y,O){let F=yt(f,y,r,Ot);return m(F)},arguments)}},p={_assertBoolean:N,_assertNum:K,addBorrowedObject:Bt,addHeapObject:m,getInt32Memory0:U,getObject:E,getStringFromWasm0:v,handleError:T,heap:()=>A,logError:it,notDefined:h,passStringToWasm0:W,takeObject:V,wasm:()=>e.exports,WASM_VECTOR_LEN:()=>M,__wbg_adapter_4:k,__wbg_adapter_3:Ot};function C(f){return function(){return it(function(y){let O=f(V(y));return m(O)},arguments)}}function x(f,y){let O={};for(let[F,Z]of Object.entries(f.extensions)){let st=Z.rustImports?.(y)??{};for(let[c,u]of Object.entries(st))c.startsWith("__wbg_")?O[c]=u:O["__wbg_"+c]=C(u)}return O}let b={...w,...x(n,p)},I=Object.keys(b),_=t.reduce((f,y)=>{let O=I.find(F=>y.startsWith(F));if(O===void 0)throw new Error(`Cannot find import mapping for ${y}. Please file a bug.`);if(I.filter(F=>y.startsWith(F)).length!=1)throw new Error(`Multiple import mappings for ${y}. Please file a bug.`);if(f.usedKeys.has(O))throw new Error(`Multiple methods maps to ${O}. Please file a bug.`);return f.res[y]=b[O],f.usedKeys.add(O),f},{res:{},usedKeys:new Set}).res;i==="__WARP_CONTRACTS_VERSION_LEGACY"?(_.initStateLegacy=de,_.handle=oe):(_.initState=tt,_.warpContractWrite=Dt,_.warpContractView=Nt),_.currentState=rt,_.version=pe,_.lang=Mt;let S={};S.__wbindgen_placeholder__=_;class L{__destroy_into_raw(){let y=this.ptr;return this.ptr=0,y}free(){let y=this.__destroy_into_raw();e.exports.__wbg_statewrapper_free(y)}}return _.StateWrapper=L,S.metering=a.metering,{imports:S,exports:_}};R();var Li=class{gasUsed;gasLimit;transaction;block;vrf;evaluationOptions;arweave;contract;unsafeClient;contracts;extensions;_activeTx;caller;kv;constructor(t,e,r,i,o){this.gasUsed=0,this.gasLimit=Number.MAX_SAFE_INTEGER,this.unsafeClient=t,this.arweave={ar:t.ar,utils:t.utils,wallets:t.wallets,crypto:t.crypto},this.evaluationOptions=r,this.contract=e,this.transaction=new xn(this),this.block=new Cn(this),this.contracts={readContractState:(a,s,l)=>{throw new Error("Not implemented - should be set by HandlerApi implementor")},viewContractState:(a,s)=>{throw new Error("Not implemented - should be set by HandlerApi implementor")},write:(a,s,l)=>{throw new Error("Not implemented - should be set by HandlerApi implementor")},refreshState:()=>{throw new Error("Not implemented - should be set by HandlerApi implementor")}},this.vrf=new In(this),this.useGas=this.useGas.bind(this),this.getBalance=this.getBalance.bind(this),this.extensions={},this.kv=new Yo(o,i,this.transaction,this.contract.id)}useGas(t){if(t<0)throw new Error("[RE:GNE] Gas number exception - gas < 0.");if(this.gasUsed+=t,this.gasUsed>this.gasLimit)throw new Error(`[RE:OOG] Out of gas! Used: ${this.gasUsed}, limit: ${this.gasLimit}`)}async getBalance(t,e){if(!this._activeTx)throw new Error("Cannot read balance - active tx is not set.");if(!this.block.height)throw new Error("Cannot read balance - block height not set.");let r=e||this.block.height;return await fetch(`${this.evaluationOptions.walletBalanceUrl}block/height/${r}/wallet/${t}/balance`).then(i=>i.ok?i.text():Promise.reject(i)).catch(i=>{throw new Error(`Unable to read wallet balance. ${i.status}. ${i.body?.message}`)})}},xn=class{constructor(t){this.smartWeaveGlobal=t}get id(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.id}get owner(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.owner.address}get target(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.recipient}get tags(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.tags}get sortKey(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.sortKey}get dryRun(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.dry===!0}get quantity(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.quantity.winston}get reward(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.fee.winston}get origin(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.source==="redstone-sequencer"?"L2":"L1"}},Cn=class{constructor(t){this.smartWeaveGlobal=t}get height(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.block.height}get indep_hash(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.block.id}get timestamp(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current tx");return this.smartWeaveGlobal._activeTx.block.timestamp}},In=class{constructor(t){this.smartWeaveGlobal=t}get data(){return this.smartWeaveGlobal._activeTx.vrf}get value(){return this.smartWeaveGlobal._activeTx.vrf.bigint}randomInt(t){if(!Number.isInteger(t))throw new Error("Integer max value required for random integer generation");let e=BigInt(this.smartWeaveGlobal._activeTx.vrf.bigint)%BigInt(t)+BigInt(1);if(e>Number.MAX_SAFE_INTEGER||e<Number.MIN_SAFE_INTEGER)throw new Error("Random int cannot be cast to number");return Number(e)}},Yo=class{constructor(t,e,r,i){this._storage=t;this._interactionState=e;this._transaction=r;this._contractTxId=i}async put(t,e){this.checkStorageAvailable(),await this._storage.put(new Jt(t,this._transaction.sortKey),e)}async get(t){this.checkStorageAvailable();let e=this._transaction.sortKey,r=await this._interactionState.getKV(this._contractTxId,new Jt(t,this._transaction.sortKey));return r??((await this._storage.getLessOrEqual(t,this._transaction.sortKey))?.cachedValue||null)}async del(t){this.checkStorageAvailable();let e=this._transaction.sortKey,r=await this._interactionState.delKV(this._contractTxId,new Jt(t,this._transaction.sortKey));if(r!=null)return r;await this._storage.del(new Jt(t,this._transaction.sortKey))}async keys(t){let e=this._transaction.sortKey;return await this._storage.keys(e,t)}async kvMap(t){let e=this._transaction.sortKey;return this._storage.kvMap(e,t)}async begin(){if(this._storage)return this._storage.begin()}async commit(){this._storage&&(this._transaction.dryRun?await this._storage.rollback():await this._storage.commit())}async rollback(){this._storage&&await this._storage.rollback()}open(){if(this._storage)return this._storage.open()}close(){if(this._storage)return this._storage.close()}checkStorageAvailable(){if(!this._storage)throw new Error("KV Storage not available")}};R();R();var zr=class{constructor(t,e){this.swGlobal=t;this.contractDefinition=e;this.assignReadContractState=this.assignReadContractState.bind(this),this.assignViewContractState=this.assignViewContractState.bind(this),this.assignWrite=this.assignWrite.bind(this),this.assignRefreshState=this.assignRefreshState.bind(this)}logger=dt.INST.create("ContractHandler");async dispose(){}assignWrite(t){this.swGlobal.contracts.write=async(e,r,i)=>{if(!t.evaluationOptions.internalWrites)throw new Error("Internal writes feature switched off. Change EvaluationOptions.internalWrites flag to 'true'");let o=i??t.evaluationOptions.throwOnInternalWriteError,a={from:this.contractDefinition.txId,to:e,input:r};this.logger.debug("swGlobal.write call:",a);let s=t.warp.contract(e,t.contract,{callingInteraction:this.swGlobal._activeTx,callType:"write"}),l=await s.applyInput(r,this.swGlobal._activeTx);this.logger.debug("Cache result?:",!this.swGlobal._activeTx.dry);let g=l.type!=="ok"&&o&&(!this.swGlobal._activeTx.dry||this.swGlobal._activeTx.dry&&this.swGlobal._activeTx.strict),v=g?`Internal write auto error for call [${JSON.stringify(a)}]: ${l.errorMessage}`:l.errorMessage,A=v?{...l.originalErrorMessages,[this.swGlobal._activeTx.id]:v}:l.originalErrorMessages;if(s.interactionState().update(s.txId(),{state:l.state,validity:{...l.originalValidity,[this.swGlobal._activeTx.id]:l.type=="ok"},errorMessages:A}),g)throw new Ee(l.type==="error"&&l.error?l.error:v);return l}}assignViewContractState(t){this.swGlobal.contracts.viewContractState=async(e,r)=>(this.logger.debug("swGlobal.viewContractState call:",{from:this.contractDefinition.txId,to:e,input:r}),await t.warp.contract(e,t.contract,{callingInteraction:this.swGlobal._activeTx,callType:"view"}).viewStateForTx(r,this.swGlobal._activeTx))}assignReadContractState(t,e){this.swGlobal.contracts.readContractState=async(r,i)=>{this.logger.debug("swGlobal.readContractState call:",{from:this.contractDefinition.txId,to:r,sortKey:e.sortKey,transaction:this.swGlobal.transaction.id});let{contract:o,warp:a}=t,l=await a.contract(r,o,{callingInteraction:e,callType:"read"}).readState(e.sortKey);if(l?.cachedValue?.errorMessages){let v=Reflect.ownKeys(l?.cachedValue?.errorMessages);if(v.length){let A=v[v.length-1],B=l?.cachedValue?.errorMessages[A];if(B.startsWith("[SkipUnsafeError]"))throw new Ee(B)}}return i?{state:_r(l.cachedValue.state),validity:l.cachedValue.validity,errorMessages:l.cachedValue.errorMessages}:_r(l.cachedValue.state)}}assignRefreshState(t){this.swGlobal.contracts.refreshState=async()=>t.contract.interactionState().get(this.swGlobal.contract.id)?.state}};var _c="__init",Oi=(n,t)=>{let e=new Error(t);throw e.name=n,e};var Bi=class extends zr{constructor(e,r,i){super(e,r);this.contractFunction=i}async handle(e,r,i){let{interaction:o,interactionTx:a}=i;return this.setupSwGlobal(i),this.enableInternalWrites(e,a),this.assertNotConstructorCall(o),await this.runContractFunction(e,o,r.state)}initState(e){}async maybeCallStateConstructor(e,r){if(this.contractDefinition.manifest?.evaluationOptions?.useConstructor){let i={input:{function:_c,args:e},caller:this.contractDefinition.owner,interactionType:"write"},o={owner:{address:r.caller,key:null},sortKey:Sn},a={interaction:i,interactionTx:o};this.setupSwGlobal(a);let s=this.configureSwGlobalForConstructor(),l=await this.runContractFunction(r,i,{});if(s(),l.type!=="ok")throw new Error(`Exception while calling constructor: ${JSON.stringify(i)}:
${l.errorMessage}`);return l.state}else return e}assertNotConstructorCall(e){if(this.contractDefinition.manifest?.evaluationOptions?.useConstructor&&e.input.function===_c)throw new Error(`You have enabled {useConstructor: true} option, so you can't call function ${_c}`)}configureSwGlobalForConstructor(){let e=a=>({get:(s,l)=>Oi("ConstructorError",`SmartWeave.${a}.${String(l)} is not accessible in constructor context`)});this.swGlobal.contracts.readContractState=()=>Oi("ConstructorError","Internal writes feature is not available in constructor"),this.swGlobal.contracts.viewContractState=()=>Oi("ConstructorError","Internal writes feature is not available in constructor"),this.swGlobal.contracts.refreshState=()=>Oi("ConstructorError","Internal writes feature is not available in constructor"),this.swGlobal.contracts.write=()=>Oi("ConstructorError","Internal writes feature is not available in constructor");let r=new Cn(this.swGlobal);this.swGlobal.block=new Proxy(this.swGlobal.block,e("block"));let i=new In(this.swGlobal);this.swGlobal.vrf=new Proxy(this.swGlobal.vrf,e("vrf"));let o=new xn(this.swGlobal);return this.swGlobal.transaction=new Proxy(this.swGlobal.vrf,e("transaction")),()=>{this.swGlobal.block=r,this.swGlobal.vrf=i,this.swGlobal.transaction=o}}async runContractFunction(e,r,i){let o=_r(i),{timeoutId:a,timeoutPromise:s}=As(e.evaluationOptions.maxInteractionEvaluationTimeSeconds);try{await this.swGlobal.kv.open(),await this.swGlobal.kv.begin();let l=await Promise.race([s,this.contractFunction(o,r)]);if(l&&(l.state!==void 0||l.result!==void 0))return await this.swGlobal.kv.commit(),{type:"ok",result:l.result,state:l.state||o};throw new Error(`Unexpected result from contract: ${JSON.stringify(l)}`)}catch(l){switch(await this.swGlobal.kv.rollback(),l.name){case"ContractError":return{type:"error",errorMessage:l.message,state:i,result:null};case"ConstructorError":throw Error(`ConstructorError: ${l.message}`);default:return{type:"exception",errorMessage:`${l&&l.stack||l&&l.message||l}`,state:i,result:null}}}finally{a&&clearTimeout(a),await this.swGlobal.kv.close()}}setupSwGlobal({interaction:e,interactionTx:r}){this.swGlobal._activeTx=r,this.swGlobal.caller=e.caller}enableInternalWrites(e,r){this.assignReadContractState(e,r),this.assignViewContractState(e),this.assignWrite(e),this.assignRefreshState(e)}};R();var Ri=class extends zr{constructor(e,r,i){super(e,r);this.wasmExports=i}async handle(e,r,i){try{let{interaction:o,interactionTx:a}=i;this.swGlobal._activeTx=a,this.swGlobal.caller=o.caller,this.swGlobal.gasLimit=e.evaluationOptions.gasLimit,this.swGlobal.gasUsed=0,this.assignReadContractState(e,a),this.assignViewContractState(e),this.assignWrite(e),await this.swGlobal.kv.open(),await this.swGlobal.kv.begin();let s=await this.doHandle(o);return i.interaction.interactionType==="view"?await this.swGlobal.kv.rollback():await this.swGlobal.kv.commit(),{type:"ok",result:s,state:this.doGetCurrentState(),gasUsed:this.swGlobal.gasUsed}}catch(o){await this.swGlobal.kv.rollback();let a={errorMessage:o.message,state:r.state,result:null};return o instanceof Ee?{...a,error:o.error,type:"error"}:{...a,type:"exception"}}finally{await this.swGlobal.kv.close()}}initState(e){switch(this.contractDefinition.srcWasmLang){case"rust":{if("initStateLegacy"in this.wasmExports){this.wasmExports.initStateLegacy(e);return}let r=this.wasmExports.initState(e);if(r)throw new Error(r);return}default:throw new Error(`Support for ${this.contractDefinition.srcWasmLang} not implemented yet.`)}}async doHandleLegacy(e){let r=await this.wasmExports.handle(e.input);if(!r)return;if(Object.prototype.hasOwnProperty.call(r,"Ok"))return r.Ok;let i,o="";throw typeof r.Err=="string"||r.Err instanceof String?i=r.Err:"kind"in r.Err?(i=r.Err.kind,o="data"in r.Err?" "+r.Err.data:""):(i=Object.keys(r.Err)[0],o=" "+r.Err[i]),i=="RuntimeError"?new Error(`[RE:RE]${o}`):new Ee(`[CE:${i}${o}]`)}async doHandle(e){switch(this.contractDefinition.srcWasmLang){case"rust":{if("handle"in this.wasmExports)return await this.doHandleLegacy(e);let r=e.interactionType==="write"?await this.wasmExports.warpContractWrite(e.input):await this.wasmExports.warpContractView(e.input);if(!r)return;if(r.type==="ok")return r.result;throw this.logger.error("Error from rust",r),r.type==="error"?new Ee(r.error):new Error(r.errorMessage)}default:throw new Error(`Support for ${this.contractDefinition.srcWasmLang} not implemented yet.`)}}async maybeCallStateConstructor(e,r){if(this.contractDefinition.manifest?.evaluationOptions?.useConstructor)throw Error("Constructor is not implemented for wasm");return e}doGetCurrentState(){switch(this.contractDefinition.srcWasmLang){case"rust":return this.wasmExports.currentState();default:throw new Error(`Support for ${this.contractDefinition.srcWasmLang} not implemented yet.`)}}};R();function Xo(n,t){let e=n.trim().split(`
`),r=e[0],i=e[e.length-1];return(/\(\s*\(\)\s*=>\s*{/g.test(r)||/\s*\(\s*function\s*\(\)\s*{/g.test(r))&&/}\s*\)\s*\(\)\s*;/g.test(i)&&(e.shift(),e.pop(),n=e.join(`
`)),n=n.replace(/export\s+async\s+function\s+handle/gmu,"async function handle").replace(/export\s+function\s+handle/gmu,"function handle"),t?`
    ${n}
    module.exports = handle;`:`
    const window=void 0,document=void 0,Function=void 0,eval=void 0,globalThis=void 0;
    const [SmartWeave, BigNumber, logger${qr()?", Buffer, atob, btoa":""}] = arguments;
    class ContractError extends Error { constructor(message) { super(message); this.name = 'ContractError' } };
    function ContractAssert(cond, message) { if (!cond) throw new ContractError(message) };
    ${n};
    return handle;
  `}function xy(n,t){try{let e=Xo(n,!1);return new Function(e)(),!0}catch(e){return t?.error(e),!1}}var th=zt(br()),Zf=Ls(),Ee=class extends Error{constructor(e,r){super(e.toString());this.error=e;this.subtype=r;this.name="ContractError"}},Pi=class{constructor(t){this.arweave=t}logger=dt.INST.create("HandlerExecutorFactory");async create(t,e,r,i){if(r.hasPlugin("contract-blacklist")){let l=r.loadPlugin("contract-blacklist"),g=!1;try{g=await l.process(t.txId)}catch(v){this.logger.error(v)}if(g==!0)throw new Ee(`[SkipUnsafeError] Skipping evaluation of the blacklisted contract ${t.txId}.`,"blacklistedSkip")}let o=null;e.useKVStorage&&(o=r.kvStorageFactory(t.txId));let a=new Li(this.arweave,{id:t.txId,owner:t.owner},e,i,o);if(r.matchPlugins("^smartweave-extension-").forEach(l=>{r.loadPlugin(l).process(a.extensions)}),t.contractType=="wasm"){this.logger.info("Creating handler for wasm contract",t.txId);let l=Ct.measure(),g,v=null,A=Cy(t.srcBinary);switch(t.srcWasmLang){case"rust":{let B={exports:null,modifiedExports:{wasm_bindgen__convert__closures__invoke2_mut__:null,_dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__:null}},m=await Iy(A,t.srcBinary),E=WebAssembly.Module.exports(m).filter(j=>j.kind==="global"&&j.name.startsWith("__WARP_CONTRACTS_VERSION_")).map(j=>j.name).shift()||"__WARP_CONTRACTS_VERSION_LEGACY",N=WebAssembly.Module.imports(m).filter(j=>j.module==="__wbindgen_placeholder__").map(j=>j.name),{imports:D,exports:K}=bc(a,N,B,t.metadata.dtor,E);v=K,g=await WebAssembly.instantiate(m,D),B.exports=g.exports,Object.keys(g.exports).forEach(j=>{j.startsWith("wasm_bindgen__convert__closures__invoke2_mut__")&&(B.modifiedExports.wasm_bindgen__convert__closures__invoke2_mut__=g.exports[j]),j.startsWith("_dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__")&&(B.modifiedExports._dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__=g.exports[j])});break}default:throw new Error(`Support for ${t.srcWasmLang} not implemented yet.`)}return this.logger.info(`WASM ${t.srcWasmLang} handler created in ${l.elapsed()}`),new Ri(a,t,v||g.exports)}else{let l=Xo(t.src,r.hasPlugin("vm2"));if(l.includes("unsafeClient"))switch(e.unsafeClient){case"allow":{this.logger.warn(`Reading unsafe contract ${t.txId}, evaluation is non-deterministic!`);break}case"throw":throw new Error(`[SkipUnsafeError] Using unsafeClient is not allowed by default. Use EvaluationOptions.unsafeClient flag to evaluate ${t.txId}.`);case"skip":throw new Ee(`[SkipUnsafeError] Skipping evaluation of the unsafe contract ${t.txId}.`,"unsafeClientSkip");default:throw new Error(`Unknown unsafeClient setting ${e.unsafeClient}`)}if(!e.allowBigInt&&l.includes("BigInt"))throw new Error("Using BigInt is not allowed by default. Use EvaluationOptions.allowBigInt flag.");if(r.hasPlugin("vm2"))return r.loadPlugin("vm2").process({normalizedSource:l,swGlobal:a,logger:this.logger,contractDefinition:t});if(r.hasPlugin("ivm-handler-api"))return r.loadPlugin("ivm-handler-api").process({contractSource:t.src,evaluationOptions:e,arweave:this.arweave,swGlobal:a,contractDefinition:t});{let g=new Function(l),v=qr()?g(a,Zf,dt.INST.create(a.contract.id),th.Buffer,atob,btoa):g(a,Zf,dt.INST.create(a.contract.id));return new Bi(a,t,v)}}}};function Cy(n){let t={status:200,statusText:"OK",headers:{"Content-Type":"application/wasm"}};return new Response(n,t)}async function Iy(n,t){return WebAssembly.compileStreaming?await WebAssembly.compileStreaming(n):await WebAssembly.compile(t)}R();var eh=zt(br()),Jr=class{constructor(t,e,r=null){this.contractTxId=t;this.depth=e;this.innerCallType=r;this.id=eh.Crypto.randomUUID()}interactions={};id;addInteractionData(t){let{interaction:e,interactionTx:r}=t,i=An.create(new Zo(r.id,r.sortKey,r.block.height,r.block.timestamp,e?.caller,e?.input.function,e?.input,r.dry,{}));return this.interactions[r.id]=i,i}getInteraction(t){return this.interactions[t]}print(){return JSON.stringify(this,null,2)}},An=class{constructor(t){this.interactionInput=t}interactionOutput;static create(t){return new An(t)}update(t){this.interactionOutput=t}},Zo=class{constructor(t,e,r,i,o,a,s,l,g={}){this.txId=t;this.sortKey=e;this.blockHeight=r;this.blockTimestamp=i;this.caller=o;this.functionName=a;this.functionArguments=s;this.dryWrite=l;this.foreignContractCalls=g}},Ec=class{constructor(t,e,r,i,o="",a){this.cacheHit=t;this.outputState=e;this.executionTime=r;this.valid=i;this.errorMessage=o;this.gasUsed=a}};R();var da=zt(Go());R();R();var Sc=(t=>(t.CONTRACT_NOT_FOUND="CONTRACT_NOT_FOUND",t))(Sc||{}),Ni=class extends Error{type;otherInfo;constructor(t,e={}){e.message?super(e.message):super(),this.type=t,this.otherInfo=e}getType(){return this.type}};function Ay(n){if(!n)return!1;let t=rh(n);return n.evolve!==void 0||t.has("evolve")}var ir=class{logger=dt.INST.create("Evolve");constructor(){this.modify=this.modify.bind(this)}async modify(t,e){let{definitionLoader:r,executorFactory:i}=e.warp,o=e.contractDefinition.txId,a=ir.evolvedSrcTxId(t),s=e.contractDefinition.srcTxId;if(a&&s!==a)try{this.logger.info("Evolving to: ",a);let l=await r.load(o,a),g=await i.create(l,e.evaluationOptions,e.warp,e.contract.interactionState());return e.contractDefinition=l,e.handler=g,e.handler.initState(t),this.logger.debug("evolved to:",{evolve:a,newSrcTxId:e.contractDefinition.srcTxId,currentSrcTxId:s,contract:e.contractDefinition.txId}),e}catch(l){throw l.name==="ContractError"&&l.subtype==="unsafeClientSkip"?l:new Ni("CONTRACT_NOT_FOUND",{message:`Error while evolving ${o} from ${s} to ${a}: ${l}`,requestedTxId:o})}return e}static evolvedSrcTxId(t){if(!Ay(t))return;let e=rh(t),r=t.evolve||e.get("evolve"),i=t.canEvolve||e.get("canEvolve");if(i==null&&(i=!0),r&&/[a-z0-9_-]{43}/i.test(r)&&i)return r}};function rh(n){let t=new Map;return n.settings&&(ky(n.settings)?t=new Map(n.settings):Ly(n.settings)&&(t=new Map(Object.entries(n.settings)))),t}function ky(n){return n==null?!1:typeof n[Symbol.iterator]=="function"}function Ly(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}R();R();R();var Lc=zt(sh(),1),lE=Lc.default.configure;var ch=Lc.default;R();async function ea(n,t,e,r,i,o="",a="0",s=!1,l,g){let v={data:Math.random().toString().slice(-4)};o&&o.length&&(v.target=o.toString(),a&&+a>0&&(v.quantity=a.toString())),s&&(v.reward="0",v.last_tx="p7vc1iSP6bvH_fCeUFa9LqoV5qiyW-jdEKouAT0XMoSwrNraB9mgpi29Q10waEpO"),g&&g.length&&(v.reward=g);let A=await n.createTransaction(v);return ra(e,r,l,i).forEach(m=>A.addTag(m.name,m.value)),t&&await t(A),A}function Oc(n,t,e){let i=new Ht().decodeTags(n);return{id:n.id,owner:{address:t,key:""},recipient:n.target,tags:i,fee:{winston:n.reward,ar:""},quantity:{winston:n.quantity,ar:""},block:{id:e.indep_hash,height:e.height,timestamp:e.timestamp,previous:null},dry:!0,anchor:null,signature:null,data:null,parent:null,bundledIn:null}}function ra(n,t,e,r){let i=[];if(r&&r.length)for(let o of r)i.push(new jt(o.name.toString(),o.value.toString()));return i.push(new jt(kt.APP_NAME,"SmartWeaveAction")),i.push(new jt(kt.APP_VERSION,"0.3.0")),i.push(new jt(kt.SDK,"Warp")),i.push(new jt(kt.CONTRACT_TX_ID,n)),i.push(new jt(kt.INPUT,JSON.stringify(t))),e&&i.push(new jt(pt.WARP_TESTNET,"1.0.0")),i}R();var xr={target:"",winstonQty:"0"},Wy=["node1","node2"];R();var Ui=class{eval(t){let e=[];return Object.keys(t.interactions).forEach(r=>{let i=t.interactions[r];this.evalForeignCalls(t.contractTxId,i,e)}),e}evalForeignCalls(t,e,r){Object.keys(e.interactionInput.foreignContractCalls).forEach(i=>{let o=e.interactionInput.foreignContractCalls[i];o.innerCallType=="write"&&Object.keys(o.interactions).forEach(a=>{let s=o.interactions[a];s.interactionInput.dryWrite&&!r.includes(o.contractTxId)&&t!==o.contractTxId&&r.push(o.contractTxId),this.evalForeignCalls(t,s,r)})})}};R();R();var Dy=Object.create,oa=Object.defineProperty,My=Object.getOwnPropertyDescriptor,$y=Object.getOwnPropertyNames,Fy=Object.getPrototypeOf,Ky=Object.prototype.hasOwnProperty,Vy=(n,t,e)=>t in n?oa(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,Lt=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports),Gy=(n,t)=>{for(var e in t)oa(n,e,{get:t[e],enumerable:!0})},qy=(n,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of $y(t))!Ky.call(n,i)&&i!==e&&oa(n,i,{get:()=>t[i],enumerable:!(r=My(t,i))||r.enumerable});return n},ar=(n,t,e)=>(e=n!=null?Dy(Fy(n)):{},qy(t||!n||!n.__esModule?oa(e,"default",{value:n,enumerable:!0}):e,n)),na=(n,t,e)=>(Vy(n,typeof t!="symbol"?t+"":t,e),e),jy=Lt(n=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});function t(e){var r=4,i=e.length,o=i%r;if(!o)return e;var a=i,s=r-o,l=i+s,g=Q.Buffer.alloc(l);for(g.write(e);s--;)g.write("=",a++);return g.toString()}n.default=t}),Hy=Lt(n=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=jy();function e(l,g){return g===void 0&&(g="utf8"),Q.Buffer.isBuffer(l)?o(l.toString("base64")):o(Q.Buffer.from(l,g).toString("base64"))}function r(l,g){return g===void 0&&(g="utf8"),Q.Buffer.from(i(l),"base64").toString(g)}function i(l){return l=l.toString(),t.default(l).replace(/\-/g,"+").replace(/_/g,"/")}function o(l){return l.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function a(l){return Q.Buffer.from(i(l),"base64")}var s=e;s.encode=e,s.decode=r,s.toBase64=i,s.fromBase64=o,s.toBuffer=a,n.default=s}),aa=Lt((n,t)=>{t.exports=Hy().default,t.exports.default=t.exports}),lh=Lt(n=>{"use strict";n.byteLength=l,n.toByteArray=v,n.fromByteArray=m;var t=[],e=[],r=typeof Uint8Array<"u"?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(o=0,a=i.length;o<a;++o)t[o]=i[o],e[i.charCodeAt(o)]=o;var o,a;e["-".charCodeAt(0)]=62,e["_".charCodeAt(0)]=63;function s(E){var N=E.length;if(N%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var D=E.indexOf("=");D===-1&&(D=N);var K=D===N?0:4-D%4;return[D,K]}function l(E){var N=s(E),D=N[0],K=N[1];return(D+K)*3/4-K}function g(E,N,D){return(N+D)*3/4-D}function v(E){var N,D=s(E),K=D[0],X=D[1],j=new r(g(E,K,X)),nt=0,U=X>0?K-4:K,M;for(M=0;M<U;M+=4)N=e[E.charCodeAt(M)]<<18|e[E.charCodeAt(M+1)]<<12|e[E.charCodeAt(M+2)]<<6|e[E.charCodeAt(M+3)],j[nt++]=N>>16&255,j[nt++]=N>>8&255,j[nt++]=N&255;return X===2&&(N=e[E.charCodeAt(M)]<<2|e[E.charCodeAt(M+1)]>>4,j[nt++]=N&255),X===1&&(N=e[E.charCodeAt(M)]<<10|e[E.charCodeAt(M+1)]<<4|e[E.charCodeAt(M+2)]>>2,j[nt++]=N>>8&255,j[nt++]=N&255),j}function A(E){return t[E>>18&63]+t[E>>12&63]+t[E>>6&63]+t[E&63]}function B(E,N,D){for(var K,X=[],j=N;j<D;j+=3)K=(E[j]<<16&16711680)+(E[j+1]<<8&65280)+(E[j+2]&255),X.push(A(K));return X.join("")}function m(E){for(var N,D=E.length,K=D%3,X=[],j=16383,nt=0,U=D-K;nt<U;nt+=j)X.push(B(E,nt,nt+j>U?U:nt+j));return K===1?(N=E[D-1],X.push(t[N>>2]+t[N<<4&63]+"==")):K===2&&(N=(E[D-2]<<8)+E[D-1],X.push(t[N>>10]+t[N>>4&63]+t[N<<2&63]+"=")),X.join("")}}),Ve=Lt(n=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.b64UrlDecode=n.b64UrlEncode=n.bufferTob64Url=n.bufferTob64=n.b64UrlToBuffer=n.stringToB64Url=n.stringToBuffer=n.bufferToString=n.b64UrlToString=n.concatBuffers=void 0;var t=lh();function e(B){let m=0;for(let D=0;D<B.length;D++)m+=B[D].byteLength;let E=new Uint8Array(m),N=0;E.set(new Uint8Array(B[0]),N),N+=B[0].byteLength;for(let D=1;D<B.length;D++)E.set(new Uint8Array(B[D]),N),N+=B[D].byteLength;return E}n.concatBuffers=e;function r(B){let m=s(B);return i(m)}n.b64UrlToString=r;function i(B){return new TextDecoder("utf-8",{fatal:!0}).decode(B)}n.bufferToString=i;function o(B){return new TextEncoder().encode(B)}n.stringToBuffer=o;function a(B){return g(o(B))}n.stringToB64Url=a;function s(B){return new Uint8Array(t.toByteArray(A(B)))}n.b64UrlToBuffer=s;function l(B){return t.fromByteArray(new Uint8Array(B))}n.bufferTob64=l;function g(B){return v(l(B))}n.bufferTob64Url=g;function v(B){return B.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}n.b64UrlEncode=v;function A(B){B=B.replace(/\-/g,"+").replace(/\_/g,"/");let m;return B.length%4==0?m=0:m=4-B.length%4,B.concat("=".repeat(m))}n.b64UrlDecode=A}),fh=Lt(n=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=Ve(),e=class{keyLength=4096;publicExponent=65537;hashAlgorithm="sha256";driver;constructor(){if(!this.detectWebCrypto())throw new Error("SubtleCrypto not available!");this.driver=crypto.subtle}async generateJWK(){let r=await this.driver.generateKey({name:"RSA-PSS",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign"]),i=await this.driver.exportKey("jwk",r.privateKey);return{kty:i.kty,e:i.e,n:i.n,d:i.d,p:i.p,q:i.q,dp:i.dp,dq:i.dq,qi:i.qi}}async sign(r,i,{saltLength:o}={}){let a=await this.driver.sign({name:"RSA-PSS",saltLength:32},await this.jwkToCryptoKey(r),i);return new Uint8Array(a)}async hash(r,i="SHA-256"){let o=await this.driver.digest(i,r);return new Uint8Array(o)}async verify(r,i,o){let a={kty:"RSA",e:"AQAB",n:r},s=await this.jwkToPublicCryptoKey(a),l=await this.driver.digest("SHA-256",i),g=await this.driver.verify({name:"RSA-PSS",saltLength:0},s,o,i),v=await this.driver.verify({name:"RSA-PSS",saltLength:32},s,o,i),A=await this.driver.verify({name:"RSA-PSS",saltLength:Math.ceil((s.algorithm.modulusLength-1)/8)-l.byteLength-2},s,o,i);return g||v||A}async jwkToCryptoKey(r){return this.driver.importKey("jwk",r,{name:"RSA-PSS",hash:{name:"SHA-256"}},!1,["sign"])}async jwkToPublicCryptoKey(r){return this.driver.importKey("jwk",r,{name:"RSA-PSS",hash:{name:"SHA-256"}},!1,["verify"])}detectWebCrypto(){if(typeof crypto>"u")return!1;let r=crypto?.subtle;return r===void 0?!1:["generateKey","importKey","exportKey","digest","sign"].every(i=>typeof r[i]=="function")}async encrypt(r,i,o){let a=await this.driver.importKey("raw",typeof i=="string"?t.stringToBuffer(i):i,{name:"PBKDF2",length:32},!1,["deriveKey"]),s=await this.driver.deriveKey({name:"PBKDF2",salt:o?t.stringToBuffer(o):t.stringToBuffer("salt"),iterations:1e5,hash:"SHA-256"},a,{name:"AES-CBC",length:256},!1,["encrypt","decrypt"]),l=new Uint8Array(16);crypto.getRandomValues(l);let g=await this.driver.encrypt({name:"AES-CBC",iv:l},s,r);return t.concatBuffers([l,g])}async decrypt(r,i,o){let a=await this.driver.importKey("raw",typeof i=="string"?t.stringToBuffer(i):i,{name:"PBKDF2",length:32},!1,["deriveKey"]),s=await this.driver.deriveKey({name:"PBKDF2",salt:o?t.stringToBuffer(o):t.stringToBuffer("salt"),iterations:1e5,hash:"SHA-256"},a,{name:"AES-CBC",length:256},!1,["encrypt","decrypt"]),l=r.slice(0,16),g=await this.driver.decrypt({name:"AES-CBC",iv:l},s,r.slice(16));return t.concatBuffers([g])}};n.default=e}),Qy=Lt((n,t)=>{(function(e){"use strict";var r,i=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,o=Math.ceil,a=Math.floor,s="[BigNumber Error] ",l=s+"Number primitive has more than 15 significant digits: ",g=1e14,v=14,A=9007199254740991,B=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],m=1e7,E=1e9;function N(q){var G,W,at,V=rt.prototype={constructor:rt,toString:null,valueOf:null},ot=new rt(1),ct=20,ut=4,vt=-7,yt=21,it=-1e7,Ot=1e7,Dt=!1,oe=1,bt=0,Bt={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xA0",suffix:""},tt="0123456789abcdefghijklmnopqrstuvwxyz",de=!0;function rt(h,w){var p,C,x,b,I,_,S,L,f=this;if(!(f instanceof rt))return new rt(h,w);if(w==null){if(h&&h._isBigNumber===!0){f.s=h.s,!h.c||h.e>Ot?f.c=f.e=null:h.e<it?f.c=[f.e=0]:(f.e=h.e,f.c=h.c.slice());return}if((_=typeof h=="number")&&h*0==0){if(f.s=1/h<0?(h=-h,-1):1,h===~~h){for(b=0,I=h;I>=10;I/=10,b++);b>Ot?f.c=f.e=null:(f.e=b,f.c=[h]);return}L=String(h)}else{if(!i.test(L=String(h)))return at(f,L,_);f.s=L.charCodeAt(0)==45?(L=L.slice(1),-1):1}(b=L.indexOf("."))>-1&&(L=L.replace(".","")),(I=L.search(/e/i))>0?(b<0&&(b=I),b+=+L.slice(I+1),L=L.substring(0,I)):b<0&&(b=L.length)}else{if(j(w,2,tt.length,"Base"),w==10&&de)return f=new rt(h),T(f,ct+f.e+1,ut);if(L=String(h),_=typeof h=="number"){if(h*0!=0)return at(f,L,_,w);if(f.s=1/h<0?(L=L.slice(1),-1):1,rt.DEBUG&&L.replace(/^0\.0*|\./,"").length>15)throw Error(l+h)}else f.s=L.charCodeAt(0)===45?(L=L.slice(1),-1):1;for(p=tt.slice(0,w),b=I=0,S=L.length;I<S;I++)if(p.indexOf(C=L.charAt(I))<0){if(C=="."){if(I>b){b=S;continue}}else if(!x&&(L==L.toUpperCase()&&(L=L.toLowerCase())||L==L.toLowerCase()&&(L=L.toUpperCase()))){x=!0,I=-1,b=0;continue}return at(f,String(h),_,w)}_=!1,L=W(L,w,10,f.s),(b=L.indexOf("."))>-1?L=L.replace(".",""):b=L.length}for(I=0;L.charCodeAt(I)===48;I++);for(S=L.length;L.charCodeAt(--S)===48;);if(L=L.slice(I,++S)){if(S-=I,_&&rt.DEBUG&&S>15&&(h>A||h!==a(h)))throw Error(l+f.s*h);if((b=b-I-1)>Ot)f.c=f.e=null;else if(b<it)f.c=[f.e=0];else{if(f.e=b,f.c=[],I=(b+1)%v,b<0&&(I+=v),I<S){for(I&&f.c.push(+L.slice(0,I)),S-=v;I<S;)f.c.push(+L.slice(I,I+=v));I=v-(L=L.slice(I)).length}else I-=S;for(;I--;L+="0");f.c.push(+L)}}else f.c=[f.e=0]}rt.clone=N,rt.ROUND_UP=0,rt.ROUND_DOWN=1,rt.ROUND_CEIL=2,rt.ROUND_FLOOR=3,rt.ROUND_HALF_UP=4,rt.ROUND_HALF_DOWN=5,rt.ROUND_HALF_EVEN=6,rt.ROUND_HALF_CEIL=7,rt.ROUND_HALF_FLOOR=8,rt.EUCLID=9,rt.config=rt.set=function(h){var w,p;if(h!=null)if(typeof h=="object"){if(h.hasOwnProperty(w="DECIMAL_PLACES")&&(p=h[w],j(p,0,E,w),ct=p),h.hasOwnProperty(w="ROUNDING_MODE")&&(p=h[w],j(p,0,8,w),ut=p),h.hasOwnProperty(w="EXPONENTIAL_AT")&&(p=h[w],p&&p.pop?(j(p[0],-E,0,w),j(p[1],0,E,w),vt=p[0],yt=p[1]):(j(p,-E,E,w),vt=-(yt=p<0?-p:p))),h.hasOwnProperty(w="RANGE"))if(p=h[w],p&&p.pop)j(p[0],-E,-1,w),j(p[1],1,E,w),it=p[0],Ot=p[1];else if(j(p,-E,E,w),p)it=-(Ot=p<0?-p:p);else throw Error(s+w+" cannot be zero: "+p);if(h.hasOwnProperty(w="CRYPTO"))if(p=h[w],p===!!p)if(p)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))Dt=p;else throw Dt=!p,Error(s+"crypto unavailable");else Dt=p;else throw Error(s+w+" not true or false: "+p);if(h.hasOwnProperty(w="MODULO_MODE")&&(p=h[w],j(p,0,9,w),oe=p),h.hasOwnProperty(w="POW_PRECISION")&&(p=h[w],j(p,0,E,w),bt=p),h.hasOwnProperty(w="FORMAT"))if(p=h[w],typeof p=="object")Bt=p;else throw Error(s+w+" not an object: "+p);if(h.hasOwnProperty(w="ALPHABET"))if(p=h[w],typeof p=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(p))de=p.slice(0,10)=="0123456789",tt=p;else throw Error(s+w+" invalid: "+p)}else throw Error(s+"Object expected: "+h);return{DECIMAL_PLACES:ct,ROUNDING_MODE:ut,EXPONENTIAL_AT:[vt,yt],RANGE:[it,Ot],CRYPTO:Dt,MODULO_MODE:oe,POW_PRECISION:bt,FORMAT:Bt,ALPHABET:tt}},rt.isBigNumber=function(h){if(!h||h._isBigNumber!==!0)return!1;if(!rt.DEBUG)return!0;var w,p,C=h.c,x=h.e,b=h.s;t:if({}.toString.call(C)=="[object Array]"){if((b===1||b===-1)&&x>=-E&&x<=E&&x===a(x)){if(C[0]===0){if(x===0&&C.length===1)return!0;break t}if(w=(x+1)%v,w<1&&(w+=v),String(C[0]).length==w){for(w=0;w<C.length;w++)if(p=C[w],p<0||p>=g||p!==a(p))break t;if(p!==0)return!0}}}else if(C===null&&x===null&&(b===null||b===1||b===-1))return!0;throw Error(s+"Invalid BigNumber: "+h)},rt.maximum=rt.max=function(){return Mt(arguments,V.lt)},rt.minimum=rt.min=function(){return Mt(arguments,V.gt)},rt.random=function(){var h=9007199254740992,w=Math.random()*h&2097151?function(){return a(Math.random()*h)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(p){var C,x,b,I,_,S=0,L=[],f=new rt(ot);if(p==null?p=ct:j(p,0,E),I=o(p/v),Dt)if(crypto.getRandomValues){for(C=crypto.getRandomValues(new Uint32Array(I*=2));S<I;)_=C[S]*131072+(C[S+1]>>>11),_>=9e15?(x=crypto.getRandomValues(new Uint32Array(2)),C[S]=x[0],C[S+1]=x[1]):(L.push(_%1e14),S+=2);S=I/2}else if(crypto.randomBytes){for(C=crypto.randomBytes(I*=7);S<I;)_=(C[S]&31)*281474976710656+C[S+1]*1099511627776+C[S+2]*4294967296+C[S+3]*16777216+(C[S+4]<<16)+(C[S+5]<<8)+C[S+6],_>=9e15?crypto.randomBytes(7).copy(C,S):(L.push(_%1e14),S+=7);S=I/7}else throw Dt=!1,Error(s+"crypto unavailable");if(!Dt)for(;S<I;)_=w(),_<9e15&&(L[S++]=_%1e14);for(I=L[--S],p%=v,I&&p&&(_=B[v-p],L[S]=a(I/_)*_);L[S]===0;L.pop(),S--);if(S<0)L=[b=0];else{for(b=-1;L[0]===0;L.splice(0,1),b-=v);for(S=1,_=L[0];_>=10;_/=10,S++);S<v&&(b-=v-S)}return f.e=b,f.c=L,f}}(),rt.sum=function(){for(var h=1,w=arguments,p=new rt(w[0]);h<w.length;)p=p.plus(w[h++]);return p},W=function(){var h="0123456789";function w(p,C,x,b){for(var I,_=[0],S,L=0,f=p.length;L<f;){for(S=_.length;S--;_[S]*=C);for(_[0]+=b.indexOf(p.charAt(L++)),I=0;I<_.length;I++)_[I]>x-1&&(_[I+1]==null&&(_[I+1]=0),_[I+1]+=_[I]/x|0,_[I]%=x)}return _.reverse()}return function(p,C,x,b,I){var _,S,L,f,y,O,F,Z,st=p.indexOf("."),c=ct,u=ut;for(st>=0&&(f=bt,bt=0,p=p.replace(".",""),Z=new rt(C),O=Z.pow(p.length-st),bt=f,Z.c=w(M(K(O.c),O.e,"0"),10,x,h),Z.e=Z.c.length),F=w(p,C,x,I?(_=tt,h):(_=h,tt)),L=f=F.length;F[--f]==0;F.pop());if(!F[0])return _.charAt(0);if(st<0?--L:(O.c=F,O.e=L,O.s=b,O=G(O,Z,c,u,x),F=O.c,y=O.r,L=O.e),S=L+c+1,st=F[S],f=x/2,y=y||S<0||F[S+1]!=null,y=u<4?(st!=null||y)&&(u==0||u==(O.s<0?3:2)):st>f||st==f&&(u==4||y||u==6&&F[S-1]&1||u==(O.s<0?8:7)),S<1||!F[0])p=y?M(_.charAt(1),-c,_.charAt(0)):_.charAt(0);else{if(F.length=S,y)for(--x;++F[--S]>x;)F[S]=0,S||(++L,F=[1].concat(F));for(f=F.length;!F[--f];);for(st=0,p="";st<=f;p+=_.charAt(F[st++]));p=M(p,L,_.charAt(0))}return p}}(),G=function(){function h(C,x,b){var I,_,S,L,f=0,y=C.length,O=x%m,F=x/m|0;for(C=C.slice();y--;)S=C[y]%m,L=C[y]/m|0,I=F*S+L*O,_=O*S+I%m*m+f,f=(_/b|0)+(I/m|0)+F*L,C[y]=_%b;return f&&(C=[f].concat(C)),C}function w(C,x,b,I){var _,S;if(b!=I)S=b>I?1:-1;else for(_=S=0;_<b;_++)if(C[_]!=x[_]){S=C[_]>x[_]?1:-1;break}return S}function p(C,x,b,I){for(var _=0;b--;)C[b]-=_,_=C[b]<x[b]?1:0,C[b]=_*I+C[b]-x[b];for(;!C[0]&&C.length>1;C.splice(0,1));}return function(C,x,b,I,_){var S,L,f,y,O,F,Z,st,c,u,d,P,$,H,et,gt,Et,lt=C.s==x.s?1:-1,mt=C.c,wt=x.c;if(!mt||!mt[0]||!wt||!wt[0])return new rt(!C.s||!x.s||(mt?wt&&mt[0]==wt[0]:!wt)?NaN:mt&&mt[0]==0||!wt?lt*0:lt/0);for(st=new rt(lt),c=st.c=[],L=C.e-x.e,lt=b+L+1,_||(_=g,L=D(C.e/v)-D(x.e/v),lt=lt/v|0),f=0;wt[f]==(mt[f]||0);f++);if(wt[f]>(mt[f]||0)&&L--,lt<0)c.push(1),y=!0;else{for(H=mt.length,gt=wt.length,f=0,lt+=2,O=a(_/(wt[0]+1)),O>1&&(wt=h(wt,O,_),mt=h(mt,O,_),gt=wt.length,H=mt.length),$=gt,u=mt.slice(0,gt),d=u.length;d<gt;u[d++]=0);Et=wt.slice(),Et=[0].concat(Et),et=wt[0],wt[1]>=_/2&&et++;do{if(O=0,S=w(wt,u,gt,d),S<0){if(P=u[0],gt!=d&&(P=P*_+(u[1]||0)),O=a(P/et),O>1)for(O>=_&&(O=_-1),F=h(wt,O,_),Z=F.length,d=u.length;w(F,u,Z,d)==1;)O--,p(F,gt<Z?Et:wt,Z,_),Z=F.length,S=1;else O==0&&(S=O=1),F=wt.slice(),Z=F.length;if(Z<d&&(F=[0].concat(F)),p(u,F,d,_),d=u.length,S==-1)for(;w(wt,u,gt,d)<1;)O++,p(u,gt<d?Et:wt,d,_),d=u.length}else S===0&&(O++,u=[0]);c[f++]=O,u[0]?u[d++]=mt[$]||0:(u=[mt[$]],d=1)}while(($++<H||u[0]!=null)&&lt--);y=u[0]!=null,c[0]||c.splice(0,1)}if(_==g){for(f=1,lt=c[0];lt>=10;lt/=10,f++);T(st,b+(st.e=f+L*v-1)+1,I,y)}else st.e=L,st.r=+y;return st}}();function pe(h,w,p,C){var x,b,I,_,S;if(p==null?p=ut:j(p,0,8),!h.c)return h.toString();if(x=h.c[0],I=h.e,w==null)S=K(h.c),S=C==1||C==2&&(I<=vt||I>=yt)?U(S,I):M(S,I,"0");else if(h=T(new rt(h),w,p),b=h.e,S=K(h.c),_=S.length,C==1||C==2&&(w<=b||b<=vt)){for(;_<w;S+="0",_++);S=U(S,b)}else if(w-=I,S=M(S,b,"0"),b+1>_){if(--w>0)for(S+=".";w--;S+="0");}else if(w+=b-_,w>0)for(b+1==_&&(S+=".");w--;S+="0");return h.s<0&&x?"-"+S:S}function Mt(h,w){for(var p,C=1,x=new rt(h[0]);C<h.length;C++)if(p=new rt(h[C]),p.s)w.call(x,p)&&(x=p);else{x=p;break}return x}function Nt(h,w,p){for(var C=1,x=w.length;!w[--x];w.pop());for(x=w[0];x>=10;x/=10,C++);return(p=C+p*v-1)>Ot?h.c=h.e=null:p<it?h.c=[h.e=0]:(h.e=p,h.c=w),h}at=function(){var h=/^(-?)0([xbo])(?=\w[\w.]*$)/i,w=/^([^.]+)\.$/,p=/^\.([^.]+)$/,C=/^-?(Infinity|NaN)$/,x=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(b,I,_,S){var L,f=_?I:I.replace(x,"");if(C.test(f))b.s=isNaN(f)?null:f<0?-1:1;else{if(!_&&(f=f.replace(h,function(y,O,F){return L=(F=F.toLowerCase())=="x"?16:F=="b"?2:8,!S||S==L?O:y}),S&&(L=S,f=f.replace(w,"$1").replace(p,"0.$1")),I!=f))return new rt(f,L);if(rt.DEBUG)throw Error(s+"Not a"+(S?" base "+S:"")+" number: "+I);b.s=null}b.c=b.e=null}}();function T(h,w,p,C){var x,b,I,_,S,L,f,y=h.c,O=B;if(y){t:{for(x=1,_=y[0];_>=10;_/=10,x++);if(b=w-x,b<0)b+=v,I=w,S=y[L=0],f=S/O[x-I-1]%10|0;else if(L=o((b+1)/v),L>=y.length)if(C){for(;y.length<=L;y.push(0));S=f=0,x=1,b%=v,I=b-v+1}else break t;else{for(S=_=y[L],x=1;_>=10;_/=10,x++);b%=v,I=b-v+x,f=I<0?0:S/O[x-I-1]%10|0}if(C=C||w<0||y[L+1]!=null||(I<0?S:S%O[x-I-1]),C=p<4?(f||C)&&(p==0||p==(h.s<0?3:2)):f>5||f==5&&(p==4||C||p==6&&(b>0?I>0?S/O[x-I]:0:y[L-1])%10&1||p==(h.s<0?8:7)),w<1||!y[0])return y.length=0,C?(w-=h.e+1,y[0]=O[(v-w%v)%v],h.e=-w||0):y[0]=h.e=0,h;if(b==0?(y.length=L,_=1,L--):(y.length=L+1,_=O[v-b],y[L]=I>0?a(S/O[x-I]%O[I])*_:0),C)for(;;)if(L==0){for(b=1,I=y[0];I>=10;I/=10,b++);for(I=y[0]+=_,_=1;I>=10;I/=10,_++);b!=_&&(h.e++,y[0]==g&&(y[0]=1));break}else{if(y[L]+=_,y[L]!=g)break;y[L--]=0,_=1}for(b=y.length;y[--b]===0;y.pop());}h.e>Ot?h.c=h.e=null:h.e<it&&(h.c=[h.e=0])}return h}function k(h){var w,p=h.e;return p===null?h.toString():(w=K(h.c),w=p<=vt||p>=yt?U(w,p):M(w,p,"0"),h.s<0?"-"+w:w)}return V.absoluteValue=V.abs=function(){var h=new rt(this);return h.s<0&&(h.s=1),h},V.comparedTo=function(h,w){return X(this,new rt(h,w))},V.decimalPlaces=V.dp=function(h,w){var p,C,x,b=this;if(h!=null)return j(h,0,E),w==null?w=ut:j(w,0,8),T(new rt(b),h+b.e+1,w);if(!(p=b.c))return null;if(C=((x=p.length-1)-D(this.e/v))*v,x=p[x])for(;x%10==0;x/=10,C--);return C<0&&(C=0),C},V.dividedBy=V.div=function(h,w){return G(this,new rt(h,w),ct,ut)},V.dividedToIntegerBy=V.idiv=function(h,w){return G(this,new rt(h,w),0,1)},V.exponentiatedBy=V.pow=function(h,w){var p,C,x,b,I,_,S,L,f,y=this;if(h=new rt(h),h.c&&!h.isInteger())throw Error(s+"Exponent not an integer: "+k(h));if(w!=null&&(w=new rt(w)),_=h.e>14,!y.c||!y.c[0]||y.c[0]==1&&!y.e&&y.c.length==1||!h.c||!h.c[0])return f=new rt(Math.pow(+k(y),_?h.s*(2-nt(h)):+k(h))),w?f.mod(w):f;if(S=h.s<0,w){if(w.c?!w.c[0]:!w.s)return new rt(NaN);C=!S&&y.isInteger()&&w.isInteger(),C&&(y=y.mod(w))}else{if(h.e>9&&(y.e>0||y.e<-1||(y.e==0?y.c[0]>1||_&&y.c[1]>=24e7:y.c[0]<8e13||_&&y.c[0]<=9999975e7)))return b=y.s<0&&nt(h)?-0:0,y.e>-1&&(b=1/b),new rt(S?1/b:b);bt&&(b=o(bt/v+2))}for(_?(p=new rt(.5),S&&(h.s=1),L=nt(h)):(x=Math.abs(+k(h)),L=x%2),f=new rt(ot);;){if(L){if(f=f.times(y),!f.c)break;b?f.c.length>b&&(f.c.length=b):C&&(f=f.mod(w))}if(x){if(x=a(x/2),x===0)break;L=x%2}else if(h=h.times(p),T(h,h.e+1,1),h.e>14)L=nt(h);else{if(x=+k(h),x===0)break;L=x%2}y=y.times(y),b?y.c&&y.c.length>b&&(y.c.length=b):C&&(y=y.mod(w))}return C?f:(S&&(f=ot.div(f)),w?f.mod(w):b?T(f,bt,ut,I):f)},V.integerValue=function(h){var w=new rt(this);return h==null?h=ut:j(h,0,8),T(w,w.e+1,h)},V.isEqualTo=V.eq=function(h,w){return X(this,new rt(h,w))===0},V.isFinite=function(){return!!this.c},V.isGreaterThan=V.gt=function(h,w){return X(this,new rt(h,w))>0},V.isGreaterThanOrEqualTo=V.gte=function(h,w){return(w=X(this,new rt(h,w)))===1||w===0},V.isInteger=function(){return!!this.c&&D(this.e/v)>this.c.length-2},V.isLessThan=V.lt=function(h,w){return X(this,new rt(h,w))<0},V.isLessThanOrEqualTo=V.lte=function(h,w){return(w=X(this,new rt(h,w)))===-1||w===0},V.isNaN=function(){return!this.s},V.isNegative=function(){return this.s<0},V.isPositive=function(){return this.s>0},V.isZero=function(){return!!this.c&&this.c[0]==0},V.minus=function(h,w){var p,C,x,b,I=this,_=I.s;if(h=new rt(h,w),w=h.s,!_||!w)return new rt(NaN);if(_!=w)return h.s=-w,I.plus(h);var S=I.e/v,L=h.e/v,f=I.c,y=h.c;if(!S||!L){if(!f||!y)return f?(h.s=-w,h):new rt(y?I:NaN);if(!f[0]||!y[0])return y[0]?(h.s=-w,h):new rt(f[0]?I:ut==3?-0:0)}if(S=D(S),L=D(L),f=f.slice(),_=S-L){for((b=_<0)?(_=-_,x=f):(L=S,x=y),x.reverse(),w=_;w--;x.push(0));x.reverse()}else for(C=(b=(_=f.length)<(w=y.length))?_:w,_=w=0;w<C;w++)if(f[w]!=y[w]){b=f[w]<y[w];break}if(b&&(x=f,f=y,y=x,h.s=-h.s),w=(C=y.length)-(p=f.length),w>0)for(;w--;f[p++]=0);for(w=g-1;C>_;){if(f[--C]<y[C]){for(p=C;p&&!f[--p];f[p]=w);--f[p],f[C]+=g}f[C]-=y[C]}for(;f[0]==0;f.splice(0,1),--L);return f[0]?Nt(h,f,L):(h.s=ut==3?-1:1,h.c=[h.e=0],h)},V.modulo=V.mod=function(h,w){var p,C,x=this;return h=new rt(h,w),!x.c||!h.s||h.c&&!h.c[0]?new rt(NaN):!h.c||x.c&&!x.c[0]?new rt(x):(oe==9?(C=h.s,h.s=1,p=G(x,h,0,3),h.s=C,p.s*=C):p=G(x,h,0,oe),h=x.minus(p.times(h)),!h.c[0]&&oe==1&&(h.s=x.s),h)},V.multipliedBy=V.times=function(h,w){var p,C,x,b,I,_,S,L,f,y,O,F,Z,st,c,u=this,d=u.c,P=(h=new rt(h,w)).c;if(!d||!P||!d[0]||!P[0])return!u.s||!h.s||d&&!d[0]&&!P||P&&!P[0]&&!d?h.c=h.e=h.s=null:(h.s*=u.s,!d||!P?h.c=h.e=null:(h.c=[0],h.e=0)),h;for(C=D(u.e/v)+D(h.e/v),h.s*=u.s,S=d.length,y=P.length,S<y&&(Z=d,d=P,P=Z,x=S,S=y,y=x),x=S+y,Z=[];x--;Z.push(0));for(st=g,c=m,x=y;--x>=0;){for(p=0,O=P[x]%c,F=P[x]/c|0,I=S,b=x+I;b>x;)L=d[--I]%c,f=d[I]/c|0,_=F*L+f*O,L=O*L+_%c*c+Z[b]+p,p=(L/st|0)+(_/c|0)+F*f,Z[b--]=L%st;Z[b]=p}return p?++C:Z.splice(0,1),Nt(h,Z,C)},V.negated=function(){var h=new rt(this);return h.s=-h.s||null,h},V.plus=function(h,w){var p,C=this,x=C.s;if(h=new rt(h,w),w=h.s,!x||!w)return new rt(NaN);if(x!=w)return h.s=-w,C.minus(h);var b=C.e/v,I=h.e/v,_=C.c,S=h.c;if(!b||!I){if(!_||!S)return new rt(x/0);if(!_[0]||!S[0])return S[0]?h:new rt(_[0]?C:x*0)}if(b=D(b),I=D(I),_=_.slice(),x=b-I){for(x>0?(I=b,p=S):(x=-x,p=_),p.reverse();x--;p.push(0));p.reverse()}for(x=_.length,w=S.length,x-w<0&&(p=S,S=_,_=p,w=x),x=0;w;)x=(_[--w]=_[w]+S[w]+x)/g|0,_[w]=g===_[w]?0:_[w]%g;return x&&(_=[x].concat(_),++I),Nt(h,_,I)},V.precision=V.sd=function(h,w){var p,C,x,b=this;if(h!=null&&h!==!!h)return j(h,1,E),w==null?w=ut:j(w,0,8),T(new rt(b),h,w);if(!(p=b.c))return null;if(x=p.length-1,C=x*v+1,x=p[x]){for(;x%10==0;x/=10,C--);for(x=p[0];x>=10;x/=10,C++);}return h&&b.e+1>C&&(C=b.e+1),C},V.shiftedBy=function(h){return j(h,-A,A),this.times("1e"+h)},V.squareRoot=V.sqrt=function(){var h,w,p,C,x,b=this,I=b.c,_=b.s,S=b.e,L=ct+4,f=new rt("0.5");if(_!==1||!I||!I[0])return new rt(!_||_<0&&(!I||I[0])?NaN:I?b:1/0);if(_=Math.sqrt(+k(b)),_==0||_==1/0?(w=K(I),(w.length+S)%2==0&&(w+="0"),_=Math.sqrt(+w),S=D((S+1)/2)-(S<0||S%2),_==1/0?w="5e"+S:(w=_.toExponential(),w=w.slice(0,w.indexOf("e")+1)+S),p=new rt(w)):p=new rt(_+""),p.c[0]){for(S=p.e,_=S+L,_<3&&(_=0);;)if(x=p,p=f.times(x.plus(G(b,x,L,1))),K(x.c).slice(0,_)===(w=K(p.c)).slice(0,_))if(p.e<S&&--_,w=w.slice(_-3,_+1),w=="9999"||!C&&w=="4999"){if(!C&&(T(x,x.e+ct+2,0),x.times(x).eq(b))){p=x;break}L+=4,_+=4,C=1}else{(!+w||!+w.slice(1)&&w.charAt(0)=="5")&&(T(p,p.e+ct+2,1),h=!p.times(p).eq(b));break}}return T(p,p.e+ct+1,ut,h)},V.toExponential=function(h,w){return h!=null&&(j(h,0,E),h++),pe(this,h,w,1)},V.toFixed=function(h,w){return h!=null&&(j(h,0,E),h=h+this.e+1),pe(this,h,w)},V.toFormat=function(h,w,p){var C,x=this;if(p==null)h!=null&&w&&typeof w=="object"?(p=w,w=null):h&&typeof h=="object"?(p=h,h=w=null):p=Bt;else if(typeof p!="object")throw Error(s+"Argument not an object: "+p);if(C=x.toFixed(h,w),x.c){var b,I=C.split("."),_=+p.groupSize,S=+p.secondaryGroupSize,L=p.groupSeparator||"",f=I[0],y=I[1],O=x.s<0,F=O?f.slice(1):f,Z=F.length;if(S&&(b=_,_=S,S=b,Z-=b),_>0&&Z>0){for(b=Z%_||_,f=F.substr(0,b);b<Z;b+=_)f+=L+F.substr(b,_);S>0&&(f+=L+F.slice(b)),O&&(f="-"+f)}C=y?f+(p.decimalSeparator||"")+((S=+p.fractionGroupSize)?y.replace(new RegExp("\\d{"+S+"}\\B","g"),"$&"+(p.fractionGroupSeparator||"")):y):f}return(p.prefix||"")+C+(p.suffix||"")},V.toFraction=function(h){var w,p,C,x,b,I,_,S,L,f,y,O,F=this,Z=F.c;if(h!=null&&(_=new rt(h),!_.isInteger()&&(_.c||_.s!==1)||_.lt(ot)))throw Error(s+"Argument "+(_.isInteger()?"out of range: ":"not an integer: ")+k(_));if(!Z)return new rt(F);for(w=new rt(ot),L=p=new rt(ot),C=S=new rt(ot),O=K(Z),b=w.e=O.length-F.e-1,w.c[0]=B[(I=b%v)<0?v+I:I],h=!h||_.comparedTo(w)>0?b>0?w:L:_,I=Ot,Ot=1/0,_=new rt(O),S.c[0]=0;f=G(_,w,0,1),x=p.plus(f.times(C)),x.comparedTo(h)!=1;)p=C,C=x,L=S.plus(f.times(x=L)),S=x,w=_.minus(f.times(x=w)),_=x;return x=G(h.minus(p),C,0,1),S=S.plus(x.times(L)),p=p.plus(x.times(C)),S.s=L.s=F.s,b=b*2,y=G(L,C,b,ut).minus(F).abs().comparedTo(G(S,p,b,ut).minus(F).abs())<1?[L,C]:[S,p],Ot=I,y},V.toNumber=function(){return+k(this)},V.toPrecision=function(h,w){return h!=null&&j(h,1,E),pe(this,h,w,2)},V.toString=function(h){var w,p=this,C=p.s,x=p.e;return x===null?C?(w="Infinity",C<0&&(w="-"+w)):w="NaN":(h==null?w=x<=vt||x>=yt?U(K(p.c),x):M(K(p.c),x,"0"):h===10&&de?(p=T(new rt(p),ct+x+1,ut),w=M(K(p.c),p.e,"0")):(j(h,2,tt.length,"Base"),w=W(M(K(p.c),x,"0"),10,h,C,!0)),C<0&&p.c[0]&&(w="-"+w)),w},V.valueOf=V.toJSON=function(){return k(this)},V._isBigNumber=!0,q!=null&&rt.set(q),rt}function D(q){var G=q|0;return q>0||q===G?G:G-1}function K(q){for(var G,W,at=1,V=q.length,ot=q[0]+"";at<V;){for(G=q[at++]+"",W=v-G.length;W--;G="0"+G);ot+=G}for(V=ot.length;ot.charCodeAt(--V)===48;);return ot.slice(0,V+1||1)}function X(q,G){var W,at,V=q.c,ot=G.c,ct=q.s,ut=G.s,vt=q.e,yt=G.e;if(!ct||!ut)return null;if(W=V&&!V[0],at=ot&&!ot[0],W||at)return W?at?0:-ut:ct;if(ct!=ut)return ct;if(W=ct<0,at=vt==yt,!V||!ot)return at?0:!V^W?1:-1;if(!at)return vt>yt^W?1:-1;for(ut=(vt=V.length)<(yt=ot.length)?vt:yt,ct=0;ct<ut;ct++)if(V[ct]!=ot[ct])return V[ct]>ot[ct]^W?1:-1;return vt==yt?0:vt>yt^W?1:-1}function j(q,G,W,at){if(q<G||q>W||q!==a(q))throw Error(s+(at||"Argument")+(typeof q=="number"?q<G||q>W?" out of range: ":" not an integer: ":" not a primitive number: ")+String(q))}function nt(q){var G=q.c.length-1;return D(q.e/v)==G&&q.c[G]%2!=0}function U(q,G){return(q.length>1?q.charAt(0)+"."+q.slice(1):q)+(G<0?"e":"e+")+G}function M(q,G,W){var at,V;if(G<0){for(V=W+".";++G;V+=W);q=V+q}else if(at=q.length,++G>at){for(V=W,G-=at;--G;V+=W);q+=V}else G<at&&(q=q.slice(0,G)+"."+q.slice(G));return q}r=N(),r.default=r.BigNumber=r,typeof define=="function"&&define.amd?define(function(){return r}):typeof t<"u"&&t.exports?t.exports=r:(e||(e=typeof self<"u"&&self?self:window),e.BigNumber=r)})(n)}),zy=Lt(n=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=Qy(),e=class{BigNum;constructor(){this.BigNum=(r,i)=>{let o=t.BigNumber.clone({DECIMAL_PLACES:i});return new o(r)}}winstonToAr(r,{formatted:i=!1,decimals:o=12,trim:a=!0}={}){let s=this.stringToBigNum(r,o).shiftedBy(-12);return i?s.toFormat(o):s.toFixed(o)}arToWinston(r,{formatted:i=!1}={}){let o=this.stringToBigNum(r).shiftedBy(12);return i?o.toFormat():o.toFixed(0)}compare(r,i){let o=this.stringToBigNum(r),a=this.stringToBigNum(i);return o.comparedTo(a)}isEqual(r,i){return this.compare(r,i)===0}isLessThan(r,i){let o=this.stringToBigNum(r),a=this.stringToBigNum(i);return o.isLessThan(a)}isGreaterThan(r,i){let o=this.stringToBigNum(r),a=this.stringToBigNum(i);return o.isGreaterThan(a)}add(r,i){let o=this.stringToBigNum(r),a=this.stringToBigNum(i);return o.plus(i).toFixed(0)}sub(r,i){let o=this.stringToBigNum(r),a=this.stringToBigNum(i);return o.minus(i).toFixed(0)}stringToBigNum(r,i=12){return this.BigNum(r,i)}};n.default=e}),Jy=Lt(n=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=class{METHOD_GET="GET";METHOD_POST="POST";config;constructor(i){this.applyConfig(i)}applyConfig(i){this.config=this.mergeDefaults(i)}getConfig(){return this.config}mergeDefaults(i){let o=i.protocol||"http",a=i.port||(o==="https"?443:80);return{host:i.host||"127.0.0.1",protocol:o,port:a,timeout:i.timeout||2e4,logging:i.logging||!1,logger:i.logger||console.log,network:i.network}}async get(i,o){return await this.request(i,{...o,method:this.METHOD_GET})}async post(i,o,a){let s=new Headers(a?.headers||{});return s.get("content-type")?.includes("application/json")||s.append("content-type","application/json"),s.append("accept","application/json, text/plain, */*"),await this.request(i,{...a,method:this.METHOD_POST,body:typeof o!="string"?JSON.stringify(o):o,headers:s})}async request(i,o){let a=new Headers(o?.headers||{}),s=`${this.config.protocol}://${this.config.host}:${this.config.port}`,l=o?.responseType;delete o?.responseType,i.startsWith("/")&&(i=i.slice(1)),this.config.network&&a.append("x-network",this.config.network),this.config.logging&&this.config.logger(`Requesting: ${s}/${i}`);let g=await fetch(`${s}/${i}`,{...o||{},headers:a});this.config.logging&&this.config.logger(`Response:   ${g.url} - ${g.status}`);let v=g.headers.get("content-type")?.match(/charset=([^()<>@,;:\"/[\]?.=\s]*)/i)?.[1],A=g,B=async()=>{if(v)try{A.data=new TextDecoder(v).decode(await g.arrayBuffer())}catch{A.data=await g.text()}else A.data=await g.text()};if(l==="arraybuffer")A.data=await g.arrayBuffer();else if(l==="text")await B();else if(l==="webstream")A.data=e(g.body);else try{let m=await g.clone().json();typeof m!="object"?await B():A.data=await g.json(),m=null}catch{await B()}return A}};n.default=t;var e=i=>{let o=i;return typeof o[Symbol.asyncIterator]>"u"?(o[Symbol.asyncIterator]=r(i),o):i},r=function(i){return async function*(){let o=i.getReader();try{for(;;){let{done:a,value:s}=await o.read();if(a)return;yield s}}finally{o.releaseLock()}}}}),Yy=Lt(n=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=class{api;constructor(e){this.api=e}getInfo(){return this.api.get("info").then(e=>e.data)}getPeers(){return this.api.get("peers").then(e=>e.data)}};n.default=t}),sa=Lt(n=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getError=void 0;var t=class extends Error{type;response;constructor(r,i={}){i.message?super(i.message):super(),this.type=r,this.response=i.response}getType(){return this.type}};n.default=t;function e(r){let i=r.data;if(typeof r.data=="string")try{i=JSON.parse(r.data)}catch{}if(r.data instanceof ArrayBuffer||r.data instanceof Uint8Array)try{i=JSON.parse(i.toString())}catch{}return i?i.error||i:r.statusText||"unknown"}n.getError=e}),Xy=Lt(n=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=ia();async function e(i){if(Array.isArray(i)){let s=t.default.utils.concatBuffers([t.default.utils.stringToBuffer("list"),t.default.utils.stringToBuffer(i.length.toString())]);return await r(i,await t.default.crypto.hash(s,"SHA-384"))}let o=t.default.utils.concatBuffers([t.default.utils.stringToBuffer("blob"),t.default.utils.stringToBuffer(i.byteLength.toString())]),a=t.default.utils.concatBuffers([await t.default.crypto.hash(o,"SHA-384"),await t.default.crypto.hash(i,"SHA-384")]);return await t.default.crypto.hash(a,"SHA-384")}n.default=e;async function r(i,o){if(i.length<1)return o;let a=t.default.utils.concatBuffers([o,await e(i[0])]),s=await t.default.crypto.hash(a,"SHA-384");return await r(i.slice(1),s)}}),hh=Lt(n=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.debug=n.validatePath=n.arrayCompare=n.bufferToInt=n.intToBuffer=n.arrayFlatten=n.generateProofs=n.buildLayers=n.generateTransactionChunks=n.generateTree=n.computeRootHash=n.generateLeaves=n.chunkData=n.MIN_CHUNK_SIZE=n.MAX_CHUNK_SIZE=void 0;var t=ia(),e=Ve();n.MAX_CHUNK_SIZE=256*1024,n.MIN_CHUNK_SIZE=32*1024;var r=32,i=32;async function o(U){let M=[],q=U,G=0;for(;q.byteLength>=n.MAX_CHUNK_SIZE;){let W=n.MAX_CHUNK_SIZE,at=q.byteLength-n.MAX_CHUNK_SIZE;at>0&&at<n.MIN_CHUNK_SIZE&&(W=Math.ceil(q.byteLength/2));let V=q.slice(0,W),ot=await t.default.crypto.hash(V);G+=V.byteLength,M.push({dataHash:ot,minByteRange:G-V.byteLength,maxByteRange:G}),q=q.slice(W)}return M.push({dataHash:await t.default.crypto.hash(q),minByteRange:G,maxByteRange:G+q.byteLength}),M}n.chunkData=o;async function a(U){return Promise.all(U.map(async({dataHash:M,minByteRange:q,maxByteRange:G})=>({type:"leaf",id:await N(await Promise.all([N(M),N(D(G))])),dataHash:M,minByteRange:q,maxByteRange:G})))}n.generateLeaves=a;async function s(U){return(await l(U)).id}n.computeRootHash=s;async function l(U){return await v(await a(await o(U)))}n.generateTree=l;async function g(U){let M=await o(U),q=await a(M),G=await v(q),W=await A(G),at=M.slice(-1)[0];return at.maxByteRange-at.minByteRange===0&&(M.splice(M.length-1,1),W.splice(W.length-1,1)),{data_root:G.id,chunks:M,proofs:W}}n.generateTransactionChunks=g;async function v(U,M=0){if(U.length<2)return U[0];let q=[];for(let G=0;G<U.length;G+=2)q.push(await E(U[G],U[G+1]));return v(q,M+1)}n.buildLayers=v;function A(U){let M=B(U);return Array.isArray(M)?m(M):[M]}n.generateProofs=A;function B(U,M=new Uint8Array,q=0){if(U.type=="leaf")return{offset:U.maxByteRange-1,proof:(0,e.concatBuffers)([M,U.dataHash,D(U.maxByteRange)])};if(U.type=="branch"){let G=(0,e.concatBuffers)([M,U.leftChild.id,U.rightChild.id,D(U.byteRange)]);return[B(U.leftChild,G,q+1),B(U.rightChild,G,q+1)]}throw new Error("Unexpected node type")}function m(U){let M=[];return U.forEach(q=>{Array.isArray(q)?M.push(...m(q)):M.push(q)}),M}n.arrayFlatten=m;async function E(U,M){return M?{type:"branch",id:await N([await N(U.id),await N(M.id),await N(D(U.maxByteRange))]),byteRange:U.maxByteRange,maxByteRange:M.maxByteRange,leftChild:U,rightChild:M}:U}async function N(U){return Array.isArray(U)&&(U=t.default.utils.concatBuffers(U)),new Uint8Array(await t.default.crypto.hash(U))}function D(U){let M=new Uint8Array(r);for(var q=M.length-1;q>=0;q--){var G=U%256;M[q]=G,U=(U-G)/256}return M}n.intToBuffer=D;function K(U){let M=0;for(var q=0;q<U.length;q++)M*=256,M+=U[q];return M}n.bufferToInt=K;var X=(U,M)=>U.every((q,G)=>M[G]===q);n.arrayCompare=X;async function j(U,M,q,G,W){if(G<=0)return!1;if(M>=G)return j(U,0,G-1,G,W);if(M<0)return j(U,0,0,G,W);if(W.length==i+r){let yt=W.slice(0,i),it=W.slice(yt.length,yt.length+r),Ot=await N([await N(yt),await N(it)]);return(0,n.arrayCompare)(U,Ot)?{offset:G-1,leftBound:q,rightBound:G,chunkSize:G-q}:!1}let at=W.slice(0,i),V=W.slice(at.length,at.length+i),ot=W.slice(at.length+V.length,at.length+V.length+r),ct=K(ot),ut=W.slice(at.length+V.length+ot.length),vt=await N([await N(at),await N(V),await N(ot)]);return(0,n.arrayCompare)(U,vt)?M<ct?await j(at,M,q,Math.min(G,ct),ut):await j(V,M,Math.max(q,ct),G,ut):!1}n.validatePath=j;async function nt(U,M=""){if(U.byteLength<1)return M;let q=U.slice(0,i),G=U.slice(q.length,q.length+i),W=U.slice(q.length+G.length,q.length+G.length+r),at=K(W),V=U.slice(q.length+G.length+W.length),ot=await N([await N(q),await N(G),await N(W)]),ct=`${M}
${JSON.stringify(Q.Buffer.from(q))},${JSON.stringify(Q.Buffer.from(G))},${at} => ${JSON.stringify(ot)}`;return nt(V,ct)}n.debug=nt}),Nc=Lt(n=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Tag=void 0;var t=Ve(),e=Xy(),r=hh(),i=class{get(s,l){if(!Object.getOwnPropertyNames(this).includes(s))throw new Error(`Field "${s}" is not a property of the Arweave Transaction class.`);if(this[s]instanceof Uint8Array)return l&&l.decode&&l.string?t.bufferToString(this[s]):l&&l.decode&&!l.string?this[s]:t.bufferTob64Url(this[s]);if(this[s]instanceof Array){if(l?.decode!==void 0||l?.string!==void 0)throw s==="tags"&&console.warn(`Did you mean to use 'transaction["tags"]' ?`),new Error("Cannot decode or stringify an array.");return this[s]}return l&&l.decode==!0?l&&l.string?t.b64UrlToString(this[s]):t.b64UrlToBuffer(this[s]):this[s]}},o=class extends i{name;value;constructor(s,l,g=!1){super(),this.name=s,this.value=l}};n.Tag=o;var a=class extends i{format=2;id="";last_tx="";owner="";tags=[];target="";quantity="0";data_size="0";data=new Uint8Array;data_root="";reward="0";signature="";chunks;constructor(s={}){super(),Object.assign(this,s),typeof this.data=="string"&&(this.data=t.b64UrlToBuffer(this.data)),s.tags&&(this.tags=s.tags.map(l=>new o(l.name,l.value)))}addTag(s,l){this.tags.push(new o(t.stringToB64Url(s),t.stringToB64Url(l)))}toJSON(){return{format:this.format,id:this.id,last_tx:this.last_tx,owner:this.owner,tags:this.tags,target:this.target,quantity:this.quantity,data:t.bufferTob64Url(this.data),data_size:this.data_size,data_root:this.data_root,data_tree:this.data_tree,reward:this.reward,signature:this.signature}}setOwner(s){this.owner=s}setSignature({id:s,owner:l,reward:g,tags:v,signature:A}){this.id=s,this.owner=l,g&&(this.reward=g),v&&(this.tags=v),this.signature=A}async prepareChunks(s){!this.chunks&&s.byteLength>0&&(this.chunks=await(0,r.generateTransactionChunks)(s),this.data_root=t.bufferTob64Url(this.chunks.data_root)),!this.chunks&&s.byteLength===0&&(this.chunks={chunks:[],data_root:new Uint8Array,proofs:[]},this.data_root="")}getChunk(s,l){if(!this.chunks)throw new Error("Chunks have not been prepared");let g=this.chunks.proofs[s],v=this.chunks.chunks[s];return{data_root:this.data_root,data_size:this.data_size,data_path:t.bufferTob64Url(g.proof),offset:g.offset.toString(),chunk:t.bufferTob64Url(l.slice(v.minByteRange,v.maxByteRange))}}async getSignatureData(){switch(this.format){case 1:let s=this.tags.reduce((g,v)=>t.concatBuffers([g,v.get("name",{decode:!0,string:!1}),v.get("value",{decode:!0,string:!1})]),new Uint8Array);return t.concatBuffers([this.get("owner",{decode:!0,string:!1}),this.get("target",{decode:!0,string:!1}),this.get("data",{decode:!0,string:!1}),t.stringToBuffer(this.quantity),t.stringToBuffer(this.reward),this.get("last_tx",{decode:!0,string:!1}),s]);case 2:this.data_root||await this.prepareChunks(this.data);let l=this.tags.map(g=>[g.get("name",{decode:!0,string:!1}),g.get("value",{decode:!0,string:!1})]);return await(0,e.default)([t.stringToBuffer(this.format.toString()),this.get("owner",{decode:!0,string:!1}),this.get("target",{decode:!0,string:!1}),t.stringToBuffer(this.quantity),t.stringToBuffer(this.reward),this.get("last_tx",{decode:!0,string:!1}),l,t.stringToBuffer(this.data_size),this.get("data_root",{decode:!0,string:!1})]);default:throw new Error(`Unexpected transaction format: ${this.format}`)}}};n.default=a}),Zy=Lt(n=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionUploader=void 0;var t=Nc(),e=Ve(),r=sa(),i=hh(),o=1,a=["invalid_json","chunk_too_big","data_path_too_big","offset_too_big","data_size_too_big","chunk_proof_ratio_not_attractive","invalid_proof"],s=1e3*40,l=class{api;chunkIndex=0;txPosted=!1;transaction;lastRequestTimeEnd=0;totalErrors=0;data;lastResponseStatus=0;lastResponseError="";get isComplete(){return this.txPosted&&this.chunkIndex===this.transaction.chunks.chunks.length}get totalChunks(){return this.transaction.chunks.chunks.length}get uploadedChunks(){return this.chunkIndex}get pctComplete(){return Math.trunc(this.uploadedChunks/this.totalChunks*100)}constructor(g,v){if(this.api=g,!v.id)throw new Error("Transaction is not signed");if(!v.chunks)throw new Error("Transaction chunks not prepared");this.data=v.data,this.transaction=new t.default(Object.assign({},v,{data:new Uint8Array(0)}))}async uploadChunk(g){if(this.isComplete)throw new Error("Upload is already complete");if(this.lastResponseError!==""?this.totalErrors++:this.totalErrors=0,this.totalErrors===100)throw new Error(`Unable to complete upload: ${this.lastResponseStatus}: ${this.lastResponseError}`);let v=this.lastResponseError===""?0:Math.max(this.lastRequestTimeEnd+s-Date.now(),s);if(v>0&&(v=v-v*Math.random()*.3,await new Promise(m=>setTimeout(m,v))),this.lastResponseError="",!this.txPosted){await this.postTransaction();return}g&&(this.chunkIndex=g);let A=this.transaction.getChunk(g||this.chunkIndex,this.data);if(!await(0,i.validatePath)(this.transaction.chunks.data_root,parseInt(A.offset),0,parseInt(A.data_size),e.b64UrlToBuffer(A.data_path)))throw new Error(`Unable to validate chunk ${this.chunkIndex}`);let B=await this.api.post("chunk",this.transaction.getChunk(this.chunkIndex,this.data)).catch(m=>(console.error(m.message),{status:-1,data:{error:m.message}}));if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=B.status,this.lastResponseStatus==200)this.chunkIndex++;else if(this.lastResponseError=(0,r.getError)(B),a.includes(this.lastResponseError))throw new Error(`Fatal error uploading chunk ${this.chunkIndex}: ${this.lastResponseError}`)}static async fromSerialized(g,v,A){if(!v||typeof v.chunkIndex!="number"||typeof v.transaction!="object")throw new Error("Serialized object does not match expected format.");var B=new t.default(v.transaction);B.chunks||await B.prepareChunks(A);let m=new l(g,B);if(m.chunkIndex=v.chunkIndex,m.lastRequestTimeEnd=v.lastRequestTimeEnd,m.lastResponseError=v.lastResponseError,m.lastResponseStatus=v.lastResponseStatus,m.txPosted=v.txPosted,m.data=A,m.transaction.data_root!==v.transaction.data_root)throw new Error("Data mismatch: Uploader doesn't match provided data.");return m}static async fromTransactionId(g,v){let A=await g.get(`tx/${v}`);if(A.status!==200)throw new Error(`Tx ${v} not found: ${A.status}`);let B=A.data;return B.data=new Uint8Array(0),{txPosted:!0,chunkIndex:0,lastResponseError:"",lastRequestTimeEnd:0,lastResponseStatus:0,transaction:B}}toJSON(){return{chunkIndex:this.chunkIndex,transaction:this.transaction,lastRequestTimeEnd:this.lastRequestTimeEnd,lastResponseStatus:this.lastResponseStatus,lastResponseError:this.lastResponseError,txPosted:this.txPosted}}async postTransaction(){if(this.totalChunks<=o){this.transaction.data=this.data;let v=await this.api.post("tx",this.transaction).catch(A=>(console.error(A),{status:-1,data:{error:A.message}}));if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=v.status,this.transaction.data=new Uint8Array(0),v.status>=200&&v.status<300){this.txPosted=!0,this.chunkIndex=o;return}throw this.lastResponseError=(0,r.getError)(v),new Error(`Unable to upload transaction: ${v.status}, ${this.lastResponseError}`)}let g=await this.api.post("tx",this.transaction);if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=g.status,!(g.status>=200&&g.status<300))throw this.lastResponseError=(0,r.getError)(g),new Error(`Unable to upload transaction: ${g.status}, ${this.lastResponseError}`);this.txPosted=!0}};n.TransactionUploader=l}),Uc=Lt((n,t)=>{t.exports={}}),tw=Lt(n=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=sa(),e=Nc(),r=Ve(),i=Zy();Uc();var o=class{api;crypto;chunks;constructor(a,s,l){this.api=a,this.crypto=s,this.chunks=l}async getTransactionAnchor(){let a=await this.api.get("tx_anchor");if(!a.data.match(/^[a-z0-9_-]{43,}/i)||!a.ok)throw new Error(`Could not getTransactionAnchor. Received: ${a.data}. Status: ${a.status}, ${a.statusText}`);return a.data}async getPrice(a,s){let l=s?`price/${a}/${s}`:`price/${a}`,g=await this.api.get(l);if(!/^\d+$/.test(g.data)||!g.ok)throw new Error(`Could not getPrice. Received: ${g.data}. Status: ${g.status}, ${g.statusText}`);return g.data}async get(a){let s=await this.api.get(`tx/${a}`);if(s.status==200){let l=parseInt(s.data.data_size);if(s.data.format>=2&&l>0&&l<=1024*1024*12){let g=await this.getData(a);return new e.default({...s.data,data:g})}return new e.default({...s.data,format:s.data.format||1})}throw s.status==404?new t.default("TX_NOT_FOUND"):s.status==410?new t.default("TX_FAILED"):new t.default("TX_INVALID")}fromRaw(a){return new e.default(a)}async search(a,s){return this.api.post("arql",{op:"equals",expr1:a,expr2:s}).then(l=>l.data?l.data:[])}getStatus(a){return this.api.get(`tx/${a}/status`).then(s=>s.status==200?{status:200,confirmed:s.data}:{status:s.status,confirmed:null})}async getData(a,s){let l;try{l=await this.chunks.downloadChunkedData(a)}catch(g){console.error(`Error while trying to download chunked data for ${a}`),console.error(g)}if(!l){console.warn(`Falling back to gateway cache for ${a}`);try{let{data:g,ok:v,status:A,statusText:B}=await this.api.get(`/${a}`,{responseType:"arraybuffer"});if(!v)throw new Error("Bad http status code",{cause:{status:A,statusText:B}});l=g}catch(g){console.error(`Error while trying to download contiguous data from gateway cache for ${a}`),console.error(g)}}if(!l)throw new Error(`${a} data was not found!`);return s&&s.decode&&!s.string?l:s&&s.decode&&s.string?r.bufferToString(l):r.bufferTob64Url(l)}async sign(a,s,l){let g=typeof s=="object"&&(A=>{let B=!0;return["n","e","d","p","q","dp","dq","qi"].map(m=>!(m in A)&&(B=!1)),B})(s),v=typeof arweaveWallet=="object";if(!g&&!v)throw new Error("No valid JWK or external wallet found to sign transaction.");if(v){try{(await arweaveWallet.getPermissions()).includes("SIGN_TRANSACTION")||await arweaveWallet.connect(["SIGN_TRANSACTION"])}catch{}let A=await arweaveWallet.sign(a,l);a.setSignature({id:A.id,owner:A.owner,reward:A.reward,tags:A.tags,signature:A.signature})}else if(g){a.setOwner(s.n);let A=await a.getSignatureData(),B=await this.crypto.sign(s,A,l),m=await this.crypto.hash(B);a.setSignature({id:r.bufferTob64Url(m),owner:s.n,signature:r.bufferTob64Url(B)})}else throw new Error("An error occurred while signing. Check wallet is valid")}async verify(a){let s=await a.getSignatureData(),l=a.get("signature",{decode:!0,string:!1}),g=r.bufferTob64Url(await this.crypto.hash(l));if(a.id!==g)throw new Error("Invalid transaction signature or ID! The transaction ID doesn't match the expected SHA-256 hash of the signature.");return this.crypto.verify(a.owner,s,l)}async post(a){if(typeof a=="string"?a=new e.default(JSON.parse(a)):typeof a.readInt32BE=="function"?a=new e.default(JSON.parse(a.toString())):typeof a=="object"&&!(a instanceof e.default)&&(a=new e.default(a)),!(a instanceof e.default))throw new Error("Must be Transaction object");a.chunks||await a.prepareChunks(a.data);let s=await this.getUploader(a,a.data);try{for(;!s.isComplete;)await s.uploadChunk()}catch(l){if(s.lastResponseStatus>0)return{status:s.lastResponseStatus,statusText:s.lastResponseError,data:{error:s.lastResponseError}};throw l}return{status:200,statusText:"OK",data:{}}}async getUploader(a,s){let l;if(s instanceof ArrayBuffer&&(s=new Uint8Array(s)),a instanceof e.default){if(s||(s=a.data),!(s instanceof Uint8Array))throw new Error("Data format is invalid");a.chunks||await a.prepareChunks(s),l=new i.TransactionUploader(this.api,a),(!l.data||l.data.length===0)&&(l.data=s)}else{if(typeof a=="string"&&(a=await i.TransactionUploader.fromTransactionId(this.api,a)),!s||!(s instanceof Uint8Array))throw new Error("Must provide data when resuming upload");l=await i.TransactionUploader.fromSerialized(this.api,a,s)}return l}async*upload(a,s){let l=await this.getUploader(a,s);for(;!l.isComplete;)await l.uploadChunk(),yield l;return l}};n.default=o}),ew=Lt(n=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=Ve();Uc();var e=class{api;crypto;constructor(r,i){this.api=r,this.crypto=i}getBalance(r){return this.api.get(`wallet/${r}/balance`).then(i=>i.data)}getLastTransactionID(r){return this.api.get(`wallet/${r}/last_tx`).then(i=>i.data)}generate(){return this.crypto.generateJWK()}async jwkToAddress(r){return!r||r==="use_wallet"?this.getAddress():this.getAddress(r)}async getAddress(r){if(!r||r==="use_wallet"){try{await arweaveWallet.connect(["ACCESS_ADDRESS"])}catch{}return arweaveWallet.getActiveAddress()}else return this.ownerToAddress(r.n)}async ownerToAddress(r){return t.bufferTob64Url(await this.crypto.hash(t.b64UrlToBuffer(r)))}};n.default=e}),rw=Lt(n=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SiloResource=void 0;var t=Ve(),e=class{api;crypto;transactions;constructor(i,o,a){this.api=i,this.crypto=o,this.transactions=a}async get(i){if(!i)throw new Error("No Silo URI specified");let o=await this.parseUri(i),a=await this.transactions.search("Silo-Name",o.getAccessKey());if(a.length==0)throw new Error(`No data could be found for the Silo URI: ${i}`);let s=await this.transactions.get(a[0]);if(!s)throw new Error(`No data could be found for the Silo URI: ${i}`);let l=s.get("data",{decode:!0,string:!1});return this.crypto.decrypt(l,o.getEncryptionKey())}async readTransactionData(i,o){if(!o)throw new Error("No Silo URI specified");let a=await this.parseUri(o),s=i.get("data",{decode:!0,string:!1});return this.crypto.decrypt(s,a.getEncryptionKey())}async parseUri(i){let o=i.match(/^([a-z0-9-_]+)\.([0-9]+)/i);if(!o)throw new Error("Invalid Silo name, must be a name in the format of [a-z0-9]+.[0-9]+, e.g. 'bubble.7'");let a=o[1],s=Math.pow(2,parseInt(o[2])),l=await this.hash(t.stringToBuffer(a),s),g=t.bufferTob64(l.slice(0,15)),v=await this.hash(l.slice(16,31),1);return new r(i,g,v)}async hash(i,o){let a=await this.crypto.hash(i);for(let s=0;s<o-1;s++)a=await this.crypto.hash(a);return a}};n.default=e;var r=class{uri;accessKey;encryptionKey;constructor(i,o,a){this.uri=i,this.accessKey=o,this.encryptionKey=a}getUri(){return this.uri}getAccessKey(){return this.accessKey}getEncryptionKey(){return this.encryptionKey}};n.SiloResource=r}),nw=Lt(n=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=sa(),e=Ve(),r=class{api;constructor(i){this.api=i}async getTransactionOffset(i){let o=await this.api.get(`tx/${i}/offset`);if(o.status===200)return o.data;throw new Error(`Unable to get transaction offset: ${(0,t.getError)(o)}`)}async getChunk(i){let o=await this.api.get(`chunk/${i}`);if(o.status===200)return o.data;throw new Error(`Unable to get chunk: ${(0,t.getError)(o)}`)}async getChunkData(i){let o=await this.getChunk(i);return e.b64UrlToBuffer(o.chunk)}firstChunkOffset(i){return parseInt(i.offset)-parseInt(i.size)+1}async downloadChunkedData(i){let o=await this.getTransactionOffset(i),a=parseInt(o.size),s=parseInt(o.offset)-a+1,l=new Uint8Array(a),g=0;for(;g<a;){this.api.config.logging&&console.log(`[chunk] ${g}/${a}`);let v;try{v=await this.getChunkData(s+g)}catch{console.error(`[chunk] Failed to fetch chunk at offset ${s+g}`),console.error("[chunk] This could indicate that the chunk wasn't uploaded or hasn't yet seeded properly to a particular gateway/node")}if(v)l.set(v,g),g+=v.length;else throw new Error(`Couldn't complete data download at ${g}/${a}`)}return l}};n.default=r}),iw=Lt(n=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=sa();Uc();var e=class{api;network;constructor(i,o){this.api=i,this.network=o}async get(i){let o=await this.api.get(`${e.ENDPOINT}${i}`);if(o.status===200)return o.data;throw o.status===404?new t.default("BLOCK_NOT_FOUND"):new Error(`Error while loading block data: ${o}`)}async getCurrent(){let{current:i}=await this.network.getInfo();return await this.get(i)}},r=e;na(r,"ENDPOINT","block/hash/"),n.default=r}),ia=Lt(n=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=zy(),e=Jy(),r=fh(),i=Yy(),o=tw(),a=ew(),s=Nc(),l=Ve(),g=rw(),v=nw(),A=iw(),B=class{api;wallets;transactions;network;blocks;ar;silo;chunks;constructor(E){this.api=new e.default(E),this.wallets=new a.default(this.api,B.crypto),this.chunks=new v.default(this.api),this.transactions=new o.default(this.api,B.crypto,this.chunks),this.silo=new g.default(this.api,this.crypto,this.transactions),this.network=new i.default(this.api),this.blocks=new A.default(this.api,this.network),this.ar=new t.default}get crypto(){return B.crypto}get utils(){return B.utils}getConfig(){return{api:this.api.getConfig(),crypto:null}}async createTransaction(E,N){let D={};if(Object.assign(D,E),!E.data&&!(E.target&&E.quantity))throw new Error("A new Arweave transaction must have a 'data' value, or 'target' and 'quantity' values.");if(E.owner==null&&N&&N!=="use_wallet"&&(D.owner=N.n),E.last_tx==null&&(D.last_tx=await this.transactions.getTransactionAnchor()),typeof E.data=="string"&&(E.data=l.stringToBuffer(E.data)),E.data instanceof ArrayBuffer&&(E.data=new Uint8Array(E.data)),E.data&&!(E.data instanceof Uint8Array))throw new Error("Expected data to be a string, Uint8Array or ArrayBuffer");if(E.reward==null){let X=E.data?E.data.byteLength:0;D.reward=await this.transactions.getPrice(X,D.target)}D.data_root="",D.data_size=E.data?E.data.byteLength.toString():"0",D.data=E.data||new Uint8Array(0);let K=new s.default(D);return await K.getSignatureData(),K}async createSiloTransaction(E,N,D){let K={};if(Object.assign(K,E),!E.data)throw new Error("Silo transactions must have a 'data' value");if(!D)throw new Error("No Silo URI specified.");if(E.target||E.quantity)throw new Error("Silo transactions can only be used for storing data, sending AR to other wallets isn't supported.");if(E.owner==null){if(!N||!N.n)throw new Error("A new Arweave transaction must either have an 'owner' attribute, or you must provide the jwk parameter.");K.owner=N.n}E.last_tx==null&&(K.last_tx=await this.transactions.getTransactionAnchor());let X=await this.silo.parseUri(D);if(typeof E.data=="string"){let nt=await this.crypto.encrypt(l.stringToBuffer(E.data),X.getEncryptionKey());K.reward=await this.transactions.getPrice(nt.byteLength),K.data=l.bufferTob64Url(nt)}if(E.data instanceof Uint8Array){let nt=await this.crypto.encrypt(E.data,X.getEncryptionKey());K.reward=await this.transactions.getPrice(nt.byteLength),K.data=l.bufferTob64Url(nt)}let j=new s.default(K);return j.addTag("Silo-Name",X.getAccessKey()),j.addTag("Silo-Version","0.1.0"),j}arql(E){return this.api.post("/arql",E).then(N=>N.data||[])}},m=B;na(m,"init"),na(m,"crypto",new r.default),na(m,"utils",l),n.default=m}),ow=Lt(n=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getDefaultConfig=void 0;var t=(i,o)=>{let a=/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,s=o.split("."),l=s[s.length-1],g=["localhost","[::1]"];return g.includes(o)||i=="file"||g.includes(l)||!!o.match(a)||!!l.match(a)},e=i=>{let o=i.charAt(0)==="[",a=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/;return!!i.match(a)||o},r=(i,o)=>{if(t(i,o))return{protocol:"https",host:"arweave.net",port:443};if(!e(o)){let a=o.split(".");if(a.length>=3){a.shift();let s=a.join(".");return{protocol:i,host:s}}}return{protocol:i,host:o}};n.getDefaultConfig=r}),aw=Lt(n=>{"use strict";var t=n&&n.__createBinding||(Object.create?function(o,a,s,l){l===void 0&&(l=s);var g=Object.getOwnPropertyDescriptor(a,s);(!g||("get"in g?!a.__esModule:g.writable||g.configurable))&&(g={enumerable:!0,get:function(){return a[s]}}),Object.defineProperty(o,l,g)}:function(o,a,s,l){l===void 0&&(l=s),o[l]=a[s]}),e=n&&n.__exportStar||function(o,a){for(var s in o)s!=="default"&&!Object.prototype.hasOwnProperty.call(a,s)&&t(a,o,s)};Object.defineProperty(n,"__esModule",{value:!0});var r=ia(),i=ow();r.default.init=function(o={}){let a={host:"arweave.net",port:443,protocol:"https"};if(typeof location!="object"||!location.protocol||!location.hostname)return new r.default({...o,...a});let s=location.protocol.replace(":",""),l=location.hostname,g=location.port?parseInt(location.port):s=="https"?443:80,v=(0,i.getDefaultConfig)(s,l),A=o.protocol||v.protocol,B=o.host||v.host,m=o.port||v.port||g;return new r.default({...o,host:B,protocol:A,port:m})},typeof globalThis=="object"?globalThis.Arweave=r.default:typeof self=="object"&&(self.Arweave=r.default),e(ia(),n),n.default=r.default}),sw=Lt(n=>{n.read=function(t,e,r,i,o){var a,s,l=o*8-i-1,g=(1<<l)-1,v=g>>1,A=-7,B=r?o-1:0,m=r?-1:1,E=t[e+B];for(B+=m,a=E&(1<<-A)-1,E>>=-A,A+=l;A>0;a=a*256+t[e+B],B+=m,A-=8);for(s=a&(1<<-A)-1,a>>=-A,A+=i;A>0;s=s*256+t[e+B],B+=m,A-=8);if(a===0)a=1-v;else{if(a===g)return s?NaN:(E?-1:1)*(1/0);s=s+Math.pow(2,i),a=a-v}return(E?-1:1)*s*Math.pow(2,a-i)},n.write=function(t,e,r,i,o,a){var s,l,g,v=a*8-o-1,A=(1<<v)-1,B=A>>1,m=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,E=i?0:a-1,N=i?1:-1,D=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(l=isNaN(e)?1:0,s=A):(s=Math.floor(Math.log(e)/Math.LN2),e*(g=Math.pow(2,-s))<1&&(s--,g*=2),s+B>=1?e+=m/g:e+=m*Math.pow(2,1-B),e*g>=2&&(s++,g/=2),s+B>=A?(l=0,s=A):s+B>=1?(l=(e*g-1)*Math.pow(2,o),s=s+B):(l=e*Math.pow(2,B-1)*Math.pow(2,o),s=0));o>=8;t[r+E]=l&255,E+=N,l/=256,o-=8);for(s=s<<o|l,v+=o;v>0;t[r+E]=s&255,E+=N,s/=256,v-=8);t[r+E-N]|=D*128}}),gh=Lt(n=>{"use strict";var t=lh(),e=sw(),r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;n.Buffer=s,n.SlowBuffer=X,n.INSPECT_MAX_BYTES=50;var i=2147483647;n.kMaxLength=i,s.TYPED_ARRAY_SUPPORT=o(),!s.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function o(){try{let c=new Uint8Array(1),u={foo:function(){return 42}};return Object.setPrototypeOf(u,Uint8Array.prototype),Object.setPrototypeOf(c,u),c.foo()===42}catch{return!1}}Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.buffer}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.byteOffset}});function a(c){if(c>i)throw new RangeError('The value "'+c+'" is invalid for option "size"');let u=new Uint8Array(c);return Object.setPrototypeOf(u,s.prototype),u}function s(c,u,d){if(typeof c=="number"){if(typeof u=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return A(c)}return l(c,u,d)}s.poolSize=8192;function l(c,u,d){if(typeof c=="string")return B(c,u);if(ArrayBuffer.isView(c))return E(c);if(c==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof c);if(y(c,ArrayBuffer)||c&&y(c.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(y(c,SharedArrayBuffer)||c&&y(c.buffer,SharedArrayBuffer)))return N(c,u,d);if(typeof c=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let P=c.valueOf&&c.valueOf();if(P!=null&&P!==c)return s.from(P,u,d);let $=D(c);if($)return $;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof c[Symbol.toPrimitive]=="function")return s.from(c[Symbol.toPrimitive]("string"),u,d);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof c)}s.from=function(c,u,d){return l(c,u,d)},Object.setPrototypeOf(s.prototype,Uint8Array.prototype),Object.setPrototypeOf(s,Uint8Array);function g(c){if(typeof c!="number")throw new TypeError('"size" argument must be of type number');if(c<0)throw new RangeError('The value "'+c+'" is invalid for option "size"')}function v(c,u,d){return g(c),c<=0?a(c):u!==void 0?typeof d=="string"?a(c).fill(u,d):a(c).fill(u):a(c)}s.alloc=function(c,u,d){return v(c,u,d)};function A(c){return g(c),a(c<0?0:K(c)|0)}s.allocUnsafe=function(c){return A(c)},s.allocUnsafeSlow=function(c){return A(c)};function B(c,u){if((typeof u!="string"||u==="")&&(u="utf8"),!s.isEncoding(u))throw new TypeError("Unknown encoding: "+u);let d=j(c,u)|0,P=a(d),$=P.write(c,u);return $!==d&&(P=P.slice(0,$)),P}function m(c){let u=c.length<0?0:K(c.length)|0,d=a(u);for(let P=0;P<u;P+=1)d[P]=c[P]&255;return d}function E(c){if(y(c,Uint8Array)){let u=new Uint8Array(c);return N(u.buffer,u.byteOffset,u.byteLength)}return m(c)}function N(c,u,d){if(u<0||c.byteLength<u)throw new RangeError('"offset" is outside of buffer bounds');if(c.byteLength<u+(d||0))throw new RangeError('"length" is outside of buffer bounds');let P;return u===void 0&&d===void 0?P=new Uint8Array(c):d===void 0?P=new Uint8Array(c,u):P=new Uint8Array(c,u,d),Object.setPrototypeOf(P,s.prototype),P}function D(c){if(s.isBuffer(c)){let u=K(c.length)|0,d=a(u);return d.length===0||c.copy(d,0,0,u),d}if(c.length!==void 0)return typeof c.length!="number"||O(c.length)?a(0):m(c);if(c.type==="Buffer"&&Array.isArray(c.data))return m(c.data)}function K(c){if(c>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return c|0}function X(c){return+c!=c&&(c=0),s.alloc(+c)}s.isBuffer=function(c){return c!=null&&c._isBuffer===!0&&c!==s.prototype},s.compare=function(c,u){if(y(c,Uint8Array)&&(c=s.from(c,c.offset,c.byteLength)),y(u,Uint8Array)&&(u=s.from(u,u.offset,u.byteLength)),!s.isBuffer(c)||!s.isBuffer(u))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(c===u)return 0;let d=c.length,P=u.length;for(let $=0,H=Math.min(d,P);$<H;++$)if(c[$]!==u[$]){d=c[$],P=u[$];break}return d<P?-1:P<d?1:0},s.isEncoding=function(c){switch(String(c).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(c,u){if(!Array.isArray(c))throw new TypeError('"list" argument must be an Array of Buffers');if(c.length===0)return s.alloc(0);let d;if(u===void 0)for(u=0,d=0;d<c.length;++d)u+=c[d].length;let P=s.allocUnsafe(u),$=0;for(d=0;d<c.length;++d){let H=c[d];if(y(H,Uint8Array))$+H.length>P.length?(s.isBuffer(H)||(H=s.from(H)),H.copy(P,$)):Uint8Array.prototype.set.call(P,H,$);else if(s.isBuffer(H))H.copy(P,$);else throw new TypeError('"list" argument must be an Array of Buffers');$+=H.length}return P};function j(c,u){if(s.isBuffer(c))return c.length;if(ArrayBuffer.isView(c)||y(c,ArrayBuffer))return c.byteLength;if(typeof c!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof c);let d=c.length,P=arguments.length>2&&arguments[2]===!0;if(!P&&d===0)return 0;let $=!1;for(;;)switch(u){case"ascii":case"latin1":case"binary":return d;case"utf8":case"utf-8":return I(c).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return d*2;case"hex":return d>>>1;case"base64":return L(c).length;default:if($)return P?-1:I(c).length;u=(""+u).toLowerCase(),$=!0}}s.byteLength=j;function nt(c,u,d){let P=!1;if((u===void 0||u<0)&&(u=0),u>this.length||((d===void 0||d>this.length)&&(d=this.length),d<=0)||(d>>>=0,u>>>=0,d<=u))return"";for(c||(c="utf8");;)switch(c){case"hex":return Dt(this,u,d);case"utf8":case"utf-8":return ut(this,u,d);case"ascii":return it(this,u,d);case"latin1":case"binary":return Ot(this,u,d);case"base64":return ct(this,u,d);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return oe(this,u,d);default:if(P)throw new TypeError("Unknown encoding: "+c);c=(c+"").toLowerCase(),P=!0}}s.prototype._isBuffer=!0;function U(c,u,d){let P=c[u];c[u]=c[d],c[d]=P}s.prototype.swap16=function(){let c=this.length;if(c%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let u=0;u<c;u+=2)U(this,u,u+1);return this},s.prototype.swap32=function(){let c=this.length;if(c%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let u=0;u<c;u+=4)U(this,u,u+3),U(this,u+1,u+2);return this},s.prototype.swap64=function(){let c=this.length;if(c%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let u=0;u<c;u+=8)U(this,u,u+7),U(this,u+1,u+6),U(this,u+2,u+5),U(this,u+3,u+4);return this},s.prototype.toString=function(){let c=this.length;return c===0?"":arguments.length===0?ut(this,0,c):nt.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(c){if(!s.isBuffer(c))throw new TypeError("Argument must be a Buffer");return this===c?!0:s.compare(this,c)===0},s.prototype.inspect=function(){let c="",u=n.INSPECT_MAX_BYTES;return c=this.toString("hex",0,u).replace(/(.{2})/g,"$1 ").trim(),this.length>u&&(c+=" ... "),"<Buffer "+c+">"},r&&(s.prototype[r]=s.prototype.inspect),s.prototype.compare=function(c,u,d,P,$){if(y(c,Uint8Array)&&(c=s.from(c,c.offset,c.byteLength)),!s.isBuffer(c))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof c);if(u===void 0&&(u=0),d===void 0&&(d=c?c.length:0),P===void 0&&(P=0),$===void 0&&($=this.length),u<0||d>c.length||P<0||$>this.length)throw new RangeError("out of range index");if(P>=$&&u>=d)return 0;if(P>=$)return-1;if(u>=d)return 1;if(u>>>=0,d>>>=0,P>>>=0,$>>>=0,this===c)return 0;let H=$-P,et=d-u,gt=Math.min(H,et),Et=this.slice(P,$),lt=c.slice(u,d);for(let mt=0;mt<gt;++mt)if(Et[mt]!==lt[mt]){H=Et[mt],et=lt[mt];break}return H<et?-1:et<H?1:0};function M(c,u,d,P,$){if(c.length===0)return-1;if(typeof d=="string"?(P=d,d=0):d>2147483647?d=2147483647:d<-2147483648&&(d=-2147483648),d=+d,O(d)&&(d=$?0:c.length-1),d<0&&(d=c.length+d),d>=c.length){if($)return-1;d=c.length-1}else if(d<0)if($)d=0;else return-1;if(typeof u=="string"&&(u=s.from(u,P)),s.isBuffer(u))return u.length===0?-1:q(c,u,d,P,$);if(typeof u=="number")return u=u&255,typeof Uint8Array.prototype.indexOf=="function"?$?Uint8Array.prototype.indexOf.call(c,u,d):Uint8Array.prototype.lastIndexOf.call(c,u,d):q(c,[u],d,P,$);throw new TypeError("val must be string, number or Buffer")}function q(c,u,d,P,$){let H=1,et=c.length,gt=u.length;if(P!==void 0&&(P=String(P).toLowerCase(),P==="ucs2"||P==="ucs-2"||P==="utf16le"||P==="utf-16le")){if(c.length<2||u.length<2)return-1;H=2,et/=2,gt/=2,d/=2}function Et(mt,wt){return H===1?mt[wt]:mt.readUInt16BE(wt*H)}let lt;if($){let mt=-1;for(lt=d;lt<et;lt++)if(Et(c,lt)===Et(u,mt===-1?0:lt-mt)){if(mt===-1&&(mt=lt),lt-mt+1===gt)return mt*H}else mt!==-1&&(lt-=lt-mt),mt=-1}else for(d+gt>et&&(d=et-gt),lt=d;lt>=0;lt--){let mt=!0;for(let wt=0;wt<gt;wt++)if(Et(c,lt+wt)!==Et(u,wt)){mt=!1;break}if(mt)return lt}return-1}s.prototype.includes=function(c,u,d){return this.indexOf(c,u,d)!==-1},s.prototype.indexOf=function(c,u,d){return M(this,c,u,d,!0)},s.prototype.lastIndexOf=function(c,u,d){return M(this,c,u,d,!1)};function G(c,u,d,P){d=Number(d)||0;let $=c.length-d;P?(P=Number(P),P>$&&(P=$)):P=$;let H=u.length;P>H/2&&(P=H/2);let et;for(et=0;et<P;++et){let gt=parseInt(u.substr(et*2,2),16);if(O(gt))return et;c[d+et]=gt}return et}function W(c,u,d,P){return f(I(u,c.length-d),c,d,P)}function at(c,u,d,P){return f(_(u),c,d,P)}function V(c,u,d,P){return f(L(u),c,d,P)}function ot(c,u,d,P){return f(S(u,c.length-d),c,d,P)}s.prototype.write=function(c,u,d,P){if(u===void 0)P="utf8",d=this.length,u=0;else if(d===void 0&&typeof u=="string")P=u,d=this.length,u=0;else if(isFinite(u))u=u>>>0,isFinite(d)?(d=d>>>0,P===void 0&&(P="utf8")):(P=d,d=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let $=this.length-u;if((d===void 0||d>$)&&(d=$),c.length>0&&(d<0||u<0)||u>this.length)throw new RangeError("Attempt to write outside buffer bounds");P||(P="utf8");let H=!1;for(;;)switch(P){case"hex":return G(this,c,u,d);case"utf8":case"utf-8":return W(this,c,u,d);case"ascii":case"latin1":case"binary":return at(this,c,u,d);case"base64":return V(this,c,u,d);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ot(this,c,u,d);default:if(H)throw new TypeError("Unknown encoding: "+P);P=(""+P).toLowerCase(),H=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function ct(c,u,d){return u===0&&d===c.length?t.fromByteArray(c):t.fromByteArray(c.slice(u,d))}function ut(c,u,d){d=Math.min(c.length,d);let P=[],$=u;for(;$<d;){let H=c[$],et=null,gt=H>239?4:H>223?3:H>191?2:1;if($+gt<=d){let Et,lt,mt,wt;switch(gt){case 1:H<128&&(et=H);break;case 2:Et=c[$+1],(Et&192)===128&&(wt=(H&31)<<6|Et&63,wt>127&&(et=wt));break;case 3:Et=c[$+1],lt=c[$+2],(Et&192)===128&&(lt&192)===128&&(wt=(H&15)<<12|(Et&63)<<6|lt&63,wt>2047&&(wt<55296||wt>57343)&&(et=wt));break;case 4:Et=c[$+1],lt=c[$+2],mt=c[$+3],(Et&192)===128&&(lt&192)===128&&(mt&192)===128&&(wt=(H&15)<<18|(Et&63)<<12|(lt&63)<<6|mt&63,wt>65535&&wt<1114112&&(et=wt))}}et===null?(et=65533,gt=1):et>65535&&(et-=65536,P.push(et>>>10&1023|55296),et=56320|et&1023),P.push(et),$+=gt}return yt(P)}var vt=4096;function yt(c){let u=c.length;if(u<=vt)return String.fromCharCode.apply(String,c);let d="",P=0;for(;P<u;)d+=String.fromCharCode.apply(String,c.slice(P,P+=vt));return d}function it(c,u,d){let P="";d=Math.min(c.length,d);for(let $=u;$<d;++$)P+=String.fromCharCode(c[$]&127);return P}function Ot(c,u,d){let P="";d=Math.min(c.length,d);for(let $=u;$<d;++$)P+=String.fromCharCode(c[$]);return P}function Dt(c,u,d){let P=c.length;(!u||u<0)&&(u=0),(!d||d<0||d>P)&&(d=P);let $="";for(let H=u;H<d;++H)$+=F[c[H]];return $}function oe(c,u,d){let P=c.slice(u,d),$="";for(let H=0;H<P.length-1;H+=2)$+=String.fromCharCode(P[H]+P[H+1]*256);return $}s.prototype.slice=function(c,u){let d=this.length;c=~~c,u=u===void 0?d:~~u,c<0?(c+=d,c<0&&(c=0)):c>d&&(c=d),u<0?(u+=d,u<0&&(u=0)):u>d&&(u=d),u<c&&(u=c);let P=this.subarray(c,u);return Object.setPrototypeOf(P,s.prototype),P};function bt(c,u,d){if(c%1!==0||c<0)throw new RangeError("offset is not uint");if(c+u>d)throw new RangeError("Trying to access beyond buffer length")}s.prototype.readUintLE=s.prototype.readUIntLE=function(c,u,d){c=c>>>0,u=u>>>0,d||bt(c,u,this.length);let P=this[c],$=1,H=0;for(;++H<u&&($*=256);)P+=this[c+H]*$;return P},s.prototype.readUintBE=s.prototype.readUIntBE=function(c,u,d){c=c>>>0,u=u>>>0,d||bt(c,u,this.length);let P=this[c+--u],$=1;for(;u>0&&($*=256);)P+=this[c+--u]*$;return P},s.prototype.readUint8=s.prototype.readUInt8=function(c,u){return c=c>>>0,u||bt(c,1,this.length),this[c]},s.prototype.readUint16LE=s.prototype.readUInt16LE=function(c,u){return c=c>>>0,u||bt(c,2,this.length),this[c]|this[c+1]<<8},s.prototype.readUint16BE=s.prototype.readUInt16BE=function(c,u){return c=c>>>0,u||bt(c,2,this.length),this[c]<<8|this[c+1]},s.prototype.readUint32LE=s.prototype.readUInt32LE=function(c,u){return c=c>>>0,u||bt(c,4,this.length),(this[c]|this[c+1]<<8|this[c+2]<<16)+this[c+3]*16777216},s.prototype.readUint32BE=s.prototype.readUInt32BE=function(c,u){return c=c>>>0,u||bt(c,4,this.length),this[c]*16777216+(this[c+1]<<16|this[c+2]<<8|this[c+3])},s.prototype.readBigUInt64LE=Z(function(c){c=c>>>0,p(c,"offset");let u=this[c],d=this[c+7];(u===void 0||d===void 0)&&C(c,this.length-8);let P=u+this[++c]*2**8+this[++c]*2**16+this[++c]*2**24,$=this[++c]+this[++c]*2**8+this[++c]*2**16+d*2**24;return BigInt(P)+(BigInt($)<<BigInt(32))}),s.prototype.readBigUInt64BE=Z(function(c){c=c>>>0,p(c,"offset");let u=this[c],d=this[c+7];(u===void 0||d===void 0)&&C(c,this.length-8);let P=u*2**24+this[++c]*2**16+this[++c]*2**8+this[++c],$=this[++c]*2**24+this[++c]*2**16+this[++c]*2**8+d;return(BigInt(P)<<BigInt(32))+BigInt($)}),s.prototype.readIntLE=function(c,u,d){c=c>>>0,u=u>>>0,d||bt(c,u,this.length);let P=this[c],$=1,H=0;for(;++H<u&&($*=256);)P+=this[c+H]*$;return $*=128,P>=$&&(P-=Math.pow(2,8*u)),P},s.prototype.readIntBE=function(c,u,d){c=c>>>0,u=u>>>0,d||bt(c,u,this.length);let P=u,$=1,H=this[c+--P];for(;P>0&&($*=256);)H+=this[c+--P]*$;return $*=128,H>=$&&(H-=Math.pow(2,8*u)),H},s.prototype.readInt8=function(c,u){return c=c>>>0,u||bt(c,1,this.length),this[c]&128?(255-this[c]+1)*-1:this[c]},s.prototype.readInt16LE=function(c,u){c=c>>>0,u||bt(c,2,this.length);let d=this[c]|this[c+1]<<8;return d&32768?d|4294901760:d},s.prototype.readInt16BE=function(c,u){c=c>>>0,u||bt(c,2,this.length);let d=this[c+1]|this[c]<<8;return d&32768?d|4294901760:d},s.prototype.readInt32LE=function(c,u){return c=c>>>0,u||bt(c,4,this.length),this[c]|this[c+1]<<8|this[c+2]<<16|this[c+3]<<24},s.prototype.readInt32BE=function(c,u){return c=c>>>0,u||bt(c,4,this.length),this[c]<<24|this[c+1]<<16|this[c+2]<<8|this[c+3]},s.prototype.readBigInt64LE=Z(function(c){c=c>>>0,p(c,"offset");let u=this[c],d=this[c+7];(u===void 0||d===void 0)&&C(c,this.length-8);let P=this[c+4]+this[c+5]*2**8+this[c+6]*2**16+(d<<24);return(BigInt(P)<<BigInt(32))+BigInt(u+this[++c]*2**8+this[++c]*2**16+this[++c]*2**24)}),s.prototype.readBigInt64BE=Z(function(c){c=c>>>0,p(c,"offset");let u=this[c],d=this[c+7];(u===void 0||d===void 0)&&C(c,this.length-8);let P=(u<<24)+this[++c]*2**16+this[++c]*2**8+this[++c];return(BigInt(P)<<BigInt(32))+BigInt(this[++c]*2**24+this[++c]*2**16+this[++c]*2**8+d)}),s.prototype.readFloatLE=function(c,u){return c=c>>>0,u||bt(c,4,this.length),e.read(this,c,!0,23,4)},s.prototype.readFloatBE=function(c,u){return c=c>>>0,u||bt(c,4,this.length),e.read(this,c,!1,23,4)},s.prototype.readDoubleLE=function(c,u){return c=c>>>0,u||bt(c,8,this.length),e.read(this,c,!0,52,8)},s.prototype.readDoubleBE=function(c,u){return c=c>>>0,u||bt(c,8,this.length),e.read(this,c,!1,52,8)};function Bt(c,u,d,P,$,H){if(!s.isBuffer(c))throw new TypeError('"buffer" argument must be a Buffer instance');if(u>$||u<H)throw new RangeError('"value" argument is out of bounds');if(d+P>c.length)throw new RangeError("Index out of range")}s.prototype.writeUintLE=s.prototype.writeUIntLE=function(c,u,d,P){if(c=+c,u=u>>>0,d=d>>>0,!P){let et=Math.pow(2,8*d)-1;Bt(this,c,u,d,et,0)}let $=1,H=0;for(this[u]=c&255;++H<d&&($*=256);)this[u+H]=c/$&255;return u+d},s.prototype.writeUintBE=s.prototype.writeUIntBE=function(c,u,d,P){if(c=+c,u=u>>>0,d=d>>>0,!P){let et=Math.pow(2,8*d)-1;Bt(this,c,u,d,et,0)}let $=d-1,H=1;for(this[u+$]=c&255;--$>=0&&(H*=256);)this[u+$]=c/H&255;return u+d},s.prototype.writeUint8=s.prototype.writeUInt8=function(c,u,d){return c=+c,u=u>>>0,d||Bt(this,c,u,1,255,0),this[u]=c&255,u+1},s.prototype.writeUint16LE=s.prototype.writeUInt16LE=function(c,u,d){return c=+c,u=u>>>0,d||Bt(this,c,u,2,65535,0),this[u]=c&255,this[u+1]=c>>>8,u+2},s.prototype.writeUint16BE=s.prototype.writeUInt16BE=function(c,u,d){return c=+c,u=u>>>0,d||Bt(this,c,u,2,65535,0),this[u]=c>>>8,this[u+1]=c&255,u+2},s.prototype.writeUint32LE=s.prototype.writeUInt32LE=function(c,u,d){return c=+c,u=u>>>0,d||Bt(this,c,u,4,4294967295,0),this[u+3]=c>>>24,this[u+2]=c>>>16,this[u+1]=c>>>8,this[u]=c&255,u+4},s.prototype.writeUint32BE=s.prototype.writeUInt32BE=function(c,u,d){return c=+c,u=u>>>0,d||Bt(this,c,u,4,4294967295,0),this[u]=c>>>24,this[u+1]=c>>>16,this[u+2]=c>>>8,this[u+3]=c&255,u+4};function tt(c,u,d,P,$){w(u,P,$,c,d,7);let H=Number(u&BigInt(4294967295));c[d++]=H,H=H>>8,c[d++]=H,H=H>>8,c[d++]=H,H=H>>8,c[d++]=H;let et=Number(u>>BigInt(32)&BigInt(4294967295));return c[d++]=et,et=et>>8,c[d++]=et,et=et>>8,c[d++]=et,et=et>>8,c[d++]=et,d}function de(c,u,d,P,$){w(u,P,$,c,d,7);let H=Number(u&BigInt(4294967295));c[d+7]=H,H=H>>8,c[d+6]=H,H=H>>8,c[d+5]=H,H=H>>8,c[d+4]=H;let et=Number(u>>BigInt(32)&BigInt(4294967295));return c[d+3]=et,et=et>>8,c[d+2]=et,et=et>>8,c[d+1]=et,et=et>>8,c[d]=et,d+8}s.prototype.writeBigUInt64LE=Z(function(c,u=0){return tt(this,c,u,BigInt(0),BigInt("0xffffffffffffffff"))}),s.prototype.writeBigUInt64BE=Z(function(c,u=0){return de(this,c,u,BigInt(0),BigInt("0xffffffffffffffff"))}),s.prototype.writeIntLE=function(c,u,d,P){if(c=+c,u=u>>>0,!P){let gt=Math.pow(2,8*d-1);Bt(this,c,u,d,gt-1,-gt)}let $=0,H=1,et=0;for(this[u]=c&255;++$<d&&(H*=256);)c<0&&et===0&&this[u+$-1]!==0&&(et=1),this[u+$]=(c/H>>0)-et&255;return u+d},s.prototype.writeIntBE=function(c,u,d,P){if(c=+c,u=u>>>0,!P){let gt=Math.pow(2,8*d-1);Bt(this,c,u,d,gt-1,-gt)}let $=d-1,H=1,et=0;for(this[u+$]=c&255;--$>=0&&(H*=256);)c<0&&et===0&&this[u+$+1]!==0&&(et=1),this[u+$]=(c/H>>0)-et&255;return u+d},s.prototype.writeInt8=function(c,u,d){return c=+c,u=u>>>0,d||Bt(this,c,u,1,127,-128),c<0&&(c=255+c+1),this[u]=c&255,u+1},s.prototype.writeInt16LE=function(c,u,d){return c=+c,u=u>>>0,d||Bt(this,c,u,2,32767,-32768),this[u]=c&255,this[u+1]=c>>>8,u+2},s.prototype.writeInt16BE=function(c,u,d){return c=+c,u=u>>>0,d||Bt(this,c,u,2,32767,-32768),this[u]=c>>>8,this[u+1]=c&255,u+2},s.prototype.writeInt32LE=function(c,u,d){return c=+c,u=u>>>0,d||Bt(this,c,u,4,2147483647,-2147483648),this[u]=c&255,this[u+1]=c>>>8,this[u+2]=c>>>16,this[u+3]=c>>>24,u+4},s.prototype.writeInt32BE=function(c,u,d){return c=+c,u=u>>>0,d||Bt(this,c,u,4,2147483647,-2147483648),c<0&&(c=4294967295+c+1),this[u]=c>>>24,this[u+1]=c>>>16,this[u+2]=c>>>8,this[u+3]=c&255,u+4},s.prototype.writeBigInt64LE=Z(function(c,u=0){return tt(this,c,u,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),s.prototype.writeBigInt64BE=Z(function(c,u=0){return de(this,c,u,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function rt(c,u,d,P,$,H){if(d+P>c.length)throw new RangeError("Index out of range");if(d<0)throw new RangeError("Index out of range")}function pe(c,u,d,P,$){return u=+u,d=d>>>0,$||rt(c,u,d,4,34028234663852886e22,-34028234663852886e22),e.write(c,u,d,P,23,4),d+4}s.prototype.writeFloatLE=function(c,u,d){return pe(this,c,u,!0,d)},s.prototype.writeFloatBE=function(c,u,d){return pe(this,c,u,!1,d)};function Mt(c,u,d,P,$){return u=+u,d=d>>>0,$||rt(c,u,d,8,17976931348623157e292,-17976931348623157e292),e.write(c,u,d,P,52,8),d+8}s.prototype.writeDoubleLE=function(c,u,d){return Mt(this,c,u,!0,d)},s.prototype.writeDoubleBE=function(c,u,d){return Mt(this,c,u,!1,d)},s.prototype.copy=function(c,u,d,P){if(!s.isBuffer(c))throw new TypeError("argument should be a Buffer");if(d||(d=0),!P&&P!==0&&(P=this.length),u>=c.length&&(u=c.length),u||(u=0),P>0&&P<d&&(P=d),P===d||c.length===0||this.length===0)return 0;if(u<0)throw new RangeError("targetStart out of bounds");if(d<0||d>=this.length)throw new RangeError("Index out of range");if(P<0)throw new RangeError("sourceEnd out of bounds");P>this.length&&(P=this.length),c.length-u<P-d&&(P=c.length-u+d);let $=P-d;return this===c&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(u,d,P):Uint8Array.prototype.set.call(c,this.subarray(d,P),u),$},s.prototype.fill=function(c,u,d,P){if(typeof c=="string"){if(typeof u=="string"?(P=u,u=0,d=this.length):typeof d=="string"&&(P=d,d=this.length),P!==void 0&&typeof P!="string")throw new TypeError("encoding must be a string");if(typeof P=="string"&&!s.isEncoding(P))throw new TypeError("Unknown encoding: "+P);if(c.length===1){let H=c.charCodeAt(0);(P==="utf8"&&H<128||P==="latin1")&&(c=H)}}else typeof c=="number"?c=c&255:typeof c=="boolean"&&(c=Number(c));if(u<0||this.length<u||this.length<d)throw new RangeError("Out of range index");if(d<=u)return this;u=u>>>0,d=d===void 0?this.length:d>>>0,c||(c=0);let $;if(typeof c=="number")for($=u;$<d;++$)this[$]=c;else{let H=s.isBuffer(c)?c:s.from(c,P),et=H.length;if(et===0)throw new TypeError('The value "'+c+'" is invalid for argument "value"');for($=0;$<d-u;++$)this[$+u]=H[$%et]}return this};var Nt={};function T(c,u,d){Nt[c]=class extends d{constructor(){super(),Object.defineProperty(this,"message",{value:u.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${c}]`,this.stack,delete this.name}get code(){return c}set code(P){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:P,writable:!0})}toString(){return`${this.name} [${c}]: ${this.message}`}}}T("ERR_BUFFER_OUT_OF_BOUNDS",function(c){return c?`${c} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),T("ERR_INVALID_ARG_TYPE",function(c,u){return`The "${c}" argument must be of type number. Received type ${typeof u}`},TypeError),T("ERR_OUT_OF_RANGE",function(c,u,d){let P=`The value of "${c}" is out of range.`,$=d;return Number.isInteger(d)&&Math.abs(d)>2**32?$=k(String(d)):typeof d=="bigint"&&($=String(d),(d>BigInt(2)**BigInt(32)||d<-(BigInt(2)**BigInt(32)))&&($=k($)),$+="n"),P+=` It must be ${u}. Received ${$}`,P},RangeError);function k(c){let u="",d=c.length,P=c[0]==="-"?1:0;for(;d>=P+4;d-=3)u=`_${c.slice(d-3,d)}${u}`;return`${c.slice(0,d)}${u}`}function h(c,u,d){p(u,"offset"),(c[u]===void 0||c[u+d]===void 0)&&C(u,c.length-(d+1))}function w(c,u,d,P,$,H){if(c>d||c<u){let et=typeof u=="bigint"?"n":"",gt;throw H>3?u===0||u===BigInt(0)?gt=`>= 0${et} and < 2${et} ** ${(H+1)*8}${et}`:gt=`>= -(2${et} ** ${(H+1)*8-1}${et}) and < 2 ** ${(H+1)*8-1}${et}`:gt=`>= ${u}${et} and <= ${d}${et}`,new Nt.ERR_OUT_OF_RANGE("value",gt,c)}h(P,$,H)}function p(c,u){if(typeof c!="number")throw new Nt.ERR_INVALID_ARG_TYPE(u,"number",c)}function C(c,u,d){throw Math.floor(c)!==c?(p(c,d),new Nt.ERR_OUT_OF_RANGE(d||"offset","an integer",c)):u<0?new Nt.ERR_BUFFER_OUT_OF_BOUNDS:new Nt.ERR_OUT_OF_RANGE(d||"offset",`>= ${d?1:0} and <= ${u}`,c)}var x=/[^+/0-9A-Za-z-_]/g;function b(c){if(c=c.split("=")[0],c=c.trim().replace(x,""),c.length<2)return"";for(;c.length%4!==0;)c=c+"=";return c}function I(c,u){u=u||1/0;let d,P=c.length,$=null,H=[];for(let et=0;et<P;++et){if(d=c.charCodeAt(et),d>55295&&d<57344){if(!$){if(d>56319){(u-=3)>-1&&H.push(239,191,189);continue}else if(et+1===P){(u-=3)>-1&&H.push(239,191,189);continue}$=d;continue}if(d<56320){(u-=3)>-1&&H.push(239,191,189),$=d;continue}d=($-55296<<10|d-56320)+65536}else $&&(u-=3)>-1&&H.push(239,191,189);if($=null,d<128){if((u-=1)<0)break;H.push(d)}else if(d<2048){if((u-=2)<0)break;H.push(d>>6|192,d&63|128)}else if(d<65536){if((u-=3)<0)break;H.push(d>>12|224,d>>6&63|128,d&63|128)}else if(d<1114112){if((u-=4)<0)break;H.push(d>>18|240,d>>12&63|128,d>>6&63|128,d&63|128)}else throw new Error("Invalid code point")}return H}function _(c){let u=[];for(let d=0;d<c.length;++d)u.push(c.charCodeAt(d)&255);return u}function S(c,u){let d,P,$,H=[];for(let et=0;et<c.length&&!((u-=2)<0);++et)d=c.charCodeAt(et),P=d>>8,$=d%256,H.push($),H.push(P);return H}function L(c){return t.toByteArray(b(c))}function f(c,u,d,P){let $;for($=0;$<P&&!($+d>=u.length||$>=c.length);++$)u[$+d]=c[$];return $}function y(c,u){return c instanceof u||c!=null&&c.constructor!=null&&c.constructor.name!=null&&c.constructor.name===u.name}function O(c){return c!==c}var F=function(){let c="0123456789abcdef",u=new Array(256);for(let d=0;d<16;++d){let P=d*16;for(let $=0;$<16;++$)u[P+$]=c[d]+c[$]}return u}();function Z(c){return typeof BigInt>"u"?st:c}function st(){throw new Error("BigInt not supported")}}),cw=Lt((n,t)=>{window.global=window,J.fetch=window.fetch,t.exports={Buffer:gh().Buffer,Crypto:window.crypto}}),dh={};Gy(dh,{AVSCTap:()=>ua,ArweaveSigner:()=>ca,DataItem:()=>Wi,InjectedArweaveSigner:()=>bw,MAX_TAG_BYTES:()=>Dc,MIN_BINARY_SIZE:()=>vh,Signer:()=>uw,createData:()=>Mc,deserializeTags:()=>Pc,indexToType:()=>wh,serializeTags:()=>mh,tagsExceedLimit:()=>Wc});var uw=class{signer;publicKey;signatureType;signatureLength;ownerLength;pem;static verify(n,t,e,r){throw new Error("You must implement verify method on child")}},lw=ar(aa(),1),Ae=ar(Ve(),1);async function ph(n){if(Array.isArray(n)){let i=(0,Ae.concatBuffers)([(0,Ae.stringToBuffer)("list"),(0,Ae.stringToBuffer)(n.length.toString())]);return await yh(n,await or().hash(i,"SHA-384"))}let t=n,e=(0,Ae.concatBuffers)([(0,Ae.stringToBuffer)("blob"),(0,Ae.stringToBuffer)(t.byteLength.toString())]),r=(0,Ae.concatBuffers)([await or().hash(e,"SHA-384"),await or().hash(t,"SHA-384")]);return await or().hash(r,"SHA-384")}async function yh(n,t){if(n.length<1)return t;let e=(0,Ae.concatBuffers)([t,await ph(n[0])]),r=await or().hash(e,"SHA-384");return await yh(n.slice(1),r)}var Bc=ar(fh(),1),fw=Bc.default.default?Bc.default.default:Bc.default,hw=class extends fw{getPublicKey(n){throw new Error("Unimplemented")}},gw;function or(){return gw??=new hw}var ge;(function(n){n[n.ARWEAVE=1]="ARWEAVE",n[n.ED25519=2]="ED25519",n[n.ETHEREUM=3]="ETHEREUM",n[n.SOLANA=4]="SOLANA",n[n.INJECTEDAPTOS=5]="INJECTEDAPTOS",n[n.MULTIAPTOS=6]="MULTIAPTOS",n[n.TYPEDETHEREUM=7]="TYPEDETHEREUM"})(ge||(ge={}));var Ln={[ge.ARWEAVE]:{sigLength:512,pubLength:512,sigName:"arweave"},[ge.ED25519]:{sigLength:64,pubLength:32,sigName:"ed25519"},[ge.ETHEREUM]:{sigLength:65,pubLength:65,sigName:"ethereum"},[ge.SOLANA]:{sigLength:64,pubLength:32,sigName:"solana"},[ge.INJECTEDAPTOS]:{sigLength:64,pubLength:32,sigName:"injectedAptos"},[ge.MULTIAPTOS]:{sigLength:64*32+4,pubLength:32*32+1,sigName:"multiAptos"},[ge.TYPEDETHEREUM]:{sigLength:65,pubLength:42,sigName:"typedEthereum"}},ca=class{signatureType=1;ownerLength=Ln[1].pubLength;signatureLength=Ln[1].sigLength;jwk;pk;constructor(n){this.pk=n.n,this.jwk=n}get publicKey(){return lw.default.toBuffer(this.pk)}sign(n){return or().sign(this.jwk,n)}static async verify(n,t,e){return await or().verify(n,t,e)}},wh={1:ca},dw=ar(aw(),1),pw=ar(aa(),1),Ke=ar(aa(),1);async function Rc(n){return ph([(0,Ae.stringToBuffer)("dataitem"),(0,Ae.stringToBuffer)("1"),(0,Ae.stringToBuffer)(n.signatureType.toString()),n.rawOwner,n.rawTarget,n.rawAnchor,n.rawTags,n.rawData])}async function yw(n,t){let e=await Rc(n),r=await t.sign(e),i=await or().hash(r);return{signature:Q.Buffer.from(r),id:Q.Buffer.from(i)}}async function ww(n,t){let{signature:e,id:r}=await yw(n,t);return n.getRaw().set(e,2),r}var ua=class{buf;pos;constructor(n=Q.Buffer.alloc(Dc),t=0){this.buf=n,this.pos=t}writeTags(n){if(!Array.isArray(n))throw new Error("input must be array");let t=n.length,e;if(t)for(this.writeLong(t),e=0;e<t;e++){let r=n[e];if(r?.name===void 0||r?.value===void 0)throw new Error(`Invalid tag format for ${r}, expected {name:string, value: string}`);this.writeString(r.name),this.writeString(r.value)}this.writeLong(0)}toBuffer(){let n=Q.Buffer.alloc(this.pos);if(this.pos>this.buf.length)throw new Error(`Too many tag bytes (${this.pos} > ${this.buf.length})`);return this.buf.copy(n,0,0,this.pos),n}tagsExceedLimit(){return this.pos>this.buf.length}writeLong(n){let t=this.buf,e,r;if(n>=-1073741824&&n<1073741824){r=n>=0?n<<1:~n<<1|1;do t[this.pos]=r&127,r>>=7;while(r&&(t[this.pos++]|=128))}else{e=n>=0?n*2:-n*2-1;do t[this.pos]=e&127,e/=128;while(e>=1&&(t[this.pos++]|=128))}this.pos++,this.buf=t}writeString(n){let t=Q.Buffer.byteLength(n),e=this.buf;this.writeLong(t);let r=this.pos;if(this.pos+=t,!(this.pos>e.length)){if(t>64)this.buf.write(n,this.pos-t,t,"utf8");else{let i,o,a,s;for(i=0,o=t;i<o;i++)a=n.charCodeAt(i),a<128?e[r++]=a:a<2048?(e[r++]=a>>6|192,e[r++]=a&63|128):(a&64512)===55296&&((s=n.charCodeAt(i+1))&64512)===56320?(a=65536+((a&1023)<<10)+(s&1023),i++,e[r++]=a>>18|240,e[r++]=a>>12&63|128,e[r++]=a>>6&63|128,e[r++]=a&63|128):(e[r++]=a>>12|224,e[r++]=a>>6&63|128,e[r++]=a&63|128)}this.buf=e}}readLong(){let n=0,t=0,e=this.buf,r,i,o,a;do r=e[this.pos++],i=r&128,n|=(r&127)<<t,t+=7;while(i&&t<28);if(i){o=n,a=268435456;do r=e[this.pos++],o+=(r&127)*a,a*=128;while(r&128);return(o%2?-(o+1):o)/2}return n>>1^-(n&1)}skipLong(){let n=this.buf;for(;n[this.pos++]&128;);}readTags(){let n=[],t;for(;t=this.readLong();)for(t<0&&(t=-t,this.skipLong());t--;){let e=this.readString(),r=this.readString();n.push({name:e,value:r})}return n}readString(){let n=this.readLong(),t=this.pos,e=this.buf;if(this.pos+=n,!(this.pos>e.length))return this.buf.slice(t,t+n).toString()}};function mh(n){let t=new ua;return t.writeTags(n),t.toBuffer()}function Wc(n){let t=new ua;return t.writeTags(n),t.tagsExceedLimit()}function Pc(n){return new ua(n).readTags()}function Cr(n){let t=0;for(let e=n.length-1;e>=0;e--)t=t*256+n[e];return t}function mw(n){if(n>(2^32-1))throw new Error("Short too long");let t=[0,0];for(let e=0;e<t.length;e++){let r=n&255;t[e]=r,n=(n-r)/256}return Uint8Array.from(t)}function uh(n){let t=[0,0,0,0,0,0,0,0];for(let e=0;e<t.length;e++){let r=n&255;t[e]=r,n=(n-r)/256}return Uint8Array.from(t)}var vw=ar(cw(),1),kn=ar(gh(),1),Dc=4096,vh=80,Wi=class{binary;_id;constructor(n){this.binary=n}static isDataItem(n){return n.binary!==void 0}get signatureType(){let n=Cr(this.binary.subarray(0,2));if(ge?.[n]!==void 0)return n;throw new Error("Unknown signature type: "+n)}async isValid(){return Wi.verify(this.binary)}get id(){return(async()=>Ke.default.encode(await this.rawId))()}set id(n){this._id=Ke.default.toBuffer(n)}get rawId(){return(async()=>kn.Buffer.from(await vw.Crypto.subtle.digest("SHA-256",this.rawSignature)))()}set rawId(n){this._id=n}get rawSignature(){return this.binary.subarray(2,2+this.signatureLength)}get signature(){return Ke.default.encode(this.rawSignature)}set rawOwner(n){if(n.byteLength!=this.ownerLength)throw new Error(`Expected raw owner (pubkey) to be ${this.ownerLength} bytes, got ${n.byteLength} bytes.`);this.binary.set(n,2+this.signatureLength)}get rawOwner(){return this.binary.subarray(2+this.signatureLength,2+this.signatureLength+this.ownerLength)}get signatureLength(){return Ln[this.signatureType].sigLength}get owner(){return Ke.default.encode(this.rawOwner)}get ownerLength(){return Ln[this.signatureType].pubLength}get rawTarget(){let n=this.getTargetStart();return this.binary[n]==1?this.binary.subarray(n+1,n+33):kn.Buffer.alloc(0)}get target(){return Ke.default.encode(this.rawTarget)}get rawAnchor(){let n=this.getAnchorStart();return this.binary[n]==1?this.binary.subarray(n+1,n+33):kn.Buffer.alloc(0)}get anchor(){return this.rawAnchor.toString()}get rawTags(){let n=this.getTagsStart(),t=Cr(this.binary.subarray(n+8,n+16));return this.binary.subarray(n+16,n+16+t)}get tags(){let n=this.getTagsStart();if(Cr(this.binary.subarray(n,n+8))==0)return[];let t=Cr(this.binary.subarray(n+8,n+16));return Pc(kn.Buffer.from(this.binary.subarray(n+16,n+16+t)))}get tagsB64Url(){return this.tags.map(n=>({name:Ke.default.encode(n.name),value:Ke.default.encode(n.value)}))}getStartOfData(){let n=this.getTagsStart(),t=this.binary.subarray(n+8,n+16),e=Cr(t);return n+16+e}get rawData(){let n=this.getTagsStart(),t=this.binary.subarray(n+8,n+16),e=Cr(t),r=n+16+e;return this.binary.subarray(r,this.binary.length)}get data(){return Ke.default.encode(this.rawData)}getRaw(){return this.binary}async sign(n){return this._id=await ww(this,n),this.rawId}async setSignature(n){this.binary.set(n,2),this._id=kn.Buffer.from(await or().hash(n))}isSigned(){return(this._id?.length??0)>0}toJSON(){return{signature:this.signature,owner:this.owner,target:this.target,tags:this.tags.map(n=>({name:Ke.default.encode(n.name),value:Ke.default.encode(n.value)})),data:this.data}}static async verify(n){if(n.byteLength<vh)return!1;let t=new Wi(n),e=t.signatureType,r=t.getTagsStart(),i=Cr(n.subarray(r,r+8)),o=n.subarray(r+8,r+16),a=Cr(o);if(a>Dc)return!1;if(i>0)try{if(Pc(kn.Buffer.from(n.subarray(r+16,r+16+a))).length!==i)return!1}catch{return!1}let s=wh[e],l=await Rc(t);return await s.verify(t.rawOwner,l,t.rawSignature)}async getSignatureData(){return Rc(this)}getTagsStart(){let n=this.getTargetStart(),t=this.binary[n]==1,e=n+(t?33:1),r=this.binary[e]==1;return e+=r?33:1,e}getTargetStart(){return 2+this.signatureLength+this.ownerLength}getAnchorStart(){let n=this.getTargetStart()+1,t=this.binary[this.getTargetStart()]==1;return n+=t?32:0,n}},bw=class{signer;publicKey;ownerLength=Ln[ge.ARWEAVE].pubLength;signatureLength=Ln[ge.ARWEAVE].sigLength;signatureType=ge.ARWEAVE;constructor(n){this.signer=n}async setPublicKey(){let n;this.signer.getPublicKey?n=await this.signer.getPublicKey():n=await this.signer.getActivePublicKey(),this.publicKey=pw.default.toBuffer(n)}async sign(n){this.publicKey||await this.setPublicKey();let t={name:"RSA-PSS",saltLength:0},e=await this.signer.signature(n,t);return new Uint8Array(Object.values(e))}async signDataItem(n,t){return this.publicKey||await this.setPublicKey(),new Wi(Q.Buffer.from(await this.signer.signDataItem({data:n,tags:t})))}static async verify(n,t,e){return await dw.default.crypto.verify(n,t,e)}},_w=ar(aa(),1);function Mc(n,t,e){let r=t.publicKey,i=e?.target?_w.default.toBuffer(e.target):null,o=1+(i?.byteLength??0),a=e?.anchor?Q.Buffer.from(e.anchor):null,s=1+(a?.byteLength??0),l=(e?.tags?.length??0)>0?mh(e.tags):null,g=16+(l?l.byteLength:0),v=Q.Buffer.from(n),A=v.byteLength,B=2+t.signatureLength+t.ownerLength+o+s+g+A,m=Q.Buffer.alloc(B);if(m.set(mw(t.signatureType),0),m.set(new Uint8Array(t.signatureLength).fill(0),2),r.byteLength!==t.ownerLength)throw new Error(`Owner must be ${t.ownerLength} bytes, but was incorrectly ${r.byteLength}`);m.set(r,2+t.signatureLength);let E=2+t.signatureLength+t.ownerLength;if(m[E]=i?1:0,i){if(i.byteLength!==32)throw new Error(`Target must be 32 bytes but was incorrectly ${i.byteLength}`);m.set(i,E+1)}let N=E+o,D=N+1;if(m[N]=a?1:0,a){if(D+=a.byteLength,a.byteLength!==32)throw new Error("Anchor must be 32 bytes");m.set(a,N+1)}m.set(uh(e?.tags?.length??0),D);let K=uh(l?.byteLength??0);m.set(K,D+8),l&&m.set(l,D+16);let X=D+g;return m.set(v,X),new Wi(m)}var Ew={...dh};globalThis.arbundles??=Ew;var Di=class{signer;bundlerSigner;type;warp;signatureProviderType;wallet;cachedAddress;constructor(t,e){this.warp=t,this.isCustomSignature(e)?(this.assertEnvForCustomSigner(e.type),this.signer=e.signer,this.type=e.type,this.signatureProviderType="CustomSignature"):this.isValidBundlerSignature(e)?(this.signatureProviderType="BundlerSigner",this.type=Sw(e.signatureType),this.bundlerSigner=e):(this.assignArweaveSigner(e),this.bundlerSigner=typeof e=="string"?null:new ca(e),this.signatureProviderType="ArWallet",this.type="arweave"),this.wallet=e}async getAddress(){if(this.cachedAddress)return this.cachedAddress;switch(this.signatureProviderType){case"CustomSignature":return this.wallet.getAddress?this.cachedAddress=await this.wallet.getAddress():this.cachedAddress=await this.deduceSignerBySigning(),this.cachedAddress;case"ArWallet":return this.cachedAddress=await this.deduceSignerBySigning(),this.cachedAddress;case"BundlerSigner":return this.cachedAddress=await this.deduceSignerBySigning(),this.cachedAddress;default:throw Error("Unknown Signature::signatureProvider : "+this.signatureProviderType)}}async deduceSignerBySigning(){let{arweave:t}=this.warp;if(this.signatureProviderType=="BundlerSigner")try{return await this.bundlerSigner.getAddress()}catch{throw new Error("Could not get address from the signer. Is the 'getAddress' implementation correct?'")}else if(this.signatureProviderType=="ArWallet"||this.signatureProviderType=="CustomSignature"){let e=await t.createTransaction({data:Math.random().toString().slice(-4),reward:"72600854",last_tx:"p7vc1iSP6bvH_fCeUFa9LqoV5qiyW-jdEKouAT0XMoSwrNraB9mgpi29Q10waEpO"});return await this.signer(e),t.wallets.ownerToAddress(e.owner)}else throw Error("Unknown Signature::type")}checkNonArweaveSigningAvailability(t){if(this.type!=="arweave"&&!t)throw new Error(`Unable to use signing function of type: ${this.type} when bundling is disabled.`)}checkBundlerSignerAvailability(t){if((!t||this.warp.environment=="local")&&this.signatureProviderType=="BundlerSigner")throw new Error("Only wallet of type 'ArWallet' or 'CustomSignature' is allowed when bundling is disabled or in local environment.")}assignArweaveSigner(t){this.signer=async e=>{await this.warp.arweave.transactions.sign(e,t)}}assertEnvForCustomSigner(t){if(this.warp.interactionsLoader.type()==="warp")throw new Error("Unable to use signing function when bundling is enabled.");if(t=="ethereum")throw new Error(`Unable to use signing function with signature of type: ${t}.`)}isCustomSignature(t){return t.signer!==void 0&&t.type!==void 0}isValidBundlerSignature(t){let e=t,r=!!e.signatureType&&!!e.ownerLength&&!!e.signatureLength;if(r&&!e.publicKey)throw new Error("It seems that you are using BundlerSigner, but publicKey is not set! Maybe try calling await bundlerSigner.setPublicKey() before using it.");return r}};function Sw(n){if(n===3)return"ethereum";if(n===1)return"arweave";throw Error(`Not supported arbundle SignatureType : ${n}`)}R();var Mi=class{rootOptions;saferEvaluationOptions={internalWrites:t=>{if(t.internalWrites===void 0||this.rootOptions.internalWrites==t.internalWrites)return this.rootOptions.internalWrites;if(this.rootOptions.internalWrites&&!t.internalWrites||!this.rootOptions.internalWrites&&t.internalWrites)return t.internalWrites;throw new Error('Could not determine "internalWrites" value ')},throwOnInternalWriteError:t=>t.throwOnInternalWriteError===void 0?this.rootOptions.throwOnInternalWriteError:t.throwOnInternalWriteError,unsafeClient:t=>{if(t.unsafeClient===void 0||this.rootOptions.unsafeClient==t.unsafeClient)return this.rootOptions.unsafeClient;if(this.rootOptions.unsafeClient==="throw"||this.rootOptions.unsafeClient==="skip")return this.rootOptions.unsafeClient;if(this.rootOptions.unsafeClient==="allow")return t.unsafeClient==="throw"?"skip":t.unsafeClient;throw new Error('Could not determine "unsafeClient" value')},ignoreExceptions:t=>{if(t.ignoreExceptions===void 0||this.rootOptions.ignoreExceptions==t.ignoreExceptions)return this.rootOptions.ignoreExceptions;if(this.rootOptions.ignoreExceptions&&!t.ignoreExceptions)return this.rootOptions.ignoreExceptions;if(!this.rootOptions.ignoreExceptions&&t.ignoreExceptions)return this.rootOptions.ignoreExceptions;throw new Error('Could not determine "ignoreExceptions" value')},waitForConfirmation:()=>this.rootOptions.waitForConfirmation,updateCacheForEachInteraction:()=>this.rootOptions.updateCacheForEachInteraction,maxCallDepth:()=>this.rootOptions.maxCallDepth,maxInteractionEvaluationTimeSeconds:()=>this.rootOptions.maxInteractionEvaluationTimeSeconds,stackTrace:()=>this.rootOptions.stackTrace,sourceType:()=>this.rootOptions.sourceType,sequencerUrl:()=>this.rootOptions.sequencerUrl,gasLimit:()=>this.rootOptions.gasLimit,allowBigInt:()=>this.rootOptions.allowBigInt,walletBalanceUrl:()=>this.rootOptions.walletBalanceUrl,mineArLocalBlocks:()=>this.rootOptions.mineArLocalBlocks,cacheEveryNInteractions:()=>this.rootOptions.cacheEveryNInteractions,remoteStateSyncEnabled:()=>this.rootOptions.remoteStateSyncEnabled,remoteStateSyncSource:()=>this.rootOptions.remoteStateSyncSource,useKVStorage:t=>t.useKVStorage,useConstructor:t=>t.useConstructor};notConflictingEvaluationOptions=["useKVStorage","sourceType","useConstructor"];constructor(t,e){if(e){let r=[];for(let i in e){let o=i,a=e[i],s=t[i];if(!this.notConflictingEvaluationOptions.includes(o))if(o==="internalWrites"){if(s===!1&&a===!0)throw new Error("Cannot proceed with contract evaluation. User is blocking internal writes, while contract requires them.")}else if(o==="unsafeClient"){if(s==="throw"&&a!=="throw"||s==="skip"&&a==="allow")throw new Error(`Cannot proceed with contract evaluation. User requires to ${s} on any unsafeClient usage, while contract uses ${a} option.`)}else t[i]!==e[i]&&r.push(`Option {${i}} differs. EvaluationOptions: [${t[i]}], manifest: [${e[i]}]. Use contract.setEvaluationOptions({${i}: ${e[i]}}) to evaluate contract state.`)}if(r.length)throw new Error(r.join(`
`))}this.rootOptions=Object.freeze(Object.assign({},t,e||{}))}forForeignContract(t){let e=_r(this.rootOptions);if(t)for(let r in t)e[r]=this.saferEvaluationOptions[r](t);return Object.freeze(e)}};R();var $i=class{constructor(t){this.warp=t;this.warp=t}name="WarpFetchWrapper";logger=dt.INST.create(this.name);fetch(t,e){let r;if(this.warp.hasPlugin("fetch-options")){let i=this.warp.loadPlugin("fetch-options");try{let o=i.process({input:t,init:e||{}});r={...e,...o}}catch(o){throw o.message&&this.logger.error(o.message),new Error(`Unable to process fetch options: ${o.message}`)}}else r=e;return fetch(t,r)}};R();var aS=new Error("timeout while waiting for mutex to become available"),sS=new Error("mutex already locked"),Tw=new Error("request for lock canceled"),xw=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(a){a(o)})}return new(e||(e=Promise))(function(o,a){function s(v){try{g(r.next(v))}catch(A){a(A)}}function l(v){try{g(r.throw(v))}catch(A){a(A)}}function g(v){v.done?o(v.value):i(v.value).then(s,l)}g((r=r.apply(n,t||[])).next())})},$c=class{constructor(t,e=Tw){this._value=t,this._cancelError=e,this._weightedQueues=[],this._weightedWaiters=[]}acquire(t=1){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return new Promise((e,r)=>{this._weightedQueues[t-1]||(this._weightedQueues[t-1]=[]),this._weightedQueues[t-1].push({resolve:e,reject:r}),this._dispatch()})}runExclusive(t,e=1){return xw(this,void 0,void 0,function*(){let[r,i]=yield this.acquire(e);try{return yield t(r)}finally{i()}})}waitForUnlock(t=1){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return new Promise(e=>{this._weightedWaiters[t-1]||(this._weightedWaiters[t-1]=[]),this._weightedWaiters[t-1].push(e),this._dispatch()})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(t){this._value=t,this._dispatch()}release(t=1){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);this._value+=t,this._dispatch()}cancel(){this._weightedQueues.forEach(t=>t.forEach(e=>e.reject(this._cancelError))),this._weightedQueues=[]}_dispatch(){var t;for(let e=this._value;e>0;e--){let r=(t=this._weightedQueues[e-1])===null||t===void 0?void 0:t.shift();if(!r)continue;let i=this._value,o=e;this._value-=e,e=this._value+1,r.resolve([i,this._newReleaser(o)])}this._drainUnlockWaiters()}_newReleaser(t){let e=!1;return()=>{e||(e=!0,this.release(t))}}_drainUnlockWaiters(){for(let t=this._value;t>0;t--)this._weightedWaiters[t-1]&&(this._weightedWaiters[t-1].forEach(e=>e()),this._weightedWaiters[t-1]=[])}},Cw=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(a){a(o)})}return new(e||(e=Promise))(function(o,a){function s(v){try{g(r.next(v))}catch(A){a(A)}}function l(v){try{g(r.throw(v))}catch(A){a(A)}}function g(v){v.done?o(v.value):i(v.value).then(s,l)}g((r=r.apply(n,t||[])).next())})},la=class{constructor(t){this._semaphore=new $c(1,t)}acquire(){return Cw(this,void 0,void 0,function*(){let[,t]=yield this._semaphore.acquire();return t})}runExclusive(t){return this._semaphore.runExclusive(()=>t())}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}};R();var Fi=class{constructor(t){this._warp=t}_json=new Map;_initialJson=new Map;_kv=new Map;has(t){return this._json.has(t)}get(t){return this._json.get(t)||null}async getKV(t,e){return this._kv.has(t)&&(await this._kv.get(t).get(e))?.cachedValue||null}async delKV(t,e){this._kv.has(t)&&await this._kv.get(t).del(e)}getKvKeys(t,e,r){return this._warp.kvStorageFactory(t).keys(e,r)}getKvRange(t,e,r){return this._warp.kvStorageFactory(t).kvMap(e,r)}async commit(t){if(t.dry)return await this.rollbackKVs(),this.reset();try{await this.doStoreJson(this._json,t),await this.commitKVs()}finally{this.reset()}}async commitKV(){await this.commitKVs(),this._kv.clear()}async rollback(t){try{await this.doStoreJson(this._initialJson,t),await this.rollbackKVs()}finally{this.reset()}}setInitial(t,e){this._initialJson.set(t,e),this._json.set(t,e)}update(t,e){this._json.set(t,e)}async updateKV(t,e,r){await(await this.getOrInitKvStorage(t)).put(e,r)}async getOrInitKvStorage(t){if(this._kv.has(t))return this._kv.get(t);let e=this._warp.kvStorageFactory(t);return this._kv.set(t,e),await e.open(),e}reset(){this._json.clear(),this._initialJson.clear(),this._kv.clear()}async doStoreJson(t,e){if(t.size>1)for(let[r,i]of t)await this._warp.stateEvaluator.putInCache(r,e,i)}async rollbackKVs(){for(let t of this._kv.values())try{await t.rollback()}finally{await t.close()}}async commitKVs(){for(let t of this._kv.values())try{await t.commit()}finally{await t.close()}}};var bh=zt(br()),_h=zt(Go());var Zr=class{constructor(t,e,r=null,i=null){this._contractTxId=t;this.warp=e;this._parentContract=r;this._innerCallData=i;if(this.waitForConfirmation=this.waitForConfirmation.bind(this),this._arweaveWrapper=new te(e),this._sorter=new nr(e.arweave),r!=null){this._evaluationOptions=this.getRoot().evaluationOptions(),this._callDepth=r.callDepth()+1;let o=r.getCallStack().getInteraction(i.callingInteraction.id);if(this._callDepth>this._evaluationOptions.maxCallDepth)throw new Error(`Max call depth of ${this._evaluationOptions.maxCallDepth} has been exceeded for interaction ${JSON.stringify(o.interactionInput)}`);if(this.logger.debug("Calling interaction",{id:i.callingInteraction.id,sortKey:i.callingInteraction.sortKey,type:i.callType}),o.interactionInput?.foreignContractCalls[t]?.innerCallType==="write"&&i.callType==="read")throw new Error("Calling a readContractState after performing an inner write is wrong - instead use a state from the result of an internal write.");let a=new Jr(t,this._callDepth,i?.callType);o.interactionInput.foreignContractCalls[t]=a,this._callStack=a,this._rootSortKey=r.rootSortKey,r._children.push(this)}else this._callDepth=0,this._callStack=new Jr(t,0),this._rootSortKey=null,this._evaluationOptions=new oi,this._children=[],this._interactionState=new Fi(e);this.getCallStack=this.getCallStack.bind(this),this._warpFetchWrapper=new $i(this.warp)}logger=dt.INST.create("HandlerBasedContract");ecLogger=dt.INST.create("ExecutionContext");_innerWritesEvaluator=new Ui;_callDepth;_arweaveWrapper;_mutex=new la;_callStack;_evaluationOptions;_eoEvaluator;_benchmarkStats=null;_sorter;_rootSortKey;_signature;_warpFetchWrapper;_children=[];_interactionState;_dreStates=new Map;async readState(t,e,r){if(this.logger.info("Read state for",{contractTxId:this._contractTxId,sortKeyOrBlockHeight:t}),!this.isRoot()&&t==null)throw new Error("SortKey MUST be always set for non-root contract calls");let{stateEvaluator:i}=this.warp,o=typeof t=="number"?this._sorter.generateLastSortKey(t):t;if(o&&!this.isRoot()&&this.interactionState().has(this.txId())){let s=this.interactionState().get(this.txId());return new Vt(o,s)}let a=await this._mutex.acquire();try{let s=Ct.measure();this.maybeResetRootContract();let l=await this.createExecutionContext(this._contractTxId,o,!1,r);this.logger.info("Execution Context",{srcTxId:l.contractDefinition?.srcTxId,missingInteractions:l.sortedInteractions?.length,cachedSortKey:l.cachedState?.sortKey}),s.stop();let g=Ct.measure(),v=await i.eval(l);g.stop();let A=s.elapsed(!0)+g.elapsed(!0);return this._benchmarkStats={gatewayCommunication:s.elapsed(!0),stateEvaluation:g.elapsed(!0),total:A},this.logger.info("Benchmark",{"Gateway communication  ":s.elapsed(),"Contract evaluation    ":g.elapsed(),"Total:                 ":`${A.toFixed(0)}ms`}),o&&!this.isRoot()&&this.interactionState().update(this.txId(),v.cachedValue),v}finally{a()}}async readStateFor(t,e){return this.readState(t,void 0,e)}async viewState(t,e=[],r=xr,i){return this.logger.info("View state for",this._contractTxId),await this.callContract(t,"view",i,void 0,e,r)}async viewStateForTx(t,e){return this.logger.info(`View state for ${this._contractTxId}`),await this.doApplyInputOnTx(t,e,"view")}async dryWrite(t,e,r,i,o){return this.logger.info("Dry-write for",this._contractTxId),await this.callContract(t,"write",e,void 0,r,i,void 0,o)}async applyInput(t,e){return this.logger.info(`Apply-input from transaction ${e.id} for ${this._contractTxId}`),await this.doApplyInputOnTx(t,e,"write")}async writeInteraction(t,e){if(this.logger.info("Write interaction",{input:t,options:e}),!this._signature)throw new Error("Wallet not connected. Use 'connect' method first.");let{arweave:r,interactionsLoader:i,environment:o}=this.warp;await this.warp.definitionLoader.load(this._contractTxId);let a=e?.tags||[],s=e?.transfer||xr,l=e?.strict===!0,g=e?.vrf===!0,v=e?.disableBundling===!0,A=e?.reward,B=i.type()=="warp"&&!v;if(this._signature.checkNonArweaveSigningAvailability(B),this._signature.checkBundlerSignerAvailability(B),B&&s.target!=xr.target&&s.winstonQty!=xr.winstonQty)throw new Error("Ar Transfers are not allowed for bundled interactions");if(g&&!B&&o==="mainnet")throw new Error("Vrf generation is only available for bundle interaction");if(!t)throw new Error(`Input should be a truthy value: ${JSON.stringify(t)}`);if(B)return await this.bundleInteraction(t,{tags:a,strict:l,vrf:g});{let m=await this.createInteraction(t,a,s,l,!1,g&&o!=="mainnet",A),E=await r.transactions.post(m);if(E.status!==200)return this.logger.error("Error while posting transaction",E),null;if(this._evaluationOptions.waitForConfirmation){this.logger.info("Waiting for confirmation of",m.id);let N=Ct.measure();await this.waitForConfirmation(m.id),this.logger.info("Transaction confirmed after",N.elapsed())}return this.warp.environment=="local"&&this._evaluationOptions.mineArLocalBlocks&&await this.warp.testing.mineBlock(),{originalTxId:m.id}}}async bundleInteraction(t,e){this.logger.info("Bundle interaction input",t);let r=await this.createInteractionDataItem(t,e.tags,xr,e.strict,e.vrf),i=this._warpFetchWrapper.fetch(`${Me(this._evaluationOptions.sequencerUrl)}/gateway/v2/sequencer/register`,{method:"POST",headers:{"Content-Type":"application/octet-stream",Accept:"application/json"},body:r.getRaw()}),o=await r.id;return{bundlrResponse:await $e(i),originalTxId:o}}async createInteractionDataItem(t,e,r,i,o=!1){this._evaluationOptions.internalWrites&&await this.discoverInternalWrites(t,e,r,i,o),o&&e.push(new jt(pt.REQUEST_VRF,"true"));let a=ra(this._contractTxId,t,this.warp.environment==="testnet",e);if(Wc(a))throw new Error("Interaction tags exceed limit of 4096 bytes.");let s=Math.random().toString().slice(-4),l=this._signature.bundlerSigner;if(!l)throw new Error("Signer not set correctly. If you connect wallet through 'use_wallet', please remember that it only works when bundling is disabled.");let g;return qr()&&l.signer?.signDataItem?g=await l.signDataItem(s,a):(g=Mc(s,l,{tags:a}),await g.sign(l)),!this._evaluationOptions.internalWrites&&i&&await this.checkInteractionInStrictMode(g.owner,t,e,r,i,o),g}async createInteraction(t,e,r,i,o=!1,a=!1,s){this._evaluationOptions.internalWrites&&await this.discoverInternalWrites(t,e,r,i,a),a&&e.push(new jt(pt.REQUEST_VRF,"true"));let l=await ea(this.warp.arweave,this._signature.signer,this._contractTxId,t,e,r.target,r.winstonQty,o,this.warp.environment==="testnet",s);return!this._evaluationOptions.internalWrites&&i&&await this.checkInteractionInStrictMode(l.owner,t,e,r,i,a),l}async checkInteractionInStrictMode(t,e,r,i,o,a){let{arweave:s}=this.warp,l=this._signature.type=="arweave"?await s.wallets.ownerToAddress(t):t,g=await this.callContract(e,"write",l,void 0,r,i,o,a);if(g.type!=="ok")throw Error("Cannot create interaction: "+JSON.stringify(g.error||g.errorMessage))}txId(){return this._contractTxId}getCallStack(){return this._callStack}connect(t){return this._signature=new Di(this.warp,t),this}setEvaluationOptions(t){if(!this.isRoot())throw new Error("Evaluation options can be set only for the root contract");return this._evaluationOptions={...this._evaluationOptions,...t},this}async waitForConfirmation(t){let{arweave:e}=this.warp,r=await e.transactions.getStatus(t);if(r.confirmed===null)this.logger.info(`Transaction ${t} not yet confirmed. Waiting another 20 seconds before next check.`),await ri(2e4),await this.waitForConfirmation(t);else return this.logger.info(`Transaction ${t} confirmed`,r),r}async createExecutionContext(t,e,r=!1,i){let{definitionLoader:o,interactionsLoader:a,stateEvaluator:s}=this.warp,l=Ct.measure(),g=await s.latestAvailableState(t,e);this.logger.debug("cache lookup",l.elapsed()),l.reset();let v=ir.evolvedSrcTxId(g?.cachedValue?.state),A,B,m,E,N=i||[];if(this.logger.debug("Cached state",g,e),g&&g.sortKey==e)this.logger.debug("State fully cached, not loading interactions."),(r||v||i?.length)&&(B=await o.load(t,v),i?.length&&(N=(await this._sorter.sort(i.map(D=>({node:D,cursor:null})))).map(D=>D.node)));else{if(i?.length)throw new Error(`Cannot apply requested interactions at ${e}`);if(B=await o.load(t,v),m=this.resolveEvaluationOptions(B.manifest?.evaluationOptions),m.remoteStateSyncEnabled&&!m.useKVStorage){E=await this.getRemoteContractState(t),g=await this.maybeSyncStateWithRemoteSource(E,e,g);let D=ir.evolvedSrcTxId(g?.cachedValue?.state);D&&D!==B.srcTxId&&(B=await o.load(t,D))}!E&&N.length==0&&(N=await a.load(t,g?.sortKey,this.getToSortKey(e),m)),g?.sortKey&&(N=N.filter(D=>D.sortKey.localeCompare(g?.sortKey)>0)),e&&(N=N.filter(D=>D.sortKey.localeCompare(e)<=0)),this.logger.debug("contract and interactions load",l.elapsed()),this.isRoot()&&N.length&&(this._rootSortKey=N[N.length-1].sortKey)}return B&&(m||(m=this.resolveEvaluationOptions(B.manifest?.evaluationOptions)),this.ecLogger.debug(`Evaluation options ${t}:`,m),A=await this.warp.executorFactory.create(B,m,this.warp,this.interactionState())),{warp:this.warp,contract:this,contractDefinition:B,sortedInteractions:N,evaluationOptions:m||this.evaluationOptions(),handler:A,cachedState:g,requestedSortKey:e}}resolveEvaluationOptions(t){return this.isRoot()?(this._eoEvaluator=new Mi(this.evaluationOptions(),t),this._eoEvaluator.rootOptions):this.getRootEoEvaluator().forForeignContract(t)}async getRemoteContractState(t){if(this.hasDreState(t))return this.getDreState(t);{let e=await this.fetchRemoteContractState(t);return e!=null?this.setDREState(t,e):null}}async fetchRemoteContractState(t){return this._warpFetchWrapper.fetch(`${this._evaluationOptions.remoteStateSyncSource}?id=${t}&events=false`).then(e=>e.ok?e.json():Promise.reject(e)).catch(e=>{throw new Error(`Unable to read contract state from DRE. ${e.status}. ${e.body?.message}`)})}getToSortKey(t){return this._parentContract?.rootSortKey?t?this._parentContract.rootSortKey.localeCompare(t)>0?this._parentContract.rootSortKey:t:this._parentContract.rootSortKey:t}async createExecutionContextFromTx(t,e){let r=e.owner.address,i=e.sortKey;return{...await this.createExecutionContext(t,i,!0),caller:r}}maybeResetRootContract(){this.isRoot()&&(this.logger.debug("Clearing call stack for the root contract"),this._callStack=new Jr(this.txId(),0),this._rootSortKey=null,this.warp.interactionsLoader.clearCache(),this._children=[],this._interactionState=new Fi(this.warp),this._dreStates=new Map)}async callContract(t,e,r,i,o=[],a=xr,s=!1,l=!1,g=!0){this.logger.info("Call contract input",t),this.maybeResetRootContract(),this._signature||this.logger.warn("Wallet not set.");let{arweave:v,stateEvaluator:A}=this.warp,B=await this.createExecutionContext(this._contractTxId,i,!0),m=this.warp.environment=="mainnet"?await this._arweaveWrapper.warpGwBlock():await v.blocks.getCurrent(),E;r?E=r:this._signature?E=await this._signature.getAddress():E="",this.logger.info("effectiveCaller",E),B={...B,caller:E};let N=await A.eval(B);this.logger.info("Current state",N.cachedValue.state);let D={input:t,caller:B.caller,interactionType:e};this.logger.debug("interaction",D);let K=await ea(v,g?this._signature?.signer:void 0,this._contractTxId,t,o,a.target,a.winstonQty,!0,this.warp.environment==="testnet"),X=Oc(K,B.caller,m);if(this.logger.debug("Creating sortKey for",{blockId:X.block.id,id:X.id,height:X.block.height}),X.sortKey=await this._sorter.createSortKey(X.block.id,X.id,X.block.height,!0),X.strict=s,l){_h.default.utils;let nt=this.warp.maybeLoadPlugin("vrf");nt?X.vrf=nt.process().generateMockVrf(X.sortKey):this.logger.warn('Cannot generate mock vrf for interaction - no "warp-contracts-plugin-vrf" attached!')}let j=await this.evalInteraction({interaction:D,interactionTx:X},B,N.cachedValue);return j.type!=="ok"&&this.logger.fatal("Error while interacting with contract",{type:j.type,error:j.errorMessage}),j}async doApplyInputOnTx(t,e,r){this.maybeResetRootContract();let i,o=await this.createExecutionContextFromTx(this._contractTxId,e);!this.isRoot()&&this.interactionState().has(this.txId())?i=new Vt(e.sortKey,this.interactionState().get(this.txId())):(i=await this.warp.stateEvaluator.eval(o),this.interactionState().update(this.txId(),i.cachedValue)),this.logger.debug("callContractForTx - evalStateResult",{result:i.cachedValue.state,txId:this._contractTxId});let s={interaction:{input:t,caller:this._parentContract.txId(),interactionType:r},interactionTx:e},l=await this.evalInteraction(s,o,i.cachedValue);return l.originalValidity=i.cachedValue.validity,l.originalErrorMessages=i.cachedValue.errorMessages,l}async evalInteraction(t,e,r){let i=this.getCallStack().addInteractionData(t),o=Ct.measure();await e.handler.initState(r.state);let a=await e.handler.handle(e,r,t);return i.update({cacheHit:!1,outputState:this._evaluationOptions.stackTrace.saveState?a.state:void 0,executionTime:o.elapsed(!0),valid:a.type==="ok",errorMessage:a.errorMessage,gasUsed:a.gasUsed}),a}parent(){return this._parentContract}callDepth(){return this._callDepth}evaluationOptions(){return this._evaluationOptions}lastReadStateStats(){return this._benchmarkStats}async stateHash(t){let e=ch(t),r=await bh.Crypto.subtle.digest("SHA-256",Q.Buffer.from(e,"utf-8"));return Q.Buffer.from(r).toString("hex")}async syncState(t,e){let{stateEvaluator:r}=this.warp,i=await this._warpFetchWrapper.fetch(`${t}?${new URLSearchParams({id:this._contractTxId,...e})}`).then(o=>o.ok?o.json():Promise.reject(o)).catch(o=>{throw o.body?.message&&this.logger.error(o.body.message),new Error(`Unable to retrieve state. ${o.status}: ${o.body?.message}`)});return await r.syncState(this._contractTxId,i.sortKey,i.state,i.validity),this}async evolve(t,e){return await this.writeInteraction({function:"evolve",value:t},e)}get rootSortKey(){return this._rootSortKey}getRootEoEvaluator(){return this.getRoot()._eoEvaluator}isRoot(){return this._parentContract==null}async getStorageValues(t){let e=await this.warp.stateEvaluator.getCache().getLast(this.txId());if(e==null)return new Vt(null,new Map);let r=this.warp.kvStorageFactory(this.txId()),i=new Map;try{await r.open();for(let o of t){let a=await r.getLessOrEqual(o,e.sortKey);i.set(o,a==null?null:a.cachedValue)}return new Vt(e.sortKey,i)}finally{await r.close()}}interactionState(){return this.getRoot()._interactionState}getRoot(){let t=this;for(;!t.isRoot();)t=t.parent();return t}async maybeSyncStateWithRemoteSource(t,e,r){let{stateEvaluator:i}=this.warp;return this.isStateHigherThanAndUpTo(t,r?.sortKey,e)?await i.syncState(this._contractTxId,t.sortKey,t.cachedValue.state,t.cachedValue.validity):r}isStateHigherThanAndUpTo(t,e,r){return t&&(!r||r>=t.sortKey)&&(!e||t.sortKey>e)}setDREState(t,e){let r=new Vt(e.sortKey,new $t(e.state,{},e.errorMessages));return this.getRoot()._dreStates.set(t,r),r}getDreState(t){return this.getRoot()._dreStates.get(t)}hasDreState(t){return this.getRoot()._dreStates.has(t)}async discoverInternalWrites(t,e,r,i,o){let a=await this.callContract(t,"write",void 0,void 0,e,r,i,o,!1);if(i&&a.type!=="ok")throw Error("Cannot create interaction: "+JSON.stringify(a.error||a.errorMessage));let s=this.getCallStack(),l=this._innerWritesEvaluator.eval(s);this.logger.debug("Input",t),this.logger.debug("Callstack",s.print()),l.forEach(g=>{e.push(new jt(pt.INTERACT_WRITE,g))}),this.logger.debug("Tags with inner calls",e)}};R();var Ki=class extends Zr{async currentBalance(t){let e=await this.viewState({function:"balance",target:t});if(e.type!=="ok")throw Error(e.errorMessage);return e.result}async currentState(){return(await super.readState()).cachedValue.state}async transfer(t,e){return await this.writeInteraction({function:"transfer",...t},e)}};R();var fa=class{constructor(t){this.arweave=t}async mineBlock(){this.validateEnv(),await this.arweave.api.get("mine")}async addFunds(t){let e=await this.arweave.wallets.getAddress(t);await this.arweave.api.get(`/mint/${e}/1000000000000000`)}async isArlocal(){return(await fetch(`${this.arweave.api.config.protocol}://${this.arweave.api.config.host}:${this.arweave.api.config.port}/info`).then(e=>e.ok?e.json():Promise.reject()).catch(e=>{throw new Error(`Unable to get network info: ${e.message}`)})).network.includes("arlocal")}async validateEnv(){if(!await this.isArlocal())throw new Error("Testing features are not available in a non testing environment")}};R();R();var ha=class{constructor(t,e){this.baseImplementation=t;this.sourceCode=e}async create(t,e,r,i){return Object.prototype.hasOwnProperty.call(this.sourceCode,t.txId)&&(t={...t,src:this.sourceCode[t.txId]}),await this.baseImplementation.create(t,e,r,i)}};var Vi=class{constructor(t,e,r="custom"){this._arweave=t;this._stateCache=e;this._environment=r}_definitionLoader;_interactionsLoader;_executorFactory;_stateEvaluator;setDefinitionLoader(t){return this._definitionLoader=t,this}setInteractionsLoader(t){return this._interactionsLoader=t,this}setExecutorFactory(t){return this._executorFactory=t,this}setStateEvaluator(t){return this._stateEvaluator=t,this}overwriteSource(t){if(this._executorFactory==null)throw new Error("Set base ExecutorFactory first");return this._executorFactory=new ha(this._executorFactory,t),this.build()}useWarpGateway(t,e){this._interactionsLoader=new Tn(new ii(t.confirmationStatus,t.source));let r=new De({...e,dbLocation:`${e.dbLocation}/contracts`}),i=new De({...e,dbLocation:`${e.dbLocation}/source`});return this._definitionLoader=new Ci(this._arweave,r,i,this._environment),this}useArweaveGateway(){return this._definitionLoader=new Qr(this._arweave,this._environment),this._interactionsLoader=new Tn(new Ii(this._arweave,this._environment)),this}build(){let t=new tn(this._arweave,this._definitionLoader,this._interactionsLoader,this._executorFactory,this._stateEvaluator,this._environment);return this._definitionLoader.warp=t,this._interactionsLoader.warp=t,t}};R();var Fc=["^smartweave-extension-"],Kc=["evm-signature-verification","subscription","ivm-handler-api","evaluation-progress","fetch-options","deploy","contract-blacklist","vm2","vrf"];var tn=class{constructor(t,e,r,i,o,a="custom"){this.arweave=t;this.definitionLoader=e;this.interactionsLoader=r;this.executorFactory=i;this.stateEvaluator=o;this.environment=a;this.testing=new fa(t),this.kvStorageFactory=s=>new De({inMemory:!1,dbLocation:`${ga}/kv/ldb/${s}`})}_createContract;_gwUrl=Vc;get createContract(){if(!this._createContract)if(this.plugins.has("deploy")){let t=this.loadPlugin("deploy");this._createContract=t.process(this)}else throw new Error("In order to use CreateContract methods please attach DeployPlugin.");return this._createContract}testing;kvStorageFactory;whoAmI;plugins=new Map;static builder(t,e,r){return new Vi(t,e,r)}contract(t,e,r){return new Zr(t,this,e,r)}async deploy(t,e){return await this.createContract.deploy(t,e)}async deployFromSourceTx(t,e){return await this.createContract.deployFromSourceTx(t,e)}async deployBundled(t){return await this.createContract.deployBundled(t)}async register(t,e){return await this.createContract.register(t,e)}async createSource(t,e,r=!1){return await this.createContract.createSource(t,e,r)}async saveSource(t,e){return await this.createContract.saveSource(t,e)}pst(t){return new Ki(t,this)}useStateCache(t){return this.stateEvaluator.setCache(t),this}useContractCache(t,e){return this.definitionLoader.setSrcCache(e),this.definitionLoader.setCache(t),this}use(t){let e=t.type();if(!this.isPluginType(e))throw new Error(`Unknown plugin type ${e}.`);return this.plugins.set(e,t),this}hasPlugin(t){return this.plugins.has(t)}matchPlugins(t){return[...this.plugins.keys()].filter(r=>r.match(t))}loadPlugin(t){if(!this.hasPlugin(t))throw new Error(`Plugin ${t} not registered.`);return this.plugins.get(t)}maybeLoadPlugin(t){return this.hasPlugin(t)?this.plugins.get(t):null}async close(){return Promise.all([this.definitionLoader.getSrcCache().close(),this.definitionLoader.getCache().close(),this.stateEvaluator.getCache().close()]).then()}async generateWallet(){let t=await this.arweave.wallets.generate();return await this.testing.isArlocal()&&await this.testing.addFunds(t),{jwk:t,address:await this.arweave.wallets.jwkToAddress(t)}}isPluginType(t){return Kc.includes(t)||Fc.some(e=>t.match(e))}useKVStorageFactory(t){return this.kvStorageFactory=t,this}useGwUrl(t){return this._gwUrl=t,this}gwUrl(){return this._gwUrl}};var pa={confirmationStatus:{notCorrupted:!0},source:"both"},Vc="https://gw.warp.cc",ga="./cache/warp",On={inMemory:!1,dbLocation:ga},Gc=class{static forLocal(t=1984,e=da.default.init({host:"localhost",port:t,protocol:"http"}),r={...On,inMemory:!0}){return this.customArweaveGw(e,r,"local")}static forTestnet(t=On,e=!1,r=da.default.init({host:"arweave.net",port:443,protocol:"https"})){return e?this.customArweaveGw(r,t,"testnet"):this.customWarpGw(r,pa,t,"testnet")}static forMainnet(t=On,e=!1,r=da.default.init({host:"arweave.net",port:443,protocol:"https"})){return e?this.customArweaveGw(r,t,"mainnet"):this.customWarpGw(r,pa,t,"mainnet")}static custom(t,e,r){let i=new De({...e,dbLocation:`${e.dbLocation}/state`}),o=new Pi(t),a=new ki(t,i,[new ir]);return tn.builder(t,i,r).setExecutorFactory(o).setStateEvaluator(a)}static customArweaveGw(t,e=On,r){return this.custom(t,e,r).useArweaveGateway().build()}static customWarpGw(t,e=pa,r=On,i){return this.custom(t,r,i).useWarpGateway(e,r).build()}};R();function Iw(n){let t=/(const|var) ret = makeMutClosure\(arg0, arg1, (\d+?), __wbg_adapter/;return n.match(t)[2]}R();function Se(n,t,e=void 0){let r=n.find(({name:i})=>i===t);return r?r.value:e}var Gi=class{constructor(t){this.env=t}arweaveWrapper;arweaveTransactions;logger=dt.INST.create(Gi.name);async load(t,e){let r=Ct.measure(),i=await this.arweaveTransactions.transaction(t);this.logger.debug("Contract tx fetch time",r.elapsed());let o=i.owner.address,a=e||Se(i.tags,kt.CONTRACT_SRC_TX_ID),s=Se(i.tags,pt.WARP_TESTNET)||null;if(s&&this.env!=="testnet")throw new Error('Trying to use testnet contract in a non-testnet env. Use the "forTestnet" factory method.');if(!s&&this.env==="testnet")throw new Error("Trying to use non-testnet contract in a testnet env.");let l=Se(i.tags,kt.MIN_FEE),g=Se(i.tags,pt.MANIFEST)?JSON.parse(Se(i.tags,pt.MANIFEST)):null;this.logger.debug("Tags decoding",r.elapsed());let v=await this.evalInitialState(i);this.logger.debug("init state",v);let A=JSON.parse(v);this.logger.debug("Parsing src and init state",r.elapsed());let{src:B,srcBinary:m,srcWasmLang:E,contractType:N,metadata:D,srcTx:K}=await this.loadContractSource(a),X={txId:t,srcTxId:a,src:B,srcBinary:m,srcWasmLang:E,initState:A,minFee:l,owner:o,contractType:N,metadata:D,manifest:g,contractTx:await this.convertToWarpCompatibleContractTx(i),srcTx:await this.convertToWarpCompatibleContractTx(K),testnet:s};return this.logger.info(`Contract definition loaded in: ${r.elapsed()}`),X}async convertToWarpCompatibleContractTx(t){return{tags:t.tags.map(({name:r,value:i})=>({name:Q.Buffer.from(r).toString("base64url"),value:Q.Buffer.from(i).toString("base64url")})),owner:t.owner.key,target:t.recipient,signature:t.signature,data:(await this.arweaveWrapper.txData(t.id)).toString("base64url")}}async loadContractSource(t){let e=Ct.measure(),r=await this.arweaveTransactions.transaction(t),i=Se(r.tags,kt.CONTENT_TYPE);if(!ci.includes(i))throw new Error(`Contract source content type ${i} not supported`);let o=i==="application/javascript"?"js":"wasm",a=o==="js"?await this.arweaveWrapper.txDataString(t):await this.arweaveWrapper.txData(t),s,l,g;if(o=="wasm"){if(l=new rr(a),s=Se(r.tags,pt.WASM_LANG),!s)throw new Error(`Wasm lang not set for wasm contract src ${t}`);g=JSON.parse(Se(r.tags,pt.WASM_META))}return this.logger.debug("Contract src tx load",e.elapsed()),e.reset(),{src:o=="js"?a:null,srcBinary:o=="wasm"?l.wasmBinary():null,srcWasmLang:s,contractType:o,metadata:g,srcTx:r}}async evalInitialState(t){if(Se(t.tags,pt.INIT_STATE))return Se(t.tags,pt.INIT_STATE);if(Se(t.tags,pt.INIT_STATE_TX)){let e=Se(t.tags,pt.INIT_STATE_TX);return this.arweaveWrapper.txDataString(e)}else return this.arweaveWrapper.txDataString(t.id)}setCache(){throw new Error("Method not implemented.")}setSrcCache(){throw new Error("Method not implemented.")}getCache(){throw new Error("Method not implemented.")}getSrcCache(){throw new Error("Method not implemented.")}type(){return"arweave"}set warp(t){this.arweaveWrapper=new te(t),this.arweaveTransactions=new Fe(t)}};R();var Eh=100,Aw=100,Sh=1057409,Bn=class{constructor(t,e){this.arweave=t;this.environment=e;this.sorter=new nr(t)}logger=dt.INST.create(Bn.name);arweaveFetcher;arweaveWrapper;_warp;sorter;tagsParser=new Ht;async load(t,e,r,i){this.logger.debug("Loading interactions for",{contractId:t,fromSortKey:e,toSortKey:r});let o=this.sorter.extractBlockHeight(e)||0,a=this.sorter.extractBlockHeight(r)||await this.currentBlockHeight(),s={tags:[{name:kt.APP_NAME,values:["SmartWeaveAction"]},{name:kt.CONTRACT_TX_ID,values:[t]},{name:pt.SEQUENCER,values:["RedStone"]}],blockFilter:{min:o,max:a+Aw},first:Eh},l=Ct.measure(),g=await this.arweaveFetcher.transactions(s);i.internalWrites&&(g=await this.appendInternalWriteInteractions(t,o,a,g)),l.stop(),this.logger.debug("All loaded interactions:",{from:e,to:r,loaded:g.length,time:l.elapsed()}),g.forEach(m=>{m.node.sortKey=m.node.sortKey??m.node?.tags?.find(E=>E.name===pt.SEQUENCER_SORT_KEY)?.value});let v=await this.sorter.sort(g),A=this.environment==="local"||this.environment==="testnet",B=this._warp.maybeLoadPlugin("vrf");return v.filter(m=>this.isNewerThenSortKeyBlockHeight(m)).filter(m=>this.isSortKeyInBounds(e,r,m)).map(m=>this.attachSequencerDataToInteraction(m)).map(m=>this.maybeAddMockVrf(A,m,B)).map((m,E,N)=>this.verifySortKeyIntegrity(m,E,N)).map(({node:m})=>m)}verifySortKeyIntegrity(t,e,r){if(e!==0){let i=r[e-1],o=r[e];if(this.logger.debug(`prev: ${i.node.id} | current: ${o.node.id}`),o.node.block.height<=Sh||o.node.lastSortKey?.split(",")[1]===Jo)return t;i.node.source==="redstone-sequencer"&&i.node.sortKey!==o.node.lastSortKey&&this.logger.warn(`Interaction loading error: interaction ${o.node.id} lastSortKey is not pointing on prev interaction ${i.node.id}`)}return t}isSortKeyInBounds(t,e,r){return t&&e?r.node.sortKey.localeCompare(t)>0&&r.node.sortKey.localeCompare(e)<=0:t&&!e?r.node.sortKey.localeCompare(t)>0:!t&&e?r.node.sortKey.localeCompare(e)<=0:!0}attachSequencerDataToInteraction(t){let e=A=>t.node.tags.find(B=>B.name===A)?.value,r=e(pt.SEQUENCER_TX_ID),i=e(pt.SEQUENCER_OWNER),o=e(pt.SEQUENCER_BLOCK_ID),a=e(pt.SEQUENCER_BLOCK_HEIGHT),s=e(pt.SEQUENCER_PREV_SORT_KEY)||e(pt.SEQUENCER_LAST_SORT_KEY),l=e(pt.SEQUENCER_SORT_KEY),g=e(pt.SEQUENCER_BLOCK_TIMESTAMP),v=ni(a);if(!i||!o||!a||!s&&v>Sh||!r||!l)throw Error(`Interaction ${t.node.id} is not sequenced by sequencer aborting. Only Sequenced transactions are supported by loader ${Bn.name}`);return{...t,node:{...t.node,owner:{address:i,key:null},block:{...t.node.block,height:ni(a),id:o,timestamp:g?ni(g):t.node.block.timestamp},sortKey:l,lastSortKey:s,id:r,source:"redstone-sequencer"}}}async appendInternalWriteInteractions(t,e,r,i){let o={tags:[{name:pt.INTERACT_WRITE,values:[t]}],blockFilter:{min:e,max:r},first:Eh},a=await this.arweaveFetcher.transactions(o);return this.logger.debug("Inner writes interactions length:",a.length),i=i.concat(a),i}maybeAddMockVrf(t,e,r){return t&&this.tagsParser.hasVrfTag(e.node)&&(r?e.node.vrf=r.process().generateMockVrf(e.node.sortKey):this.logger.warn('Cannot generate mock vrf for interaction - no "warp-contracts-plugin-vrf" attached!')),e}isNewerThenSortKeyBlockHeight(t){if(t.node.sortKey){let e=t.node.sortKey.split(",")[0],r=Number.parseInt(e);return Number(t.node.block.height)-r>=0}return!0}async currentBlockHeight(){return(await this.arweaveWrapper.info()).height}type(){return"arweave"}clearCache(){}set warp(t){this.arweaveWrapper=new te(t),this.arweaveFetcher=new Fe(t),this._warp=t}};return Bh(kw);})();
/*! Bundled license information:

ieee754/index.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)

buffer/index.js:
  (*!
   * The buffer module from node.js, for the browser.
   *
   * @author   Feross Aboukhadijeh <https://feross.org>
   * @license  MIT
   *)

queue-microtask/index.js:
  (*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

run-parallel-limit/index.js:
  (*! run-parallel-limit. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

warp-arbundles/build/web/esm/bundle.js:
  (*! Bundled license information:
  
  ieee754/index.js:
    (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)
  
  buffer/index.js:
    (*!
     * The buffer module from node.js, for the browser.
     *
     * @author   Feross Aboukhadijeh <https://feross.org>
     * @license  MIT
     *)
  *)
*/
